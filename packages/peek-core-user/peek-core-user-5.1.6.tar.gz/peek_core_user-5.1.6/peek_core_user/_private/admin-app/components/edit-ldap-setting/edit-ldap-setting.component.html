<nz-card nzTitle="Edit LDAP Settings">
    <div class="card-content">
        <p *ngIf="(items$ | async)?.length === 0" class="empty-message">
            There are no LDAP Settings, Please create one with the Add button
        </p>

        <div class="ldap-form">
            <div *ngFor="let item of items$ | async" class="ldap-item">
                <div class="row">
                    <nz-form-item>
                        <nz-form-label>Title</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapTitle" 
                                required
                                placeholder="Enter LDAP title"
                            />
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label>URI</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapUri" 
                                required
                                placeholder="Enter LDAP URI"
                            />
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label>Domain</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapDomain" 
                                required
                                placeholder="Enter LDAP domain"
                            />
                        </nz-form-control>
                    </nz-form-item>

                    <button 
                        nz-button 
                        nzType="text" 
                        nzDanger
                        class="delete-button"
                        nz-popconfirm
                        nzPopconfirmTitle="Are you sure you want to delete this item?"
                        (nzOnConfirm)="removeRow(item)"
                    >
                        <i nz-icon nzType="delete"></i>
                    </button>
                </div>

                <div class="row">
                    <nz-form-item>
                        <nz-form-label>CN Folders</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapCNFolders" 
                                required
                                placeholder="Enter CN folders"
                            />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="row">
                    <nz-form-item>
                        <nz-form-label>OU Folders</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapOUFolders" 
                                required
                                placeholder="Enter OU folders"
                            />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="row">
                    <nz-form-item>
                        <nz-form-label>Groups</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapGroups" 
                                required
                                placeholder="Enter LDAP groups"
                            />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="row">
                    <nz-form-item>
                        <nz-form-label>Agent Host</nz-form-label>
                        <nz-form-control>
                            <input 
                                nz-input 
                                [(ngModel)]="item.agentHost"
                                placeholder="Enter agent host"
                            />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <!-- Email Authentication Section -->
                <div class="row">
                    <nz-form-item>
                        <nz-form-label>Service Username</nz-form-label>
                        <nz-form-control nzHasFeedback>
                            <input 
                                nz-input 
                                [(ngModel)]="item.ldapServiceUsername"
                                placeholder="Service account username (e.g., SVC_PEEK_LDAP)"
                            />
                            <small class="form-help-text">Service account for email address lookups</small>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="row">
                    <nz-form-item>
                        <nz-form-label>Service Password</nz-form-label>
                        <nz-form-control nzHasFeedback>
                            <input 
                                nz-input 
                                type="password"
                                [(ngModel)]="item.ldapServicePassword"
                                placeholder="Service account password"
                            />
                            <small class="form-help-text">Password for the service account</small>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div class="row switches">
                    <div class="switch-item">
                        <span>For Admin</span>
                        <nz-switch [(ngModel)]="item.adminEnabled"></nz-switch>
                    </div>
                    <div class="switch-item">
                        <span>For Office</span>
                        <nz-switch [(ngModel)]="item.desktopEnabled"></nz-switch>
                    </div>
                    <div class="switch-item">
                        <span>For Field</span>
                        <nz-switch [(ngModel)]="item.mobileEnabled"></nz-switch>
                    </div>
                    <div class="switch-item">
                        <span>Allow Email Login</span>
                        <nz-switch [(ngModel)]="item.allowEmailLogin"></nz-switch>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-footer">
            <nz-space>
                <button *nzSpaceItem nz-button nzType="primary" (click)="save()">
                    <i nz-icon nzType="save"></i>
                    Save
                </button>
                <button *nzSpaceItem nz-button nzType="default" (click)="loader.load()">
                    <i nz-icon nzType="reload"></i>
                    Reset
                </button>
                <button *nzSpaceItem nz-button nzType="default" (click)="addRow()">
                    <i nz-icon nzType="plus"></i>
                    Add
                </button>
            </nz-space>
        </div>
    </div>
</nz-card>