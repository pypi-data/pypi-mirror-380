version: 1.0.0

experiment:
  name: Dichtung4Gates
  description: Optimization of Dichtung case with 4 gates
  parameter_constraints: []
  parameters:
  - name: machineRampFactor
    bounds: [1.0, 100.0]
    scaling: log
    parameter_type: float
  - name: injectionToggleTimeGate1
    bounds: [0.0, 6.0]
    parameter_type: float
  - name: injectionToggleTimeGate2
    bounds: [0.0, 6.0]
    parameter_type: float
  - name: injectionToggleTimeGate3
    bounds: [0.0, 6.0]
    parameter_type: float
  - name: injectionToggleTimeGate4
    bounds: [0.0, 6.0]
    parameter_type: float
  - name: injectionRateGate1
    bounds: [0.0, 1.915102]
    parameter_type: float
  - name: injectionRateGate2
    bounds: [0.0, 1.915102]
    parameter_type: float
  - name: injectionRateGate3
    bounds: [0.0, 1.915102]
    parameter_type: float
  - name: injectionRateGate4
    bounds: [0.0, 1.915102]
    parameter_type: float
  - name: injectionInitialStateGate1
    parameter_type: str
    values: ["on", "off"]
  - name: injectionInitialStateGate2
    parameter_type: str
    values: ["on", "off"]
  - name: injectionInitialStateGate3
    parameter_type: str
    values: ["on", "off"]
  - name: injectionInitialStateGate4
    parameter_type: str
    values: ["on", "off"]

trial_generation:
  method: fast

existing_trials:
  file_path: ''

baseline:
  parameters:
    machineRampFactor: 10.0
    injectionToggleTimeGate1: 1.0
    injectionToggleTimeGate2: 1.0
    injectionToggleTimeGate3: 1.0
    injectionToggleTimeGate4: 1.0
    injectionRateGate1: 1.9
    injectionRateGate2: 1.9
    injectionRateGate3: 1.9
    injectionRateGate4: 1.9
    injectionInitialStateGate1: "on"
    injectionInitialStateGate2: "off"
    injectionInitialStateGate3: "on"
    injectionInitialStateGate4: "off"

optimization:
  metrics:
  - name: weldline
    command: [ "./metric_from_log.sh", "local", "weldline" ]
    progress: [ "./metric_from_log.sh", "local", "weldline" ]
  - name: balancedFilling
    command: [ "./metric_from_log.sh", "local", "balancedFilling" ]
    progress: [ "./metric_from_log.sh", "local", "balancedFilling" ]
  - name: maxInletPressure
    command: [ "./metric_from_log.sh", "local", "maxInletPressure" ]
    progress: [ "./metric_from_log.sh", "local", "maxInletPressure" ]
  - name: fillTime
    command: [ "./metric_from_log.sh", "local", "fillTime" ]
    progress: [ "./metric_from_log.sh", "local", "fillTime" ]
  objective: "-weldline, -balancedFilling, -maxInletPressure, -fillTime"
  outcome_constraints:
  - "maxInletPressure <= 2e7"
  - "weldline <= 60"
  - "balancedFilling <= 0.1"
  - "fillTime <= 3.6"
  case_runner:
    template_case: ./4GateDesign
    mode: local # or: remote
    runner: "./Allrun.fe5" # or: ./run_on_cluster.sh or: ./Allrun <path-to-container>
    remote_status_query: "" # or: ./state_on_cluster.sh
    remote_early_stop: "" # or: docker exec slurm-head scancel --name $CASE_NAME
    trial_destination: ./trials
    artifacts_folder: ./artifacts
    file_substitution: []
    variable_substitution:
    - file: /constant/gateSettings
      parameter_scopes:
        machineRampFactor: machineRampFactor
        injectionToggleTimeGate1: gate1.injectionToggleTime
        injectionToggleTimeGate2: gate2.injectionToggleTime
        injectionToggleTimeGate3: gate3.injectionToggleTime
        injectionToggleTimeGate4: gate4.injectionToggleTime
        injectionRateGate1: gate1.injectionRate
        injectionRateGate2: gate2.injectionRate
        injectionRateGate3: gate3.injectionRate
        injectionRateGate4: gate4.injectionRate
        injectionInitialStateGate1: gate1.injectionInitialState
        injectionInitialStateGate2: gate2.injectionInitialState
        injectionInitialStateGate3: gate3.injectionInitialState
        injectionInitialStateGate4: gate4.injectionInitialState

orchestration_settings:
  max_trials: 300
  parallelism: 4
  global_stopping_strategy:
    improvement_bar: 0.1
    min_trials: 30
    window_size: 10
  early_stopping_strategy:
    type: or
    left:
      type: percentile
      metric_names: [ "weldline" ]
      min_progression: 7
      percentile_threshold: 25
      trial_indices_to_ignore: !range [0, 30]
    right:
      type: percentile
      metric_names: [ "balancedFilling" ]
      min_progression: 10
      percentile_threshold: 15
      trial_indices_to_ignore: !range [0, 30]
  initial_seconds_between_polls: 60
  seconds_between_polls_backoff_factor: 1.0
  timeout_hours: 48
  ttl_seconds_for_trials: 2400

store:
  read_from: nowhere
  save_to: json
  backend_options:
    url: 'null'
