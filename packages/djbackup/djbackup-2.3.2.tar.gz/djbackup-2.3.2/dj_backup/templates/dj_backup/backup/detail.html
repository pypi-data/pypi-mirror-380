{% extends 'dj_backup/base/base_template.html' %}

{% block Title %}
    detail - {{ backup.name }}
{% endblock %}

{% block BodyClass %}
    has-rtl nk-body npc-apps apps-only has-apps-sidebar npc-apps-files
{% endblock %}

{% block Style %}
    <style>

        .nk-file-details-row .nk-file-details-col:last-of-type {
            color: #aab5c4;
        }

        @media screen and (max-width: 768px) {
            .data-value {
                display: block !important;
                text-align: center;
                margin: 5px auto;
            }
        }

    </style>
{% endblock %}

{% block Content %}

    <div class="nk-app-root">
    <!-- main @s -->
    <div class="nk-main">
        <!-- wrap @s -->
        <div class="nk-wrap">
            <!-- main header @s -->
            {% include 'dj_backup/base/header.html' %}
            <!-- main header @e -->
            <!-- content @s -->
            <div class="nk-content p-0">
                <div class="nk-content-inner">
                    <div class="nk-content-body">
                        <div class="nk-fmg">
                            {% include 'dj_backup/base/menu-aside.html' %}
                            <!-- .nk-fmg-aside -->
                            <div class="nk-fmg-body">

                                <div class="nk-fmg-body-content">
                                    <div class="nk-block-head nk-block-head-md">
                                        <div class="nk-block-between position-relative">
                                            <div class="nk-block-head-content mb-3">
                                                <h3 class="nk-block-title page-title">
                                                    {{ backup.name }}
                                                    |
                                                    detail
                                                </h3>
                                            </div>
                                        </div>
                                        <!-- .nk-block -->
                                    </div>

                                    <div class="nk-block col-12 col-md-10 col-lg-7 col-lg-9 mx-auto">
                                        <div class="drodown text-end mb-2">
                                            <a href="#"
                                               class="dropdown-toggle btn btn-icon btn-secondary px-2 text-center"
                                               data-bs-toggle="dropdown" aria-expanded="false">
                                                action
                                                <em class="icon ni ni-setting"></em>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <ul class="link-list-opt no-bdr">
                                                    {% if backup.has_storage %}
                                                        {% if not backup.is_running %}
                                                            <li>
                                                                <button type="button" class="btn text-success"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#modal-start-running">Start
                                                                    backup
                                                                </button>
                                                            </li>
                                                        {% else %}
                                                            <li>
                                                                <button type="button" class="btn text-warning"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#modal-stop-running">Pause
                                                                    backup
                                                                </button>
                                                            </li>
                                                        {% endif %}
                                                        <li>
                                                            <button type="button" class="btn text-info"
                                                                    data-bs-toggle="modal"
                                                                    data-bs-target="#modal-update">Edit
                                                            </button>
                                                        </li>
                                                    {% endif %}
                                                    <li>
                                                        <button type="button" class="btn text-danger"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#modal-delete">Delete
                                                        </button>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="card card-bordered ">

                                            <!-- .nav-tabs -->
                                            <div class="card-inner card-inner-md">
                                                <!-- .nk-block-head -->
                                                <div class="nk-block">
                                                    <div class="nk-data data-list data-list-s2">
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Name</span>
                                                                <span class="data-value">
                                                                        {{ backup.name }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Note</span>
                                                                <span class="data-value">
                                                                    {{ backup.note|default:'-' }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Execution status</span>
                                                                <span class="data-value">
                                                                    {% if backup.is_running %}
                                                                        <span class="badge badge-dot bg-success">
                                                                            is running
                                                                        </span>
                                                                    {% else %}
                                                                        <span class="badge badge-dot bg-danger">
                                                                           paused
                                                                        </span>
                                                                    {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Timing</span>
                                                                <span class="data-value">
                                                                   <span>
                                                                       every
                                                                       <b>
                                                                           {{ backup.interval }}
                                                                           {{ backup.unit_label }}
                                                                       </b>
                                                                   </span>
                                                                </span>
                                                            </div>
                                                        </div>

                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Count of runs</span>
                                                                <span class="data-value">
                                                                    <span class="badge badge-dim bg-warning badge-sm spread-num-el">{{ backup.count_run }}</span>
                                                                </span>
                                                            </div>
                                                        </div>

                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Last run time</span>
                                                                <span class="data-value">
                                                                        <span>{{ backup.get_last_run }}</span>
                                                                    </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Repeats</span>
                                                                <span class="data-value">
                                                                    {% if backup.repeats == -1 %}
                                                                        <span class="badge bg-secondary">forever</span>
                                                                    {% else %}
                                                                        <span class="spread-num-el">{{ backup.repeats }}</span>
                                                                    {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Total size</span>
                                                                <span class="data-value">
                                                                   <span class="file-size-convert"
                                                                         data-size="{{ backup.get_usage_size }}"></span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Store in</span>
                                                                <span class="data-value">
                                                                   {% for storage in backup_storages %}
                                                                       <span class="badge badge-dim bg-success badge-sm m-1">
                                                                            {{ storage.display_name }}
                                                                            (<span class="file-size-convert"
                                                                                   data-size="{{ storage.usage_size }}"></span>)
                                                                            <hr>
                                                                           count:
                                                                            <span class="spread-num-el">{{ storage.count_backup }}</span>
                                                                        </span>
                                                                   {% endfor %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Secure/Encryption</span>
                                                                <span class="data-value">
                                                                   {% if backup.has_secure %}
                                                                       <span class="badge badge-sm badge-dim bg-info">{{ backup.get_secure.encryption_type }}</span>
                                                                   {% else %}
                                                                       <em class="icon ni ni-cross text-warning"></em>
                                                                   {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Keep temporary files</span>
                                                                <span class="data-value">
                                                                    {% if backup.has_temp %}
                                                                        <em class="icon ni ni-check text-success"></em>
                                                                    {% else %}
                                                                        <em class="icon ni ni-cross text-warning"></em>
                                                                    {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        {% if backup.backup_type == 'database' %}
                                                            <div class="data-item">
                                                                <div class="data-col">
                                                                    <span class="data-label">Database name</span>
                                                                    <span class="data-value">
                                                                        {{ backup.database }}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="data-item">
                                                                <div class="data-col">
                                                                    <span class="data-label">Database type</span>
                                                                    <span class="data-value">
                                                                        {{ backup.database_type }}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="data-item">
                                                                <div class="data-col">
                                                                    <span class="data-label">Additional config(args)</span>
                                                                    <span class="data-value">
                                                                        {% for args in backup.get_additional_args %}
                                                                            <span class="badge badge-dim bg-info">{{ args }}</span>
                                                                        {% empty %}
                                                                            <em class="ni ni-cross text-warning"></em>
                                                                        {% endfor %}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        {% else %}
                                                            <div class="data-item">
                                                                <div class="data-col">
                                                                    <span class="data-label">Files</span>
                                                                    <span class="data-value">
                                                                        {% for file in backup.get_files %}
                                                                            <span class="badge badge-dim bg-info m-1"
                                                                                  style="white-space: normal!important;">
                                                                                {{ file.dir }}
                                                                            </span>
                                                                        {% endfor %}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Count of successful results</span>
                                                                <span class="data-value">
                                                                    <span class="badge badge-dim bg-success badge-sm spread-num-el">{{ backup.get_success_results.count }}</span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">Count of unsuccessful results</span>
                                                                <span class="data-value">
                                                                    <span class="badge badge-dim bg-danger badge-sm spread-num-el">{{ backup.get_unsuccessful_results.count }}</span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .nk-block -->
                                            </div>
                                            <!-- .card-inner -->
                                        </div>
                                        <!-- .card -->
                                        <div class="nk-fmg-listing nk-block my-4">
                                            <div class="nk-block-head-content mb-3">
                                                <h4 class="nk-block-title page-title">
                                                    Results
                                                </h4>
                                            </div>
                                            <div class="nk-files nk-files-view-group">
                                                <!-- .nk-files-head -->
                                                <div class="nk-files-group">
                                                    <div class="nk-files-list">
                                                        {% for result in results %}
                                                            <div class="nk-file-item nk-file">
                                                                <div class="nk-file-info">
                                                                    <div class="nk-file-title">
                                                                        <div class="nk-file-icon">
                                                                            {% if result.status == 'successful' %}
                                                                                <em class="icon ni ni-check text-success fs-20px"></em>
                                                                            {% else %}
                                                                                <em class="icon ni ni-cross text-danger fs-20px"></em>
                                                                            {% endif %}
                                                                        </div>
                                                                        <div class="nk-file-name">
                                                                            <div class="nk-file-name-text">
                                                                                <a href="#result-detail-{{ result.id }}"
                                                                                   data-bs-toggle="modal">
                                                                                    {{ result.backup_name|truncatechars:14 }}
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <ul class="nk-file-desc">
                                                                        <li class="date">{{ result.get_created_at }}</li>
                                                                        <li class="size file-size-convert"
                                                                            data-size="{{ result.size }}"></li>
                                                                    </ul>
                                                                </div>
                                                                <div class="nk-file-actions">
                                                                    <div class="dropdown">
                                                                        <a href=""
                                                                           class="dropdown-toggle btn btn-sm btn-icon btn-trigger"
                                                                           data-bs-toggle="dropdown"><em
                                                                                class="icon ni ni-more-h"></em></a>
                                                                        <div class="dropdown-menu dropdown-menu-end">
                                                                            <ul class="link-list-plain no-bdr">
                                                                                <li>
                                                                                    <a href="#result-detail-{{ result.id }}"
                                                                                       data-bs-toggle="modal"><em
                                                                                            class="icon ni ni-eye"></em><span>detail</span></a>
                                                                                </li>
                                                                                <li>
                                                                                    {% with result.get_download_link as download_link %}
                                                                                        {% if download_link %}
                                                                                            <a href="{{ download_link }}"
                                                                                               download="download"
                                                                                               class="file-dl-toast"><em
                                                                                                    class="icon ni ni-download"></em><span>download</span></a>
                                                                                        {% endif %}
                                                                                    {% endwith %}
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% empty %}
                                                            <h6 class="text-warning m-2">No results found</h6>
                                                        {% endfor %}
                                                    </div>
                                                </div>

                                                <div class="card-inner  my-5">
                                                    <div class="nk-block-between-md justify-content-center">
                                                        <div class="g">
                                                            <ul class="pagination justify-content-center justify-content-md-start">
                                                                {% if page_obj.has_previous %}
                                                                    <li class="page-item"><a
                                                                            class="page-link add-params-to-href"
                                                                            href="?page=1">first</a>
                                                                    </li>
                                                                    <li class="page-item"><a
                                                                            class="page-link add-params-to-href"
                                                                            href="?page={{ page_obj.previous_page_number }}">previous</a>
                                                                    </li>
                                                                {% endif %}

                                                                <span class="fs-13px mt-1 mx-2">
                                                                        page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                                                                </span>

                                                                {% if page_obj.has_next %}
                                                                    <li class="page-item"><a
                                                                            class="page-link add-params-to-href"
                                                                            href="?page={{ page_obj.next_page_number }}">next</a>
                                                                    </li>
                                                                    <li class="page-item"><a
                                                                            class="page-link add-params-to-href"
                                                                            href="?page={{ page_obj.paginator.num_pages }}">last</a>
                                                                    </li>
                                                                {% endif %}
                                                            </ul>
                                                            <!-- .pagination -->
                                                        </div>

                                                        <!-- .pagination-goto -->
                                                    </div>
                                                    <!-- .nk-block-between -->
                                                </div>
                                            </div>

                                            <!-- .nk-files -->
                                        </div>
                                    </div>
                                    <!-- .nk-fmg-body-content -->
                                </div>
                                <!-- .nk-fmg-body -->
                            </div>
                            <!-- .nk-fmg -->
                        </div>
                    </div>
                </div>
                <!-- content @e -->
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
    </div>
    <!-- app-root @e -->

    {% for result in results %}
        <div class="modal fade" tabindex="-1" role="dialog" id="result-detail-{{ result.id }}">
            <div class="modal-dialog modal-md" role="document">
                <div class="modal-content">
                    <div class="modal-header align-center">
                        <div class="nk-file-title">
                            <div class="nk-file-icon">
                                <span class="nk-file-icon-type">
                                    <em class="icon ni ni-upload-cloud" style="font-size: 30px"></em>
                                </span>
                            </div>
                            <div class="nk-file-name">
                                <div class="nk-file-name-text"><span class="title">Backup result</span>
                                </div>
                                <div class="nk-file-name-sub">{{ backup.name|truncatechars:20 }}</div>
                            </div>
                        </div>
                        <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                    </div>
                    <div class="modal-body">
                        <div class="nk-file-details">
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Status</div>
                                <div class="nk-file-details-col">
                                    <span class="badge badge-dot {% if result.status == 'successful' %}bg-success{% else %}bg-danger{% endif %}">{{ result.get_status_display }}</span>
                                </div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Store in</div>
                                <div class="nk-file-details-col">{{ result.storage.display_name }}</div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Size</div>
                                <div class="nk-file-details-col">
                                    <span class="file-size-convert" data-size="{{ result.size }}"></span>
                                </div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Time taken</div>
                                <div class="nk-file-details-col">
                                    <span>{{ result.time_taken }}</span>
                                    seconds
                                </div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Backup file name</div>
                                <div class="nk-file-details-col">
                                    {{ result.backup_name }}
                                </div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Result loc(out)</div>
                                <div class="nk-file-details-col">{{ result.out|default:'-' }}</div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Temp location</div>
                                <div class="nk-file-details-col">{{ result.temp_location|default:'-' }}</div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Description</div>
                                <div class="nk-file-details-col">{{ result.description|default:'-' }}</div>
                            </div>
                            <div class="nk-file-details-row">
                                <div class="nk-file-details-col">Creation time</div>
                                <div class="nk-file-details-col">{{ result.get_created_at }}</div>
                            </div>
                        </div>
                    </div>
                    <!-- .modal-body -->
                    <div class="modal-footer modal-footer-stretch bg-light">
                        <div class="modal-footer-between justify-content-end">
                            <div class="g">
                                <ul class="btn-toolbar g-3 text-end">
                                    {% with result.get_download_link as download_link %}
                                        {% if download_link %}
                                            <li><a href="{{ download_link }}" download="download"
                                                   class="btn btn-primary file-dl-toast">Download</a></li>
                                        {% else %}
                                            <li><a class="btn btn-outline-light btn-white" style="cursor:not-allowed;">
                                                The backup is not available for download
                                            </a></li>
                                        {% endif %}
                                    {% endwith %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- .modal-footer -->
                </div>
                <!--.modal-content -->
            </div>
            <!--.modla-dialog -->
        </div>
    {% endfor %}


    <div class="modal fade" tabindex="-1" id="modal-start-running">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Start backup
                    </h5>
                    <a href="#" class="close" data-bs-dismiss="modal" aria-label="close">
                        <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <form method="post"
                          action="{% url 'dj_backup:backup__manage_running_status' backup_id=backup.id %}"
                          class="form-validate is-alter" novalidate="novalidate">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="start">
                        <div class="badge-dim bg-success fs-17px p-2" style="border-radius: 10px">
                            <p>Are you sure you want to run the backup '{{ backup.name }}'?</p>
                        </div>
                        <div class="form-group text-end mt-3">
                            <button type="submit" class="btn btn-lg btn-success p-1 px-2">
                                Yes, start
                                <em class="icon icon-circle ni ni-check bg-success"></em>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="modal-stop-running">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Pause backup
                    </h5>
                    <a href="#" class="close" data-bs-dismiss="modal" aria-label="close">
                        <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <form method="post"
                          action="{% url 'dj_backup:backup__manage_running_status' backup_id=backup.id %}"
                          class="form-validate is-alter" novalidate="novalidate">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="stop">
                        <div class="badge-dim bg-danger fs-17px p-2" style="border-radius: 10px">
                            <p>Are you sure you want to pause the backup '{{ backup.name }}'?</p>
                        </div>
                        <div class="form-group text-end mt-3">
                            <button type="submit" class="btn btn-lg btn-danger p-1 px-2">
                                Yes, pause
                                <em class="icon icon-circle ni ni-cross bg-danger"></em>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="modal-update">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Edit backup
                    </h5>
                    <a href="#" class="close" data-bs-dismiss="modal" aria-label="close">
                        <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <form method="post"
                          action="{% url 'dj_backup:backup__update' backup_id=backup.id %}"
                          class="form-validate is-alter" novalidate="novalidate" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="form-group">
                            <label class="form-label" for="name">Name</label>
                            <div class="form-control-wrap">
                                <input type="text" name="name" class="form-control" id="name"
                                       required=""
                                       placeholder="name" value="{{ backup.name }}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="note">Note</label>
                            <div class="form-control-wrap">
                                    <textarea name="note" id="note"
                                              class="form-control">{{ backup.note|default:'' }}</textarea>
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="form-label" for="backup-time">Timing</label>
                            <div class="form-control-wrap">
                                <div class="form-text-hint">
                                    <p class="overline-title d-inline-block">every</p>
                                    <input type="number" class="form-control" id="interval-time"
                                           placeholder="backup timing" value="{{ backup.interval }}" required name="interval">
                                    <select name="unit" required class="js-select2 overline-title select-by-value"
                                            value="{{ backup.unit }}">
                                        <option value="minutes">minute</option>
                                        <option value="hours">hour</option>
                                        <option value="days">day</option>
                                        <option value="weeks">week</option>
                                    </select>
                                </div>
                            </div>
                            {#                                    <div class="form-note">Interval for backups</div>#}
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="repeats">Number of backups</label>
                            <div class="form-control-wrap">
                                <input type="number" class="form-control" id="repeats"
                                       placeholder="-1" value="{{ backup.repeats }}" required name="repeats">
                            </div>
                            <div class="form-note">Enter '-1' for permanent backup</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Secure/Encryption</label>
                            <div class="form-control-wrap">
                                <select name="encryption_type" class="form-select js-select2 select-by-value" value="{{ backup.get_secure.encryption_type|lower|default:'none' }}"
                                        required>
                                    <option value="none">
                                        None
                                    </option>
                                    {% for enc_type in enc_types %}
                                        <option value="{{ enc_type.0 }}">
                                            {{ enc_type.1 }}({{ enc_type.0 }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-note">
                                <b>Using encryption increases the security of your backup.</b>
                            </div>
                        </div>
                        <div class="form-group {% if not backup.get_secure %}d-none{% endif %}" id="enc_key_form">
                            <label class="form-label" for="enc_key">Encryption Key</label>
                            <div class="form-control-wrap">
                                <input type="text" maxlength="100" class="form-control" id="enc_key"
                                       placeholder="Encryption Key" name="key" value="{{ backup.get_secure.key|default:'' }}">
                            </div>
                            <div class="form-note">
                                <b class="text-danger">Do not share your encryption key with anyone, and make
                                    sure to store it in a secure location..</b>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Store in </label>
                            <div class="form-control-wrap">
                                <select name="storages" class="form-select js-select2" multiple required>
                                    {% for storage in all_storages %}
                                        {% if storage.is_available %}
                                            <option value="{{ storage.id }}"
                                                    {% if storage in backup.get_storages %}selected{% endif %}>{{ storage.display_name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Keep temporary files</label>
                            <div class="form-control-wrap">
                                <select name="has_temp" class="form-select js-select2 select-by-value"
                                        value="{{ backup.has_temp }}"
                                        required>
                                    <option value="true">
                                        Yes
                                    </option>
                                    <option value="false">
                                        No
                                    </option>
                                </select>
                            </div>
                            <div class="form-note">
                                To enable quick and easy access to backups, activate this option.
                                Note:
                                <b>Be aware that enabling file retention will increase disk space usage.</b>
                            </div>
                        </div>

                        <div class="form-group text-left mt-5">
                            <button type="submit" class="btn btn-lg btn-success p-1 px-2">
                                Update backup
                                <em class="icon icon-circle ni ni-pen bg-success"></em>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="modal-delete">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Delete backup
                    </h5>
                    <a href="#" class="close" data-bs-dismiss="modal" aria-label="close">
                        <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <form method="post"
                          action="{% url 'dj_backup:backup__delete' backup_id=backup.id %}"
                          class="form-validate is-alter" novalidate="novalidate">
                        {% csrf_token %}
                        <div class="badge-dim bg-danger fs-17px p-2" style="border-radius: 10px">
                            <p>
                                Are you sure you want to delete the backup '{{ backup.name }}'?
                            </p>
                            <b>There will be no return after deletion</b>
                        </div>
                        <div class="form-group text-end mt-3">
                            <button type="submit" class="btn btn-lg btn-danger p-1 px-2">
                                Yes, I'm sure, delete.
                                <em class="icon icon-circle ni ni-trash-empty bg-danger"></em>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block Script %}
    <script>
        // backup secure/encryption forms
        let enc_key_form = document.getElementById('enc_key_form')

        $('[name="encryption_type"]').on('select2:select', function (e) {
            let t = this.value
            if (t !== 'none') {
                enc_key_form.classList.remove('d-none')
                enc_key_form.querySelector('input').setAttribute('required', 'required')
            } else {
                enc_key_form.classList.add('d-none')
                enc_key_form.querySelector('input').removeAttribute('required')
                enc_key_form.querySelector('input').value = ''
            }
        });
    </script>
    <script>
        document.querySelectorAll('.file-dl-toast').forEach(function (el) {
            el.addEventListener('click', function (e) {
                let href = this.getAttribute('href')
                let link = document.createElement('a')
                link.href = href
                link.download = true
                link.style.display = 'none'
                document.body.appendChild(link)
                link.click()
                link.remove()
            })
        })
    </script>
{% endblock %}