import{j as Ae,m as Ue,u as Pe,k as Be,r as E,s as Se,l as Te,o as Re,n as M,w as d,p as r,q as n,t as Ee,v as h,x as Oe,y as m,z as q,A as v,C as Ve,D as $e,E as k,G as _,H as Fe,J as Me,K as G,N as Ie,O as De,P as J,Q as Le,R as I,_ as H,T as Ne,X as je,Y as K,Z as ze,$ as We,a0 as Ze,a1 as qe,a2 as Ge,a3 as Je,a4 as He,a5 as Q,a6 as Ke,a7 as Qe}from"./index-E76cnppT.js";import{loader as Xe,VueMonacoEditor as Ye}from"@guolao/vue-monaco-editor";import*as et from"monaco-editor";import tt from"monaco-editor/esm/vs/editor/editor.worker?worker";import ot from"monaco-editor/esm/vs/language/json/json.worker?worker";import nt from"monaco-editor/esm/vs/language/css/css.worker?worker";import at from"monaco-editor/esm/vs/language/html/html.worker?worker";import rt from"monaco-editor/esm/vs/language/typescript/ts.worker?worker";import{newPyodideWorker as it}from"./frontend/tools/pyodide-worker-api.ts";import{version as st}from"pyodide";self.MonacoEnvironment={getWorker(e,t){return t==="json"?new ot:t==="css"||t==="scss"||t==="less"?new nt:t==="html"||t==="handlebars"||t==="razor"?new at:t==="typescript"||t==="javascript"?new rt:new tt}};function lt(){Xe.config({monaco:et})}const ae="3.7.8",dt=ae,B=typeof Buffer=="function",X=typeof TextDecoder=="function"?new TextDecoder:void 0,Y=typeof TextEncoder=="function"?new TextEncoder:void 0,ut="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",T=Array.prototype.slice.call(ut),O=(e=>{let t={};return e.forEach((l,c)=>t[l]=c),t})(T),pt=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,p=String.fromCharCode.bind(String),ee=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),re=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),ie=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),se=e=>{let t,l,c,u,i="";const S=e.length%3;for(let C=0;C<e.length;){if((l=e.charCodeAt(C++))>255||(c=e.charCodeAt(C++))>255||(u=e.charCodeAt(C++))>255)throw new TypeError("invalid character found");t=l<<16|c<<8|u,i+=T[t>>18&63]+T[t>>12&63]+T[t>>6&63]+T[t&63]}return S?i.slice(0,S-3)+"===".substring(S):i},N=typeof btoa=="function"?e=>btoa(e):B?e=>Buffer.from(e,"binary").toString("base64"):se,D=B?e=>Buffer.from(e).toString("base64"):e=>{let l=[];for(let c=0,u=e.length;c<u;c+=4096)l.push(p.apply(null,e.subarray(c,c+4096)));return N(l.join(""))},V=(e,t=!1)=>t?re(D(e)):D(e),ct=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?p(192|t>>>6)+p(128|t&63):p(224|t>>>12&15)+p(128|t>>>6&63)+p(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return p(240|t>>>18&7)+p(128|t>>>12&63)+p(128|t>>>6&63)+p(128|t&63)}},ft=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,le=e=>e.replace(ft,ct),te=B?e=>Buffer.from(e,"utf8").toString("base64"):Y?e=>D(Y.encode(e)):e=>N(le(e)),P=(e,t=!1)=>t?re(te(e)):te(e),oe=e=>P(e,!0),mt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,yt=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),l=t-65536;return p((l>>>10)+55296)+p((l&1023)+56320);case 3:return p((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return p((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},de=e=>e.replace(mt,yt),ue=e=>{if(e=e.replace(/\s+/g,""),!pt.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,l,c,u=[];for(let i=0;i<e.length;)t=O[e.charAt(i++)]<<18|O[e.charAt(i++)]<<12|(l=O[e.charAt(i++)])<<6|(c=O[e.charAt(i++)]),l===64?u.push(p(t>>16&255)):c===64?u.push(p(t>>16&255,t>>8&255)):u.push(p(t>>16&255,t>>8&255,t&255));return u.join("")},j=typeof atob=="function"?e=>atob(ie(e)):B?e=>Buffer.from(e,"base64").toString("binary"):ue,pe=B?e=>ee(Buffer.from(e,"base64")):e=>ee(j(e).split("").map(t=>t.charCodeAt(0))),ce=e=>pe(fe(e)),ht=B?e=>Buffer.from(e,"base64").toString("utf8"):X?e=>X.decode(pe(e)):e=>de(j(e)),fe=e=>ie(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),L=e=>ht(fe(e)),vt=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},me=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ye=function(){const e=(t,l)=>Object.defineProperty(String.prototype,t,me(l));e("fromBase64",function(){return L(this)}),e("toBase64",function(t){return P(this,t)}),e("toBase64URI",function(){return P(this,!0)}),e("toBase64URL",function(){return P(this,!0)}),e("toUint8Array",function(){return ce(this)})},he=function(){const e=(t,l)=>Object.defineProperty(Uint8Array.prototype,t,me(l));e("toBase64",function(t){return V(this,t)}),e("toBase64URI",function(){return V(this,!0)}),e("toBase64URL",function(){return V(this,!0)})},gt=()=>{ye(),he()},xt={version:ae,VERSION:dt,atob:j,atobPolyfill:ue,btoa:N,btoaPolyfill:se,fromBase64:L,toBase64:P,encode:P,encodeURI:oe,encodeURL:oe,utob:le,btou:de,decode:L,isValid:vt,fromUint8Array:V,toUint8Array:ce,extendString:ye,extendUint8Array:he,extendBuiltins:gt},bt=`import micropip

# Prioritize the OCP.wasm package repository for finding the ported dependencies.
micropip.set_index_urls(["https://yeicor.github.io/OCP.wasm", "https://pypi.org/simple"])

# For build123d < 0.10.0, we need to install the mock the py-lib3mf package (before the main install).
await micropip.install("lib3mf")
micropip.add_mock_package("py-lib3mf", "2.4.1", modules={"py_lib3mf": 'from lib3mf import *'})

# Install the yacv_server package, which is the main server for the OCP.wasm playground; and also preinstalls build123d.
await micropip.install("yacv_server", pre=True)

# Preimport the yacv_server package to ensure it is available in the global scope, and mock the ocp_vscode package.
from yacv_server import *

micropip.add_mock_package("ocp-vscode", "2.8.9", modules={"ocp_vscode": 'from yacv_server import *'})
show_object = show

# Preinstall the font-fetcher package and install its hook to automatically download any requested font.
await micropip.install("font-fetcher", pre=True)

from font_fetcher.ocp import install_ocp_font_hook

install_ocp_font_hook()
`,wt={style:{display:"inline-flex","margin-right":"16px"}},kt={style:{"padding-left":"12px",width:"48px"}},_t={style:{"padding-right":"12px",width:"48px"}},Ct={class:"playground-container"},At={class:"playground-console"},Ut={style:{display:"flex","align-items":"center","justify-content":"space-between",margin:"0"}},ne="yacv_server://model/",Pt=Ae({__name:"PlaygroundDialogContent",props:{modelValue:{required:!0},modelModifiers:{}},emits:Ue(["close","updateModel"],["update:modelValue"]),setup(e,{emit:t}){Pe(a=>({v7a02484c:g.value}));const l=Be(e,"modelValue"),c=t;lt();const u=E("");function i(a){u.value+=a;let o=1e4;u.value.length>o&&(u.value=u.value.slice(-o)),console.log(a),Ke(()=>{const s=document.querySelector(".playground-console");s&&(s.scrollTop=s.scrollHeight)})}const S={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0},C=window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs",ve=Se(),ge=a=>ve.value=a,g=E(.9);let b=null;const w=E(!0);async function z(a,o=void 0){w.value=!0,g.value==0&&!a&&(g.value=.9),b===null?(i(`Creating new Pyodide worker...
`),b=it(Object.assign({indexURL:`https://cdn.jsdelivr.net/pyodide/v${st}/full/`,packages:["micropip","sqlite3"]},o?{_loadSnapshot:o}:{}))):i(`Reusing existing Pyodide instance...
`),i(`Preloading packages...
`),await b.asyncRun(bt,i,i),w.value=!1,i(`Pyodide worker ready.
`)}async function $(){if(b===null){i(`Pyodide worker is not initialized. Please wait...
`);return}if(w.value){i(`Pyodide is already running. Please wait...
`);return}i(`Running code...
`);try{w.value=!0,await b.asyncRun(l.value.code,i,a=>{if(a.startsWith(ne)){const o=a.slice(ne.length);xe(o)}else i(a)})}catch(a){i(`Error running code: ${a}
`)}finally{i(`Code execution finished.
`),w.value=!1}}function xe(a){i(`Model data detected... ${a.length}B
`);let o=0,s=0;for(;o<a.length&&(a[o]==="{"?s++:a[o]==="}"&&s--,s!==0);o++);if(s!==0)throw`Error: Invalid model data received: ${a}
`;const A=a.slice(0,o+1);let y=JSON.parse(A);const x=new qe(y.name,"",y.hash,y.is_remove);if(i(`Model metadata: ${JSON.stringify(x)}
`),x.isRemove)delete R[x.name];else{const U=xt.toUint8Array(a.slice(o+1));console.assert(U.slice(0,4).toString()=="103,108,84,70","Invalid GLTF binary data received: "+U.slice(0,4).toString()),R[x.name]=U;const Ce=new Blob([U],{type:"model/gltf-binary"});x.url=URL.createObjectURL(Ce)}let f=new Ge([x],()=>{});c("updateModel",f)}function be(a=void 0){b&&(b.terminate(),b=null),u.value="",z(!1,a)}function W(a,o){const s=window.location,A=new URLSearchParams(s.search);for(const f of o)A.delete(f);const y=new URLSearchParams(s.hash.slice(1));for(const f of o)y.delete(f);for(const f in a)if(Array.isArray(a[f]))for(const U of a[f])y.append(f,U);else typeof a[f]=="string"&&y.set(f,a[f]);const x=`${s.origin}${s.pathname}?${A}#${y}`;if(i(`Share link ready: ${x}
`),navigator.clipboard?.writeText===void 0){i(`Clipboard API not available. Please copy the link manually.
`);return}else navigator.clipboard.writeText(x).then(()=>i(`Link copied to clipboard!
`)).catch(f=>i(`Failed to copy link: ${f}
`))}function Z(){W({pg_code:Je(He(l.value.code,{level:9}))},["pg_code"])}const R={};async function we(){try{i(`Uploading files...
`);const a=new Blob([l.value.code],{type:"text/x-python"}),o={pg_code:await Q("code.py",new Uint8Array(await a.arrayBuffer()))};o.preload=[];for(const s in R){const A=R[s],y=await Q(s+".glb",A);o.preload.push(y)}return W(o,["pg_code"])}catch(a){return i(`Error uploading/sharing files: ${a}. Falling back to private share link.
`),Z()}}function ke(){throw new Error("Not implemented yet!")}function _e(){throw new Error("Not implemented yet!")}(async()=>{const a=await Te;l.value.firstTime&&(g.value=a.pg_opacity_loading),await z(!0),l.value.firstTime&&(await $(),g.value=a.pg_opacity_loaded,l.value.firstTime=!1)})();const F=E(null);return Re(()=>{F.value&&F.value.addEventListener("keydown",a=>{a instanceof KeyboardEvent&&(a.key==="F10"?(a.preventDefault(),$()):a.key==="Escape"&&c("close"))})}),(a,o)=>(I(),M(n(Ze),{class:"popup-card",style:K(g.value==0?"position: absolute; top: calc(-50vh + 24px); width: calc(100vw - 64px);":"")},{default:d(()=>[r(n(Ee),{class:"popup"},{default:d(()=>[r(n(Oe),{style:{flex:"0 1 auto"}},{default:d(()=>[...o[10]||(o[10]=[m("Playground",-1)])]),_:1}),r(n(q)),h("span",wt,[r(n(v),{path:n(Ve),type:"mdi",style:{height:"32px"}},null,8,["path"]),r(n($e),{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=s=>g.value=s),max:1,min:0,step:.1,style:{width:"100px",height:"32px"}},null,8,["modelValue"]),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[11]||(o[11]=[m("Opacity of the editor (0 = hidden, 1 = fully visible)",-1)])]),_:1})]),h("span",kt,[r(n(_),{icon:"",disabled:"",onClick:o[1]||(o[1]=s=>ke())},{default:d(()=>[r(n(v),{path:n(Fe),type:"mdi"},null,8,["path"])]),_:1}),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[12]||(o[12]=[m("Save current state to a snapshot for fast startup (WIP)",-1)])]),_:1})]),h("span",_t,[r(n(_),{icon:"",disabled:"",onClick:o[2]||(o[2]=s=>_e())},{default:d(()=>[r(n(v),{path:n(Me),type:"mdi"},null,8,["path"])]),_:1}),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[13]||(o[13]=[m("Load snapshot for fast startup (WIP)",-1)])]),_:1})]),r(n(_),{icon:"",onClick:o[3]||(o[3]=s=>Z()),style:{"padding-left":"12px"}},{default:d(()=>[r(n(v),{path:n(G),type:"mdi"},null,8,["path"]),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[14]||(o[14]=[m("Share link that automatically runs the code.",-1),h("br",null,null,-1),m("Only people with the link can see the code. ",-1)])]),_:1})]),_:1}),r(n(_),{icon:"",onClick:o[4]||(o[4]=s=>we()),style:{"padding-right":"12px"}},{default:d(()=>[r(n(v),{path:n(G),type:"mdi",style:{position:"absolute",scale:"75%",top:"6px"}},null,8,["path"]),r(n(v),{path:n(Ie),type:"mdi",style:{position:"absolute",scale:"75%",bottom:"6px"}},null,8,["path"]),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[15]||(o[15]=[m("Uploads all models and code and then shares a link to them.",-1),h("br",null,null,-1),m("Useful to view the models while the playground loads, but uses third-party storage. ",-1)])]),_:1})]),_:1}),r(n(_),{icon:"",onClick:o[5]||(o[5]=s=>be()),style:{"padding-left":"12px"}},{default:d(()=>[r(n(v),{path:n(De),type:"mdi"},null,8,["path"]),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[16]||(o[16]=[m("Reset Pyodide worker (this forgets all previous state and will take a little while) ",-1)])]),_:1})]),_:1}),r(n(_),{icon:"",onClick:o[6]||(o[6]=s=>$()),disabled:w.value,style:{"padding-right":"12px"}},{default:d(()=>[r(n(v),{path:n(Le),type:"mdi"},null,8,["path"]),w.value?(I(),M(H,{key:0,style:{position:"absolute",top:"-16%",left:"-28%"}})):J("",!0),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[17]||(o[17]=[m("Run code",-1)])]),_:1})]),_:1},8,["disabled"]),r(n(_),{icon:"",onClick:o[7]||(o[7]=s=>c("close"))},{default:d(()=>[r(n(v),{path:n(Ne),type:"mdi"},null,8,["path"]),r(n(k),{activator:"parent",location:"bottom"},{default:d(()=>[...o[18]||(o[18]=[m("Close (Pyodide remains loaded)",-1)])]),_:1})]),_:1})]),_:1}),r(n(je),{class:"popup-card-text",style:K(g.value==0?"display: none":"")},{default:d(()=>[h("div",Ct,[h("div",{class:"playground-editor",ref_key:"editorRef",ref:F},[r(n(Ye),{value:l.value.code,"onUpdate:value":o[8]||(o[8]=s=>l.value.code=s),theme:n(C),options:S,language:"python",onMount:ge},null,8,["value","theme"])],512),h("div",At,[h("h3",Ut,[o[19]||(o[19]=m(" Console Output ",-1)),r(n(q)),r(n(_),{onClick:o[9]||(o[9]=s=>u.value="")},{default:d(()=>[r(n(v),{path:n(ze),type:"mdi",class:"h-"},null,8,["path"])]),_:1})]),h("pre",null,We(u.value),1),w.value?(I(),M(H,{key:0})):J("",!0)])])]),_:1},8,["style"])]),_:1},8,["style"]))}}),Mt=Qe(Pt,[["__scopeId","data-v-dc6f61fe"]]);export{Mt as default};
//# sourceMappingURL=PlaygroundDialogContent-BpMNRrbp.js.map
