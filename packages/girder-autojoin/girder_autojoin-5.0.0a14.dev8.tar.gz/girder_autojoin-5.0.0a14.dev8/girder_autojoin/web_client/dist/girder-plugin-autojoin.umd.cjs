(function(a){typeof define=="function"&&define.amd?define(a):a()})(function(){"use strict";function a(t,u,F,e){if(u===!1||u==null||!u&&(t==="class"||t==="style"))return"";if(u===!0)return" "+(e?t:t+'="'+t+'"');var i=typeof u;return i!=="object"&&i!=="function"||typeof u.toJSON!="function"||(u=u.toJSON()),typeof u=="string"||(u=JSON.stringify(u),F||u.indexOf('"')===-1)?(F&&(u=l(u))," "+t+'="'+u+'"'):" "+t+"='"+u.replace(/'/g,"&#39;")+"'"}function l(t){var u=""+t,F=b.exec(u);if(!F)return t;var e,i,o,g="";for(e=F.index,i=0;e<u.length;e++){switch(u.charCodeAt(e)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==e&&(g+=u.substring(i,e)),i=e+1,g+=o}return i!==e?g+u.substring(i,e):g}var b=/["&<>]/;function _(t,u,F,e){if(!(t instanceof Error))throw t;if(!(typeof window>"u"&&u||e))throw t.message+=" on line "+F,t;var i,o,g,d;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),i=3,o=e.split(`
`),g=Math.max(F-i,0),d=Math.min(o.length,F+i)}catch(p){return t.message+=" - could not read from "+u+" ("+p.message+")",void _(t,null,F)}i=o.slice(g,d).map(function(p,w){var r=w+g+1;return(r==F?"  > ":"    ")+r+"| "+p}).join(`
`),t.path=u;try{t.message=(u||"Pug")+":"+F+`
`+i+`

`+t.message}catch{}throw t}function C(t){var u="",F,e,i;try{var o=t||{};(function(g,d,p,w){i=1,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<div class="g-config-breadcrumb-container"></div>',i=3,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<p class="g-autojoin-description">',i=4,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"The Auto Join plugin allows you to define rules to automatically assign new",i=5,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+`
`,i=5,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"users to groups based on their email address domain. Typically, this is used in",i=6,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+`
`,i=6,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"conjunction with ",i=6,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<a href="#settings">',i=6,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"email verification</a>",i=6,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+".",i=7,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+`
`,i=7,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"</p>",i=8,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<div class="g-autojoin-container">',i=9,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<table class="table table-hover">',i=10,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<thead>",i=11,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tr>",i=12,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<th>",i=12,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"If email contains</th>",i=13,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<th>",i=13,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Add user to group</th>",i=14,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<th>",i=14,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"With access level</th>",i=15,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<th></th></tr></thead>",i=16,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tbody>",i=17,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",w.length||(i=18,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tr>",i=19,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<td class="g-autojoin-empty" colspan="4">',i=19,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"No rules defined.</td></tr>"),i=20,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",(function(){var r=w;if(typeof r.length=="number")for(var n=0,s=r.length;n<s;n++){var c=r[n];i=21,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug";var j=d[c.groupId];i=22,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug";var f=p[c.level];i=23,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tr>",i=24,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=24,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=c.pattern)==null?"":F)+"</td>",i=25,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=25,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=j?j.get("name"):"(group no longer exists)")==null?"":F)+"</td>",i=26,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=26,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=f)==null?"":F)+"</td>",i=27,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=28,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<button"+(' class="g-autojoin-remove btn btn-xs btn-danger" title="Remove rule"'+a("data-index",n,!0,!1))+">",i=29,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<i class="icon-cancel"></i></button></td></tr>'}else{var s=0;for(var n in r){s++;var c=r[n];i=21,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug";var j=d[c.groupId];i=22,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug";var f=p[c.level];i=23,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tr>",i=24,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=24,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=c.pattern)==null?"":F)+"</td>",i=25,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=25,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=j?j.get("name"):"(group no longer exists)")==null?"":F)+"</td>",i=26,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=26,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=f)==null?"":F)+"</td>",i=27,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=28,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<button"+(' class="g-autojoin-remove btn btn-xs btn-danger" title="Remove rule"'+a("data-index",n,!0,!1))+">",i=29,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<i class="icon-cancel"></i></button></td></tr>'}}}).call(this),u=u+"</tbody>",i=30,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tfoot>",i=31,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<tr>",i=32,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=33,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<input class="form-control input-sm" id="g-autojoin-pattern" placeholder="Enter email pattern"/></td>',i=34,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=35,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<select class="form-control input-sm" id="g-autojoin-group">',i=36,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<option value="">',i=36,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"(Select group)</option>",i=37,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",(function(){var r=g;if(typeof r.length=="number")for(var n=0,s=r.length;n<s;n++){var c=r[n];i=38,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<option"+a("value",c.get("_id"),!0,!1)+">",i=38,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=c.get("name"))==null?"":F)+"</option>"}else{var s=0;for(var n in r){s++;var c=r[n];i=38,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<option"+a("value",c.get("_id"),!0,!1)+">",i=38,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+l((F=c.get("name"))==null?"":F)+"</option>"}}}).call(this),u=u+"</select></td>",i=39,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=40,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<select class="form-control input-sm" id="g-autojoin-level">',i=41,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<option value="">',i=41,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"(Select access level)</option>",i=42,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<option value="0">',i=42,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Member</option>",i=43,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<option value="1">',i=43,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Moderator</option>",i=44,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<option value="2">',i=44,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Admin</option></select></td>",i=45,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"<td>",i=46,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<button class="btn btn-xs btn-primary" id="g-autojoin-add" title="Add rule">',i=47,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<i class="icon-plus"></i></button></td></tr></tfoot></table></div>',i=49,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<p class="g-validation-failed-message" id="g-autojoin-error-message"></p>',i=51,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<div class="g-autojoin-buttons">',i=52,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<button class="btn btn-sm btn-primary" id="g-autojoin-save">',i=52,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Save Changes</button>",i=53,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+'<button class="btn btn-sm btn-default" id="g-autojoin-cancel">',i=53,e="/home/circleci/project/girder/plugins/autojoin/girder_autojoin/web_client/templates/configView.pug",u=u+"Cancel</button></div>"}).call(this,"groups"in o?o.groups:typeof groups<"u"?groups:void 0,"groupsById"in o?o.groupsById:typeof groupsById<"u"?groupsById:void 0,"levelNames"in o?o.levelNames:typeof levelNames<"u"?levelNames:void 0,"rules"in o?o.rules:typeof rules<"u"?rules:void 0)}catch(g){_(g,e,i)}return u}const k="",m=girder.$,E=girder.collections.GroupCollection,v=girder.views.widgets.PluginConfigBreadcrumbWidget,V=girder.router,y=girder.events,$=girder.views.View,{restRequest:h}=girder.rest;var x=$.extend({events:{"click .g-autojoin-remove":function(t){this.$("#g-autojoin-error-message").text("");var u=parseInt(m(t.currentTarget).attr("data-index"),10);this.rules.splice(u,1),this.render()},"click #g-autojoin-add":function(t){this.$("#g-autojoin-error-message").text("");var u=m("#g-autojoin-pattern").val(),F=m("#g-autojoin-group").val(),e=m("#g-autojoin-level").val();if(u===""||F===""||e===""){this.$("#g-autojoin-error-message").text("All fields are required.");return}var i={pattern:u,groupId:F,level:parseInt(e,10)};this.rules.push(i),this.render()},"click #g-autojoin-save":function(t){this.$("#g-autojoin-error-message").text(""),this._saveSettings([{key:"autojoin",value:this.rules}])},"click #g-autojoin-cancel":function(t){V.navigate("plugins",{trigger:!0})}},initialize:function(){this.rules=[],this.collection=new E,this.collection.pageLimit=0,this.collection.on("g:changed",function(){this.render()},this).fetch(),h({method:"GET",url:"system/setting",data:{list:JSON.stringify(["autojoin"])}}).done(t=>{this.rules=t.autojoin||[],this.render()})},render:function(){var t=this.collection.toArray(),u={};t.forEach(function(e){u[e.get("_id")]=e});var F={0:"Member",1:"Moderator",2:"Admin"};return this.$el.html(C({rules:this.rules,groups:t,groupsById:u,levelNames:F})),new v({pluginName:"Auto Join",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render(),this},_saveSettings:function(t){h({method:"PUT",url:"system/setting",data:{list:JSON.stringify(t)},error:null}).done(()=>{y.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})}).fail(u=>{this.$("#g-autojoin-error-message").text(u.responseJSON.message)})}});const N=girder.router,S=girder.events,{exposePluginConfig:I}=girder.utilities.PluginUtils;I("autojoin","plugins/autojoin/config"),N.route("plugins/autojoin/config","autojoinConfig",function(){S.trigger("g:navigateTo",x)})});
