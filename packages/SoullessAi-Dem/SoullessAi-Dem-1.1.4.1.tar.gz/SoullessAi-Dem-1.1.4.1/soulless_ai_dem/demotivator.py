from PIL import Image, ImageDraw, ImageFont
import random
import os

all_txt = [
    [u"А че"],
    [u"заставляет задуматься"],
    [u"Жалко пацана"],
    [u"ты че сука??"],
    [u"ААХАХАХАХХАХА", u"ААХАХААХАХА"],
    [u"ГИГАНТ МЫСЛИ", u"отец русской демократии"],
    [u"Он"],
    [u"ЧТО БЛЯТЬ?"],
    [u"охуенная тема"],
    [u"ВОТ ОНИ", u"типичные комедиклабовские шутки"],
    [u"НУ НЕ БЛЯДИНА?"],
    [u"Узнали?"],
    [u"Согласны?"],
    [u"Вот это мужик"],
    [u"ЕГО ИДЕИ", u"будут актуальны всегда"],
    ["", u"ПРИ СТАЛИНЕ ОН БЫ СИДЕЛ"],
    [u"о вадим"],
    [u"2 месяца на дваче", u"и это, блядь, нихуя не смешно"],
    [u"Что дальше?", u"Чайник с функцией жопа?"],
    ["", u"И нахуя мне эта информация?"],
    [u"Верхний текст"],
    [u"нижний текст"],
    [u"Показалось"],
    [u"Суды при анкапе"],
    [u"Хуйло с района", "", u"такая шелупонь с одной тычки ляжет"],
    [u"Брух"],
    [u"Расскажи им", u"как ты устал в офисе"],
    [u"Окурок блять", u"есть 2 рубля?"],
    [u"Аниме ставшее легендой"],
    [u"СМИРИСЬ","", u"ты никогда не станешь настолько же крутым"],
    [u"а ведь это идея"],
    ["",u"Если не лайкнешь у тебя нет сердца"],
    [u"Вместо тысячи слов"],
    [u"ШАХ И МАТ!!!"],
    [u"Самый большой член в мире",u"У этой девушки"],
    [u"Немного",u"перфекционизма"],
    [u"кто"],
    ["",u"эта сука уводит чужих мужей"],
    [u"Кто он???"],
    ["",u"Вы тоже хотели насрать туда в детстве?"],
    ["",u"Вся суть современного общества",u"в одном фото"],
    [u"Он обязательно выживет!"],
    ["",u"Вы тоже хотите подрочить ему?"],
    ["",u"И вот этой хуйне поклоняются русские?"],
    [u"Вот она суть","",u"человеческого общества в одной картинке"],
    [u"Вы думали это рофл?",u"Нет это жопа"],
    ["",u"При сталине такой хуйни не было",u"А у вас было?"],
    [u"Он грыз провода"],
    [u"Назло старухам",u"на радость онанистам"],
    [u"Где-то в Челябинске"],
    [u"Агитация за Порошенко"],
    [u"ИДЕАЛЬНО"],
    [u"Грыз?"],
    [u"Ну давай расскажи им",u"какая у тебя тяжелая работа"],
    ["",u"Желаю в каждом доме такого гостя"],
    [u"Шкура на вырост"],
    [u"НИКОГДА",u"не сдавайся"],
    [u"Оппа гангнам стайл",u"уууу сэкси лейди оп оп"],
    [u"Они сделали это",u"сукины дети, они справились"],
    [u"Эта сука",u"хочет денег"],
    [u"Это говно, а ты?"],
    ["",u"Вот она нынешняя молодежь"],
    [u"Погладь кота",u"погладь кота сука"],
    [u"Я обязательно выживу"],
    ["",u"Вот она, настоящая мужская дружба",u"без политики и лицимерия"],
    ["",u"ОБИДНО ЧТО Я ЖИВУ В СТРАНЕ",u"где гантели стоят в 20 раз дороже чем бутылка водки"],
    [u"Царь, просто царь"],
    ["",u"Нахуй вы это в учебники вставили?",u"И ещё ебаную контрольную устроили"],
    ["",u"ЭТО НАСТОЯЩАЯ КРАСОТА",u"а не ваши голые бляди"],
    ["",u"Тема раскрыта ПОЛНОСТЬЮ"],
    ["",u"РОССИЯ, КОТОРУЮ МЫ ПОТЕРЯЛИ"],
    [u"ЭТО - Я",u"ПОДУМАЙ МОЖЕТ ЭТО ТЫ"],
    [u"почему",u"что почему"],
    [u"КУПИТЬ БЫ ДЖЫП",u"БЛЯТЬ ДА НАХУЙ НАДО"],
    ["","",u"мы не продаём бомбастер лицам старше 12 лет"],
    [u"МРАЗЬ"],
    [u"Правильная аэрография"],
    [u"Вот она русская",u"СМЕКАЛОЧКА"],
    [u"Он взял рехстаг!",u"А чего добился ты?"],
    [u"На аватарку"],
    [u"Фотошоп по-деревенски"],
    [u"Инструкция в самолете"],
    [u"Цирк дю Солей"],
    [u"Вкус детства",u"школоте не понять"],
    [u"Вот оно - СЧАСТЬЕ"],
    [u"Он за тебя воевал",u"а ты даже не знаешь его имени"],
    [u"Зато не за компьютером"],
    ["",u"Не трогай это на новый год"],
    [u"Мой первый рисунок",u"мочой на снегу"],
    ["",u"Майские праздники на даче"],
    [u"Ваш пиздюк?"],
    [u"Тест драйв подгузников"],
    [u"Не понимаю",u"как это вообще выросло?"],
    [u"Супермен в СССР"],
    [u"Единственный",u"кто тебе рад"],
    [u"Макдональдс отдыхает"],
    [u"Ну че",u" как дела на работе пацаны?"],
    [u"Вся суть отношений"],
    [u"Беларусы, спасибо!"],
    ["",u"У дверей узбекского военкомата"],
    [u"Вместо 1000 слов"],
    [u"Один вопрос",u"нахуя?"],
    [u"Ответ на санкции",u"ЕВРОПЫ"],
    [u"ЦЫГАНСКИЕ ФОКУСЫ"],
    [u"Блять!", u"да он гений!"],
    ["",u"Украина ищет новые источники газа"],
    [u"ВОТ ЭТО",u"НАСТОЯЩИЕ КАЗАКИ а не ряженные"],
    [u"Нового года не будет",u"Санта принял Ислам"],
    ["",u"Он был против наркотиков",u"а ты и дальше убивай себя"],
    [u"Всем похуй!",u"Всем похуй!"],
    [u"БРАТЬЯ СЛАВЯНЕ",u"помните друг о друге"],
    ["",u"ОН ПРИДУМАЛ ГОВНО",u"а ты даже не знаешь его имени"],
    ["",u"краткий курс истории нацболов"],
    [u"Эпоха ренессанса"]
]

def get_random_text():
    return all_txt[random.randrange(len(all_txt))]

def get_template_path(filename):
    package_dir = os.path.dirname(__file__)
    templates_dir = os.path.join(package_dir, 'templates')
    
    if '.' in filename:
        full_path = os.path.join(templates_dir, filename)
        if os.path.exists(full_path):
            return full_path
    
    for ext in ['.png', '.jpg', '.jpeg']:
        full_path = os.path.join(templates_dir, f"{filename}{ext}")
        if os.path.exists(full_path):
            return full_path
    
    available = os.listdir(templates_dir)
    raise FileNotFoundError(f"Файл {filename} не найден. Доступные файлы: {available}")

def create_demotivator(input_path, output_path, text_lines=None, small=False):
    package_dir = os.path.dirname(os.path.abspath(__file__))
    
    unicode_font = [
        ImageFont.truetype(os.path.join(package_dir, "fonts/times.ttf"), 58),
        ImageFont.truetype(os.path.join(package_dir, "fonts/times.ttf"), 40),
        ImageFont.truetype(os.path.join(package_dir, "fonts/times.ttf"), 30),
        ImageFont.truetype(os.path.join(package_dir, "fonts/times.ttf"), 22)
    ]
    
    if text_lines is None:
        txt = get_random_text()
    else:
        txt = text_lines
    
    rows = 0
    for t in txt:
        if t:
            rows += 1
    if rows > 2:
        rows = 2
    
    if text_lines is None:
        back_path = get_template_path('base')
    else:
        back_path = get_template_path('base_r')
    
    back = Image.open(back_path)
    
    if input_path:
        im = Image.open(input_path)
        newx = 608
        newy = 566
        im = im.resize((newx, newy), Image.ANTIALIAS)
        back.paste(im, (55, 33))
    
    draw = ImageDraw.Draw(back)
    pos = 0
    sz = 0
    
    for t in txt:
        if not t or pos > 1:
            continue
        
        w, h = draw.textsize(t, font=unicode_font[sz])
        
        while w > 714 and sz < 3:
            sz += 1
            w, h = draw.textsize(t, font=unicode_font[sz])
        
        draw.text((714/2 - w/2, 700 - h/2 + (-rows/2 + pos) * 58), 
                 t, font=unicode_font[sz], fill="white")
        
        sz += 1
        if sz > 3:
            sz = 3
        
        if t:
            pos += 1
    
    if small:
        back = back.resize((357, 372), Image.ANTIALIAS)
    
    back.save(output_path)
