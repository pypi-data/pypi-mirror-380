(function(a){typeof define=="function"&&define.amd?define(a):a()})(function(){"use strict";function a(o,e,u,i){if(e===!1||e==null||!e&&(o==="class"||o==="style"))return"";if(e===!0)return" "+(i?o:o+'="'+o+'"');var t=typeof e;return t!=="object"&&t!=="function"||typeof e.toJSON!="function"||(e=e.toJSON()),typeof e=="string"||(e=JSON.stringify(e),u||e.indexOf('"')===-1)?(u&&(e=h(e))," "+o+'="'+e+'"'):" "+o+"='"+e.replace(/'/g,"&#39;")+"'"}function h(o){var e=""+o,u=f.exec(e);if(!u)return o;var i,t,r,g="";for(i=u.index,t=0;i<e.length;i++){switch(e.charCodeAt(i)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}t!==i&&(g+=e.substring(t,i)),t=i+1,g+=r}return t!==i?g+e.substring(t,i):g}var f=/["&<>]/;function c(o,e,u,i){if(!(o instanceof Error))throw o;if(!(typeof window>"u"&&e||i))throw o.message+=" on line "+u,o;var t,r,g,F;try{i=i||require("fs").readFileSync(e,{encoding:"utf8"}),t=3,r=i.split(`
`),g=Math.max(u-t,0),F=Math.min(r.length,u+t)}catch(n){return o.message+=" - could not read from "+e+" ("+n.message+")",void c(o,null,u)}t=r.slice(g,F).map(function(n,U){var d=U+g+1;return(d==u?"  > ":"    ")+d+"| "+n}).join(`
`),o.path=e;try{o.message=(e||"Pug")+":"+u+`
`+t+`

`+o.message}catch{}throw o}function w(o){var e="",u,i;try{var t=o||{};(function(r,g,F,n){i=1,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-config-breadcrumb-container"></div>',i=3,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<form class="g-settings-form" role="form">',i=4,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-settings-form-container">',i=5,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"<h4>",i=5,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Instance Branding</h4></div>",i=7,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<p class="g-homepage-description"></p>',i=8,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"To configure elements of the default homepage",i=10,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="form-group">',i=11,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<label for="g-homepage-header">',i=11,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Header</label>",i=12,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"<input"+(' class="form-control input-sm" id="g-homepage-header" type="text"'+a("value",F||"",!0,!1)+a("placeholder",`Default: ${r||"none"}`,!0,!1)+' title="The homepage header."')+"/></div>",i=16,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="form-group">',i=17,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<label for="g-homepage-subheader">',i=17,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Subheader</label>",i=18,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"<input"+(' class="form-control input-sm" id="g-homepage-subheader" type="text"'+a("value",n||"",!0,!1)+a("placeholder",`Default: ${g||"none"}`,!0,!1)+' title="The homepage subheader."')+"/></div>",i=22,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="form-group">',i=23,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<label for="g-homepage-welcome-text">',i=23,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Welcome Text</label>",i=24,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-welcome-text-container" id="g-homepage-welcome-text"></div></div>',i=26,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="form-group">',i=27,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"<label>",i=27,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Logo</label>",i=28,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-logo-container">',i=29,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-logo-preview-container">',i=30,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-logo-preview">',i=31,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<img alt="Logo"/></div>',i=32,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<button class="btn btn-sm btn-default" id="g-homepage-logo-reset" type="button" title="Reset default logo">',i=33,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"Use default</button></div>",i=34,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-logo-upload-container"></div></div></div></form>',i=36,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"<hr/>",i=38,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<p class="g-homepage-description">',i=39,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+"To completely replace the homepage content (ignoring the other settings), enter Markdown here.</p>",i=41,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<div class="g-homepage-container"></div>',i=43,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<p class="g-validation-failed-message" id="g-homepage-error-message"></p>',i=45,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<form id="g-homepage-form" role="form">',i=46,u="/home/circleci/project/girder/plugins/homepage/girder_homepage/web_client/templates/configView.pug",e=e+'<input class="btn btn-sm btn-primary" type="submit" value="Save"/></form>'}).call(this,"defaultHeader"in t?t.defaultHeader:typeof defaultHeader<"u"?defaultHeader:void 0,"defaultSubHeader"in t?t.defaultSubHeader:typeof defaultSubHeader<"u"?defaultSubHeader:void 0,"header"in t?t.header:typeof header<"u"?header:void 0,"subHeader"in t?t.subHeader:typeof subHeader<"u"?subHeader:void 0)}catch(r){c(r,u,i)}return e}const M="",b=girder.$,p=girder.models.FolderModel,s=girder.views.widgets.MarkdownWidget,_=girder.views.widgets.PluginConfigBreadcrumbWidget,v=girder.views.View,E=girder.views.widgets.UploadWidget,C=girder.events,{restRequest:l,getApiRoot:V}=girder.rest,j=v.extend({events:{"submit #g-homepage-form":function(o){o.preventDefault(),this._saveSettings([{key:"homepage.markdown",value:this.editor.val()},{key:"homepage.header",value:this.$("#g-homepage-header").val()},{key:"homepage.subheader",value:this.$("#g-homepage-subheader").val()},{key:"homepage.welcome_text",value:this.welcomeText.val()},{key:"homepage.logo",value:this.logoFileId}])},"click #g-homepage-logo-reset":function(o){this.logoFileId=null,this._updateLogoDisplay()}},initialize:function(){const o=l({method:"GET",url:"system/setting",data:{list:JSON.stringify(["homepage.markdown","homepage.header","homepage.subheader","homepage.welcome_text","homepage.logo"])}}).then(u=>u),e=l({method:"GET",url:"homepage/assets"}).then(u=>u);b.when(o,e).done((u,i)=>{this.editor=new s({prefix:"homepage",placeholder:"Enter Markdown for the homepage",parentView:this,parent:new p({_id:i["homepage.markdown"]}),enableUploads:!0,maxUploadSize:1024*1024*10,allowedExtensions:["png","jpeg","jpg","gif"]}),this.welcomeText=new s({prefix:"welcome",placeholder:"Enter Markdown to replace the welcome text.",parentView:this,parent:new p({_id:i["homepage.welcome_text"]}),enableUploads:!0,maxUploadSize:1024*1024*10,allowedExtensions:["png","jpeg","jpg","gif"]}),this.editor.text=u["homepage.markdown"],this.header=u["homepage.header"],this.subHeader=u["homepage.subheader"],this.welcomeText.text=u["homepage.welcome_text"],this.logoFileId=u["homepage.logo"],this.logoUploader=new E({parent:new p({_id:i["homepage.logo"]}),parentType:"folder",title:"Homepage Logo",modal:!1,multiFile:!1,parentView:this}),this.listenTo(this.logoUploader,"g:uploadFinished",t=>{this.logoFileId=t.files[0].id,this._updateLogoDisplay()}),this.render()})},_updateLogoDisplay:function(){let o;this.logoFileId?o=`${V()}/file/${this.logoFileId}/download?contentDisposition=inline`:o="Girder_Mark.png",this.$(".g-homepage-logo-preview img").attr("src",o)},render:function(){return this.$el.html(w({header:this.header||null,subHeader:this.subHeader||null,defaultHeader:"Girder",defaultSubHeader:"Data management platform"})),this.editor.setElement(this.$(".g-homepage-container")).render(),this.welcomeText.setElement(this.$(".g-homepage-welcome-text-container")).render(),this.logoUploader.render().$el.appendTo(this.$(".g-homepage-logo-upload-container")),this._updateLogoDisplay(),this.breadcrumb||(this.breadcrumb=new _({pluginName:"Homepage",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render()),this},_saveSettings:function(o){this.$("#g-homepage-error-message").text(""),l({method:"PUT",url:"system/setting",data:{list:JSON.stringify(o)},error:null}).done(()=>{C.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})}).fail(e=>{this.$("#g-homepage-error-message").text(e.responseJSON.message)})}}),x=girder.router,y=girder.events,{exposePluginConfig:$}=girder.utilities.PluginUtils;$("homepage","plugins/homepage/config"),x.route("plugins/homepage/config","homepageConfig",function(){y.trigger("g:navigateTo",j)});const k=girder.views.body.FrontPageView,{renderMarkdown:m}=girder.misc,{restRequest:H,getApiRoot:S}=girder.rest,{wrap:T}=girder.utilities.PluginUtils;T(k,"render",function(o){return H({method:"GET",url:"homepage"}).done(e=>{if(e["homepage.markdown"])this.$el.html(m(e["homepage.markdown"]));else if(o.call(this),e["homepage.header"]&&this.$(".g-frontpage-title").text(e["homepage.header"]),e["homepage.subheader"]&&this.$(".g-frontpage-subtitle").text(e["homepage.subheader"]),e["homepage.welcome_text"]&&this.$(".g-frontpage-welcome-text-content").html(m(e["homepage.welcome_text"])),e["homepage.logo"]){const u=`${S()}/file/${e["homepage.logo"]}/download?contentDisposition=inline`;this.$(".g-frontpage-logo").attr("src",u)}}),this})});
