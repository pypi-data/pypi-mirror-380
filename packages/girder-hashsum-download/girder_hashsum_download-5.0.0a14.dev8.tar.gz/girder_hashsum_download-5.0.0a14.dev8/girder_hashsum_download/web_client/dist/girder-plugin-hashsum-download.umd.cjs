(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";function d(s,e,i,u){if(e===!1||e==null||!e&&(s==="class"||s==="style"))return"";if(e===!0)return" "+(u?s:s+'="'+s+'"');var t=typeof e;return t!=="object"&&t!=="function"||typeof e.toJSON!="function"||(e=e.toJSON()),typeof e=="string"||(e=JSON.stringify(e),i||e.indexOf('"')===-1)?(i&&(e=p(e))," "+s+'="'+e+'"'):" "+s+"='"+e.replace(/'/g,"&#39;")+"'"}function p(s){var e=""+s,i=f.exec(e);if(!i)return s;var u,t,n,o="";for(u=i.index,t=0;u<e.length;u++){switch(e.charCodeAt(u)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t!==u&&(o+=e.substring(t,u)),t=u+1,o+=n}return t!==u?o+e.substring(t,u):o}var f=/["&<>]/;function h(s,e,i,u){if(!(s instanceof Error))throw s;if(!(typeof window>"u"&&e||u))throw s.message+=" on line "+i,s;var t,n,o,r;try{u=u||require("fs").readFileSync(e,{encoding:"utf8"}),t=3,n=u.split(`
`),o=Math.max(i-t,0),r=Math.min(n.length,i+t)}catch(a){return s.message+=" - could not read from "+e+" ("+a.message+")",void h(s,null,i)}t=n.slice(o,r).map(function(a,F){var l=F+o+1;return(l==i?"  > ":"    ")+l+"| "+a}).join(`
`),s.path=e;try{s.message=(e||"Pug")+":"+i+`
`+t+`

`+s.message}catch{}throw s}function w(s){var e="",i,u;try{var t=s||{};(function(n,o,r,a){u=1,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",o.has("sha512")?(u=2,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<div class="g-file-info-line" property="sha512">',u=3,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<i class="icon-barcode"></i>',u=4,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"<span>",u=4,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"SHA-512:</span>",u=5,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"<input"+(' class="g-hash-textbox"'+d("readonly",!0,!0,!1)+' type="text"'+d("value",o.get("sha512"),!0,!1))+"/>",u=6,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"<a"+(' class="g-keyfile-download" title="Download key file"'+d("href",r(o.id,"sha512"),!0,!1))+">",u=7,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<i class="icon-key-inv"></i></a></div>'):a.getAccessLevel()>=n.WRITE&&(u=9,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<div class="g-file-info-line" property="hash-compute">',u=10,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<i class="icon-barcode"></i>',u=11,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"<span>",u=11,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+"Hash unknown &mdash;</span>",u=12,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+'<a class="g-hashsum-compute">',u=12,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/hashsumDownloadFileInfoWidget.pug",e=e+" click to compute</a></div>")}).call(this,"AccessType"in t?t.AccessType:typeof AccessType<"u"?AccessType:void 0,"file"in t?t.file:typeof file<"u"?file:void 0,"keyfileUrl"in t?t.keyfileUrl:typeof keyfileUrl<"u"?keyfileUrl:void 0,"parentItem"in t?t.parentItem:typeof parentItem<"u"?parentItem:void 0)}catch(n){h(n,i,u)}return e}const T="",c=girder.views.widgets.FileInfoWidget,{getApiRoot:_,restRequest:b}=girder.rest,{AccessType:y}=girder.constants,{wrap:v}=girder.utilities.PluginUtils;var C=function(s,e){return`${_()}/file/${s}/hashsum_file/${e}`};v(c,"render",function(s){return s.call(this),this.$('.g-file-info-line[property="id"]').before(w({file:this.model,parentItem:this.parentItem,keyfileUrl:C,AccessType:y})),this}),c.prototype.events||(c.prototype.events={}),c.prototype.events["click .g-hashsum-compute"]=function(){b({url:`file/${this.model.id}/hashsum`,method:"POST",data:{progress:!0}}).done(s=>{this.model.set(s),this.render()})};function E(s,e,i,u){if(e===!1||e==null||!e&&(s==="class"||s==="style"))return"";if(e===!0)return" "+(u?s:s+'="'+s+'"');var t=typeof e;return t!=="object"&&t!=="function"||typeof e.toJSON!="function"||(e=e.toJSON()),typeof e=="string"||(e=JSON.stringify(e),i||e.indexOf('"')===-1)?(i&&(e=k(e))," "+s+'="'+e+'"'):" "+s+"='"+e.replace(/'/g,"&#39;")+"'"}function k(s){var e=""+s,i=j.exec(e);if(!i)return s;var u,t,n,o="";for(u=i.index,t=0;u<e.length;u++){switch(e.charCodeAt(u)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t!==u&&(o+=e.substring(t,u)),t=u+1,o+=n}return t!==u?o+e.substring(t,u):o}var j=/["&<>]/;function g(s,e,i,u){if(!(s instanceof Error))throw s;if(!(typeof window>"u"&&e||u))throw s.message+=" on line "+i,s;var t,n,o,r;try{u=u||require("fs").readFileSync(e,{encoding:"utf8"}),t=3,n=u.split(`
`),o=Math.max(i-t,0),r=Math.min(n.length,i+t)}catch(a){return s.message+=" - could not read from "+e+" ("+a.message+")",void g(s,null,i)}t=n.slice(o,r).map(function(a,F){var l=F+o+1;return(l==i?"  > ":"    ")+l+"| "+a}).join(`
`),s.path=e;try{s.message=(e||"Pug")+":"+i+`
`+t+`

`+s.message}catch{}throw s}function I(s){var e="",i,u;try{var t=s||{};(function(n){u=1,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<div class="g-config-breadcrumb-container"></div>',u=2,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<form id="g-hashsum-download-config-form" role="form">',u=3,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<div class="checkbox">',u=4,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<label class="control-label" for="g-hashsum-download-auto-compute">',u=5,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+"<input"+(' id="g-hashsum-download-auto-compute" type="checkbox"'+E("checked",n["hashsum_download.auto_compute"]?"checked":null,!0,!1))+"/>",u=7,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+"<span>",u=7,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+"Automatically compute file checksums on upload</span></label></div>",u=9,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<p class="g-validation-failed-message" id="g-hashsum-download-error-message"></p>',u=10,i="/home/circleci/project/girder/plugins/hashsum_download/girder_hashsum_download/web_client/templates/config.pug",e=e+'<input class="btn btn-sm btn-primary" type="submit" value="Save"/></form>'}).call(this,"settings"in t?t.settings:typeof settings<"u"?settings:void 0)}catch(n){g(n,i,u)}return e}const W=girder.views.widgets.PluginConfigBreadcrumbWidget,$=girder.views.View,D=girder.events,{restRequest:m}=girder.rest;var x=$.extend({events:{"submit #g-hashsum-download-config-form":function(s){s.preventDefault(),this.$("#g-hashsum-download-error-message").empty(),this._saveSettings([{key:"hashsum_download.auto_compute",value:this.$("#g-hashsum-download-auto-compute").is(":checked")}])}},initialize:function(){this.breadcrumb=new W({pluginName:"Hashsum download",parentView:this}),m({method:"GET",url:"system/setting",data:{list:JSON.stringify(["hashsum_download.auto_compute"])}}).done(s=>{this.settings=s,this.render()})},render:function(){return this.$el.html(I({settings:this.settings})),this.breadcrumb.setElement(this.$(".g-config-breadcrumb-container")).render(),this},_saveSettings:function(s){m({method:"PUT",url:"system/setting",data:{list:JSON.stringify(s)},error:null}).done(()=>{D.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})}).fail(e=>{this.$("#g-hashsum-download-error-message").text(e.responseJSON.message)})}});const S=girder.router,A=girder.events,{exposePluginConfig:O}=girder.utilities.PluginUtils;O("hashsum_download","plugins/hashsum_download/config"),S.route("plugins/hashsum_download/config","hashsumDownloadConfig",function(){A.trigger("g:navigateTo",x)})});
