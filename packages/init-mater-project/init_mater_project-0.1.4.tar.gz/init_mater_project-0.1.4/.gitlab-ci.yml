stages:
  - quality
  - tests
  
lint:
  stage: quality
  image: python:3.12
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  before_script:
    - pip install uv
    - uv sync --group dev
  script:
    - uv run ruff check . --diff
    - uv run ruff format --diff .

test:
  stage: tests
  image: python:3.12
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  before_script:
    - pip install uv
    - uv sync --group test
  script:
    - uv run pytest -v --tb=short

test-cov:
  stage: tests
  image: python:3.12
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
    - if: $CI_COMMIT_BRANCH == "dev"
  before_script:
    - pip install uv
    - uv sync --group test
  script:
    - uv run pytest -v --cov=src/init_mater_project --cov-report=term --cov-report=xml
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
