{% extends "base.html" %}

{% macro percent(numerator, denominator) %}
  {% if denominator %}
    ({{ '%.0f' % ((numerator / denominator) * 100) }}%)
  {% else %}
    &nbsp;
  {% endif %}
{% endmacro %}

{% block main %}
  {% if user_first and user_last %}
    <p>Dear {{ user_first }} {{ user_last }},</p>
  {% else %}
    <p>Dear {{ user_name }},</p>
  {% endif %}

  <p>
    This is an automated notification that the HPC allocation request <strong>"{{ req_title }}"</strong>
    (ID: {{ req_id }}) submitted by the <em>{{ req_team }}</em> team has expired.
  </p>

  <p>
    Your team's total resource usage under this allocation request is provided below.
  </p>

  <table style="width: 100%; border-collapse: collapse; font-family: sans-serif; font-size: 14px;">
    <thead>
    <tr style="background-color: #f2f2f2;">
      <th style="text-align: center; padding: 8px; border: 1px solid #ccc;">Cluster</th>
      <th style="text-align: center; padding: 8px; border: 1px solid #ccc;">Awarded SUs</th>
      <th style="text-align: center; padding: 8px; border: 1px solid #ccc;">Utilized SUs</th>
    </tr>
    </thead>
    <tbody>
    {% for alloc in allocations %}
      <tr>
        <td style="text-align: center; padding: 8px; border: 1px solid #ccc;">{{ alloc.alloc_cluster }}</td>
        <td style="text-align: center; padding: 8px; border: 1px solid #ccc;">{{ "{:,}".format(alloc.alloc_awarded) }}</td>
        <td style="text-align: center; padding: 8px; border: 1px solid #ccc;">
          {{ "{:,}".format(alloc.alloc_final) }} {{ percent(alloc.alloc_final, alloc.alloc_awarded) }}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <p style="padding-top: 10px">
    <strong>What Does This Mean</strong>
  </p>

  <p>
    On {{ req_submitted.strftime('%B %d, %Y') }} your team requested the HPC service units listed above.
    Access to these resources went into effect on {{ req_active.strftime('%B %d, %Y') }} and expired on
    {{ req_expire.strftime('%B %d, %Y') }}.
    Now that the allocation request has expired, any unused service units are no longer available for use by your team.
  </p>

  <p>
    Any resources granted to your team by other allocation requests remain unaffected.
    The system will automatically apply as much of your system usage as possible to the expiring request, maximizing
    the total service units available in any remaining allocations.
  </p>

  <p style="padding-top: 10px">
    <strong>What Happens Now</strong>
  </p>

  <p>
    If you no longer require HPC service units, have already submitted a follow-up request, or have sufficient service
    units through a different request, then no action is required at this time.
  </p>

  <p>
    If you require additional HPC service units, an administrator for the <em>{{ req_team }}</em> team
    will need to submit a new request for additional resources.
  </p>

  <p>
    For any additional questions, please contact your system administrator(s).
  </p>

  <p style="padding-top: 10px">
    Sincerely,<br>The Keystone HPC Utility
  </p>
{% endblock %}
