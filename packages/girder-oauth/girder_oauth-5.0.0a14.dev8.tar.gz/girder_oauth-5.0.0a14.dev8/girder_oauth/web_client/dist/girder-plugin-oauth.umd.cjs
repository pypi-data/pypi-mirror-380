(function(c){typeof define=="function"&&define.amd?define(c):c()})(function(){"use strict";function c(t,u,r,e){if(u===!1||u==null||!u&&(t==="class"||t==="style"))return"";if(u===!0)return" "+(e?t:t+'="'+t+'"');var i=typeof u;return i!=="object"&&i!=="function"||typeof u.toJSON!="function"||(u=u.toJSON()),typeof u=="string"||(u=JSON.stringify(u),r||u.indexOf('"')===-1)?(r&&(u=l(u))," "+t+'="'+u+'"'):" "+t+"='"+u.replace(/'/g,"&#39;")+"'"}function _(t,u){return Array.isArray(t)?$(t,u):t&&typeof t=="object"?I(t):t||""}function $(t,u){for(var r,e="",i="",F=Array.isArray(u),a=0;a<t.length;a++)(r=_(t[a]))&&(F&&u[a]&&(r=l(r)),e=e+i+r,i=" ");return e}function I(t){var u="",r="";for(var e in t)e&&t[e]&&L.call(t,e)&&(u=u+r+e,r=" ");return u}function l(t){var u=""+t,r=x.exec(u);if(!r)return t;var e,i,F,a="";for(e=r.index,i=0;e<u.length;e++){switch(u.charCodeAt(e)){case 34:F="&quot;";break;case 38:F="&amp;";break;case 60:F="&lt;";break;case 62:F="&gt;";break;default:continue}i!==e&&(a+=u.substring(i,e)),i=e+1,a+=F}return i!==e?a+u.substring(i,e):a}var L=Object.prototype.hasOwnProperty,x=/["&<>]/;function E(t,u,r,e){if(!(t instanceof Error))throw t;if(!(typeof window>"u"&&u||e))throw t.message+=" on line "+r,t;var i,F,a,p;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),i=3,F=e.split(`
`),a=Math.max(r-i,0),p=Math.min(F.length,r+i)}catch(g){return t.message+=" - could not read from "+u+" ("+g.message+")",void E(t,null,r)}i=F.slice(a,p).map(function(g,s){var n=s+a+1;return(n==r?"  > ":"    ")+n+"| "+g}).join(`
`),t.path=u;try{t.message=(u||"Pug")+":"+r+`
`+i+`

`+t.message}catch{}throw t}function A(t){var u="",r,e,i;try{var F=t||{};(function(a,p,g){i=1,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-config-breadcrumb-container"></div>',i=3,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-reg-policy-config-container">',i=4,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p>",i=5,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Normally, if the core registration policy is set to closed, OAuth",i=6,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+`
`,i=6,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"users are also not allowed to be created. If you want to override this",i=7,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+`
`,i=7,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"policy and allow OAuth users to register even if the core registration",i=8,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+`
`,i=8,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"policy is closed, check the box below.</p>",i=9,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="checkbox">',i=10,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label>",i=11,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<input class="g-ignore-registration-policy" type="checkbox"/>',i=12,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Ignore closed registration policy</label></div></div>",i=14,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-oauth-provider-list-title">',i=14,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Configure supported providers below</div>",i=15,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p>",i=15,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Only fill in the information for the OAuth2 providers you wish to enable.</p>",i=17,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel-group" id="g-oauth-provider-accordion">',i=18,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",(function(){var s=g;if(typeof s.length=="number")for(var n=0,h=s.length;n<h;n++){var o=s[n];i=19,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel panel-default">',i=20,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<div"+(' class="panel-heading" data-toggle="collapse" data-parent="#g-oauth-provider-accordion"'+c("data-target",`#g-oauth-provider-${o.id}`,!0,!1))+">",i=23,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel-title">',i=24,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<a>",i=25,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<i"+c("class",_([`icon-${o.icon}`],[!0]),!1,!1)+"></i>",i=26,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<span>",i=26,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r)+"</span></a></div></div>",i=27,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<div"+(' class="panel-collapse collapse"'+c("id",`g-oauth-provider-${o.id}`,!0,!1))+">",i=28,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel-body">',i=29,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p>",i=29,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.instructions)==null?"":r)+"</p>",i=30,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",o.hasAuthorizedOrigins&&(i=31,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-oauth-value-container">',i=32,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<b>",i=32,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Authorized javascript origins:</b>",i=33,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<span class="g-oauth-value">',i=33,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=p)==null?"":r)+"</span></div>"),i=34,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-oauth-value-container">',i=35,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<b>",i=35,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Authorized redirect URI:</b>",i=36,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<span class="g-oauth-value">',i=36,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=`${p}${a}/oauth/${o.id}/callback`)==null?"":r)+"</span></div>",i=37,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<form"+(' class="g-oauth-provider-form" role="form"'+c("id",`g-oauth-provider-${o.id}-form`,!0,!1)+c("provider-id",o.id,!0,!1))+">",i=39,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",o.takesTenantId&&(i=40,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-tenant-id`,!0,!1))+">",i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" tenant ID</label>",i=42,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-tenant-id`,!0,!1)+' type="text" placeholder="Tenant ID, e.g., 885af973-684f-2561-7a74-5bedd6a0d901"')+"/></div>"),i=44,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-client-id`,!0,!1))+">",i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" client ID</label>",i=46,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-client-id`,!0,!1)+' type="text" placeholder="Client ID, e.g., b394e84b-a2f1-e65a-b2ef-f7457ccd2d2a"')+"/></div>",i=48,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-client-secret`,!0,!1))+">",i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" client secret</label>",i=50,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-client-secret`,!0,!1)+' type="text" placeholder="Client secret, e.g., bS_BkHNW2DJl-XIvCI3WP6w24~LoC54ZiefaY"')+"/></div>",i=52,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p"+(' class="g-validation-failed-message"'+c("id",`g-oauth-provider-${o.id}-error-message`,!0,!1))+"></p>",i=53,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="btn btn-sm btn-primary" type="submit" value="Save"'+c("provider-id",o.id,!0,!1))+"/></form></div></div></div>"}else{var h=0;for(var n in s){h++;var o=s[n];i=19,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel panel-default">',i=20,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<div"+(' class="panel-heading" data-toggle="collapse" data-parent="#g-oauth-provider-accordion"'+c("data-target",`#g-oauth-provider-${o.id}`,!0,!1))+">",i=23,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel-title">',i=24,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<a>",i=25,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<i"+c("class",_([`icon-${o.icon}`],[!0]),!1,!1)+"></i>",i=26,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<span>",i=26,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r)+"</span></a></div></div>",i=27,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<div"+(' class="panel-collapse collapse"'+c("id",`g-oauth-provider-${o.id}`,!0,!1))+">",i=28,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="panel-body">',i=29,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p>",i=29,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.instructions)==null?"":r)+"</p>",i=30,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",o.hasAuthorizedOrigins&&(i=31,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-oauth-value-container">',i=32,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<b>",i=32,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Authorized javascript origins:</b>",i=33,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<span class="g-oauth-value">',i=33,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=p)==null?"":r)+"</span></div>"),i=34,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="g-oauth-value-container">',i=35,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<b>",i=35,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"Authorized redirect URI:</b>",i=36,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<span class="g-oauth-value">',i=36,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=`${p}${a}/oauth/${o.id}/callback`)==null?"":r)+"</span></div>",i=37,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<form"+(' class="g-oauth-provider-form" role="form"'+c("id",`g-oauth-provider-${o.id}-form`,!0,!1)+c("provider-id",o.id,!0,!1))+">",i=39,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",o.takesTenantId&&(i=40,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-tenant-id`,!0,!1))+">",i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=41,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" tenant ID</label>",i=42,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-tenant-id`,!0,!1)+' type="text" placeholder="Tenant ID, e.g., 885af973-684f-2561-7a74-5bedd6a0d901"')+"/></div>"),i=44,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-client-id`,!0,!1))+">",i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=45,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" client ID</label>",i=46,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-client-id`,!0,!1)+' type="text" placeholder="Client ID, e.g., b394e84b-a2f1-e65a-b2ef-f7457ccd2d2a"')+"/></div>",i=48,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+'<div class="form-group">',i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+c("for",`g-oauth-provider-${o.id}-client-secret`,!0,!1))+">",i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+l((r=o.name)==null?"":r),i=49,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+" client secret</label>",i=50,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm form-control"'+c("id",`g-oauth-provider-${o.id}-client-secret`,!0,!1)+' type="text" placeholder="Client secret, e.g., bS_BkHNW2DJl-XIvCI3WP6w24~LoC54ZiefaY"')+"/></div>",i=52,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<p"+(' class="g-validation-failed-message"'+c("id",`g-oauth-provider-${o.id}-error-message`,!0,!1))+"></p>",i=53,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/configView.pug",u=u+"<input"+(' class="btn btn-sm btn-primary" type="submit" value="Save"'+c("provider-id",o.id,!0,!1))+"/></form></div></div></div>"}}}).call(this),u=u+"</div>"}).call(this,"apiRoot"in F?F.apiRoot:typeof apiRoot<"u"?apiRoot:void 0,"origin"in F?F.origin:typeof origin<"u"?origin:void 0,"providers"in F?F.providers:typeof providers<"u"?providers:void 0)}catch(a){E(a,e,i)}return u}const u0="",V=girder.$,d=girder._,O=girder.views.widgets.PluginConfigBreadcrumbWidget,T=girder.views.View,{getApiRoot:P,restRequest:b}=girder.rest,j=girder.events;var D=T.extend({events:{"submit .g-oauth-provider-form":function(t){t.preventDefault();var u=V(t.target).attr("provider-id");this.$("#g-oauth-provider-"+u+"-error-message").empty();const r=[{key:"oauth."+u+"_client_id",value:this.$("#g-oauth-provider-"+u+"-client-id").val().trim()},{key:"oauth."+u+"_client_secret",value:this.$("#g-oauth-provider-"+u+"-client-secret").val().trim()}];d.findWhere(this.providers,{id:u}).takesTenantId&&r.push({key:"oauth."+u+"_tenant_id",value:this.$("#g-oauth-provider-"+u+"-tenant-id").val().trim()}),this._saveSettings(u,r)},"change .g-ignore-registration-policy":function(t){b({method:"PUT",url:"system/setting",data:{key:"oauth.ignore_registration_policy",value:V(t.target).is(":checked")}}).done(()=>{j.trigger("g:alert",{icon:"ok",text:"Setting saved.",type:"success",timeout:3e3})})}},initialize:function(){this.providers=[{id:"google",name:"Google",icon:"google",hasAuthorizedOrigins:!0,takesTenantId:!1,instructions:"Client IDs and secret keys are managed in the Google Developer Console. When creating your client ID there, use the following values:"},{id:"globus",name:"Globus",icon:"globe",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:"Client IDs and secret keys are managed in the Google Developer Console. When creating your client ID there, use the following values:"},{id:"github",name:"GitHub",icon:"github-circled",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:"Client IDs and secret keys are managed in the Applications page of your GitHub account settings. Use the following as the authorization callback URL:"},{id:"bitbucket",name:"Bitbucket",icon:"bitbucket",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:"Client IDs and secret keys are managed in the Applications page of your Bitbucket account settings. Use the following as the authorization callback URL:"},{id:"microsoft",name:"Microsoft",icon:"microsoft",hasAuthorizedOrigins:!1,takesTenantId:!0,instructions:'Application (client) ID and secret keys can be found at the "Overview" and "Certificates & secrets" sections of the Azure application website. Select the "User.Read" permission under "API permissions - Microsoft Graph - Delegated permissions" and add this callback URL to the "Redirect URIs" under "Authentication":'},{id:"linkedin",name:"LinkedIn",icon:"linkedin",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:'Client IDs and secret keys are managed at the Applications page of the LinkedIn Developers site. Select the "r_basicprofile" and "r_emailaddress" Default Application Permissions, and use the following as an OAuth 2.0 Authorized Redirect URL:'},{id:"box",name:"Box",icon:"box-brand",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:"Client IDs and secret keys are managed in the Box Developer Services page. When creating your client ID there, use the following as the authorization callback URL:"},{id:"cilogon",name:"CILogon",icon:"cilogon",hasAuthorizedOrigins:!1,takesTenantId:!1,instructions:"Client IDs and secret keys are managed through the CILogon Client Registration page. When creating your client ID there, use the following as the authorization callback URL:"}],this.providerIds=d.pluck(this.providers,"id");var t=["oauth.ignore_registration_policy"];d.each(this.providerIds,function(u){t.push("oauth."+u+"_client_id"),t.push("oauth."+u+"_client_secret"),d.findWhere(this.providers,{id:u}).takesTenantId&&t.push("oauth."+u+"_tenant_id")},this),b({method:"GET",url:"system/setting",data:{list:JSON.stringify(t)}}).done(u=>{this.settingVals=u,this.render()})},render:function(){var t=window.location.protocol+"//"+window.location.host,u=P();if(u.substring(0,1)!=="/"&&(u="/"+u),this.$el.html(A({origin:t,apiRoot:u,providers:this.providers})),this.breadcrumb||(this.breadcrumb=new O({pluginName:"OAuth login",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render()),this.settingVals){d.each(this.providerIds,function(e){this.$("#g-oauth-provider-"+e+"-client-id").val(this.settingVals["oauth."+e+"_client_id"]),this.$("#g-oauth-provider-"+e+"-client-secret").val(this.settingVals["oauth."+e+"_client_secret"]),d.findWhere(this.providers,{id:e}).takesTenantId&&this.$("#g-oauth-provider-"+e+"-tenant-id").val(this.settingVals["oauth."+e+"_tenant_id"])},this);var r=this.settingVals["oauth.ignore_registration_policy"];this.$(".g-ignore-registration-policy").attr("checked",r?"checked":null)}return this},_saveSettings:function(t,u){u.push({key:"oauth.providers_enabled",value:d.filter(this.providerIds,function(r){return!!this.$("#g-oauth-provider-"+r+"-client-id").val()},this)}),b({method:"PUT",url:"system/setting",data:{list:JSON.stringify(u)},error:null}).done(()=>{j.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:3e3})}).fail(r=>{this.$("#g-oauth-provider-"+t+"-error-message").text(r.responseJSON.message)})}});const R=girder.events,S=girder.router,{exposePluginConfig:z}=girder.utilities.PluginUtils;z("oauth","plugins/oauth/config"),S.route("plugins/oauth/config","oauthConfig",function(){R.trigger("g:navigateTo",D)});function m(t,u,r,e){if(u===!1||u==null||!u&&(t==="class"||t==="style"))return"";if(u===!0)return" "+(e?t:t+'="'+t+'"');var i=typeof u;return i!=="object"&&i!=="function"||typeof u.toJSON!="function"||(u=u.toJSON()),typeof u=="string"||(u=JSON.stringify(u),r||u.indexOf('"')===-1)?(r&&(u=w(u))," "+t+'="'+u+'"'):" "+t+"='"+u.replace(/'/g,"&#39;")+"'"}function f(t,u){return Array.isArray(t)?U(t,u):t&&typeof t=="object"?W(t):t||""}function U(t,u){for(var r,e="",i="",F=Array.isArray(u),a=0;a<t.length;a++)(r=f(t[a]))&&(F&&u[a]&&(r=w(r)),e=e+i+r,i=" ");return e}function W(t){var u="",r="";for(var e in t)e&&t[e]&&N.call(t,e)&&(u=u+r+e,r=" ");return u}function w(t){var u=""+t,r=J.exec(u);if(!r)return t;var e,i,F,a="";for(e=r.index,i=0;e<u.length;e++){switch(u.charCodeAt(e)){case 34:F="&quot;";break;case 38:F="&amp;";break;case 60:F="&lt;";break;case 62:F="&gt;";break;default:continue}i!==e&&(a+=u.substring(i,e)),i=e+1,a+=F}return i!==e?a+u.substring(i,e):a}var N=Object.prototype.hasOwnProperty,J=/["&<>]/;function y(t,u,r,e){if(!(t instanceof Error))throw t;if(!(typeof window>"u"&&u||e))throw t.message+=" on line "+r,t;var i,F,a,p;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),i=3,F=e.split(`
`),a=Math.max(r-i,0),p=Math.min(F.length,r+i)}catch(g){return t.message+=" - could not read from "+u+" ("+g.message+")",void y(t,null,r)}i=F.slice(a,p).map(function(g,s){var n=s+a+1;return(n==r?"  > ":"    ")+n+"| "+g}).join(`
`),t.path=u;try{t.message=(u||"Pug")+":"+r+`
`+i+`

`+t.message}catch{}throw t}function q(t){var u="",r,e,i;try{var F=t||{};(function(a,p,g){i=1,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-container">',i=2,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-section-header">',i=3,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-section-header-text">',i=4,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",p?(i=5,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"Or ",i=5,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+w((r=g)==null?"":r),i=5,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+" with"):(i=7,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"Log in with"),u=u+"</div></div>",i=8,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",(function(){var s=a;if(typeof s.length=="number")for(var n=0,h=s.length;n<h;n++){var o=s[n];i=9,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"<div"+(m("class",f(["g-oauth-button",o.class],[!1,!0]),!1,!1)+m("g-provider",o.providerId,!0,!1))+">",i=10,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-button-icon">',i=11,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"<i"+m("class",f([`icon-${o.icon}`],[!0]),!1,!1)+"></i></div>",i=12,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-button-text">',i=12,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+w((r=o.text||o.providerId)==null?"":r)+"</div></div>"}else{var h=0;for(var n in s){h++;var o=s[n];i=9,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"<div"+(m("class",f(["g-oauth-button",o.class],[!1,!0]),!1,!1)+m("g-provider",o.providerId,!0,!1))+">",i=10,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-button-icon">',i=11,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+"<i"+m("class",f([`icon-${o.icon}`],[!0]),!1,!1)+"></i></div>",i=12,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+'<div class="g-oauth-button-text">',i=12,e="/home/circleci/project/girder/plugins/oauth/girder_oauth/web_client/templates/oauthLoginView.pug",u=u+w((r=o.text||o.providerId)==null?"":r)+"</div></div>"}}}).call(this),u=u+"</div>"}).call(this,"buttons"in F?F.buttons:typeof buttons<"u"?buttons:void 0,"enablePasswordLogin"in F?F.enablePasswordLogin:typeof enablePasswordLogin<"u"?enablePasswordLogin:void 0,"modeText"in F?F.modeText:typeof modeText<"u"?modeText:void 0)}catch(a){y(a,e,i)}return u}const e0="",B=girder.$,v=girder._,G=girder.views.View,{restRequest:M}=girder.rest,{splitRoute:H}=girder.misc;var k=G.extend({events:{"click .g-oauth-button":function(t){var u=B(t.currentTarget).attr("g-provider"),r=v.findWhere(this.providers,{id:u});window.location=r.url}},initialize:function(t){var u=t.redirect||H(window.location.href).base;this.modeText=t.modeText||"log in",this.providers=null,this.enablePasswordLogin=v.has(t,"enablePasswordLogin")?t.enablePasswordLogin:!0,M({url:"oauth/provider",data:{redirect:u,list:!0}}).done(r=>{this.providers=r,this.render()})},render:function(){if(this.providers===null)return this;var t=[];return v.each(this.providers,function(u){var r=this._buttons[u.id];r?(r.providerId=u.id,r.text=u.name,t.push(r)):console.warn("Unsupported OAuth2 provider: "+u.id)},this),t.length&&this.$el.append(q({modeText:this.modeText,buttons:t,enablePasswordLogin:this.enablePasswordLogin})),this},_buttons:{google:{icon:"gplus",class:"g-oauth-button-google"},globus:{icon:"globe",class:"g-oauth-button-globus"},github:{icon:"github-circled",class:"g-oauth-button-github"},bitbucket:{icon:"bitbucket",class:"g-oauth-button-bitbucket"},microsoft:{icon:"microsoft",class:"g-oauth-button-microsoft"},linkedin:{icon:"linkedin",class:"g-oauth-button-linkedin"},box:{icon:"box",class:"g-oauth-button-box"},cilogon:{icon:"cilogon",class:"g-oauth-button-box"}}});const X=girder.views.layout.LoginView,{wrap:Y}=girder.utilities.PluginUtils;Y(X,"render",function(t){return t.call(this),new k({el:this.$(".modal-body"),parentView:this,enablePasswordLogin:this.enablePasswordLogin}).render(),this});const Z=girder.views.layout.RegisterView,{getCurrentUser:K}=girder.auth,{wrap:Q}=girder.utilities.PluginUtils;Q(Z,"render",function(t){return t.call(this),K()||new k({el:this.$(".modal-body"),parentView:this,modeText:"register automatically"}).render(),this});const C=new URLSearchParams(window.location.search).get("girderToken");if(C){window.localStorage.setItem("girderToken",C),girder.auth.setCurrentToken(C);const t=new URLSearchParams(window.location.search);t.delete("girderToken"),window.location.search=t.toString()}});
