[
    {"trigger": "reload_config_trigger", "source": ["Starting"], "dest": "Creating container", "after": "create"},
    {"trigger": "build_image_trigger", "source": ["Starting"], "dest": "Building image", "after": "build_image"},
    {"trigger": "commit_history_trigger", "source": ["Starting"], "dest": "Building commit history", "after": "commit_history"},
    {"trigger": "create_trigger", "source": ["Starting"], "dest": "Building image", "before": "verify_quantity_instances", "after": "build_image", "conditions": ["build_image_required"]},
    {"trigger": "create_trigger", "source": ["Starting"], "dest": "Creating container", "before": "verify_quantity_instances", "after": "create", "unless": ["build_image_required", "create_database"]},
    {"trigger": "create_trigger", "source": ["Starting"], "dest": "Restoring backup", "conditions": ["create_database"], "unless": ["keep_database", "use_btrfs", "use_zfs"], "before": "verify_quantity_instances", "after": "restore"},
    {"trigger": "create_trigger", "source": ["Starting"], "dest": "Restoring btrfs backup", "conditions": ["create_database", "use_btrfs"], "before": "verify_quantity_instances", "after": "restore_snapshot"},
    {"trigger": "create_trigger", "source": ["Starting"], "dest": "Restoring zfs backup", "conditions": ["create_database", "use_zfs"], "before": "verify_quantity_instances", "after": "restore_snapshot"},
    {"trigger": "restore_trigger", "source": ["Starting"], "dest": "Restoring backup", "after": "restore"},
    {"trigger": "deactivate_trigger", "source": ["Starting"], "dest": "Deactivating database", "after": "deactivate"},
    {"trigger": "instance_restart_trigger", "source": ["Starting"], "dest": "Restarting instance", "after": "restart_instance"},
    {"trigger": "container_restart_trigger", "source": ["Starting"], "dest": "Restarting container", "after": "restart_container"},
    {"trigger": "change_passwords_trigger", "source": ["Starting"], "dest": "Changing passwords", "after": "change_passwords"},
    {"trigger": "destroy_trigger", "source": ["Starting"], "dest": "Destroying instance", "after": "delete_instance"},
    {"trigger": "backup_trigger", "source": ["Starting"], "dest": "Generating backup", "after": "backup"},
    {"trigger": "deactivate_backup_trigger", "source": ["Starting"], "dest": "Deactivating backup", "conditions": ["deactivating_backup"], "after": "deactivate_backup"},
    {"trigger": "push_images_trigger", "source": ["Starting"], "dest": "Pushing images", "after": "push_image"},
    {"trigger": "update_prod_trigger", "source": ["Starting"], "dest": "Updating production instance", "after": "update_production", "conditions": "_check_update_production_requirements"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Pushing images", "conditions": ["create_container"], "unless": ["skip_push"], "after": "push_image"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Restoring btrfs backup", "conditions": ["create_database", "use_btrfs", "skip_push"],  "unless": ["keep_database"], "after": "restore_snapshot"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Restoring zfs backup", "conditions": ["create_database", "use_zfs", "skip_push"],  "unless": ["keep_database"], "after": "restore_snapshot"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Restoring backup", "conditions": ["create_database", "skip_push"],  "unless": ["keep_database", "use_zfs", "use_btrfs"], "after": "restore"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Creating container", "conditions": ["create_container", "skip_push", "keep_database"], "unless": ["create_database"], "after": "create"},
    {"trigger": "build_done_trigger", "source": ["Building image"], "dest": "Done", "unless": ["create_container"], "before": "clean_working_folders"},
    {"trigger": "push_images_done_trigger", "source": ["Pushing images"], "dest": "Restoring btrfs backup", "conditions": ["create_database", "use_btrfs"],  "unless": ["keep_database", "pushing_images"], "after": "restore_snapshot"},
    {"trigger": "push_images_done_trigger", "source": ["Pushing images"], "dest": "Restoring zfs backup", "conditions": ["create_database", "use_zfs"],  "unless": ["keep_database", "pushing_images"], "after": "restore_snapshot"},
    {"trigger": "push_images_done_trigger", "source": ["Pushing images"], "dest": "Restoring backup", "conditions": ["create_database"], "unless": ["pushing_images", "keep_database", "use_zfs", "use_btrfs"], "after": "restore"},
    {"trigger": "push_images_done_trigger", "source": ["Pushing images"], "dest": "Creating container", "conditions": ["create_container", "keep_database"], "unless": ["pushing_images"], "after": "create"},
    {"trigger": "push_images_done_trigger", "source": ["Pushing images"], "dest": "Done", "conditions": ["pushing_images"], "before": "clean_working_folders"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Deactivating database", "conditions": ["keep_database"], "unless": ["is_production"], "after": "deactivate"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Deactivating database", "conditions": ["use_btrfs"], "after": "deactivate"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Deactivating database", "conditions": ["use_zfs"], "after": "deactivate"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Executing final steps", "unless": ["create_database", "keep_database", "reloading_config", "use_btrfs", "use_zfs", "update_required"], "after": "post_process"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Executing final steps", "conditions": ["test_instance_created"], "after": "post_process"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Updating database", "conditions": ["update_required", "container_created"], "unless": ["reloading_config"], "after": "updatedb"},
    {"trigger": "create_done_trigger", "source": ["Creating container"], "dest": "Done", "conditions": ["reloading_config"], "unless": ["create_database", "keep_database"], "before": "clean_working_folders"},
    {"trigger": "restore_done_trigger", "source": ["Restoring backup"], "dest": "Deactivating database", "conditions": ["deactivate_required"], "after": "deactivate"},
    {"trigger": "restore_done_trigger", "source": ["Restoring backup"], "dest": "Updating database", "conditions": ["update_required"] ,"unless": ["deactivate_required"], "after": "updatedb"},
    {"trigger": "restore_done_trigger", "source": ["Restoring backup"], "dest": "Executing final steps", "unless": ["create_container", "update_required", "deactivate_required"], "after": "post_process"},
    {"trigger": "restore_done_trigger", "source": ["Restoring backup"], "dest": "Creating container", "after": "create", "conditions": ["create_container"], "unless": ["deactivate_required"]},
    {"trigger": "restore_done_trigger", "source": ["Restoring btrfs backup", "Restoring zfs backup"], "dest": "Creating container", "after": "create"},
    {"trigger": "deactivate_done_trigger", "source": ["Deactivating database"], "dest": "Creating container", "conditions": ["create_container"], "unless": ["deactivating_database", "container_created"], "after": "create"},
    {"trigger": "deactivate_done_trigger", "source": ["Deactivating database"], "dest": "Updating database", "conditions": ["update_required", "container_created"], "unless": ["deactivating_database"], "after": "updatedb"},
    {"trigger": "deactivate_done_trigger", "source": ["Deactivating database"], "dest": "Executing final steps", "conditions": ["container_created"], "unless": ["update_required", "deactivating_database"], "after": "post_process"},
    {"trigger": "deactivate_done_trigger", "source": ["Deactivating database"], "dest": "Done", "conditions": ["deactivating_database"], "unless": ["create_container"], "before": "clean_working_folders"},
    {"trigger": "update_done_trigger", "source": ["Updating database"], "dest": "Deactivating database", "conditions": ["deactivate_required"], "after": "deactivate"},
    {"trigger": "update_done_trigger", "source": ["Updating database"], "dest": "Executing final steps", "unless": ["deactivate_required"], "after": "post_process"},
    {"trigger": "destroy_done_trigger", "source": "Destroying instance", "dest": "Building image", "conditions": ["build_image_required", "create_container"], "after": "build_image"},
    {"trigger": "destroy_done_trigger", "source": ["Destroying instance"], "dest": "Restoring btrfs backup", "conditions": ["create_container", "create_database", "use_btrfs"], "after": "restore_snapshot"},
    {"trigger": "destroy_done_trigger", "source": ["Destroying instance"], "dest": "Restoring zfs backup", "conditions": ["create_container", "create_database", "use_zfs"], "after": "restore_snapshot"},
    {"trigger": "destroy_done_trigger", "source": ["Destroying instance"], "dest": "Restoring backup", "conditions": ["create_container", "create_database"], "unless": ["build_image_required", "keep_database", "use_btrfs", "use_zfs"], "after": "restore"},
    {"trigger": "destroy_done_trigger", "source": ["Destroying instance"], "dest": "Creating container", "conditions": ["create_container"], "unless": ["build_image_required"], "after": "create"},
    {"trigger": "destroy_done_trigger", "source": ["Destroying instance"], "dest": "Done", "unless": ["create_container"], "before": "clean_working_folders"},
    {"trigger": "done_trigger", "source": "*", "dest": "Done", "before": "clean_working_folders"},
    {"trigger": "error_trigger", "source": "*", "dest": "Error", "unless": ["need_revert"], "before": "clean_working_folders"},
    {"trigger": "error_trigger", "source": "Updating production instance", "dest": "Creating container", "after": "create", "conditions": ["need_revert"]}
]
