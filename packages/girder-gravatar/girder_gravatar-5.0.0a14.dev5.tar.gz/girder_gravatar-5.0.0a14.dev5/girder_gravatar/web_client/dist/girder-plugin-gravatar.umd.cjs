(function(i){typeof define=="function"&&define.amd?define(i):i()})(function(){"use strict";function i(r,e,u,t){if(!(r instanceof Error))throw r;if(!(typeof window>"u"&&e||t))throw r.message+=" on line "+u,r;var a,n,s,c;try{t=t||require("fs").readFileSync(e,{encoding:"utf8"}),a=3,n=t.split(`
`),s=Math.max(u-a,0),c=Math.min(n.length,u+a)}catch(g){return r.message+=" - could not read from "+e+" ("+g.message+")",void i(r,null,u)}a=n.slice(s,c).map(function(g,C){var o=C+s+1;return(o==u?"  > ":"    ")+o+"| "+g}).join(`
`),r.path=e;try{r.message=(e||"Pug")+":"+u+`
`+a+`

`+r.message}catch{}throw r}function l(r){var e="",u,t;try{t=1,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<div class="g-config-breadcrumb-container"></div>',t=2,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<p class="g-gravatar-description">',t=3,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+"The default image can be a URL, or one of the special defaults mentioned&nbsp;",t=4,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<a href="https://en.gravatar.com/site/implement/images/">',t=4,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+"here.</a></p>",t=5,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<form id="g-gravatar-settings-form" role="form">',t=6,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<div class="form-group">',t=7,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<label class="control-label" for="g-gravatar-default-image">',t=7,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+"Default image</label>",t=8,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<input class="input-sm form-control" id="g-gravatar-default-image" type="text" placeholder="Default image"/></div>',t=10,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<p class="g-validation-failed-message" id="g-gravatar-error-message"></p>',t=11,u="/home/circleci/project/girder/plugins/gravatar/girder_gravatar/web_client/templates/configView.pug",e=e+'<input class="btn btn-sm btn-primary" type="submit" value="Save"/></form>'}catch(a){i(a,u,t)}return e}const d=girder.views.widgets.PluginConfigBreadcrumbWidget,p=girder.views.View,m=girder.events,{restRequest:F}=girder.rest;var v=p.extend({events:{"submit #g-gravatar-settings-form":function(r){r.preventDefault(),this.$("#g-gravatar-error-message").empty(),this._saveSettings([{key:"gravatar.default_image",value:this.$("#g-gravatar-default-image").val().trim()}])}},initialize:function(){F({method:"GET",url:"system/setting",data:{list:JSON.stringify(["gravatar.default_image"])}}).done(r=>{this.render(),this.$("#g-gravatar-default-image").val(r["gravatar.default_image"])})},render:function(){return this.$el.html(l()),this.breadcrumb||(this.breadcrumb=new d({pluginName:"Gravatar portraits",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render()),this},_saveSettings:function(r){F({method:"PUT",url:"system/setting",data:{list:JSON.stringify(r)},error:null}).done(()=>{m.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})}).fail(e=>{this.$("#g-gravatar-error-message").text(e.responseJSON.message)})}});const f=girder.router,h=girder.events,{exposePluginConfig:w}=girder.utilities.PluginUtils;w("gravatar","plugins/gravatar/config"),f.route("plugins/gravatar/config","gravatarConfig",function(){h.trigger("g:navigateTo",v)});const b=girder.models.UserModel,{getApiRoot:_}=girder.rest;b.prototype.getGravatarUrl=function(r){r=r||64;var e=this.get("gravatar_baseUrl");return e||`${_()}/user/${this.id}/gravatar?size=${r}`}});
