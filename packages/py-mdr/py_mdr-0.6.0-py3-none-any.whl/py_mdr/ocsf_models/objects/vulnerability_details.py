from dataclasses import dataclass, field
from datetime import datetime
from typing import List

from py_mdr.ocsf_models.objects.affected_code import AffectedCode, AffectedSoftwarePackage
from py_mdr.ocsf_models.objects.base_model import BaseModel
from py_mdr.ocsf_models.objects.kb_article import KBArticle
from py_mdr.ocsf_models.objects.remediation import Remediation
from py_mdr.ocsf_models.objects.vulnerabilities import CVE, CWE


@dataclass
class VulnerabilityDetails(BaseModel):
    """
    The vulnerability is an unintended characteristic of a computing component or system configuration that multiplies the risk of an adverse event or a loss occurring either due to accidental exposure, deliberate attack, or conflict with new system components.

    Attributes:
    - Affected Code (affected_code) [Optional]: List of AffectedCode objects that describe details about code blocks identified as vulnerable.
    - Affected Software Packages (affected_packages) [Optional]: List of software packages identified as affected by a vulnerability/vulnerabilities.
    - CVE (cve) [Recommended]: The Common Vulnerabilities and Exposures (CVE).
    - CWE (cwe) [Recommended]: The CWE object represents a weakness in a software system that can be exploited by a threat actor to perform an attack.
    - Description (desc) [Optional]: The description of the vulnerability.
    - Exploit Availability (is_exploit_available) [Optional]: Indicates if an exploit or a PoC (proof-of-concept) is available for the reported vulnerability.
    - First Seen (first_seen_time) [Optional]: The time when the vulnerability was first observed.
    - First Seen (first_seen_time_dt) [Optional]: The time when the vulnerability was first observed in datetime format.
    - Knowledgebase Articles (kb_article_list) [Optional]: A list of KB articles or patches related to an endpoint. A KB Article contains metadata that describes the patch or an update.
    - Last Seen (last_seen_time) [Optional]: The time when the vulnerability was most recently observed.
    - Last Seen (last_seen_time_dt) [Optional]: The time when the vulnerability was most recently observed in datetime format.
    - References (references) [Recommended]: A list of reference URLs with additional information about the vulnerability.
    - Related Vulnerabilities (related_vulnerabilities) [Optional]: List of vulnerabilities that are related to this vulnerability.
    - Remediation Guidance (remediation) [Optional]: The remediation recommendations on how to mitigate the identified vulnerability.
    - Severity (severity) [Optional]: The vendor assigned severity of the vulnerability.
    - Title (title) [Optional]: A title or a brief phrase summarizing the discovered vulnerability.
    - Vendor Name (vendor_name) [Optional]: The name of the vendor that identified the vulnerability.
    """

    affected_code: List[AffectedCode] = field(default_factory=list)
    affected_packages: List[AffectedSoftwarePackage] = field(default_factory=list)
    cve: CVE = field(default_factory=CVE)
    cwe: CWE = field(default_factory=CWE)
    desc: str = None
    is_exploit_available: bool = None
    first_seen_time: int = None
    first_seen_time_dt: datetime = None
    kb_article_list: List[KBArticle] = field(default_factory=list)
    last_seen_time: int = None
    last_seen_time_dt: datetime = None
    references: List[str] = field(default_factory=list)
    related_vulnerabilities: List[str] = field(default_factory=list)
    remediation: Remediation = field(default_factory=Remediation)
    severity: str = None
    title: str = None
    vendor_name: str = None
