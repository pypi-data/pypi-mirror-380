import{w as A,v as w,a as u,G as I,y as P,q as v,A as C}from"./chunk-QMGIS6GS-Ycl3lDfV.js";import{j as e}from"./index-B4oKE3iz.js";import{J as b,I as K,a as _,b as B,P as D}from"./PackageCard-BU9c_QO4.js";import{T as t,d as z}from"./dayjs.min-B_dhOL6t.js";import{f as J}from"./api-tgDzxHzW.js";import{u as L}from"./ScrollArea-DZ4wk0Ci.js";import{B as g,L as N}from"./Loader-B9JD8HZZ.js";import{G as x}from"./Group-3SoFkW_U.js";import{T as j}from"./Title-CmbW-mDV.js";import{D as R}from"./Divider-DNtoRLi1.js";import{C as F}from"./Card-Dow6iKi0.js";import{P as G}from"./Paper-C4kvkNN2.js";import{B as f}from"./Button-kXQ3kFES.js";import{I as V}from"./IconArrowLeft-CZ1KUR1o.js";import{S}from"./SimpleGrid-B3GKyrsx.js";import{T as E}from"./Text-BRX5JXq7.js";import{B as M}from"./Badge-C-Zq__Qu.js";import{I as O}from"./Input-Dk8j5b2Q.js";import{m as k}from"./events-Bu47C8H8.js";import{S as Y}from"./Stack-CyWGn-AO.js";import{P as q}from"./PasswordInput-1a3PblwM.js";import"./createReactComponent-BN_c2kk2.js";import"./create-safe-context-Bb_7Uh0a.js";import"./floating-ui.react-BY6ulEKs.js";import"./CloseButton-Dy-wbEsU.js";import"./use-merged-ref-BUQ1B9HC.js";import"./DirectionProvider-DuCsFlA9.js";import"./px-CiO0pVtX.js";import"./get-sorted-breakpoints-CWbmZd_q.js";import"./ActionIcon-55kNUHHC.js";import"./use-input-props-BMt-FEuk.js";function we(){return[{title:"New Agent | JIVAS Manager"}]}async function Ie({request:m}){const a=new URL(m.url),s=a.searchParams.get("limit")||"10",r=a.searchParams.get("offset")||"0",n=a.searchParams.get("search")||"",l=a.searchParams.get("type")||"agent",o=localStorage.getItem("jpr-key")||null,i=new URL(`${b}/packages/search`);i.searchParams.set("limit",s),i.searchParams.set("offset",r),i.searchParams.set("q",n),console.log({packageType:l,search:n}),i.searchParams.set("type",l==="all"?"":l);const c=o?{"x-api-key":o}:void 0;console.log({headers:c});const d=await fetch(i.toString(),{method:"GET",headers:{...c,"Content-Type":"application/json"}}).then(h=>h.json());return{packages:d.packages,totalPackages:d.total,apiKey:o||""}}async function ve({request:m}){var l;const a=localStorage.getItem("jivas-host"),s=localStorage.getItem("jpr-key"),r=await m.formData(),n=r.get("_action");if(n==="createAgentFromDaf"){const o=r.get("version"),i=r.get("package"),c=await J(`${a}/walker/import_agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reporting:!0,daf_name:i,daf_version:o||"latest",jpr_api_key:s||void 0})}).then(async h=>await h.json()),d=(l=c.reports)==null?void 0:l[0];return d?(localStorage.setItem("jivas-agent",d.id),w("/dashboard")):c.reports}if(n==="updateJPRApiKey"){const o=r.get("apiKey");return localStorage.setItem("jpr-key",o||""),{}}}const Ce=A(function({loaderData:a}){var y;localStorage.getItem("jivas-host"),localStorage.getItem("jivas-token");const[s,r]=u.useState(null),[n,l]=u.useState(new Set([])),[o,i]=I(),c=P(),d=L(async p=>{o.set("search",p),i(o)},500),h=v(),T=C();return e.jsxs(g,{py:"xl",px:"xl",children:[e.jsx(x,{justify:"space-between",children:e.jsx(j,{order:3,children:"New Agent"})}),e.jsx(R,{mt:"xs",mb:"xl"}),e.jsx(F,{h:"80vh",px:"xs",withBorder:!0,children:e.jsxs(G,{p:"md",radius:"md",h:"100%",children:[e.jsx(j,{order:3,children:"Browse Agents"}),s?e.jsxs(g,{mt:"xl",children:[e.jsxs(x,{children:[e.jsx(f,{onClick:()=>r(null),size:"xs",leftSection:e.jsx(V,{size:16}),color:"dark",children:"Back"}),e.jsx(j,{order:4,children:s.title})]}),e.jsxs(S,{mt:"lg",cols:{base:1,md:2},children:[e.jsxs(g,{children:[e.jsx(j,{order:6,children:"Description"}),e.jsx(E,{size:"sm",c:"gray.7",children:s.description})]}),e.jsxs(g,{children:[e.jsx(t,{variant:"vertical",layout:"fixed",withTableBorder:!0,children:e.jsxs(t.Tbody,{children:[e.jsxs(t.Tr,{children:[e.jsx(t.Th,{w:160,children:"Package"}),e.jsx(t.Td,{children:s.package})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Version"}),e.jsx(t.Td,{children:s.version})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Category"}),e.jsx(t.Td,{children:e.jsx(M,{color:"dark",children:s.type})})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Downloads"}),e.jsx(t.Td,{children:s.downloads})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Last Published"}),e.jsx(t.Td,{children:z(s.publishedAt).format("MMMM D, YYYY h:mm:ss A")})]})]})}),e.jsx(x,{justify:"end",mt:"lg",children:e.jsx(f,{onClick:()=>c.submit({_action:"createAgentFromDaf",package:s.package,version:s.version},{method:"POST"}),leftSection:e.jsx(K,{size:16}),loading:c.state!=="idle",color:"dark",children:"Create Agent"})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{my:"lg",children:[e.jsx(O,{placeholder:"Search Agent",w:400,rightSection:h.state==="loading"&&h.location.pathname==T.pathname?e.jsx(N,{size:"xs"}):null,onChange:p=>{d(p.target.value)},leftSection:e.jsx(_,{size:16})}),e.jsx(f,{size:"sm",color:"dark",onClick:()=>k.open({title:"JPR Configuration",children:e.jsx(U,{apiKeyInit:a.apiKey})}),leftSection:e.jsx(B,{size:16}),children:"Configure"})]}),e.jsx(S,{cols:{base:1,md:2,lg:4},children:(y=a.packages)==null?void 0:y.map(p=>e.jsx(D,{onClick:r,pkg:p},p.id))})]})]})})]})});function U({apiKeyInit:m}){const[a,s]=u.useState(m),r=P();return e.jsxs(Y,{children:[e.jsx(q,{label:"API Key",placeholder:"API Key",value:a||"",onChange:n=>s(n.target.value)}),e.jsx(f,{size:"sm",color:"dark",mt:"sm",loading:r.state!=="idle",onClick:()=>{r.submit({apiKey:a,_action:"updateJPRApiKey"},{method:"POST",action:"/new-agent"}),k.closeAll()},children:"Save"})]})}export{ve as clientAction,Ie as clientLoader,Ce as default,we as meta};
