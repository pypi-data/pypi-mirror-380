import{w as I,v,a as y,G as w,y as A,q as C,A as b,z as K}from"./chunk-QMGIS6GS-Ycl3lDfV.js";import{j as e}from"./index-B4oKE3iz.js";import{J as z,I as _,a as B,b as J,P as L}from"./PackageCard-BU9c_QO4.js";import{T as t,d as D}from"./dayjs.min-B_dhOL6t.js";import{f as R}from"./api-tgDzxHzW.js";import{u as G}from"./ScrollArea-DZ4wk0Ci.js";import{B as x,L as N}from"./Loader-B9JD8HZZ.js";import{G as g}from"./Group-3SoFkW_U.js";import{A as E}from"./ActionIcon-55kNUHHC.js";import{I as k}from"./IconArrowLeft-CZ1KUR1o.js";import{T as j}from"./Title-CmbW-mDV.js";import{D as M}from"./Divider-DNtoRLi1.js";import{C as O}from"./Card-Dow6iKi0.js";import{P as V}from"./Paper-C4kvkNN2.js";import{B as u}from"./Button-kXQ3kFES.js";import{S as P}from"./SimpleGrid-B3GKyrsx.js";import{T as F}from"./Text-BRX5JXq7.js";import{B as Y}from"./Badge-C-Zq__Qu.js";import{I as q}from"./Input-Dk8j5b2Q.js";import{m as T}from"./events-Bu47C8H8.js";import{S as U}from"./Stack-CyWGn-AO.js";import{P as $}from"./PasswordInput-1a3PblwM.js";import"./createReactComponent-BN_c2kk2.js";import"./create-safe-context-Bb_7Uh0a.js";import"./floating-ui.react-BY6ulEKs.js";import"./CloseButton-Dy-wbEsU.js";import"./use-merged-ref-BUQ1B9HC.js";import"./DirectionProvider-DuCsFlA9.js";import"./px-CiO0pVtX.js";import"./get-sorted-breakpoints-CWbmZd_q.js";import"./use-input-props-BMt-FEuk.js";function we(){return[{title:"Add Action | JIVAS Manager"}]}async function Ce({request:h}){const a=new URL(h.url),s=a.searchParams.get("limit")||"10",o=a.searchParams.get("offset")||"0",n=a.searchParams.get("search")||"",c=a.searchParams.get("type")||"action",r=localStorage.getItem("jpr-key")||null,i=new URL(`${z}/packages/search`);i.searchParams.set("limit",s),i.searchParams.set("offset",o),i.searchParams.set("q",n),console.log({packageType:c,search:n}),i.searchParams.set("type",c==="all"?"":c);const l=r?{"x-api-key":r}:void 0;console.log({headers:l});const d=await fetch(i.toString(),{method:"GET",headers:{...l,"Content-Type":"application/json"}}).then(m=>m.json());return{packages:d.packages,totalPackages:d.total,apiKey:r||""}}async function be({request:h}){var c;const a=localStorage.getItem("jivas-host"),s=localStorage.getItem("jpr-key"),o=await h.formData(),n=o.get("_action");if(n==="installAction"){const r=localStorage.getItem("jivas-agent"),i=o.get("version"),l=o.get("package"),d=await R(`${a}/walker/install_action`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent_id:r,reporting:!0,package_name:l,version:i||"latest",jpr_api_key:s||void 0})}).then(async f=>await f.json()),m=(c=d.reports)==null?void 0:c[0];return m?(localStorage.setItem("jivas-agent",m.id),v("/dashboard")):d.reports}if(n==="updateJPRApiKey"){const r=o.get("apiKey");return localStorage.setItem("jpr-key",r||""),{}}}const Ke=I(function({loaderData:a}){var S;localStorage.getItem("jivas-host"),localStorage.getItem("jivas-token");const[s,o]=y.useState(null),[n,c]=y.useState(new Set([])),[r,i]=w(),l=A(),d=G(async p=>{r.set("search",p),i(r)},500),m=C(),f=b();return e.jsxs(x,{py:"xl",px:"xl",children:[e.jsxs(g,{children:[e.jsx(E,{color:"dark",size:"sm",component:K,to:"/actions",children:e.jsx(k,{})}),e.jsx(j,{order:3,children:"Add Action"})]}),e.jsx(M,{mt:"xs",mb:"xl"}),e.jsx(O,{h:"80vh",px:"xs",withBorder:!0,children:e.jsxs(V,{p:"md",radius:"md",h:"100%",children:[e.jsx(j,{order:3,children:"Browse Actions"}),s?e.jsxs(x,{mt:"xl",children:[e.jsxs(g,{children:[e.jsx(u,{onClick:()=>o(null),size:"xs",leftSection:e.jsx(k,{size:16}),color:"dark",children:"Back"}),e.jsx(j,{order:4,children:s.title})]}),e.jsxs(P,{mt:"lg",cols:{base:1,md:2},children:[e.jsxs(x,{children:[e.jsx(j,{order:6,children:"Description"}),e.jsx(F,{size:"sm",c:"gray.7",children:s.description})]}),e.jsxs(x,{children:[e.jsx(t,{variant:"vertical",layout:"fixed",withTableBorder:!0,children:e.jsxs(t.Tbody,{children:[e.jsxs(t.Tr,{children:[e.jsx(t.Th,{w:160,children:"Package"}),e.jsx(t.Td,{children:s.package})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Version"}),e.jsx(t.Td,{children:s.version})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Category"}),e.jsx(t.Td,{children:e.jsx(Y,{color:"dark",children:s.type})})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Downloads"}),e.jsx(t.Td,{children:s.downloads})]}),e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Last Published"}),e.jsx(t.Td,{children:D(s.publishedAt).format("MMMM D, YYYY h:mm:ss A")})]})]})}),e.jsx(g,{justify:"end",mt:"lg",children:e.jsx(u,{onClick:()=>l.submit({_action:"installAction",package:s.package,version:s.version},{method:"POST"}),leftSection:e.jsx(_,{size:16}),loading:l.state!=="idle",color:"dark",children:"Install Action"})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(g,{my:"lg",children:[e.jsx(q,{placeholder:"Search Agent",w:400,rightSection:m.state==="loading"&&m.location.pathname==f.pathname?e.jsx(N,{size:"xs"}):null,onChange:p=>{d(p.target.value)},leftSection:e.jsx(B,{size:16})}),e.jsx(u,{size:"sm",color:"dark",onClick:()=>T.open({title:"JPR Configuration",children:e.jsx(W,{apiKeyInit:a.apiKey})}),leftSection:e.jsx(J,{size:16}),children:"Configure"})]}),e.jsx(P,{cols:{base:1,md:2,lg:4},children:(S=a.packages)==null?void 0:S.map(p=>e.jsx(L,{onClick:o,pkg:p},p.id))})]})]})})]})});function W({apiKeyInit:h}){const[a,s]=y.useState(h),o=A();return e.jsxs(U,{children:[e.jsx($,{label:"API Key",placeholder:"API Key",value:a||"",onChange:n=>s(n.target.value)}),e.jsx(u,{size:"sm",color:"dark",mt:"sm",loading:o.state!=="idle",onClick:()=>{o.submit({apiKey:a,_action:"updateJPRApiKey"},{method:"POST",action:"/new-agent"}),T.closeAll()},children:"Save"})]})}export{be as clientAction,Ce as clientLoader,Ke as default,we as meta};
