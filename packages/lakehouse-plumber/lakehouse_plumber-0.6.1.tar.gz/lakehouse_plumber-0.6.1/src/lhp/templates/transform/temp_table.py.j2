@dlt.table(
    temporary=True,
)
def {{ target_table }}():
    """{{ description }}"""
    {% if sql %}
    df = spark.sql("""{{ sql }}""")
    {% else %}
    {% if readMode == "stream" %}
    df = spark.readStream.table("{{ source_view }}")
    {% else %}
    df = spark.read.table("{{ source_view }}")
    {% endif %}
    {% endif %}
    {% if add_operational_metadata %}
    
    # Add operational metadata columns
    {% for col_name, expression in metadata_columns.items()|sort %}
    df = df.withColumn('{{ col_name }}', {{ expression }})
    {% endfor %}
    {% endif %}

    return df 