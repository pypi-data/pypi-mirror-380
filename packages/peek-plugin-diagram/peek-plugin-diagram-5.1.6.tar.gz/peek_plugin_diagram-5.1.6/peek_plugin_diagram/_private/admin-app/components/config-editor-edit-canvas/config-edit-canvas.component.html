<ng-container *ngIf="delegate.selector$ | async">
    <peek-admin-panel-header-for-tuple-loader-delegate
        [delegate]="delegate"
        [deleteEnabled]="false"
    ></peek-admin-panel-header-for-tuple-loader-delegate>
    <peek-admin-content-tuple-data-loader [delegate]="delegate">
        <ng-container *ngIf="delegate.formGroup$ | async as formGroup">
            <nz-card class="settings-card">
                <div class="form-container" [formGroup]="formGroup">
                    <!-- ID Field (Disabled) -->
                    <nz-form-item>
                        <nz-form-label nzFor="id">ID</nz-form-label>
                        <nz-form-control>
                            {{ formGroup.controls["id"].value }}
                        </nz-form-control>
                        <span class="grow"></span>

                        <button
                            nz-button
                            nzType="default"
                            (click)="triggerRecompile()"
                            nz-popover
                            [nzPopoverMouseEnterDelay]="1.0"
                            nzPopoverPlacement="top"
                            nzPopoverTitle=""
                            [nzPopoverContent]="recompilePopoverContent"
                            [disabled]="delegate.dataDirtyOrWeHaveLock$ | async"
                        >
                            Trigger Recompile
                            <i nz-icon nzType="build"></i>
                        </button>
                        <ng-template #recompilePopoverContent>
                            <p>Recompile all shapes in this CoordSet</p>
                        </ng-template>
                    </nz-form-item>

                    <!-- Basic Information -->
                    <nz-form-item>
                        <nz-form-label nzFor="key">Key</nz-form-label>
                        <nz-form-control>
                            {{ formGroup.controls["key"].value }}
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzRequired nzFor="name"
                            >Name
                        </nz-form-label>
                        <nz-form-control nzErrorTip="Please input a name">
                            <input
                                nz-input
                                id="name"
                                formControlName="name"
                                placeholder="Configuration profile name"
                                required
                            />
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="comment">Comment</nz-form-label>
                        <nz-form-control>
                            <textarea
                                nz-input
                                id="comment"
                                formControlName="comment"
                                placeholder="Optional description"
                                [rows]="3"
                            ></textarea>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label nzFor="order">Order</nz-form-label>
                        <nz-form-control>
                            <nz-input-number
                                id="order"
                                formControlName="order"
                            ></nz-input-number>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label nzFor="enabled">Enabled</nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="enabled"
                                formControlName="enabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="lightModeEnabled"
                            >Light Mode Enabled
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="lightModeEnabled"
                                formControlName="lightModeEnabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-divider>View Settings</nz-divider>

                    <div class="coord-section">
                        <h4>Initial Position</h4>
                        <div class="coord-group">
                            <nz-form-item>
                                <nz-form-label nzFor="initialPanX"
                                    >Initial Pan X
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="initialPanX"
                                        formControlName="initialPanX"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzFor="initialPanY"
                                    >Initial Pan Y
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="initialPanY"
                                        formControlName="initialPanY"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzFor="initialZoom"
                                    >Initial Zoom
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="initialZoom"
                                        formControlName="initialZoom"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzFor="positionOnZoom"
                                    >Position On Zoom
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="positionOnZoom"
                                        formControlName="positionOnZoom"
                                        [nzStep]="0.01"
                                        [nzMin]="0"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>

                    <nz-form-item>
                        <nz-form-label nzFor="initialDarkMode"
                            >Initial Dark Mode
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="initialDarkMode"
                                formControlName="initialDarkMode"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>

                    <div class="coord-section">
                        <h4>Background Colors</h4>
                        <div class="coord-group">
                            <nz-form-item>
                                <nz-form-label nzFor="backgroundDarkColor"
                                    >Dark Background
                                </nz-form-label>
                                <nz-form-control>
                                    <input
                                        nz-input
                                        id="backgroundDarkColor"
                                        formControlName="backgroundDarkColor"
                                        placeholder="#000000"
                                    />
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzFor="backgroundLightColor"
                                    >Light Background
                                </nz-form-label>
                                <nz-form-control>
                                    <input
                                        nz-input
                                        id="backgroundLightColor"
                                        formControlName="backgroundLightColor"
                                        placeholder="#ffffff"
                                    />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>

                    <div class="coord-section">
                        <h4>Zoom Limits</h4>
                        <div class="coord-group">
                            <nz-form-item>
                                <nz-form-label nzFor="minZoom"
                                    >Minimum Zoom
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="minZoom"
                                        formControlName="minZoom"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label nzFor="maxZoom"
                                    >Maximum Zoom
                                </nz-form-label>
                                <nz-form-control>
                                    <nz-input-number
                                        id="maxZoom"
                                        formControlName="maxZoom"
                                    ></nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>

                    <nz-divider>Grid Sizes</nz-divider>

                    <h4>
                        Z-Grids
                        <i
                            nz-icon
                            nzType="info-circle"
                            class="info-icon"
                            nz-popover
                            [nzPopoverMouseEnterDelay]="1.0"
                            nzPopoverPlacement="top"
                            nzPopoverTitle=""
                            [nzPopoverContent]="zGridsPopoverContent"
                        ></i>
                        <ng-template #zGridsPopoverContent>
                            <p>
                                Z-Grids in the Peek diagram provide performance
                                when viewing a large diagram and when zoomed
                                into to the detail of a diagram.
                            </p>
                            <p>
                                When zoomed out, grids are larger, and contain
                                less detail, making them quick to load and
                                render.
                            </p>
                            <p>
                                When zoomed in, the grid X,Y size is smaller,
                                and it contain all the detail.
                            </p>
                        </ng-template>
                    </h4>

                    <div class="grid-sizes-table">
                        <nz-table
                            #gridSizesTable
                            nzSize="small"
                            [nzPaginationPosition]="null"
                            [nzFrontPagination]="false"
                            [nzData]="gridSizesFormControlRows$ | async"
                            [nzBordered]="true"
                            [nzShowSizeChanger]="true"
                        >
                            <thead>
                                <tr>
                                    <th>
                                        Order
                                        <i
                                            nz-icon
                                            nzType="info-circle"
                                            class="info-icon"
                                            nz-popover
                                            [nzPopoverMouseEnterDelay]="1.0"
                                            nzPopoverPlacement="top"
                                            nzPopoverTitle=""
                                            [nzPopoverContent]="
                                                orderPopoverContent
                                            "
                                        ></i>
                                        <ng-template #orderPopoverContent>
                                            <p>
                                                This field is the order of the
                                                z-grids.
                                            </p>
                                            <p>
                                                Please ensure the zoom level
                                                min/max ranges are consecutive
                                                across all z-grids.
                                            </p>
                                        </ng-template>
                                    </th>
                                    <th>Min</th>
                                    <th>Max</th>
                                    <th>X Grid</th>
                                    <th>Y Grid</th>
                                    <th>
                                        Smallest Text
                                        <i
                                            nz-icon
                                            nzType="info-circle"
                                            class="info-icon"
                                            nz-popover
                                            [nzPopoverMouseEnterDelay]="1.0"
                                            nzPopoverPlacement="top"
                                            nzPopoverTitle=""
                                            [nzPopoverContent]="
                                                smallestTextPopoverContent
                                            "
                                        ></i>
                                        <ng-template
                                            #smallestTextPopoverContent
                                        >
                                            <p>
                                                The smallest text that will be
                                                compiled into the grids at the
                                                maximum zoom level.
                                            </p>
                                        </ng-template>
                                    </th>
                                    <th>
                                        Smallest Shape
                                        <i
                                            nz-icon
                                            nzType="info-circle"
                                            class="info-icon"
                                            nz-popover
                                            [nzPopoverMouseEnterDelay]="1.0"
                                            nzPopoverPlacement="top"
                                            nzPopoverTitle=""
                                            [nzPopoverContent]="
                                                smallestShapePopoverContent
                                            "
                                        ></i>
                                        <ng-template
                                            #smallestShapePopoverContent
                                        >
                                            <p>
                                                The smallest shape that will be
                                                compiled into the grids at the
                                                maximum zoom level.
                                            </p>
                                            <p>
                                                This value is used to filter out
                                                shapes smaller than the value,
                                                and the shapes largest
                                                appearance within the grid.
                                                Which is at the maxZoom value.
                                            </p>
                                            <p>
                                                Zoomed out zGrids can have
                                                larger values to remove detail,
                                                the most detailed grids can have
                                                a smaller value, Most likely no
                                                smaller than 2 as users will not
                                                get any benefit from a 2 pixel
                                                shape.
                                            </p>
                                        </ng-template>
                                    </th>
                                    <th class="grid-calcs">
                                        Min Grids
                                        <i
                                            nz-icon
                                            nzType="info-circle"
                                            class="info-icon"
                                            nz-popover
                                            [nzPopoverMouseEnterDelay]="1.0"
                                            nzPopoverPlacement="top"
                                            nzPopoverTitle=""
                                            [nzPopoverContent]="
                                                minGridsPopoverContent
                                            "
                                        ></i>
                                        <ng-template #minGridsPopoverContent>
                                            <p>
                                                The number of grids that will
                                                appear on the screen at the
                                                minimum zoom level on a
                                                2560x1440 (2k) screen.
                                            </p>
                                        </ng-template>
                                    </th>
                                    <th class="grid-calcs">
                                        Max Grids
                                        <i
                                            nz-icon
                                            nzType="info-circle"
                                            class="info-icon"
                                            nz-popover
                                            [nzPopoverMouseEnterDelay]="1.0"
                                            nzPopoverPlacement="top"
                                            nzPopoverTitle=""
                                            [nzPopoverContent]="
                                                maxGridsPopoverContent
                                            "
                                        ></i>
                                        <ng-template #maxGridsPopoverContent>
                                            <p>
                                                The number of grids that will
                                                appear on the screen at the
                                                maximum zoom level on a
                                                2560x1440 (2k) screen.
                                            </p>
                                        </ng-template>
                                    </th>
                                    <th class="action-button-th">
                                        <button
                                            nz-button
                                            nzShape="circle"
                                            (click)="addGridSizeRow()"
                                        >
                                            <span nz-icon nzType="plus"></span>
                                        </button>
                                    </th>
                                </tr>
                            </thead>
                            <ng-container formArrayName="gridSizes">
                                <tbody>
                                    <tr
                                        *ngFor="
                                            let grid of gridSizesTable.data;
                                            let i = index
                                        "
                                        [formGroupName]="i"
                                    >
                                        <input
                                            type="hidden"
                                            formControlName="id"
                                        />
                                        <input
                                            type="hidden"
                                            formControlName="coordSetId"
                                        />
                                        <td>
                                            <nz-input-number
                                                formControlName="key"
                                            />
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="min"
                                            ></nz-input-number>
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="max"
                                            ></nz-input-number>
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="xGrid"
                                            ></nz-input-number>
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="yGrid"
                                            ></nz-input-number>
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="smallestTextSize"
                                            ></nz-input-number>
                                        </td>
                                        <td>
                                            <nz-input-number
                                                formControlName="smallestShapeSize"
                                            ></nz-input-number>
                                        </td>
                                        <td [ngClass]="getMinGridsClass(grid)">
                                            {{ getMinGridsDisplay(grid) }}
                                        </td>
                                        <td [ngClass]="getMaxGridsClass(grid)">
                                            {{ getMaxGridsDisplay(grid) }}
                                        </td>
                                        <td class="action-button">
                                            <button
                                                nz-button
                                                nzType="default"
                                                nzShape="circle"
                                                (click)="removeGridSizeRow(i)"
                                                nz-popover
                                                [nzPopoverMouseEnterDelay]="1.0"
                                                nzPopoverPlacement="top"
                                                nzPopoverTitle=""
                                                [nzPopoverContent]="
                                                    removeRowPopoverContent
                                                "
                                            >
                                                <i nz-icon nzType="delete"></i>
                                            </button>
                                            <ng-template
                                                #removeRowPopoverContent
                                            >
                                                <p>Remove this grid size</p>
                                            </ng-template>
                                        </td>
                                    </tr>
                                </tbody>
                            </ng-container>
                        </nz-table>
                    </div>

                    <nz-divider>Feature Toggles</nz-divider>

                    <nz-form-item>
                        <nz-form-label nzFor="dispGroupTemplatesEnabled"
                            >Display Group Templates Enabled
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="dispGroupTemplatesEnabled"
                                formControlName="dispGroupTemplatesEnabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="edgeTemplatesEnabled"
                            >Edge Templates Enabled
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="edgeTemplatesEnabled"
                                formControlName="edgeTemplatesEnabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="branchesEnabled"
                            >Branches Enabled
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="branchesEnabled"
                                formControlName="branchesEnabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-divider>Edit Settings</nz-divider>

                    <nz-form-item>
                        <nz-form-label nzFor="editEnabled"
                            >Edit Enabled
                        </nz-form-label>
                        <nz-form-control>
                            <nz-switch
                                id="editEnabled"
                                formControlName="editEnabled"
                            ></nz-switch>
                        </nz-form-control>
                    </nz-form-item>

                    <div *ngIf="formGroup.get('editEnabled').value">
                        <nz-form-item>
                            <nz-form-label nzFor="editDefaultLayerId"
                                >Default Layer
                            </nz-form-label>
                            <nz-form-control>
                                <pl-diagram-lookup-create-edit-select
                                    id="editDefaultLayerId"
                                    formControlName="editDefaultLayerId"
                                    [modelSetKey$]="modelSetKey$"
                                    [coordSetKey$]="coordSetKey$"
                                    [lookupType]="LookupTypeE.LAYER"
                                    [allowClear]="true"
                                ></pl-diagram-lookup-create-edit-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="editDefaultLevelId"
                                >Default Level
                            </nz-form-label>
                            <nz-form-control>
                                <pl-diagram-lookup-create-edit-select
                                    id="editDefaultLevelId"
                                    formControlName="editDefaultLevelId"
                                    [modelSetKey$]="modelSetKey$"
                                    [coordSetKey$]="coordSetKey$"
                                    [lookupType]="LookupTypeE.LEVEL"
                                    [allowClear]="true"
                                ></pl-diagram-lookup-create-edit-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="editDefaultColorId"
                                >Default Color
                            </nz-form-label>
                            <nz-form-control>
                                <pl-diagram-lookup-create-edit-select
                                    id="editDefaultColorId"
                                    formControlName="editDefaultColorId"
                                    [modelSetKey$]="modelSetKey$"
                                    [coordSetKey$]="coordSetKey$"
                                    [lookupType]="LookupTypeE.COLOR"
                                    [allowClear]="true"
                                ></pl-diagram-lookup-create-edit-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="editDefaultLineStyleId"
                                >Default Line Style
                            </nz-form-label>
                            <nz-form-control>
                                <pl-diagram-lookup-create-edit-select
                                    id="editDefaultLineStyleId"
                                    formControlName="editDefaultLineStyleId"
                                    [modelSetKey$]="modelSetKey$"
                                    [coordSetKey$]="coordSetKey$"
                                    [lookupType]="LookupTypeE.LINE_STYLE"
                                    [allowClear]="true"
                                ></pl-diagram-lookup-create-edit-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label nzFor="editDefaultTextStyleId"
                                >Default Text Style
                            </nz-form-label>
                            <nz-form-control>
                                <pl-diagram-lookup-create-edit-select
                                    id="editDefaultTextStyleId"
                                    formControlName="editDefaultTextStyleId"
                                    [modelSetKey$]="modelSetKey$"
                                    [coordSetKey$]="coordSetKey$"
                                    [lookupType]="LookupTypeE.TEXT_STYLE"
                                    [allowClear]="true"
                                ></pl-diagram-lookup-create-edit-select>
                            </nz-form-control>
                        </nz-form-item>

                        <div class="coord-section">
                            <h4>Vertex Settings</h4>
                            <div class="coord-group">
                                <nz-form-item>
                                    <nz-form-label
                                        nzFor="editDefaultVertexCoordSetId"
                                        >Default Vertex Coord Set
                                    </nz-form-label>
                                    <nz-form-control>
                                        <nz-select
                                            id="editDefaultVertexCoordSetId"
                                            formControlName="editDefaultVertexCoordSetId"
                                            nzShowSearch
                                            [nzAllowClear]="true"
                                        >
                                            <nz-option
                                                *ngFor="
                                                    let item of vertexDispGroupCanvasOptions$
                                                        | async
                                                "
                                                [nzValue]="item.id"
                                                [nzLabel]="item.nameKey"
                                            >
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label
                                        nzFor="editDefaultVertexGroupName"
                                        >Default Vertex Group Name
                                    </nz-form-label>
                                    <nz-form-control>
                                        <nz-select
                                            id="editDefaultVertexGroupName"
                                            formControlName="editDefaultVertexGroupName"
                                            nzShowSearch
                                            [nzAllowClear]="true"
                                        >
                                            <nz-option
                                                *ngFor="
                                                    let item of vertexDispGroupNameOptions$
                                                        | async
                                                "
                                                [nzValue]="item.name"
                                                [nzLabel]="item.name"
                                            >
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                        </div>

                        <div class="coord-section">
                            <h4>Edge Settings</h4>
                            <div class="coord-group">
                                <nz-form-item>
                                    <nz-form-label
                                        nzFor="editDefaultEdgeCoordSetId"
                                        >Default Edge Coord Set
                                    </nz-form-label>
                                    <nz-form-control>
                                        <nz-select
                                            id="editDefaultEdgeCoordSetId"
                                            formControlName="editDefaultEdgeCoordSetId"
                                            nzShowSearch
                                            [nzAllowClear]="true"
                                        >
                                            <nz-option
                                                *ngFor="
                                                    let item of edgeDispGroupCanvasOptions$
                                                        | async
                                                "
                                                [nzValue]="item.id"
                                                [nzLabel]="item.nameKey"
                                            >
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label
                                        nzFor="editDefaultEdgeGroupName"
                                        >Default Edge Group Name
                                    </nz-form-label>
                                    <nz-form-control>
                                        <nz-select
                                            id="editDefaultEdgeGroupName"
                                            formControlName="editDefaultEdgeGroupName"
                                            nzShowSearch
                                            [nzAllowClear]="true"
                                        >
                                            <nz-option
                                                *ngFor="
                                                    let item of edgeDispGroupNameOptions$
                                                        | async
                                                "
                                                [nzValue]="item.name"
                                                [nzLabel]="item.name"
                                            >
                                            </nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                        </div>
                    </div>

                    <nz-divider>Access Control</nz-divider>

                    <nz-form-item>
                        <nz-form-label nzFor="userGroupsAllowed"
                            >User Groups Allowed
                        </nz-form-label>
                        <nz-form-control>
                            <textarea
                                nz-input
                                id="userGroupsAllowed"
                                formControlName="userGroupsAllowed"
                                placeholder="Enter comma-separated group names"
                                [rows]="2"
                            ></textarea>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-label nzFor="userGroupsDenied"
                            >User Groups Denied
                        </nz-form-label>
                        <nz-form-control>
                            <textarea
                                nz-input
                                id="userGroupsDenied"
                                formControlName="userGroupsDenied"
                                placeholder="Enter comma-separated group names"
                                [rows]="2"
                            ></textarea>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-divider>Additional Data</nz-divider>

                    <nz-form-item>
                        <nz-form-label nzFor="data">Data (JSON)</nz-form-label>
                        <nz-form-control>
                            <textarea
                                nz-input
                                id="data"
                                formControlName="data"
                                placeholder="Enter JSON data"
                                [rows]="5"
                            ></textarea>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </nz-card>
        </ng-container>
    </peek-admin-content-tuple-data-loader>
</ng-container>
