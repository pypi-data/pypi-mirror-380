"use strict";(self.webpackChunkinhpc_dm=self.webpackChunkinhpc_dm||[]).push([[717],{6717:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_e});var s=n(9219),o=n(3794),r=n(5273),i=n(316),a=n(8222),l=n(7262),d=n(3345),c=n(7628),h=n(8262);new a.LabIcon({name:"jfs:drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24" fill="none">\n  <path class="jp-icon3 jp-icon-selectable" stroke="#616161" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 12H2M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11zM6 16h.01M10 16h.01"/>\n</svg>\n'}),new a.LabIcon({name:"jfs:file-tree",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="20" viewBox="0 0 16 16">\n  <path class="jp-icon3" fill="#616161" d="M16 10V6H5v1H3V4h9V0H0v4h2v10h3v2h11v-4H5v1H3V8h2v2z"/>\n</svg>\n'}),new a.LabIcon({name:"jfs:jupyter-fs",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" viewBox="0 0 100 100">\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="9.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="20" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="20" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="39.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="50" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="50" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="69.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="80" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="80" r="3"/>\n</svg>\n'});const u=new a.LabIcon({name:"jfs:visibility",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>\n</svg>'}),m=new a.LabIcon({name:"jfs:visibility-off",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>\n</svg>'});class p{constructor(e){this.template=e,this.pattern=/(?:)/}substitute(e){return this.template.replace(this.pattern,(t,n)=>e[n])}tokens(){const e=[];let t;for(;t=this.pattern.exec(this.template);)e.push(t[1]);return e}}class g extends p{constructor(){super(...arguments),this.pattern=/{{(\S+?)}}/g}}function f(e){return new g(e).tokens()}function v(e){var t;return"ask"===e.auth&&!e.init&&!!(null===(t=e.missingTokens)||void 0===t?void 0:t.length)}class y extends d.Component{constructor(e,t){super(e),this.state=y.initialState({open:!0,options:t})}render(){return d.createElement("div",null,d.createElement(h.Dialog,{className:"jfs-ask-dialog",open:this.state.open,onClose:this._onClose.bind(this)},d.createElement(h.DialogTitle,{className:"jfs-ask jfs-ask-dialog-title"},"Please enter token values for filesystem resources"),d.createElement(h.DialogContent,{className:"jfs-ask jfs-ask-dialog-content"},this._form()),d.createElement(h.DialogActions,{className:"jfs-ask jfs-ask-dialog-actions"},d.createElement(h.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-cancel",onClick:this._onClose.bind(this),color:"primary"},"Cancel"),d.createElement(h.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-submit",onClick:this._onSubmit.bind(this),color:"primary"},"Submit"))))}_form(){return d.createElement("form",{className:"jfs-ask jfs-ask-form",onSubmit:this._onSubmit.bind(this),noValidate:!0,autoComplete:"off"},this._formInner())}_formInner(){return this.props.resources.map(e=>{const t=decodeURIComponent(e.url),n=v(e)?this._inputs(e.url):[],s=f(e.url);let o="";e.init&&this.props.options.cache?o="already initialized":s.length||(o="no template parameters");const r=`${e.name}:${o&&` ${o}`}`;return[d.createElement(h.ExpansionPanel,{className:"jfs-ask jfs-ask-panel",disabled:!!o,expanded:!o,key:`${e.name}_panel`},d.createElement(h.ExpansionPanelSummary,{className:"jfs-ask jfs-ask-panel-summary"},d.createElement(h.Typography,null,r),!o&&d.createElement(h.Tooltip,{title:t},d.createElement(h.Typography,{noWrap:!0},t))),d.createElement(h.ExpansionPanelDetails,{className:"jfs-ask jfs-ask-panel-details"},n))]})}_inputs(e){return f(e).map(t=>{var n,s,o;return d.createElement(h.TextField,{className:"jfs-ask jfs-ask-input",autoFocus:!0,fullWidth:!0,key:`${e}_${t}`,label:t,margin:"dense",name:t,onChange:this._onChange(e).bind(this),type:(null===(n=this.state.visibility[e])||void 0===n?void 0:n[t])?"text":"password",value:(null===(s=this.state.values[e])||void 0===s?void 0:s[t])||"",InputProps:{endAdornment:d.createElement(h.InputAdornment,{position:"end"},d.createElement(h.IconButton,{onClick:this._onClickVisiblity(e,t).bind(this),onMouseDown:this._onMouseDownVisibility.bind(this),edge:"end"},(null===(o=this.state.visibility[e])||void 0===o?void 0:o[t])?d.createElement(u.react,null):d.createElement(m.react,null)))}})})}_onChange(e){return t=>{const n=t.target;this._setValue(e,n.name,n.value)}}_onClickVisiblity(e,t){return()=>{this._toggleVisibility(e,t)}}_onMouseDownVisibility(e){e.preventDefault()}_onOpen(){this.setState({open:!0})}_onClose(){this.setState(y.initialState({options:this.state.options})),this.props.handleClose()}async _onSubmit(e){e.preventDefault(),this.props.handleSubmit(this.state.values),this._onClose()}_setValue(e,t,n){const s=Object.assign(Object.assign({},this.state.values[e]),{[t]:n});this.setState({values:Object.assign(Object.assign({},this.state.values),{[e]:s})})}_toggleVisibility(e,t){var n;const s=Object.assign(Object.assign({},this.state.visibility[e]),{[t]:!(null===(n=this.state.visibility[e])||void 0===n?void 0:n[t])});this.setState({visibility:Object.assign(Object.assign({},this.state.visibility),{[e]:s})})}}y.displayName="AskDialog",function(e){e.initialState=({open:e=!1,options:t})=>({open:e,options:Object.assign({},t),values:{},visibility:{}})}(y||(y={}));var w=n(5023),_=n(7296);class b{constructor(){this._settings=void 0}get baseUrl(){return this.settings.baseUrl}get resourcesUrl(){return w.URLExt.join(this.baseUrl,"inhpc_dm/resources")}get settings(){return this._settings||(this._settings=_.ServerConnection.makeSettings()),this._settings}}class x extends b{static get instance(){return void 0===x._instance&&(x._instance=new x),x._instance}async getResourcesRequest(){const e=this.settings,t=this.resourcesUrl;return _.ServerConnection.makeRequest(t,{method:"GET"},e).then(e=>200!==e.status?e.text().then(t=>{throw new _.ServerConnection.ResponseError(e,t)}):e.json())}async initResourceRequest(e){const t=this.settings,n=this.resourcesUrl;return _.ServerConnection.makeRequest(n,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"},t).then(e=>200!==e.status?e.text().then(t=>{throw new _.ServerConnection.ResponseError(e,t)}):e.json())}}function E(e){return Object.assign({name:"",url:""},e)}var D=n(5256),C=n(7088);async function k(e="",t={}){const n=_.ServerConnection.makeSettings(),s=w.URLExt.join(n.baseUrl,e);let o;try{o=await _.ServerConnection.makeRequest(s,t,n)}catch(e){if(e instanceof Error)throw new _.ServerConnection.NetworkError(e);{let e;throw e=new TypeError("Serverside was not available, something went wrong"),console.log("Serverside was not available, something went wrong"),new _.ServerConnection.NetworkError(e)}}if(!o.ok){let e;e=o.statusText;try{e+=JSON.stringify(await o.json())}catch(e){}throw new _.ServerConnection.ResponseError(o,e)}return await o.json()}class P extends C.DataGrid{constructor(){super({style:Object.assign(Object.assign({},C.DataGrid.defaultStyle),{rowBackgroundColor:e=>e%2==0?"rgba(64, 115, 53, 0.2)":""}),defaultSizes:{rowHeight:10,columnHeaderHeight:12,columnWidth:200,rowHeaderWidth:200}}),this.mouseHandler=new C.BasicMouseHandler,this.keyHandler=new C.BasicKeyHandler,this.refreshData()}async refreshData(){try{const e=await k("inhpc_dm/tasks",{method:"GET"});console.log(e.tasks);let t=new C.JSONModel({data:e.tasks,schema:S});this.dataModel=t}catch(e){console.error(`Error refreshing tasks list".\n${e}`),(0,o.showErrorMessage)("Error",`${e}`)}}}const S={primaryKey:["Started"],fields:[{name:"Started",type:"string"},{name:"Source",type:"string"},{name:"Target",type:"string"},{name:"Status",type:"string"}],pandas_version:"0.20.0"};class j extends D.Widget{constructor(e=[]){super(),this.addClass("jp-Input-Dialog"),this._list=Array(),this._input_endpoint=document.createElement("div"),this._input_endpoint.classList.add("jp-mod-styled"),this._input_endpoint.id="jp-dialog-input-id_ep";let t=0;e.forEach(e=>{const n=document.createElement("div"),s=document.createElement("input");s.type="checkbox",s.name="inhpc_dm_endpoint_selection",s.value=e,s.id="inhpc_dm_endpoint_selection"+t,s.onclick=e=>{var t=e.target;t.checked&&this._list.forEach(e=>{e.checked=!1}),t.checked=!0},0==t&&(s.checked=!0);const o=document.createElement("label");o.textContent=e,o.htmlFor=s.id,n.appendChild(s),n.appendChild(o),this._list.push(s),this._input_endpoint.appendChild(n),t++});const n=document.createElement("label");n.textContent="Select Endpoint",n.htmlFor=this._input_endpoint.id,this.node.appendChild(n),this.node.appendChild(this._input_endpoint)}getValue(){const e=this._list.find(e=>e.checked||e.ariaChecked);return e?e.value:null}}class L extends o.ToolbarButton{constructor(e){super({icon:a.addIcon,tooltip:"Choose remote filesystem",onClick:()=>{this.handle_click(e)}})}async handle_click(e){try{const n=await k("inhpc_dm/resources",{method:"GET"});console.log(n);const s=[];n.forEach(e=>{console.log(`Available endpoint: ${e.url}`),s.push(e.url)});const r=(await(t=s,function(e={}){return new o.Dialog(e).launch()}({body:new j(t),buttons:[o.Dialog.cancelButton({label:"Cancel"}),o.Dialog.okButton({label:"OK"})],focusNodeSelector:"input"}))).value;if(null==r)return;let i,a;n.forEach(e=>{r===e.url&&(i=e.drive,a=e.name)}),console.log(`Selected drive = ${i}`),e.setEndpoint(r,i,a)}catch(e){console.error(`Error on GET /inhpc_dm/resources: ${e}`),(0,o.showErrorMessage)("Error",`${e}`)}var t}}class W extends o.ToolbarButton{constructor(e,t,n,s,o){super({label:s,tooltip:o,onClick:()=>{this.handle_click(e,t,n)}})}async handle_click(e,t,n){var s,r,i=t.getSelectedDir(),a=[];for(const t of e.getSelected())a.push(t.path);if(0!=a.length)if(null!=i){var l=JSON.stringify({command:"copy",parameters:{target:i,sources:a}});console.log("Copy command params: "+l);try{const e=await k("inhpc_dm/tasks",{body:l,method:"POST"});console.log(e);var d=null!==(s=e.status)&&void 0!==s?s:"OK",c=null!==(r=e.error_info)&&void 0!==r?r:"Task launched successfully";(0,o.showDialog)({title:d,body:c,buttons:[o.Dialog.okButton()]}),n.refreshData()}catch(e){console.error(`Error on POST /inhpc_dm/tasks: ${e}`),(0,o.showErrorMessage)("Error",`${e}`)}}else(0,o.showErrorMessage)("Error","Please select a target directory");else(0,o.showErrorMessage)("Error","Please select source file(s)")}}class I extends o.ToolbarButton{constructor(e,t){super({icon:a.refreshIcon,tooltip:t,onClick:()=>{this.handle_click(e)}})}async handle_click(e){e.refreshData()}}var M=n(5362),O=n(3948),T=n(4053),R=n(2546),A=function(e){return this instanceof A?(this.v=e,this):new A(e)},B=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=e[n]&&function(t){return new Promise(function(s,o){!function(e,t,n,s){Promise.resolve(s).then(function(t){e({value:t,done:n})},t)}(s,o,(t=e[n](t)).done,t.value)})}}};function F(e,t){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),r=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){r.push([e,t,n,s])>1||a(e,t)})})}function a(e,t){try{(n=o[e](t)).value instanceof A?Promise.resolve(n.value.v).then(l,d):c(r[0][2],n)}catch(e){c(r[0][3],e)}var n}function l(e){a("next",e)}function d(e){a("throw",e)}function c(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}(this,arguments,function*(){const n=e.join("/");if(!n.startsWith(t.pathstr))throw new Error(`Path ${n} not in ${t.pathstr}`);let s=t;yield yield A(s);for(let o=t.row.path.length;o<e.length;++o){const t=yield A(s.getChildren()),r=null==t?void 0:t.find(t=>t.name===e[o]);if(!r)throw new Error(`Path ${n} not in ${s.pathstr}`);s=r,yield yield A(s)}})}async function $(e,t,n){const s=await async function(e,t){var n,s,o,r;let i;try{for(var a,l=!0,d=B(F(t,e.root));!(n=(a=await d.next()).done);){r=a.value,l=!1;try{i=r,!i.isExpand&&i.hasChildren&&await i.expand()}finally{l=!0}}}catch(e){s={error:e}}finally{try{l||n||!(o=d.return)||await o.call(d)}finally{if(s)throw s.error}}return i}(e,t);return e.selectionModel.select(s,n),s}async function N(e,t){var n,s,o,r;try{for(var i,a=!0,l=B(F(t,e.root));!(n=(i=await l.next()).done);){r=i.value,a=!1;try{const t=r;t.pathstr!==e.root.pathstr&&await e.openDir(t.row)}finally{a=!0}}}catch(e){s={error:e}}finally{try{a||n||!(o=l.return)||await o.call(l)}finally{if(s)throw s.error}}}async function V(e,t){var n,s,o,r;let i;try{for(var a,l=!0,d=B(F(e.row.path.slice(0,-1),t));!(n=(a=await d.next()).done);){r=a.value,l=!1;try{i=r}finally{l=!0}}}catch(e){s={error:e}}finally{try{l||n||!(o=d.return)||await o.call(d)}finally{if(s)throw s.error}}return i}function H(e,t,n=!1){const s=t.row.path.length+(n?1:0);if(!e.some(e=>e.path.length<=s+(e.getChildren?0:1)))return n?e.map(e=>Object.assign(Object.assign({},e),{getChildren:void 0})):e}class z{constructor(e){this._model=new R.ClipboardModel,this._drive=new _.Drive,this._tracker=e,this._model.deleteSub.subscribe(async e=>{await Promise.all(e.map(e=>this._onDelete(e)));const t=this._tracker.currentWidget.model,n=H(e,t.root,!0);this.model.refresh(t,n)}),this._model.pasteSub.subscribe(async({destination:e,doCut:t,memo:n})=>{const s="dir"===e.kind?e.path:e.path.slice(0,-1),o=R.Path.fromarray(s);await Promise.all(n.map(e=>this._onPaste(e,o,t)));const r=this._tracker.currentWidget.model;let i=H([e],r.root,!1);if(t&&void 0!==i){const e=H(n,r.root,!1);void 0===e?i=void 0:i.push(...e)}this.model.refresh(r,i)})}refresh(e,t){null!=e||(e=this._tracker.currentWidget.model),this.model.refresh(e,t)}refreshSelection(e){this.refresh(e,e.selection.map(e=>e.row))}get model(){return this._model}async _onDelete(e){const t=R.Path.fromarray(e.path);try{await this._drive.delete(t)}catch(e){await(0,o.showErrorMessage)("Delete Failed",e)}}async _onPaste(e,t,n){const s=R.Path.fromarray(e.path);try{await this._drive.copy(s,t),n&&await this._drive.delete(s)}catch(e){await(0,o.showErrorMessage)("Paste Error",e)}}}class U{constructor(e,t,n){this.contentsManager=e,this.drive=t,this.onGetChildren=n}async get(e,t){return e=U.toFullPath(e,this.drive),U.toJupyterContentRow(await this.contentsManager.get(e,t),this.contentsManager,this.drive,this.onGetChildren)}async save(e,t){return e=U.toFullPath(e,this.drive),U.toJupyterContentRow(await this.contentsManager.save(e,t),this.contentsManager,this.drive,this.onGetChildren)}async rename(e,t){return e=U.toFullPath(e,this.drive),t=U.toFullPath(t,this.drive),U.toJupyterContentRow(await this.contentsManager.rename(e,t),this.contentsManager,this.drive,this.onGetChildren)}async newUntitled(e){return e.path=e.path&&U.toFullPath(e.path,this.drive),U.toJupyterContentRow(await this.contentsManager.newUntitled(e),this.contentsManager,this.drive,this.onGetChildren)}async downloadUrl(e){return e=U.toFullPath(e,this.drive),await this.contentsManager.getDownloadUrl(e)}}!function(e){function t(e,t){return!t||e.startsWith(`${t}:`)?e.startsWith(`${t}:/`)?e.replace(`${t}:/`,`${t}:`):e:e.startsWith(`${t}/`)?[t,e.slice(t.length+1)].join(":"):[t,e].join(":")}e.toFullPath=t,e.toLocalPath=function(e){const[t,...n]=e.split("/");return[t.split(":").pop(),...n].join("/")},e.toJupyterContentRow=function e(n,s,r,i){const{path:a,type:d}=n,c=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]])}return n}(n,["path","type"]),h=t(a,r).replace(/\/$/,""),u="directory"===d?"dir":d;return Object.assign(Object.assign({path:R.Path.toarray(h),kind:u},c),"dir"===u?{getChildren:async()=>{let t;const n=new l.PromiseDelegate;if(i){const e=R.Path.toarray(h).join("/");i(e,n.promise)}try{t=await s.get(h,{content:!0}),n.resolve()}catch(e){return(0,o.showErrorMessage)("Failed to get directory contents",e),n.reject("Failed to get directory contents"),[]}return t.content.map(t=>e(t,s,r,i))}}:{})}}(U||(U={}));var q=n(1355);const G="jfs-DropWidget",J="jfs-DragWidget",K="jfs-mod-dragHandle",X="jfs-mod-dropTarget",Y="application/x-jupyterfs-thead";function Q(e,t,n){let s=e;for(;s&&!s.classList.contains(t);)s=s.parentElement;return!!s&&s===n}class Z extends D.Widget{constructor(e={}){var t;super(e),this.acceptDropsFromExternalSource=!0===e.acceptDropsFromExternalSource,this.addClass(G),this.acceptedDropMimeTypes=null!==(t=e.acceptedDropMimeTypes)&&void 0!==t?t:[]}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this.evtDrop(e)}}validateSource(e){return this.acceptDropsFromExternalSource||e.source===this}findDropTarget(e,t){return this.acceptedDropMimeTypes.some(e=>t.hasData(e))&&this._isValidTargetHeader(e,t.getData(Y))?(e.classList.add(X),t.types().includes(Y)?e:function(e,t){const n=Array.isArray(e),s=t=>n?e.indexOf(t)>-1:t.parentElement===e;let o=t,r=null;for(;o&&o!==e;){if(s(o)){r=o;break}o=o.parentElement}return r}(this.node,e)):null}evtDrop(e){let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(X)){t.classList.remove(X);break}t=t.parentElement}if(t&&Q(t,G,this.node))return this.validateSource(e)?void this.processDrop(t,e):(e.dropAction="none",e.preventDefault(),void e.stopPropagation())}onAfterAttach(e){const t=this.node;t.addEventListener("lm-dragenter",this),t.addEventListener("lm-dragleave",this),t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this)}onBeforeDetach(e){const t=this.node;t.removeEventListener("lm-dragenter",this),t.removeEventListener("lm-dragleave",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}_evtDragEnter(e){if(!this.validateSource(e))return;const t=this.findDropTarget(e.target,e.mimeData);null!==t&&(this._clearDropTarget(),t.classList.add(X),e.preventDefault(),e.stopPropagation())}_evtDragLeave(e){e.preventDefault(),e.stopPropagation(),this._clearDropTarget()}_evtDragOver(e){this.validateSource(e)&&(this._clearDropTarget(),null!==this.findDropTarget(e.target,e.mimeData)&&(e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction))}_isValidTargetHeader(e,t){return e.classList.contains("tf-header-name")&&e.innerText!==t&&"path"!==e.innerText}_clearDropTarget(){const e=this.node.getElementsByClassName(X);e.length&&e[0].classList.remove(X)}}class ee extends Z{constructor(e={}){super(e),this.drag=null,this.dragHandleClass=K,this.defaultSupportedActions="all",this.defaultProposedAction="move",this._clickData=null,this.addClass(J)}dispose(){this.drag=null,this._clickData=null,super.dispose()}handleEvent(e){switch(e.type){case"mousedown":this._evtDragMousedown(e);break;case"mouseup":this._evtDragMouseup(e);break;case"mousemove":this._evtDragMousemove(e);break;default:super.handleEvent(e)}}findDragTarget(e){return e}getDragImage(e){const t=this.findDragTarget(e);return t?t.cloneNode(!0):null}onDragComplete(e){this.drag=null}onAfterAttach(e){this.node.addEventListener("mousedown",this),super.onAfterAttach(e)}onBeforeDetach(e){const t=this.node;t.removeEventListener("click",this),t.removeEventListener("dblclick",this),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),super.onBeforeDetach(e)}startDrag(e,t,n){const s=this.getDragImage(e);this.drag=new q.Drag({dragImage:s||void 0,mimeData:new l.MimeData,supportedActions:this.defaultSupportedActions,proposedAction:this.defaultProposedAction,source:this}),this.addMimeData(e,this.drag.mimeData),this.drag.start(t,n).then(e=>this.onDragComplete(e)),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)}_findDragHandle(e){let t=null,n=e;for(;n&&n!==this.node;){if(n.classList.contains(this.dragHandleClass)){t=n;break}n=n.parentElement}return null===t||Q(t,J,this.node)||(t=null),t}_evtDragMousedown(e){const t=e.target,n=this._findDragHandle(t);null!==n&&0===e.button&&(this._clickData={pressX:e.clientX,pressY:e.clientY,handle:n},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault())}_evtDragMouseup(e){if(0!==e.button||!this.drag)return document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),void(this.drag=null);e.preventDefault(),e.stopPropagation()}_evtDragMousemove(e){if(this.drag)return;e.preventDefault(),e.stopPropagation();const t=this._clickData;if(!t)throw new Error("Missing drag data");const n=Math.abs(e.clientX-t.pressX),s=Math.abs(e.clientY-t.pressY);n<5&&s<5||(this.startDrag(t.handle,e.clientX,e.clientY),this._clickData=null)}}class te extends ee{constructor(e={}){super(e)}processDrop(e,t){}findDropTarget(e,t){return null}}class ne extends ee{processDrop(e,t){if(!Z.isValidAction(t.supportedActions,"move")||"none"===t.proposedAction)return t.dropAction="none",t.preventDefault(),void t.stopPropagation();if(!this.validateSource(t))throw new Error("Invalid source!");const n=this.move(t.mimeData,e);t.preventDefault(),t.stopPropagation(),t.dropAction=n}}!function(e){e.isValidAction=function(e,t){switch(e){case"all":return!0;case"link-move":return"move"===t||"link"===t;case"copy-move":return"move"===t||"copy"===t;case"copy-link":return"link"===t||"copy"===t;default:return t===e}}}(Z||(Z={})),function(e){function t(e){e.addClass(K)}e.makeHandle=t,e.unmakeHandle=function(e){e.removeClass(K)},e.createDefaultHandle=function(){const e=new D.Widget;return e.addClass("jfs-DragWidget-dragHandle"),t(e),e}}(te||(te={})),n(8416),new RegExp(`^${w.PageConfig.getOption("treeUrl")}([^?]+)`),new RegExp(`^${w.PageConfig.getOption("workspacesUrl")}[^?/]+/tree/([^?]+)`),D.Widget;var se=n(4602);const oe=1048576;o.ToolbarButton;class re{constructor(e){this._uploads=[],this._uploadChanged=new se.Signal(this),this._uploadCompleted=new se.Signal(this),this._disposed=!1,this.model=e.model,this._contentsProxy=e.contentsProxy}get uploadChanged(){return this._uploadChanged}get uploadCompleted(){return this._uploadCompleted}get isDisposed(){return this._disposed}dispose(){this.isDisposed||(this._disposed=!0,se.Signal.clearData(this))}async upload(e,t){await this._uploadCheckDisposed(),(t=t||this.model.selectedLast||this.model.root).hasChildren||(t=await V(t,this.model.root));const n=t.pathstr?t.pathstr+"/"+e.name:e.name;let s=null;try{s=await this._contentsProxy.get(n,{content:!1})}catch(e){}if(s&&!await(0,M.shouldOverwrite)(n.slice(n.indexOf("/")+1)))return null;await this._uploadCheckDisposed();const o=e.size>oe,r=await this._upload(e,n,o);return t.invalidate(),this._uploadCompleted.emit({path:r.path}),r}async _upload(e,t,n){const s=e.name,o=async(n,o)=>{await this._uploadCheckDisposed();const r=new FileReader;r.readAsDataURL(n),await new Promise((t,n)=>{r.onload=t,r.onerror=t=>n(`Failed to upload "${e.name}":  ${t}`)}),await this._uploadCheckDisposed();const i=r.result.split(",")[1],a={type:"file",format:"base64",name:s,chunk:o,content:i};return await this._contentsProxy.save(t,a)};if(!n)try{return await o(e)}catch(t){throw T.ArrayExt.removeFirstWhere(this._uploads,t=>e.name===t.path),t}let r,i={path:t,progress:0};this._uploadChanged.emit({name:"start",newValue:i,oldValue:null});for(let n=0;!r;n+=oe){const s=n+oe,a=s>=e.size,l=a?-1:s/oe,d={path:t,progress:n/e.size};let c;this._uploads.splice(this._uploads.indexOf(i)),this._uploads.push(d),this._uploadChanged.emit({name:"update",newValue:d,oldValue:i}),i=d;try{c=await o(e.slice(n,s),l)}catch(t){throw T.ArrayExt.removeFirstWhere(this._uploads,t=>e.name===t.path),this._uploadChanged.emit({name:"failure",newValue:i,oldValue:null}),t}a&&(r=c)}return this._uploads.splice(this._uploads.indexOf(i)),this._uploadChanged.emit({name:"finish",newValue:null,oldValue:i}),r}_uploadCheckDisposed(){return this.isDisposed?Promise.reject("Filemanager disposed. File upload canceled"):Promise.resolve()}}var ie,ae;!function(e){e.createUploadInput=function(){const e=document.createElement("input");return e.type="file",e.multiple=!0,e},e.translateToolTip=function(e){return(e=e||O.nullTranslator).load("jupyterlab").__("Upload Files")}}(ie||(ie={}));class le extends o.WidgetTracker{constructor(){super(...arguments),this._finders=new Map}setCurrent(e){this._current=e}get currentWidget(){return this._current?this._current:super.currentWidget}async add(e){if(e)return this._finders.set(e.id,e),e.disposed.connect(this._onWidgetDisposed,this),super.add(e)}remove(e){this._finders.delete(e.id),e.disposed.disconnect(this._onWidgetDisposed,this)}findByDrive(e){return this._finders.get(e)}hasByDrive(e){return this._finders.has(e)}_onWidgetDisposed(e){this.remove(e)}}class de extends ne{constructor({app:e,columns:t,url:n,rootPath:s="",translator:r,settings:i,preferredDir:a}){const{commands:d,serviceManager:{contents:c}}=e;super({node:document.createElement("tree-finder-panel"),acceptedDropMimeTypes:[Y]}),this.addClass("jp-tree-finder"),this.contentsProxy=new U(c,s,this.onGetChildren.bind(this)),this.settings=i,this.translator=r||O.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._commands=d,this._expanding=new Map,this._columns=t,this.url=n,this.rootPath=""===s?s:s+":",this.preferredDir=a,this._initialLoad=!0,this._readyDelegate=new l.PromiseDelegate,this._readyDelegate.promise.catch(e=>(0,o.showErrorMessage)("Failed to init browser",e)),this._readyDelegate.promise.then(()=>{const e=this.model;e.renamerSub.subscribe(({name:t,target:n})=>{e.sort()})})}move(e,t){const n=e.getData(Y),s=t.innerText;return this._reorderColumns(n,s),this.nodeInit(),"move"}addMimeData(e,t){const n=e.innerText;t.setData(Y,n)}getDragImage(e){const t=this.findDragTarget(e);let n=null;return t&&(n=t.cloneNode(!0),n.classList.add("jp-thead-drag-image")),n}onGetChildren(e,t){if(this._initialLoad){const n=R.Path.toarray(this.rootPath).join("/");e===n&&t.finally(()=>{this._initialLoad=!1,this.draw()})}this._expanding.set(e,(this._expanding.get(e)||0)+1),1===this._expanding.get(e)&&this.draw(),t.finally(()=>{this._expanding.set(e,(this._expanding.get(e)||1)-1),0===this._expanding.get(e)&&this.draw()})}async _reorderColumns(e,t){var n;const s=this._columns.indexOf(e),o=this._columns.indexOf(t);s<o?(this._columns.splice(o+1,0,e),this._columns.splice(s,1)):s>o&&(this._columns.splice(s,1),this._columns.splice(o,0,e)),await(null===(n=this.settings)||void 0===n?void 0:n.set("display_columns",this._columns))}draw(){var e;null===(e=this.model)||void 0===e||e.requestDraw()}refresh(){var e;null===(e=this.model)||void 0===e||e.refreshSub.next()}async nodeInit(){var e;const t=await this.contentsProxy.get(this.rootPath,{content:!1});this._currentFolder=null===(e=this.model)||void 0===e?void 0:e.root.pathstr,await this.node.init({root:t,gridOptions:{columnFormatters:{last_modified:e=>R.Format.timeSince(e),size:e=>e&&R.Format.bytesToHumanReadable(e),writable:e=>e?"✓":"╳"},doWindowResize:!0,showFilter:!0},modelOptions:{columnNames:this.columns}});const n=this.node.querySelector("tree-finder-grid");null==n||n.addStyleListener(()=>{var e,t,s;n.classList.toggle("jfs-mod-loading",this._initialLoad);const o=n.querySelectorAll("thead tr > th:first-child > span.rt-column-resize"),r=n.querySelectorAll("thead tr").length;if(o.length>r)for(const e of n.querySelectorAll("thead tr > th:first-child > span.rt-column-resize:first-child"))e.removeAttribute("class");let i=(null===(e=this.model)||void 0===e?void 0:e.selectedLast)?null===(t=this.model)||void 0===t?void 0:t.contents.indexOf(this.model.selectedLast):-1;const a=document.activeElement===document.body;for(const e of n.querySelectorAll("tr > th")){const t=e.querySelector("span.tf-header-name");t&&"path"!==t.innerText&&t.classList.add(this.dragHandleClass);const o=e.querySelector("span.rt-group-name");if(null==o||o.setAttribute("tabindex","0"),a&&o&&-1!==i){const t=n.getMeta(e);t&&t.y===i&&(o.focus(),i=-1)}if(o){const t=n.getMeta(e),r=(null==t?void 0:t.y)?null===(s=this.model)||void 0===s?void 0:s.contents[t.y]:void 0;r&&e.classList.toggle("jfs-mod-loading",!!o&&(this._expanding.get(r.pathstr)||0)>0)}}}),this.uploader?this.uploader.model=this.model:this.uploader=new re({contentsProxy:this.contentsProxy,model:this.model}),this._currentFolder&&await N(this.model,this._currentFolder.split("/")),this.model.openSub.subscribe(e=>e.forEach(e=>{if(e.getChildren){const e=ae.tracker.findByDrive(this.parent.id);ae.tracker.save(e)}else this._commands.execute("docmanager:open",{path:R.Path.fromarray(e.path)})}))}get columns(){return this._columns}set columns(e){if(T.ArrayExt.shallowEqual(this._columns,e))return;this._columns=e;const t=this.model;t.options=Object.assign(Object.assign({},t.options),{columnNames:this._columns}),t.initColumns(),this.nodeInit()}get ready(){return this._readyDelegate.promise}get model(){return this.node.model}get selection(){var e;return null===(e=this.model)||void 0===e?void 0:e.selection}get selectionPathstrs(){var e;return null===(e=this.model)||void 0===e?void 0:e.selection.map(e=>R.Path.fromarray(e.row.path))}handleEvent(e){switch(e.type){case"keydown":this.evtKeydown(e);break;case"dragenter":this.evtNativeDragOverEnter(e);case"dragover":this.evtNativeDragOverEnter(e);break;case"dragleave":case"dragend":this.evtNativeDragLeaveEnd(e);break;case"drop":this.evtNativeDrop(e);break;default:super.handleEvent(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node,n=this.nodeInit();this._initialLoad&&n.then(()=>{this._readyDelegate.resolve()}),t.addEventListener("keydown",this),t.addEventListener("dragenter",this),t.addEventListener("dragover",this),t.addEventListener("dragleave",this),t.addEventListener("dragend",this),t.addEventListener("drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;t.removeEventListener("keydown",this),t.removeEventListener("dragover",this),t.removeEventListener("dragover",this),t.removeEventListener("dragleave",this),t.removeEventListener("dragend",this),t.removeEventListener("drop",this)}_findEventRowElement(e,t){let n=e.target;for(;n.parentElement&&n.parentElement!==this.node;){if(n.matches(t))return n;n=n.parentElement}}selectNeighbour(e,t){const n=this.model;let s=n.selectedLast;const{range:o,pivot:r}=n.selectionModel;if(r&&r===(null==s?void 0:s.pathstr)&&o&&o.length>=1){const e=n.contents.map(e=>e.pathstr),t=e.indexOf(r),i=e.indexOf(o[0]),a=e.indexOf(o[o.length-1]);s=t<i?n.contents[a]:n.contents[i]}let i=s?n.contents.indexOf(s):e<0?n.contents.length-1:0;if(s&&(i+=e),i<0||i>=n.contents.length)return;const a=n.contents[i];t?n.selectionModel.selectRange(a,n.contents):n.selectionModel.select(a),ae.scrollIntoView(this,a.pathstr)}evtKeydown(e){var t,n,s,o;if(!(null===(t=this.parent)||void 0===t?void 0:t.node.classList.contains("jfs-mod-renaming")))switch(e.key){case"ArrowDown":case"ArrowUp":e.stopPropagation(),e.preventDefault(),this.selectNeighbour("ArrowUp"===e.key?-1:1,e.shiftKey);break;case"ArrowLeft":if(null===(n=this.model)||void 0===n?void 0:n.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;e.shiftKey||(t.isExpand?this.model.collapse(this.model.contents.indexOf(t)):V(t,this.model.root).then(e=>{var t,n;if(e!==(null===(t=this.model)||void 0===t?void 0:t.root))return null===(n=this.model)||void 0===n||n.selectionModel.select(e),ae.scrollIntoView(this,e.pathstr)}))}break;case"ArrowRight":if(null===(s=this.model)||void 0===s?void 0:s.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;e.shiftKey||(t.isExpand?t.hasChildren&&t.getChildren().then(e=>{var t;if(e&&e.length>0)return null===(t=this.model)||void 0===t||t.selectionModel.select(e[0]),ae.scrollIntoView(this,e[0].pathstr)}):this.model.expand(this.model.contents.indexOf(t)))}break;case" ":if(null===(o=this.model)||void 0===o?void 0:o.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;if(t.hasChildren){const e=this.model.contents.indexOf(t);t.isExpand?this.model.collapse(e):this.model.expand(e)}}}}evtNativeDragOverEnter(e){const t=this._findEventRowElement(e,"tree-finder-grid tr");t&&t.classList.add("jfs-mod-native-drop"),e.preventDefault()}evtNativeDragLeaveEnd(e){const t=this._findEventRowElement(e,".jfs-mod-native-drop");t&&t.classList.remove("jfs-mod-native-drop")}evtNativeDrop(e){var t,n,s;const r=this.node.querySelector(".jfs-mod-native-drop");r&&r.classList.remove("jfs-mod-native-drop");const i=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(!i||0===i.length)return;const a=null===(n=e.dataTransfer)||void 0===n?void 0:n.items.length;if(!a)return;for(let t=0;t<a;t++){const n=null===(s=e.dataTransfer)||void 0===s?void 0:s.items[t].webkitGetAsEntry();(null==n?void 0:n.isDirectory)&&(0,o.showDialog)({title:this._trans.__("Error Uploading Folder"),body:this._trans.__("Drag and Drop is currently not supported for folders"),buttons:[o.Dialog.cancelButton({label:this._trans.__("Close")})]})}e.preventDefault();let l=this.model.root;if(r){const e=this.node.querySelector("tree-finder-grid").getMeta(r.querySelector("th"));e.y&&(l=this.model.contents[e.y])}for(let e=0;e<i.length;e++)this.uploader.upload(i[e],l)}}!function(e){e.tracker=new le({namespace:"jupyter-fs-treefinder"}),e.clipboard=new z(e.tracker),e.sidebar=function(){},e.doRename=async function(e,t){var n;if(e.node.classList.contains("jfs-mod-renaming"))return t.row;const s=e.node.querySelector("tr.tf-mod-select .rt-tree-container .rt-group-name").firstChild,r=s.textContent.replace(/(.*)\/$/,"$1"),i=document.createElement("input");i.value=r;try{e.node.classList.replace("jfs-mod-notRenaming","jfs-mod-renaming");const a=await function(e,t,n){const s=e.parentElement;s.replaceChild(t,e),t.focus();const o=t.value.lastIndexOf(".");return-1===o?t.setSelectionRange(0,t.value.length):t.setSelectionRange(0,o),new Promise((o,r)=>{t.onblur=()=>{s.replaceChild(e,t),o(t.value)},t.onkeydown=e=>{switch(e.keyCode){case 13:e.stopPropagation(),e.preventDefault(),t.blur();break;case 27:e.stopPropagation(),e.preventDefault(),t.value=n,t.blur();break;case 38:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=0);break;case 40:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=t.value.length)}}})}(s,i,r);if(null===(n=s.parentElement)||void 0===n||n.focus(),!a||a===t.name)return t.row;if(!(0,M.isValidFileName)(a))return(0,o.showErrorMessage)("Rename Error",Error(a+' is not a valid name. Names must have nonzero length, and cannot include "/", "\\", or ":"')),t.row;const l=t.getPathAtDepth(1).join("/"),d=l.slice(0,-1*r.length)+a,c=s.textContent.endsWith("/")?"/":"";let h;try{h=await e.contentsProxy.rename(l+c,d+c)}catch(e){"File not renamed"!==e&&(0,o.showErrorMessage)("Rename Error",e),h=t.row}return s.textContent=a+c,h}finally{e.node.classList.replace("jfs-mod-renaming","jfs-mod-notRenaming")}},e.scrollIntoView=async function(e,t){const n=e.model;await n.flatten();const s=e.node.querySelector("tree-finder-grid");if(await s.draw(),!e.node.querySelector(".tf-mod-select .rt-tree-container .rt-group-name")){const e=n.contents.findIndex(e=>e.pathstr===t);-1!==e&&await s.scrollToCell(0,e,1,n.contents.length)}},e.download=async function(e,t,n){if(n);else{const n=await e.contentsProxy.downloadUrl(t),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",""),document.body.appendChild(s),s.click(),document.body.removeChild(s)}}}(ae||(ae={}));var ce=n(9012);const he=Object.fromEntries(["copy","cut","delete","open","paste","refresh","rename","download","create_folder","create_file","copyFullPath","copyRelativePath","restore","toggleColumnPath","toggleColumn"].map(e=>[e,`treefinder:${e}`])),ue=["size","last_modified","writable","mimetype"],me=e=>{var t;if(!e.currentWidget)return!1;const n=null===(t=e.currentWidget.model)||void 0===t?void 0:t.selection;return!!n&&n.every(e=>e.row.writable)};function pe(e){return`${he.toggleColumn}-${e}`}function ge(e){const t=[];for(const n of e){const e=n.getPathAtDepth(1).join("/");t.push(e)}return t}class fe extends D.Widget{constructor(e,t){super(),this.addClass("jp-tree-finder-sidebar"),this.node.classList.add("jfs-mod-notRenaming"),this.app=e,this.settings=t,this.drive=null,this.name=null,this.treefinder=null,this.toolbar=new a.Toolbar,this.layout=new D.PanelLayout,this.layout.addWidget(this.toolbar),this._buttons=[];const n=new a.ToolbarButton({icon:a.refreshIcon,onClick:()=>{ae.tracker.setCurrent(this.treefinder),e.commands.execute(he.refresh),ae.tracker.setCurrent(null)},tooltip:"Refresh",enabled:!1}),s=new a.ToolbarButton({icon:a.newFolderIcon,onClick:()=>{ae.tracker.setCurrent(this.treefinder),e.commands.execute(he.create_folder),ae.tracker.setCurrent(null)},tooltip:"New Folder",enabled:!1});this.toolbar.addItem("refresh",n),this.toolbar.addItem("new file",s),this._buttons.push(n),this._buttons.push(s)}onBeforeShow(e){this.treefinder&&(this.treefinder.refresh(),this.treefinder.draw())}onResize(e){this.treefinder&&this.treefinder.draw()}setEndpoint(e,t,n){this.drive=t,this.name=n,this.treefinder&&(this.treefinder.parent=null,this.update(),ae.tracker.remove(this.treefinder),this.treefinder=null);let s=Array();s.push("path"),s.push("size"),this.treefinder=new de({app:this.app,columns:s,url:e,rootPath:t,settings:this.settings}),this.layout.addWidget(this.treefinder),ae.tracker.add(this.treefinder),this._buttons.forEach(e=>{e.enabled=!0}),this.update()}getSelectedDir(){var e=this.getSelected();return 1==e.length&&e[0].isDir?e[0].path:this.getCurrentDir()}getSelected(){var e=[];return this.treefinder.model.selection.forEach(t=>{console.log("selected: "+JSON.stringify(t));var n=new ve;n.drive=this.drive,n.path=t.pathstr,n.isDir="dir"==t.row.kind,console.log("--\x3e "+JSON.stringify(n)),e.push(n)}),e}getCurrentDir(){var e=this.treefinder.model.root.pathstr;return e.includes("/")?e:e+"/"}}class ve{constructor(){this.isDir=!1}}class ye extends D.Widget{constructor(e,t){super(),this.addClass("my-dmWidget"),this._fbWidget_l=new fe(e,t);const n=new L(this._fbWidget_l);this._fbWidget_l.toolbar.insertItem(0,"selectEndpointBtn",n),this._fbPanel_l=new D.SplitPanel({orientation:"vertical",spacing:1}),this._fbPanel_l.id="fb_panel_l",this._fbPanel_l.addWidget(this._fbWidget_l),this._fbPanel_l.setRelativeSizes([90,10]),this._fbWidget_r=new fe(e,t);const s=new L(this._fbWidget_r);this._fbWidget_r.toolbar.insertItem(0,"selectEndpointBtn",s),this._transferListWidget=new P,this._fbPanel_r=new D.SplitPanel({orientation:"vertical",spacing:1}),this._fbPanel_r.id="fb_panel_r",this._fbPanel_r.addWidget(this._fbWidget_r),this._fbPanel_r.setRelativeSizes([90,10]),this._transferBoxPanel=new D.BoxPanel({direction:"top-to-bottom"}),this._transferBoxPanel.id="transferToolbar",this._transferBoxPanel.node.style.maxWidth="100px",this._transferBoxPanel.node.style.maxHeight="100px",this._transferBoxPanel.node.style.top="200px";const o=new W(this._fbWidget_l,this._fbWidget_r,this._transferListWidget,"--\x3e","Copy left selected to right directory directly"),r=new W(this._fbWidget_r,this._fbWidget_l,this._transferListWidget,"<--","Copy right selected to left directory directly");this._transferBoxPanel.addWidget(o),this._transferBoxPanel.addWidget(r),this._fbPanel=new D.BoxPanel({direction:"left-to-right",spacing:1}),this._fbPanel.id="fb_panel",this._fbPanel.addClass("dm_Widget-main"),this._fbPanel.addWidget(this._fbPanel_l),this._fbPanel.addWidget(this._transferBoxPanel),this._fbPanel.addWidget(this._fbPanel_r);let i=new D.SplitPanel({orientation:"horizontal",spacing:1});i.title.label="Transfers",i.addWidget(this._transferListWidget);const a=new I(this._transferListWidget,"Refresh list of transfers");i.addWidget(a),i.setRelativeSizes([80,20]);let l=new D.DockPanel;l.addWidget(i),this._mainLayout=this.layout=new D.BoxLayout,this._panel_collection=new D.SplitPanel({orientation:"vertical",spacing:10,alignment:"center"}),this._panel_collection.id="panel_collection",this._panel_collection.addWidget(this._fbPanel),this._panel_collection.addWidget(l),this._panel_collection.setRelativeSizes([80,10]),this._mainLayout.addWidget(this._panel_collection)}}let we="inhpc_dm:plugin";const _e={id:we,autoStart:!0,requires:[i.ISettingRegistry,o.ICommandPalette,s.ILayoutRestorer,r.ILauncher,o.IThemeManager],activate:(e,t,n,s,r,i)=>{async function h(e,t){var n,s;let o=(null!==(n=null==t?void 0:t.composite.resources)&&void 0!==n?n:[]).map(E);const r=null!==(s=null==t?void 0:t.composite.options)&&void 0!==s?s:{};try{o=(await async function(e,t){const n=new l.PromiseDelegate;if(function(e){for(const t of e)if(v(t))return!0;return!1}(e=await x.instance.initResourceRequest({resources:e,options:Object.assign(Object.assign({},t),{_addServerside:!0})}))){const s=document.createElement("div");document.body.appendChild(s);let o=!1;const r=()=>{try{c.unmountComponentAtNode(s),s.remove(),o||n.resolve(e)}catch(e){n.reject(e)}},i=async s=>{try{o=!0,e=await x.instance.initResourceRequest({resources:e.map(e=>Object.assign(Object.assign({},e),{tokenDict:s[e.url]})),options:t}),n.resolve(e)}catch(e){n.reject(e)}};c.render(d.createElement(y,{handleClose:r,handleSubmit:i,options:t,resources:e}),s)}else n.resolve(e);return n.promise}(o,r)).filter(e=>e.init)}catch(e){console.error("Failed to update resources!",e)}!async function(e,t,n,s,o){var r;const i=[],l={},d=null!==(r=null==o?void 0:o.composite.display_columns)&&void 0!==r?r:["size"],c=new D.Menu({commands:e.commands});c.title.label="Show/Hide Columns",c.title.icon=a.filterListIcon,c.addItem({command:he.toggleColumnPath});for(const t of ue)c.addItem({command:pe(t)}),l[t]=d.includes(t),i.push(e.commands.addCommand(pe(t),{execute:async e=>{l[t]=!l[t],await(null==o?void 0:o.set("display_columns",ue.filter(e=>l[e])))},label:t,isToggleable:!0,isToggled:()=>l[t]}));const h=".jp-tree-finder-sidebar";let u=1;[...i,e.contextMenu.addItem({command:he.open,selector:h,rank:u++}),e.contextMenu.addItem({command:he.copy,selector:h,rank:u++}),e.contextMenu.addItem({command:he.cut,selector:h,rank:u++}),e.contextMenu.addItem({command:he.paste,selector:h,rank:u++}),e.contextMenu.addItem({command:he.delete,selector:h,rank:u++}),e.contextMenu.addItem({command:he.rename,selector:h,rank:u++}),e.contextMenu.addItem({command:he.download,selector:h,rank:u++}),e.contextMenu.addItem({type:"separator",selector:h,rank:u++}),e.contextMenu.addItem({command:he.copyFullPath,selector:h,rank:u++}),e.contextMenu.addItem({command:he.copyRelativePath,selector:h,rank:u++}),e.contextMenu.addItem({type:"separator",selector:h,rank:u++}),e.contextMenu.addItem({command:he.create_file,selector:h,rank:u++}),e.contextMenu.addItem({command:he.create_folder,selector:h,rank:u++}),e.contextMenu.addItem({type:"separator",selector:h,rank:u++}),e.contextMenu.addItem({type:"submenu",submenu:c,selector:h,rank:u++}),e.contextMenu.addItem({args:{selection:!0},command:he.refresh,selector:h,rank:u++})].reduce((e,t)=>(e.add(t),e),new ce.DisposableSet)}(e,ae.tracker,ae.clipboard,0,t)}console.log("JupyterLab extension InHPC data management activating."),function(e,t,n){[e.commands.addCommand(he.copy,{execute:e=>n.model.copySelection(t.currentWidget.model),icon:a.copyIcon,label:"Copy",isVisible:()=>{var e;const n=t.currentWidget;return!!n&&!(null===(e=n.model)||void 0===e?void 0:e.selection.some(e=>"dir"===e.row.kind))},isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.cut,{execute:e=>n.model.cutSelection(t.currentWidget.model),icon:a.cutIcon,label:"Cut",isEnabled:()=>me(t)}),e.commands.addCommand(he.delete,{execute:async e=>{const s=t.currentWidget,r=s.model,i=1===r.selection.length?`Are you sure you want to permanently delete: ${r.selection[0].name}?`:`Are you sure you want to permanently delete the ${r.selection.length} selected items?`,a=await(0,o.showDialog)({title:"Delete",body:i,buttons:[o.Dialog.cancelButton({label:"Cancel"}),o.Dialog.warnButton({label:"Delete"})],defaultButton:0});!s.isDisposed&&a.button.accept&&n.model.deleteSelection(r)},icon:a.closeIcon.bindprops({stylesheet:"menuItem"}),label:"Delete",isEnabled:()=>me(t)}),e.commands.addCommand(he.open,{execute:e=>{var n;return t.currentWidget.model.openSub.next(null===(n=t.currentWidget.selection)||void 0===n?void 0:n.map(e=>e.row))},label:"Open",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.paste,{execute:e=>n.model.pasteSelection(t.currentWidget.model),icon:a.pasteIcon,label:"Paste",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.rename,{execute:e=>{const n=t.currentWidget,s=n.selection[0];ae.doRename(n,s).then(e=>{var t;null===(t=n.model)||void 0===t||t.renamerSub.next({name:e.name,target:s}),s.row=e})},icon:a.editIcon,label:"Rename",isEnabled:()=>me(t)}),e.commands.addCommand(he.download,{execute:async e=>{const n=t.currentWidget,s=n.selection;await Promise.allSettled(s.map(e=>ae.download(n,e.pathstr,e.hasChildren)))},icon:a.downloadIcon,label:"Download",isEnabled:()=>{var e,n,s;return!!(null===(s=null===(n=null===(e=t.currentWidget)||void 0===e?void 0:e.model)||void 0===n?void 0:n.selection)||void 0===s?void 0:s.some(e=>!e.hasChildren))}}),e.commands.addCommand(he.create_folder,{execute:async e=>{var n;const s=t.currentWidget,r=s.model;let i=null!==(n=r.selectedLast)&&void 0!==n?n:r.root;i.hasChildren||(i=await V(i,r.root));const a=R.Path.fromarray(i.row.path);let l;try{l=await s.contentsProxy.newUntitled({type:"directory",path:a})}catch(e){return void(0,o.showErrorMessage)("Could not create folder",e)}i.invalidate();const d=await $(r,l.path);r.refreshSub.next(H([i.row],r.root)),await ae.scrollIntoView(s,d.pathstr);const c=await ae.doRename(s,d);r.renamerSub.next({name:c.name,target:d}),d.row=c},icon:a.newFolderIcon,label:"New Folder",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.create_file,{execute:async e=>{var n;const s=t.currentWidget,r=s.model;let i=null!==(n=r.selectedLast)&&void 0!==n?n:r.root;i.hasChildren||(i=await V(i,r.root));const a=R.Path.fromarray(i.row.path);let l;try{l=await s.contentsProxy.newUntitled({type:"file",path:a})}catch(e){return void(0,o.showErrorMessage)("Could not create file",e)}i.invalidate();const d=await $(r,l.path);r.refreshSub.next(H([i.row],r.root)),await ae.scrollIntoView(s,d.pathstr);const c=await ae.doRename(s,d);r.renamerSub.next({name:c.name,target:d}),d.row=c},icon:a.fileIcon,label:"New File",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.refresh,{execute:e=>{e.selection?n.refreshSelection(t.currentWidget.model):n.refresh(t.currentWidget.model)},icon:a.refreshIcon,label:e=>e.selection?"Refresh Selection":"Refresh",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.copyFullPath,{execute:async e=>{const n=t.currentWidget,s=ge(n.selection).map(e=>{var t,s;return[(s=null!==(t=n.url)&&void 0!==t?t:"",s.trimEnd().replace(/\/+$/,"")),e].join("/")});await navigator.clipboard.writeText(s.join("\n"))},label:"Copy Full Path",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.copyRelativePath,{execute:async e=>{const n=ge(t.currentWidget.selection);await navigator.clipboard.writeText(n.join("\n"))},label:"Copy Relative Path",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(he.toggleColumnPath,{execute:e=>{},label:"path",isEnabled:()=>!1,isToggled:()=>!0}),e.commands.addCommand(he.restore,{execute:async e=>{const n=e.rootPath.split("/"),s=t.findByDrive(e.id);if(!s)throw new Error(`Could not restore JupyterFS browser: ${e.id}`);const o=s.model;s.preferredDir||(await N(o,n),await t.save(s))}})].reduce((e,t)=>(e.add(t),e),new ce.DisposableSet)}(e,ae.tracker,ae.clipboard);try{Promise.all([e.restored,t.load(we)]).then(([,t])=>{h(e,t),t.changed.connect(()=>{h(e,t)}),function(e,t,n,s,r){let i;console.log("Initialising InHPC data management front-end.");const l="inhpc:opendm";let d=new o.WidgetTracker({namespace:"inhpc_dm"});i=d.currentWidget;let c={label:"InHPC - Data Management dual browser view",icon:a.folderIcon,execute:()=>{if(i=d.currentWidget,!i||i.isDisposed){const t=new ye(e,r);t.id="dmwidget_id",i=new o.MainAreaWidget({content:t}),i.id="inhpc-datamanagement",i.title.label="Data Management",i.title.closable=!0,d.add(i)}i.isAttached||e.shell.add(i,"main"),i.content.update(),e.shell.activateById(i.id)}};e.commands.addCommand(l,c),t.addItem({command:l,category:"Other"}),s&&s.add({command:l,category:"Other"})}(e,n,0,r,t)})}catch(e){console.warn(`Failed to load settings for the inhpc_dm extension.\n${e}`)}const u=document.createElement("style");function m(e,t){return`\n      .jp-tree-finder {\n        --tf-dir-icon: url('data:image/svg+xml,${encodeURIComponent(e)}');\n        --tf-file-icon: url('data:image/svg+xml,${encodeURIComponent(t)}');\n      }\n      `}u.setAttribute("id","jupyter-fs-icon-inject"),i.themeChanged.connect(()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--jp-ui-font-color1");u.textContent=m(a.folderIcon.svgstr.replace(/fill="([^"]{0,7})"/,`fill="${e}"`),a.fileIcon.svgstr.replace(/fill="([^"]{0,7})"/,`fill="${e}"`))}),u.textContent=m(a.folderIcon.svgstr,a.fileIcon.svgstr),document.head.appendChild(u)}}}}]);