(self.webpackChunkinhpc_dm=self.webpackChunkinhpc_dm||[]).push([[514],{1514:t=>{self,t.exports=(()=>{var t={710:()=>{const t=new WeakMap,e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e,i,s,r){var n={};return Object.keys(s).forEach(function(t){n[t]=s[t]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,s){return s(t,e,i)||i},n),r&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(r):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}class r{constructor(t,e,i){this._column_sizes=t,this._container=e,this.table=i,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,i){t.set(e,i)}_get_or_create_metadata(e){if(void 0===e)return{};if(t.has(e))return t.get(e);{const i={};return t.set(e,i),i}}_replace_cell(t,e){const{tr:i,row_container:s}=this._get_row(t);let r=s[e];return r&&(i.removeChild(r),s.splice(e,1,void 0)),r}_fetch_cell(t,e){if(t<0||e<0)return;const{row_container:i}=this._get_row(t);return i[e]}_get_cell(t="TD",e,i){const{tr:s,row_container:r}=this._get_row(e);let n=r[i];if(n||(i<r.length?(n=r[i]=document.createElement(t),s.insertBefore(n,r.slice(i+1).find(t=>t))):(n=r[i]=document.createElement(t),s.appendChild(n))),n.tagName!==t){const r=document.createElement(t);s.replaceChild(r,n),this.cells[e].splice(i,1,r),n=r}return n}_get_row(t){let e=this.rows[t];e||(e=this.rows[t]=document.createElement("tr"),this.table.appendChild(e));let i=this.cells[t];return i||(i=this.cells[t]=[]),{tr:e,row_container:i}}_clean_columns(t){for(let e=0;e<this.rows.length;e++){const i=this.rows[e],s=this.cells[e];this.cells[e]=s.slice(0,t[e]||t);const r=this.cells[e].filter(t=>void 0!==t).length;for(;i.children[r];)i.removeChild(i.children[r])}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}}class n extends r{constructor(...t){super(...t),i(this,"_group_header_cache",[]),i(this,"_offset_cache",[])}_draw_group_th(t,e,i){const s=this._get_cell("TH",e,t[e]||0);if(t[e]+=1,s.removeAttribute("colspan"),s.style.minWidth="0",s.textContent="",i instanceof HTMLElement)s.appendChild(i);else{const t=document.createElement("span");t.textContent=i,s.appendChild(t)}const r=document.createElement("span");return r.className="rt-column-resize",s.appendChild(r),s}_draw_group(t,e,i){const s=this._get_or_create_metadata(i);return s.column_header=t,s.value=e,s.value=e,s}_draw_th(t,e,i,s,r){const n=this._get_or_create_metadata(i);if(n.column_header=t,n.value=e,n.size_key=r.length?r[0]:r,!(r.length>1)){const t=this._column_sizes.override[n.size_key],e=this._column_sizes.auto[n.size_key];t?(i.classList.toggle("rt-cell-clip",e>t),i.style.minWidth=t+"px",i.style.maxWidth=t+"px"):e?(i.classList.remove("rt-cell-clip"),i.style.maxWidth="",i.style.minWidth=e+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return n}get_column_header(t){return this._get_cell("TH",this.num_rows()-1,t)}draw(t,e,i,s,r,n,o){const a=null==e?void 0:e.length;if(0===a)return{};let l,h,c;for(let p=0;p<a;p++){if(c=e[p]?e[p]:"",this._offset_cache[p]=this._offset_cache[p]||0,p<a-1){var d,u,_;(null===(d=this._group_header_cache)||void 0===d||null===(u=d[p])||void 0===u||null===(_=u[0])||void 0===_?void 0:_.value)===c?(l=this._group_header_cache[p][1],this._group_header_cache[p][2]+=1,1===i&&(this._group_header_cache[p][0].row_header_x=r),l.setAttribute("colspan",this._group_header_cache[p][2])):(l=this._draw_group_th(this._offset_cache,p,c),h=this._draw_group(e,c,l),this._group_header_cache[p]=[h,l,1])}else{l=this._draw_group_th(this._offset_cache,p,c),h=this._draw_th(t||e,c,l,s,r);for(const[t]of this._group_header_cache)t.size_key=h.size_key;l.removeAttribute("colspan")}h&&(h.x=s,h.column_header_y=p,h.x0=n,h._virtual_x=o,1===i&&(h.row_header_x=r))}return this._clean_rows(this._offset_cache.length),{th:l,metadata:h}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}}class o extends r{_draw_td(t,e,i,s,{column_name:r},{ridx_offset:n},o){const a=this._get_cell(t,e,s),l=this._get_or_create_metadata(a);l.y=e+n,l.size_key=o,"TD"===t&&(l.column_header=r);const h=this._column_sizes.override[l.size_key];if(h){const t=this._column_sizes.auto[l.size_key];a.classList.toggle("rt-cell-clip",t>h),a.style.minWidth=h+"px",a.style.maxWidth=h+"px"}else a.classList.remove("rt-cell-clip"),a.style.minWidth="",a.style.maxWidth="";return i instanceof HTMLElement?(a.textContent="",a.appendChild(i)):a.textContent=i,l.value=i,{td:a,metadata:l}}draw(t,e,i,s=!1,r,n,o){const{cidx:a,column_data:l,row_headers:h,column_data_listener_metadata:c}=e;let d,{row_height:u}=i;const _=[],p=[];let m=0;const f=[];for(let b=0;b<(s?i.row_headers_length:1);b++){m=0;for(const v of l){var w;const l=null==h?void 0:h[m];let g;if(s){const t=v[b],s=this._fetch_cell(m-(_[b]||1),a+b),r=this._get_or_create_metadata(s),o=this._fetch_cell(m,a+b-(f[m]||1)),l=this._get_or_create_metadata(o);!o||l.value!==t&&void 0!==t||o.hasAttribute("rowspan")?s&&r.value===t&&!s.hasAttribute("colspan")?(_[b]=_[b]?_[b]+1:2,s.setAttribute("rowspan",_[b]),this._replace_cell(m,a+b)):(g=this._draw_td("TH",m,t,a+b,e,i,b),g.td.style.display="",g.td.removeAttribute("rowspan"),g.td.removeAttribute("colspan"),g.metadata.row_header=v,g.metadata.row_header_x=b,g.metadata.x0=n,g.metadata.y0=i.ridx_offset,g.metadata.y1=i.y1,g.metadata._virtual_x=b,_[b]=1,f[m]=1,p[b]=g):(f[m]=f[m]?f[m]+1:2,o.setAttribute("colspan",f[m]),this._replace_cell(m,a+b))}else g=this._draw_td("TD",m,v,a,e,i,o),c&&(g.metadata.user=c[m]),g.metadata.x=r,g.metadata.x0=n,g.metadata.x1=i.x1,g.metadata.row_header=l||[],g.metadata.y0=i.ridx_offset,g.metadata.y1=i.y1,g.metadata.dx=r-n,g.metadata.dy=g.metadata.y-g.metadata.y0,g.metadata._virtual_x=a,p[0]=g;if(m++,d=g?g.metadata:d,u=u||(null===(w=g)||void 0===w?void 0:w.td.offsetHeight),m*u>t)break}}return this._clean_rows(m),{tds:p,ridx:m,metadata:d,row_height:u}}clean({ridx:t,cidx:e}){this._clean_rows(t),this._clean_columns(e)}}let a=0,l=0,h=performance.now();const c=(t,...e)=>t.map((t,i)=>[t,e[i]]).flat().filter(t=>!!t).join("");function d(t,e,i){const s=Symbol("private lock"),r=i.value;return i.value=async function(...t){if(this[s]&&(await this[s],this[s]))return void await this[s];let e;this[s]=(()=>{let t;const e=new Promise(e=>{t=e});return e.resolve=t,e})();try{e=await r.call(this,...t)}finally{const t=this[s];this[s]=void 0,t.resolve()}return e},i.value.flush=function(){return this[s]},i}class u{constructor(t,e,i){this.clear(i);const[s]=i.children,[r,a]=s.children;this.table=s,this._column_sizes=e,this.header=new n(e,t,r),this.body=new o(e,t,a),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(t){t.innerHTML=c` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(t){for(;t.length>0;){const[e,i,s]=t.pop();let r;const n=getComputedStyle(e);"border-box"!==n.boxSizing?(r=e.clientWidth,r-=parseFloat(n.paddingLeft),r-=parseFloat(n.paddingRight)):r=e.offsetWidth,this._column_sizes.row_height=this._column_sizes.row_height||s.offsetHeight,this._column_sizes.indices[i.size_key]=r;const o=this._column_sizes.override.hasOwnProperty(i.size_key);r&&!o&&(this._column_sizes.auto[i.size_key]=r),"0px"===e.style.minWidth&&(e.style.minWidth=r+"px")}}async*draw(t,e,i,s,r,n){var o,a,l,h;const{width:c,height:d}=t,{view:u,config:_}=e;let{data:p,row_headers:m,column_headers:f,metadata:w}=await u(r.start_col,r.start_row,r.end_col,r.end_row);const{start_row:b=0,start_col:v=0,end_col:g=0,end_row:y=0}=r;m&&(this._row_headers_length=m.reduce((t,e)=>Math.max(t,e.length),0),m=m.map(t=>(t.length=this._row_headers_length,t))),e.config.column_pivots=Array.from(Array((null==f||null===(o=f[0])||void 0===o?void 0:o.length)-1||0).keys()),e.config.row_pivots=Array.from(Array((null===(a=m)||void 0===a||null===(l=a[0])||void 0===l?void 0:l.length)||0).keys());const x={viewport_width:0,selected_id:i,ridx_offset:b,x0:v,x1:g,y1:y,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length};let S,E=0,z=[],C=!0;if((null===(h=m)||void 0===h?void 0:h.length)>0){const t=_.row_pivots.join(","),i={column_name:t,cidx:0,column_data:m,row_headers:m,first_col:C},r=E+v;S=this.body.draw(d,i,{...x,x0:0},!0,void 0,void 0,r);const n=[];for(let i=0;i<e.config.row_pivots.length;i++)n.push(this.header.draw(t,Array(e.config.column_pivots.length+1).fill(""),1,void 0,i,v,i));if(C=!1,x.viewport_width+=n.reduce((t,{th:e},i)=>t+(this._column_sizes.indices[i]||e.offsetWidth),0),x.row_height=x.row_height||S.row_height,E=m[0].length,!s)for(let t=0;t<e.config.row_pivots.length;t++){const{td:e,metadata:i}=S.tds[t]||{},{th:s,metadata:r}=n[t];z.push([s||e,r||i,e||s])}}try{var L;let t=0;const e=n-r.start_col;for(;t<e;){if(!p[t]){let e=Math.max(r.end_col,0);r.start_col=e;let i=0,s=0;for(;this._column_sizes.indices.length>E+v+i+1&&s+x.viewport_width<c;)i++,s+=this._column_sizes.indices[E+v+i];if(s+x.viewport_width<c){const t=Math.min(n,e+5);r.end_col=Math.max(1,Math.min(n,t))}else r.end_col=Math.max(1,Math.min(n,e+i));const o=u(r.start_col,r.start_row,r.end_col,r.end_row);yield;const a=await o;if(0===a.data.length)return void(yield z);r.end_col=r.start_col+a.data.length;for(let e=0;e<a.data.length;e++){var M;p[t+e]=a.data[e],a.metadata&&(w[t+e]=a.metadata[e]),f&&(f[t+e]=null===(M=a.column_headers)||void 0===M?void 0:M[e])}}const e=(null==f?void 0:f[t])||"",i={column_name:e,cidx:E,column_data:p[t],column_data_listener_metadata:null==w?void 0:w[t],row_headers:m,first_col:C},o=t+v,a=E+v,l=this.header.draw(void 0,e,void 0,o,a,v,E);if(S=this.body.draw(d,i,x,!1,o,v,a),C=!1,!s)for(const{td:t,metadata:e}of S.tds)z.push([l.th||t,l.metadata||e,t||l.th]);const h=this._column_sizes.indices[E+v];var T;if(x.viewport_width+=h||(null===(T=l.th)||void 0===T?void 0:T.offsetWidth)||S.tds.reduce((t,e)=>{var i;return t+(null===(i=e.td)||void 0===i?void 0:i.offsetWidth)},0),x.row_height=x.row_height||S.row_height,E++,t++,x.viewport_width>c){var k;this.body.clean({ridx:(null===(k=S)||void 0===k?void 0:k.ridx)||0,cidx:E}),this.header.clean(),yield z,x.viewport_width=0;for(let[t]of z)x.viewport_width+=t.offsetWidth;if(x.viewport_width>c)return}}this.body.clean({ridx:(null===(L=S)||void 0===L?void 0:L.ridx)||0,cidx:E}),this.header.clean(),yield z}finally{var P;this.body.clean({ridx:(null===(P=S)||void 0===P?void 0:P.ridx)||0,cidx:E}),this.header.clean()}}}var _;function p(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(p.prototype,HTMLElement.prototype),Object.setPrototypeOf(p,HTMLElement);let m=(s((_=class extends p{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=c` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;const[,t,e]=this.shadowRoot.children;this._table_clip=e,this._virtual_panel=t,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&("both"!==this._virtual_mode&&"vertical"!==this._virtual_mode||(this._table_clip.style.top="0px"),"both"!==this._virtual_mode&&"horizontal"!==this._virtual_mode||(this._table_clip.style.left="0px"))}_calculate_viewport(t,e,i,s){const{start_row:r,end_row:n}=this._calculate_row_range(t,i),{start_col:o,end_col:a}=this._calculate_column_range(e,s);return this._nrows=t,{start_col:o,end_col:a,start_row:r,end_row:n}}_calculate_row_range(t,e){const{height:i}=this._container_size,s=this._column_sizes.row_height||19,r=this._view_cache.config.column_pivots.length+1,n=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),o=Math.max(this.scrollTop,0)/n,a=i/s,l=e?t:this._nrows||0,h=Math.max(0,l+(r-a));let c=Math.ceil(h*o);return{start_row:c,end_row:Math.min(Math.ceil(c+a),t)}}_calculate_column_range(t,e){const i=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),s=this.scrollLeft/i,r=this._max_scroll_column(t)+.5;if("none"===this._virtual_mode||"vertical"===this._virtual_mode)return{start_col:0,end_col:1/0};{let i=Math.floor(r*s);return{start_col:i,end_col:i+(!e&&this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let e=0;if(this._view_cache.config.row_pivots.length>0)for(const t of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))e+=t;let i=t;for(;e<this._container_size.width&&i>=0;)i--,e+=this._column_sizes.indices[i]||60;return Math.min(t-1,i+1)}_validate_viewport({start_col:t,end_col:e,start_row:i,end_row:s}){const r=this._start_col!==t,n=this._start_row!==i||this._end_row!==s||this._end_col!==e;return this._start_col=t,this._end_col=e,this._start_row=i,this._end_row=s,{invalid_column:r,invalid_row:n}}_update_virtual_panel_width(t,e){if(t)if("vertical"===this._virtual_mode||"none"===this._virtual_mode)this._virtual_panel.style.width=this._column_sizes.indices.reduce((t,e)=>t+e,0)+"px";else{const t=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),i=this.scrollLeft/t,s=this._max_scroll_column(e);let r=0,n=0;for(;r<s;)n+=this._column_sizes.indices[r]||60,r++;const o=this._container_size.width+n;this._virtual_panel.style.width=o+"px",this.scrollLeft=i*n}}_update_virtual_panel_height(t){const{row_height:i=19}=this._column_sizes,s=this.table_model.header.num_rows()*i;let r;if("horizontal"===this._virtual_mode||"none"===this._virtual_mode)r=t*i+s;else{const n=this.clientHeight/(this._table_clip.offsetHeight-s);r=Math.min(e,t*i*n)}this._virtual_panel.style.height=r+"px"}async draw(t={}){const e=performance.now(),{invalid_viewport:i=!0,preserve_width:s=!1,reset_scroll_position:r=!1,invalid_columns:n=!1}=t;r&&this.reset_scroll(),this._invalid_schema=n||this._invalid_schema;const{num_columns:o,num_rows:h}=await this._view_cache.view(0,0,0,0);this._container_size={width:"none"===this._virtual_mode||"vertical"===this._virtual_mode?1/0:this._table_clip.clientWidth,height:"none"===this._virtual_mode||"horizontal"===this._virtual_mode?1/0:this._table_clip.clientHeight};const c=this._calculate_viewport(h,o,r,n),{invalid_row:d,invalid_column:u}=this._validate_viewport(c);if(this._update_virtual_panel_height(h),this._invalid_schema||d||u||i||u){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this}));let t=[];for await(t of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,s,c,o)){this._is_styling=!0;const e=this._style_callbacks;for(const t of e)await t({detail:this});if(this._is_styling=!1,!this._invalidated&&void 0!==t)break;this._invalidated=!1}this.table_model.autosize_cells(t),this.table_model.header.reset_header_cache(),s||this._update_virtual_panel_width(this._invalid_schema||u||i,o),this._invalid_schema=!1}var _;_=performance.now()-e,a=(a*l+_)/(l+1),l+=1}}).prototype,"draw",[d],Object.getOwnPropertyDescriptor(_.prototype,"draw"),_.prototype),_);var f;let w=(s((f=class extends m{register_listeners(){this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this._register_glitch_scroll_listeners()}async _on_scroll(t){t.stopPropagation(),t.returnValue=!1,await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!1}),this.addEventListener("touchmove",this._on_touchmove.bind(this),{passive:!1})}_on_mousewheel(t){if(!window.safari)return;const{clientWidth:e,clientHeight:i,scrollTop:s,scrollLeft:r,scrollHeight:n}=this;if(t.deltaY>0&&s+i>=n||t.deltaY<0&&s<=0){t.preventDefault(),t.returnValue=!1;const n=Math.max(1,this._virtual_panel.offsetHeight-i),o=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.min(n,s+t.deltaY),this.scrollLeft=Math.min(o,r+t.deltaX),this._on_scroll(t)}}_on_touchmove(t){t.preventDefault(),t.returnValue=!1;const{clientWidth:e,clientHeight:i,scrollTop:s,scrollLeft:r}=this,n=Math.max(1,this._virtual_panel.offsetHeight-i),o=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.min(n,s+(this._memo_touch_startY-t.touches[0].screenY)),this.scrollLeft=Math.min(o,r+(this._memo_touch_startX-t.touches[0].screenX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].screenY,this._memo_touch_startX=t.touches[0].screenX}async _on_dblclick(e){let i=e.target;for(;"TD"!==i.tagName&&"TH"!==i.tagName;)if(i=i.parentElement,!this.contains(i))return;const s=e.target.classList.contains("rt-column-resize"),r=t.get(i);if(s){e.stopImmediatePropagation(),i.style.minWidth="",i.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(delete this._column_sizes.override[r.size_key],delete this._column_sizes.auto[r.size_key],delete this._column_sizes.indices[r.size_key]);for(const t of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(const i of e.shiftKey?t:[t[r._virtual_x]])i&&(i.style.minWidth="",i.style.maxWidth="",i.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(0!==e.button)return;let i=e.target;for(;"TD"!==i.tagName&&"TH"!==i.tagName;)if(i=i.parentElement,!this.contains(i))return;const s=e.target.classList.contains("rt-column-resize"),r=t.get(i);s&&(this._on_resize_column(e,i,r),e.stopImmediatePropagation())}_on_resize_column(t,e,i){const{_virtual_x:s,size_key:r}=i,n=t.pageX,o=s+e.colSpan-1,a=this.table_model.header.get_column_header(o),l=this._column_sizes.indices[r],h=t=>this._on_resize_column_move(t,a,n,l,r,o),c=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",c);const t=this._column_sizes.override[r],e=this._column_sizes.indices[r]!==t;this._column_sizes.indices[r]=t,e&&this.draw()};document.addEventListener("mousemove",h),document.addEventListener("mouseup",c)}async _on_resize_column_move(t,e,i,s,r,n){await new Promise(setTimeout);const o=t.pageX-i,a=Math.max(1,s+o);if(this._column_sizes.override[r]=a,o<0)await this.draw({preserve_width:!0});else{e.style.minWidth=a+"px",e.style.maxWidth=a+"px";const t=this._column_sizes.auto[r];for(const e of this.table_model.body.cells){const i=e[n];i&&(i.style.maxWidth=i.style.minWidth=a+"px",i.classList.toggle("rt-cell-clip",t>a))}}}}).prototype,"_on_resize_column_move",[d],Object.getOwnPropertyDescriptor(f.prototype,"_on_resize_column_move"),f.prototype),f);const b=["both","horizontal","vertical","none"];document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",class extends w{connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._column_sizes={auto:{},override:{},indices:[]},this._style_callbacks=[],this.table_model=new u(this._table_clip,this._column_sizes,this),this._initialized=!0)}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto={},this._column_sizes.override={},this._column_sizes.indices=[];for(let t=0;t<this.table_model.header.num_columns();t++){const e=this.table_model.header.get_column_header(t);e.style.minWidth="",e.style.maxWidth=""}}clear(){this.table_model=new u(this._table_clip,this._column_sizes,this)}addStyleListener(t){this._style_callbacks=this._style_callbacks.concat(t);let e=!0;return()=>{if(!e)return;e=!1;const i=this._style_callbacks=this._style_callbacks.slice(),s=i.indexOf(t);i.splice(s,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(void 0!==e){if(e instanceof HTMLElement)return t.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){const t=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(t)}}else{if(!(e.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length));if(e.column_header_y<this._view_cache.config.column_pivots.length){const t=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(t)}}}}getDrawFPS(){return function(){const t=performance.now(),e=t-h,i=a,s=1e3*l/e,r=l;return a=0,l=0,h=t,{avg:i,real_fps:s,virtual_fps:1e3/i,num_frames:r,elapsed:e}}()}async scrollToCell(t,e,i,s){const r=this._virtual_panel.offsetHeight/s;this.scrollTop=r*e,this.scrollLeft=t/(this._max_scroll_column(i)||i)*(this.scrollWidth-this.clientWidth),await this.draw.flush()}setDataListener(t,{virtual_mode:e="both"}={}){console.assert(b.indexOf(e)>-1,`Unknown virtual_mode ${e};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=e,this._invalid_schema=!0,this._view_cache={view:t,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}})},561:(t,e,i)=>{"use strict";var s,r,n,o,a;i.r(e),i.d(e,{ClipboardModel:()=>A,Content:()=>h,ContentsModel:()=>J,DEFAULT_COL:()=>l,FilterPatterns:()=>q,Format:()=>s,Path:()=>n,RegularTable:()=>r,SelectionModel:()=>Q,SortStates:()=>U,Tag:()=>o,Tree:()=>a,TreeFinderBreadcrumbsElement:()=>c,TreeFinderFilterElement:()=>d,TreeFinderFiltersElement:()=>u,TreeFinderGridElement:()=>m,TreeFinderPanelElement:()=>tt,filterContentRoot:()=>K,filterSortContentRoot:()=>X,sortContentRoot:()=>G}),function(t){t.DATE_FORMATTER=new Intl.DateTimeFormat("en-us"),t.bytesToHumanReadable=function(t,e=!1,i=1){if(!t)return"--";const s=e?1e3:1024;if(Math.abs(t)<s)return t+" B";const r=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let n=-1;const o=10**i;do{t/=s,++n}while(Math.round(Math.abs(t)*o)/o>=s&&n<r.length-1);return t.toFixed(i)+" "+r[n]},t.dateToStr=function(e,i){return t.DATE_FORMATTER.format(e).includes(i)},t.timeSince=function(t){t=t instanceof Date?t:new Date(t);const e=Math.floor((Date.now()-t.valueOf())/1e3);let i=e/31536e3;return i>1?Math.floor(i)+" years":(i=e/2592e3,i>1?Math.floor(i)+" months":(i=e/86400,i>1?Math.floor(i)+" days":(i=e/3600,i>1?Math.floor(i)+" hours":(i=e/60,i>1?Math.floor(i)+" minutes":Math.floor(e)+" seconds"))))}}(s||(s={})),function(t){function e(t){return void 0!==(null==t?void 0:t.y)&&!(null==t?void 0:t.column_header_y)}function i(t){var e;return void 0!==(null===(e=t)||void 0===e?void 0:e.column_header_y)&&!!(null==t?void 0:t.column_header)}function s(t){return e(t)||r(t)}function r(t){var e;return void 0!==(null===(e=t)||void 0===e?void 0:e.row_header_x)&&!!(null==t?void 0:t.row_header)}function n(t,e,i=!0){if("TREE-FINDER-GRID"===t.tagName)return;let s=e.getMeta(t);return i&&!s&&t.parentElement?n(t.parentElement,e,i):s}t.cellClicked=e,t.columnHeaderClicked=i,t.rowClicked=s,t.rowHeaderClicked=r,t.clickLoggingListener=function(t,o){const a=n(t.target,o,!0);a?(e(a)&&console.log("cell clicked"),i(a)&&console.log("column header clicked"),s(a)&&console.log("row clicked"),r(a)&&console.log("row header clicked"),console.log(a)):console.log("event has no metadata")},t.colNameFromMeta=function(t){const{column_header:e,value:i}=t;return i instanceof HTMLElement?i.textContent:"0"===e?"path":i},t.metadataFromElement=n}(r||(r={})),function(t){t.equal=function(t,e){return t.length===e.length&&t.every((t,i)=>t===e[i])},t.fromarray=function(t){const[e,...i]=t;return`${e?e+":":""}${i.join("/")}`},t.toarray=function(t){const e=t.split(/:/g),[i,s]=e.length>=2?e:["",t];return[i,...s?s.split(/[\/\\]/g):[]]},t.normSlash=function(e,i){return t.trimSlash(e)+(i?"/":"")},t.trimSlash=function(t){return t.replace(/[\/\\]/g,"")}}(n||(n={})),function(t){t.html=(t,...e)=>t.map((t,i)=>[t,e[i]]).flat().filter(t=>!!t).join(""),t.attrs=t=>t.map(t=>{const e=t.values.filter(t=>t).join(" ");return e?` ${t.key}="${e}"`:""}).join("")}(o||(o={})),function(t){const e=document.createElement("template"),i=document.createElement("template"),s=document.createElement("template");t.breadcrumbsSpans=function(t){return'<div class="tf-breadcrumbs-home"><span class="tf-breadcrumbs-crumb tf-breadcrumbs-icon tf-breadcrumbs-dir-icon" data-crumbix="0"></span><span>/</span></div>'+[...t.slice(1)].map((t,e)=>`<span class="tf-breadcrumbs-crumb" data-crumbix="${e+1}">${t}</span>`).join('<span class="tf-breadcrumbs-separator">/</span>')},t.colHeaderSpans=function(t,e=!1){return s.innerHTML=`<span class="tf-header"><span class="tf-header-name">${t}</span><span class="tf-header-sort"></span></span>`,e?(i.innerHTML='<input class="tf-header-input"></input>',[i.content.firstChild,s.content.firstChild]):[s.content.firstChild]},t.rowHeaderSpan=function({hasChildren:t,isExpand:i,path:s,editable:r=!1,pathRender:a="tree"}){s=s.map((e,i)=>n.normSlash(e,i<s.length-1||t));const l=o.attrs([{key:"class",values:["rt-group-name",!t&&"rt-group-leaf",r&&"tf-mod-editable"]}]),h="relative"===a?s.join(""):s.slice(-1).join(""),c=function({hasChildren:t,isExpand:e,path:i=[]}){const s=i.slice(1).map(()=>'<span class="rt-tree-group"></span>');if(t){const t=`<span class="rt-row-header-icon">${e?"remove":"add"}</span>`;s.push(t)}return s.join("")}({hasChildren:t,isExpand:i,path:"tree"===a?s:[]});return e.innerHTML=`<span class="rt-tree-container">${c}<span${l}>${h}</span></span>`,"regular"===a?[s.slice(0,-1).join(""),e.content.firstChild]:[e.content.firstChild]}}(a||(a={}));const l="path";class h{constructor({row:t,filterer:e,sorter:i}){this._hasChildren=!1,this._isExpand=!1,this._dirtyChildren=!1,this._dirtySort=!1,this.init({row:t,filterer:e,sorter:i})}init({row:t,filterer:e,sorter:i}){return this.row=t,this.filterer=e,this.sorter=i,this}collapse(){this._isExpand=!1}equalPath(t){return n.equal(this.row.path,t)}async expand(){this._isExpand=!0,await this.getChildren()}async getChildren(){if(this._row.getChildren)return this._dirtyChildren&&(this._cacheMap?this._cache=(await this._row.getChildren()).map(t=>{var e,i;return null!==(i=null===(e=this._cacheMap.get(t.path.join("/")))||void 0===e?void 0:e.init({row:t,sorter:this._sorter}))&&void 0!==i?i:new h({row:t,sorter:this._sorter})}):this._cache=(await this._row.getChildren()).map(t=>new h({row:t,sorter:this._sorter})),this._cacheMap=new Map(this._cache.map(t=>[t.pathstr,t])),this._dirtyChildren=!1,this._dirtySort=!!this._sorter),this._dirtySort&&this._cache.sort(this._sorter),this._cache}getPathAtDepth(t=0,e){const i=this.row.path.slice(t);return void 0!==e&&i.length>1?[...Array(i.length-1).fill(e),i[i.length-1]]:i}async _flatten(t=[]){if(this.hasChildren)for(const e of await this.getChildren())t.push(e),e.isExpand&&await e._flatten(t);return t}async flatten(){return this._filterer?(await this._flatten()).filter(this._filterer):await this._flatten()}invalidate(t=!1){if(this.hasChildren&&([this._dirtyChildren,this._dirtySort]=[!0,!1],t&&this._cache))for(const e of this._cache)e.invalidate(t)}get hasChildren(){return this._hasChildren}get isExpand(){return this._isExpand}get nchildren(){var t,e;return null!==(e=null===(t=this._cache)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get name(){return this.row.path.slice(-1)[0]}get pathstr(){return this._pathstr}get row(){return this._row}set row(t){this._row=t,this._hasChildren=!!this._row.getChildren,this._pathstr=this._row.path.join("/"),this.invalidate()}set filterer(t){this._filterer=t}set sorter(t){if(this._sorter=t,this._dirtySort=!(!t||!this._cache),this._cache)for(const e of this._cache)e.sorter=t}get _dirty(){return this._dirtyChildren||this._dirtySort}}!function(t){t.blank=function(e){return new t({row:e.reduce((t,e)=>("path"===e?t.path=[]:t[e]="",t),{})})}}(h||(h={}));class c extends HTMLElement{constructor(){super(...arguments),this._initialized=!1,this._initializedListeners=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this._initialized=!0),this._initializedListeners||(this.addEventListener("mouseup",t=>this.onClick(t)),this._initializedListeners=!0)}init(t){this.model=t,this.model.crumbModel.crumbNamesSub.subscribe({next:t=>this._onCrumbUpdate(t)})}async _onCrumbUpdate(t){this.innerHTML=a.breadcrumbsSpans(t)}create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=o.html`
      <style>
        :host > .tf-breadcrumbs-top {
          display: flex;
          align-items: flex-start;
        }
      </style>
      <div class="tf-breadcrumbs-top">
        ${"<slot></slot>"}
      </div>
    `,[this.shadowSheet,this.top]=this.shadowRoot.children}async onClick(t){if(0!==t.button)return;const e=t.target;e.dataset.crumbix&&this.model.crumbModel.revert(parseInt(e.dataset.crumbix))}}customElements.define("tree-finder-breadcrumbs",c);class d extends HTMLElement{constructor(){super(...arguments),this._initialized=!1,this._initializedListeners=!1}clear(){this.innerHTML='<input class="tf-filter-input"></input>',[this._input]=this.children}connectedCallback(){this._initialized||(this.create_shadow_dom(),this._initialized=!0),this._initializedListeners||(this.addEventListener("input",t=>this.onInput(t)),this._initializedListeners=!0)}init(t,e=0){this.model=t,this.clear(),this._col=0===e?"path":this.model.columns[e-1]}create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=o.html`
      <style>
        :host > .tf-filter-top {
          display: inline-block;
          padding: 8px 0px 4px 0px;
          width: 100%;
        }
      </style>
      <div class="tf-filter-top">
        ${"<slot></slot>"}
      </div>
    `,[this.shadowSheet,this.top]=this.shadowRoot.children}onInput(t){const e={col:this._col,pattern:t.target.value};this.model.filterCol=this._col,this.model.onFilterInput(e)}get col(){return this._col}get input(){return this._input}}!function(t){t.get=function(){return document.createElement("tree-finder-filter").constructor===HTMLElement&&customElements.define("tree-finder-filter",t),customElements.get("tree-finder-filter")}}(d||(d={})),d.get();class u extends HTMLElement{constructor(){super(...arguments),this._initialized=!1}clear(){this.innerHTML="<tree-finder-filter></tree-finder-filter>".repeat(this.model.columns.length+1),this.filters=[...this.children]}connectedCallback(){this._initialized||(this.create_shadow_dom(),this._initialized=!0)}init(t){this._initialized||(this.create_shadow_dom(),this._initialized=!0),this.model=t,this.clear();for(const[e,i]of this.filters.entries())i.init(t,e)}create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=o.html`
      <style>
      </style>
      <div class="tf-filters-top">
        ${"<slot></slot>"}
      </div>
    `,[this.shadowSheet,this.top]=this.shadowRoot.children}entries(){return this.filters.entries()}getChild(t){return this.filters[t]}getInput(t){var e;return null===(e=this.getChild(t))||void 0===e?void 0:e.input}}customElements.define("tree-finder-filters",u);var _=i(710);document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",_.RegularTableElement);const p=customElements.get("regular-table");class m extends p{constructor(){super(...arguments),this._initializedListeners=!1}async init(t,e={}){if(this.model=t,this.options=e,this.setDataListener(this.dataListener.bind(this),{virtual_mode:this._options.virtual_mode}),!this._initializedListeners){const[t,e]=[this.table_model.header.table,this.table_model.body.table];this.addStyleListener(()=>this.columnHeaderStyleListener()),this.addStyleListener(()=>this.rowStyleListener()),this.addEventListener("mouseover",t=>this.onMouseover(t)),t.addEventListener("mouseup",t=>this.onSortClick(t)),e.addEventListener("contextmenu",t=>this.onRowClick(t)),e.addEventListener("dblclick",t=>this.onRowDoubleClick(t)),e.addEventListener("mouseup",t=>this.onRowClick(t)),e.addEventListener("mouseup",t=>this.onTreeClick(t)),this.options.doWindowResize&&window.addEventListener("resize",async()=>{await this.draw()}),this.model.drawSub.subscribe(async t=>{t&&this._resetAutoSize(),await this.draw(),this.model.options.needsWidths&&await this.draw()}),this._initializedListeners=!0}this.model.requestDraw()}async dataListener(t,e,i,s){return{num_columns:this.model.columns.length,num_rows:this.model.contents.length,column_headers:this.model.columns.slice(t,i).map((t,e)=>this.options.showFilter?[this.filters.getChild(e+1),...a.colHeaderSpans(t)]:a.colHeaderSpans(t)),row_headers:this.model.contents.slice(e,s).map(t=>this._getRowHeader(t)),data:this.model.isBlank?[Array(this.model.columns.length).fill("")]:this._getData(t,e,i,s)}}columnHeaderStyleListener(){var t,e;this.cornerHeaderStyleListener();for(const t of this.querySelectorAll("thead tr:first-child th")){t.classList.toggle("tf-header-align-left",!0);const e=t.querySelector("tree-finder-filter");e&&(e.input.classList.toggle("tf-header-input",!0),this.model.filterCol===e.col&&(e.input.focus(),delete this.model.filterCol))}for(const i of this.querySelectorAll("thead tr:last-child th")){const s=this.getMeta(i),n=r.colNameFromMeta(s);if(n){const s=null===(t=this.model.sortStates.byColumn["0"===n?"path":n])||void 0===t?void 0:t.order;null===(e=i.querySelector(".tf-header-sort"))||void 0===e||e.classList.toggle(`tf-header-sort-${s}`,!!s)}i.classList.toggle("tf-header-corner",void 0===s.x),i.classList.toggle("tf-header-align-left",!0)}this.model.options.needsWidths&&this.columnWidthStyleListener()}columnWidthStyleListener(){let t=[...this._column_sizes.indices];"regular"===this._pathRender&&t.length>0&&(t=[t[0]+t[1],...t.slice(2)]),this.model.columnWidthsSub.next(t.map(t=>`calc(${t}px - 12px)`))}cornerHeaderStyleListener(){const t=this.querySelectorAll("thead tr > th:first-child > span:first-child:not([class])"),e=this.options.showFilter?[this.filters.getChild(0),...a.colHeaderSpans("path")]:a.colHeaderSpans("path");for(let i=0;i<t.length;i++)t[i].replaceWith(e[i])}rowStyleListener(){const t=this.querySelectorAll("tbody th span.rt-group-name");for(const e of t){const{y:t}=r.metadataFromElement(e,this);if(null!=t){const i=this.model.contents[t];e.classList.add("tf-grid-filetype-icon",`tf-grid-${i.row.kind}-icon`),this._renamerStyleListener(e,i)}}this._selectedStyleListener()}async onMouseover(t){var e;if("regular"===this._pathRender){const i=t.target,s=r.metadataFromElement(i,this),n=null===(e=null==s?void 0:s.row_header)||void 0===e?void 0:e[0];for(let t of this.table_model.body.rows)if(t.childElementCount>this.model.columns.length+1){const e=t.children[0];e.classList.toggle("tf-mod-hover",e.textContent===n)}}}async onRowClick(t){if(0!==t.button&&2!==t.button)return;const e=t.target;if(e.classList.contains("rt-row-header-icon"))return;const i=r.metadataFromElement(e,this);if(!i||!r.rowClicked(i))return;const s=this.model.contents[i.y];2===t.button&&this.model.selectionModel.has(s)||(t.shiftKey?this.model.selectionModel.selectRange(s,this.model.contents):this.model.selectionModel.select(s,t.ctrlKey||t.metaKey),this._selectedStyleListener())}async onSortClick(t){if(0!==t.button)return;const e=t.target;if(e.classList.contains("rt-column-resize"))return;const i=r.metadataFromElement(e,this);!i||!r.columnHeaderClicked(i)||i.column_header_y<this.table_model.header.rows.length-1||await this.model.sort({col:r.colNameFromMeta(i),multisort:t.shiftKey})}async onTreeClick(t){if(0!==t.button)return;let e=t.target;if(!e.classList.contains("rt-row-header-icon"))return;const i=r.metadataFromElement(e,this);this.model.contents[i.y].isExpand?await this.model.collapse(i.y):await this.model.expand(i.y)}async onRowDoubleClick(t){if(0!==t.button)return;const e=t.target,i=r.metadataFromElement(e,this);if(!i||!r.rowClicked(i))return;const s=this.model.contents[i.y];await this.model.open(s.row)}get options(){return{...this._options}}set options({columnFormatters:t,doWindowResize:e=!1,pathRender:i="tree",pathRenderOnFilter:s="relative",showFilter:r=!1,virtual_mode:n="vertical"}){this._options={columnFormatters:t,doWindowResize:e,pathRender:i,pathRenderOnFilter:s,showFilter:r,virtual_mode:n},this.showFilter=this._options.showFilter}set showFilter(t){t?(this.filters=document.createElement("tree-finder-filters"),this.filters.init(this.model)):delete this.filters,this._options.showFilter=t}_getData(t,e,i,r){var n,o;const a=[];for(const l of this.model.columns.slice(t,i)){const t=null!==(o=null===(n=this.options.columnFormatters)||void 0===n?void 0:n[l])&&void 0!==o?o:t=>t;a.push(this.model.contents.slice(e,r).map(e=>{const i=t(e.row[l]);return i instanceof Date?s.DATE_FORMATTER.format(i):i}))}return a}_getRowHeader(t){return a.rowHeaderSpan({hasChildren:t.hasChildren,isExpand:t.isExpand,path:t.getPathAtDepth(this.model.pathDepth),editable:this.model.renamerTest(t),pathRender:this._pathRender})}_renamerStyleListener(t,e){t.classList.contains("tf-mod-editable")&&(t.getAttribute("contenteditable")||(t.addEventListener("keydown",i=>{"Enter"===i.key?t.blur():"Escape"===i.key&&(t.textContent=e.name,t.blur())}),t.addEventListener("blur",()=>{const i=t.textContent;i&&(e.row.path=[...e.row.path.slice(0,-1),i],t.classList.toggle("tf-mod-editable",!1),t.removeAttribute("contenteditable"),this.model.renamerSub.next({name:i,target:e})),this.model.renamerPath=null}),t.setAttribute("contenteditable","true")),t.focus())}_selectedStyleListener(){const t=this.model.columns.length+1;for(let e of this.table_model.body.rows.slice(0,this.model.contents.length)){const{y:i}=r.metadataFromElement(e.children[0],this);if(e&&"TR"===e.tagName&&(e.classList.toggle("tf-mod-select",this.model.selectionModel.has(this.model.contents[i])),"regular"===this._pathRender))for(let i=0;i<e.children.length-t;i++)e.children[0].classList.toggle("tf-mod-select-not",!0)}}get _pathRender(){return this.model.filterPatterns.any?this.options.pathRenderOnFilter||"tree":this.options.pathRender||"tree"}}customElements.define("tree-finder-grid",m);var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function w(t,e){function i(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function b(t){return"function"==typeof t}var v=!1,g={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack,v=t},get useDeprecatedSynchronousErrorHandling(){return v}};function y(t){setTimeout(function(){throw t},0)}var x={closed:!0,next:function(t){},error:function(t){if(g.useDeprecatedSynchronousErrorHandling)throw t;y(t)},complete:function(){}},S=Array.isArray||function(t){return t&&"number"==typeof t.length},E=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),z=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var i,s=this,r=s._parentOrParents,n=s._ctorUnsubscribe,o=s._unsubscribe,a=s._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var l=0;l<r.length;++l)r[l].remove(this);if(b(o)){n&&(this._unsubscribe=void 0);try{o.call(this)}catch(t){e=t instanceof E?C(t.errors):[t]}}if(S(a)){l=-1;for(var h=a.length;++l<h;){var c=a[l];if(null!==(i=c)&&"object"==typeof i)try{c.unsubscribe()}catch(t){e=e||[],t instanceof E?e=e.concat(C(t.errors)):e.push(t)}}}if(e)throw new E(e)}},t.prototype.add=function(e){var i=e;if(!e)return t.EMPTY;switch(typeof e){case"function":i=new t(e);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof t)){var s=i;(i=new t)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var r=i._parentOrParents;if(null===r)i._parentOrParents=this;else if(r instanceof t){if(r===this)return i;i._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return i;r.push(this)}var n=this._subscriptions;return null===n?this._subscriptions=[i]:n.push(i),i},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function C(t){return t.reduce(function(t,e){return t.concat(e instanceof E?e.errors:e)},[])}var L="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),M=function(t){function e(i,s,r){var n=t.call(this)||this;switch(n.syncErrorValue=null,n.syncErrorThrown=!1,n.syncErrorThrowable=!1,n.isStopped=!1,arguments.length){case 0:n.destination=x;break;case 1:if(!i){n.destination=x;break}if("object"==typeof i){i instanceof e?(n.syncErrorThrowable=i.syncErrorThrowable,n.destination=i,i.add(n)):(n.syncErrorThrowable=!0,n.destination=new T(n,i));break}default:n.syncErrorThrowable=!0,n.destination=new T(n,i,s,r)}return n}return w(e,t),e.prototype[L]=function(){return this},e.create=function(t,i,s){var r=new e(t,i,s);return r.syncErrorThrowable=!1,r},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(z),T=function(t){function e(e,i,s,r){var n,o=t.call(this)||this;o._parentSubscriber=e;var a=o;return b(i)?n=i:i&&(n=i.next,s=i.error,r=i.complete,i!==x&&(b((a=Object.create(i)).unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=n,o._error=s,o._complete=r,o}return w(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;g.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,i=g.useDeprecatedSynchronousErrorHandling;if(this._error)i&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)i?(e.syncErrorValue=t,e.syncErrorThrown=!0):y(t),this.unsubscribe();else{if(this.unsubscribe(),i)throw t;y(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var i=function(){return t._complete.call(t._context)};g.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),g.useDeprecatedSynchronousErrorHandling)throw t;y(t)}},e.prototype.__tryOrSetError=function(t,e,i){if(!g.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,i)}catch(e){return g.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(y(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(M),k="function"==typeof Symbol&&Symbol.observable||"@@observable";function P(t){return t}var H=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var s=this.operator,r=function(t,e,i){if(t){if(t instanceof M)return t;if(t[L])return t[L]()}return t||e||i?new M(t,e,i):new M(x)}(t,e,i);if(s?r.add(s.call(r,this.source)):r.add(this.source||g.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),g.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){g.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,i=e.closed,s=e.destination,r=e.isStopped;if(i||r)return!1;t=s&&s instanceof M?s:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=R(e))(function(e,s){var r;r=i.subscribe(function(e){try{t(e)}catch(t){s(t),r&&r.unsubscribe()}},s,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[k]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:function(t){return 0===t.length?P:1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}}(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=R(t))(function(t,i){var s;e.subscribe(function(t){return s=t},function(t){return i(t)},function(){return t(s)})})},t.create=function(e){return new t(e)},t}();function R(t){if(t||(t=g.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var O=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),D=function(t){function e(e,i){var s=t.call(this)||this;return s.subject=e,s.subscriber=i,s.closed=!1,s}return w(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}},e}(z),W=function(t){function e(e){var i=t.call(this,e)||this;return i.destination=e,i}return w(e,t),e}(M),F=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return w(e,t),e.prototype[L]=function(){return new W(this)},e.prototype.lift=function(t){var e=new j(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new O;if(!this.isStopped)for(var e=this.observers,i=e.length,s=e.slice(),r=0;r<i;r++)s[r].next(t)},e.prototype.error=function(t){if(this.closed)throw new O;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,i=e.length,s=e.slice(),r=0;r<i;r++)s[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new O;this.isStopped=!0;for(var t=this.observers,e=t.length,i=t.slice(),s=0;s<e;s++)i[s].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new O;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new O;return this.hasError?(t.error(this.thrownError),z.EMPTY):this.isStopped?(t.complete(),z.EMPTY):(this.observers.push(t),new D(this,t))},e.prototype.asObservable=function(){var t=new H;return t.source=this,t},e.create=function(t,e){return new j(t,e)},e}(H),j=function(t){function e(e,i){var s=t.call(this)||this;return s.destination=e,s.source=i,s}return w(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):z.EMPTY},e}(F);class A{constructor(){this.copySub=new F,this.cutSub=new F,this.deleteSub=new F,this.pasteSub=new F,this.doCut=!1,this.memo=[]}copy(t){this.doCut=!1,this.memo=t,this.copySub.next(t)}cut(t){this.doCut=!0,this.memo=t,this.cutSub.next(t)}delete(t){this.deleteSub.next(t)}paste(t){this.pasteSub.next({destination:t,doCut:this.doCut,memo:this.memo}),this.doCut=!1}copySelection(t){this.copy(t.selection.map(t=>t.row))}cutSelection(t){this.cut(t.selection.map(t=>t.row))}deleteSelection(t){this.delete(t.selection.map(t=>t.row))}pasteSelection(t){var e,i;const s=null!==(i=null===(e=t.selectedLast)||void 0===e?void 0:e.row)&&void 0!==i?i:t.root.row;s&&this.paste(s)}open(t,e){t.openSub.next(e)}refresh(t,e){t.refreshSub.next(e)}}var B=function(t){function e(e){var i=t.call(this)||this;return i._value=e,i}return w(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new O;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(F);const $=["asc","desc",null],N=$[0];class q{constructor(t){if(this._patterns={},t)for(const e of t)this.set(e)}set(t){const{col:e,pattern:i}=t;i?this._patterns[e]=i:delete this._patterns[e]}get any(){return!!Object.keys(this.patterns).length}get patterns(){return this._patterns}}class U{constructor(t){this.defaultColumn=l,t=null!=t?t:[{col:l,order:N}],this.states=t.map((t,e)=>({...t,ix:e,sign:"desc"===t.order?-1:1})),this.byColumn=this.states.reduce((t,e)=>(t[e.col]=e,t),{})}}function Y(t,e=0){return function(i){for(const[r,n]of Object.entries(t.patterns)){if("path"===r)return i.getPathAtDepth(e).join("/").includes(n);{const t=i.row[r];if("string"==typeof t)return t.includes(n);if(t instanceof Date)return s.dateToStr(t,n);if("boolean"==typeof t){const e=Number(n);return!Number.isNaN(e)&&t===!!e||(t?"true":"false").includes(n)}return t==Number(n)}}return!0}}function I(t){return function(e,i){for(const{col:s,sign:r}of t.states){let t,n=e.row[s],o=i.row[s];if(Array.isArray(n)&&(n=n[n.length-1],o=o[o.length-1]),t="string"==typeof n?n.localeCompare(o):n-o,t)return r*t}return 0}}function V(t,e,i=!1){let s=[...t.states];if(e in t.byColumn){const{ix:i,order:r}=t.byColumn[e],n=$[($.indexOf(r)+1)%$.length];n?s[i]={col:e,order:n}:s.splice(i,1)}else{const t={col:e,order:N};i?s.push(t):s=[t]}return new U(s)}async function K({root:t,filterPatterns:e,pathDepth:i}){return t.filterer=Y(e,null!=i?i:t.row.path.length),t.flatten()}async function X({root:t,filterPatterns:e,sortStates:i,col:s,multisort:r,pathDepth:n}){return s&&((i=V(i,s,r)).states.length||(i=new U)),t.filterer=Y(e,null!=n?n:t.row.path.length),t.sorter=I(i),[await t.flatten(),i]}async function G({root:t,sortStates:e,col:i,multisort:s}){return i&&((e=V(e,i,s)).states.length||(e=new U)),t.sorter=I(e),[await t.flatten(),e]}class Z{constructor(){this._crumbsRows=[],this._crumbsRows=[],this.crumbNamesSub=new B([]),this.revertedCrumbSub=new B(void 0)}revert(t){this._crumbsRows=this._crumbsRows.slice(0,t+1);const e=this._crumbsRows.pop();return this.revertedCrumbSub.next(e),e}extend(t){return this._crumbsRows=[...this._crumbsRows,...t],this._onCrumbUpdate(),this._crumbsRows[this._crumbsRows.length-1]}async _onCrumbUpdate(){this.crumbNamesSub.next(this._crumbsRows.map(t=>t.path[t.path.length-1]))}}class J{constructor(t,e={}){this.columnWidthsSub=new B([]),this.drawSub=new B(!1),this.openSub=new F,this.refreshSub=new F,this.renamerSub=new F,this.selectionModel=new Q,this._renamerPath=null,this.crumbModel=new Z,this._filterPatterns=new q,this._parentMap=new WeakMap,this._sortStates=new U,this.options=e,this.crumbModel.revertedCrumbSub.subscribe(async t=>{t&&(await this.open(t),this.requestDraw({autosize:!0}))}),this.openSub.subscribe(t=>t.map(t=>this.openDir(t))),this.refreshSub.subscribe(t=>{this._invalidate(t),this.flatten()}),this.renamerSub.subscribe(()=>this._renamerPath=null),this.open(t)}async open(...t){this.openSub.next(t)}async openDir(t){if("dir"!==t.kind)return;this._contents=[];const e=[t];for(;this._parentMap.has(e[0]);)e.unshift(this._parentMap.get(e[0]));this.crumbModel.extend(e),this._parentMap=new WeakMap,this._root=new h({row:t}),this.initColumns(),await this._root.getChildren(),await this.sort({autosize:!0})}initColumns(){var t;const e=null!==(t=this.options.columnNames)&&void 0!==t?t:Object.keys(this._root.row);this._columns=e.filter(t=>!["path","getChildren"].includes(t)),this._ixByColumn=Object.fromEntries(this._columns.map((t,e)=>[t,e+1]))}async collapse(t){const e=this._contents[t];let i=t+1,s=0;for(;this._contents[i]&&this._contents[i].row.path.length>e.row.path.length;)i++,s++;this._contents.splice(t+1,s),e.collapse(),this.requestDraw({autosize:!0})}async expand(t){var e;const i=this._contents[t];i.expand();for(const t of null!==(e=await(null==i?void 0:i.getChildren()))&&void 0!==e?e:[])this._parentMap.set(t.row,i.row);let s;[s,this._sortStates]=await X({filterPatterns:this._filterPatterns,pathDepth:this.pathDepth,root:i,sortStates:this._sortStates}),this._contents.splice(t+1,0,...s),this.requestDraw({autosize:!0})}async filter({autosize:t=!0}={}){await this._root.expand(),this._contents=await K({filterPatterns:this._filterPatterns,root:this._root}),this.requestDraw({autosize:t})}async flatten({autosize:t=!0}={}){this._contents=await this._root.flatten(),this.requestDraw({autosize:t})}onFilterInput(t){this._filterPatterns.set(t),this.filter()}renamerTest(t){return null!==this._renamerPath&&t.equalPath(this._renamerPath)}requestDraw(t={}){const{autosize:e=!1}=t;if(t.delay){const{delay:e,...i}=t;setTimeout(()=>this.requestDraw(i),e)}this.drawSub.next(e)}async sort(t={}){const{autosize:e=!1,col:i,multisort:s}=t;await this._root.expand(),[this._contents,this._sortStates]=await X({col:i,filterPatterns:this._filterPatterns,multisort:s,root:this._root,sortStates:this._sortStates}),this.requestDraw({autosize:e})}_invalidate(t){if(t){const e=new Set(t.map(t=>t.getChildren?t.path.join("/"):t.path.slice(0,-1).join("/")));this.contents.filter(t=>e.has(t.pathstr)).forEach(t=>t.invalidate())}else this._root.invalidate(!0)}get columns(){return this._columns}get contents(){return this.isBlank?[h.blank(["path",...this._columns])]:this._contents}get filterPatterns(){return this._filterPatterns}get isBlank(){return!this._contents.length&&this._columns.length}get ixByColumn(){return this._ixByColumn}get options(){return{...this._options}}set options({columnNames:t,doRefetch:e=!1,needsWidths:i=!1}){this._options={columnNames:t,doRefetch:e,needsWidths:i}}get pathDepth(){return this._root.row.path.length}set renamerPath(t){this._renamerPath=t}get root(){return this._root}get selection(){return this.selectionModel.get(this._contents)}get selectedLast(){return this.selectionModel.getLast(this._contents)}get sortStates(){return this._sortStates}}class Q{constructor(){this.clear()}clear(){this.pivot=null,this.range=[],this._lastPathstr=null,this.selection=new Set}get(t){return t.filter(t=>this.has(t))}getLast(t){if(!this._lastPathstr)return null;for(let e=0;e<t.length;e++)if(t[e].pathstr===this._lastPathstr)return t[e];return null}has(t){return this.selection.has(t.pathstr)}select(t,e=!1){e?this.range=[]:this.clear(),this._lastPathstr=t.pathstr,this.selection.has(this._lastPathstr)?this.selection.delete(this._lastPathstr):this.selection.add(this._lastPathstr),this.pivot=this.selection.size>0?this._lastPathstr:null}selectRange(t,e){for(const t of this.range)this.selection.delete(t);this.range=Q.findRange(this.pivot,t.pathstr,e.map(t=>t.pathstr));for(const t of this.range)this.selection.add(t)}get lastPathstr(){return this._lastPathstr}}!function(t){t.findRange=function(t,e,i){if(t===e)return[];const s=null!==t?i.indexOf(t):-1,r=i.indexOf(e),n=[];if(s>r)for(let t=r;t<s;t++)n.push(i[t]);else for(let t=s+1;t<=r;t++)n.push(i[t]);return n}}(Q||(Q={}));class tt extends HTMLElement{constructor(){super(...arguments),this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this._initialized=!0)}clear(){this.innerHTML=o.html`
      <tree-finder-breadcrumbs class="tf-panel-breadcrumbs" slot="breadcrumbs"></tree-finder-breadcrumbs>
      ${this.options.showFilter?'<tree-finder-filters class="tf-panel-filters" slot="filters"></tree-finder-filters>':'<div slot="filters"></div>'}
      <tree-finder-grid class="tf-panel-grid" slot="grid"></tree-finder-grid>
    `,[this.breadcrumbs,this.filters,this.grid]=this.children}async init({root:t,options:e={},modelOptions:i={},gridOptions:s={}}){this.options=e,this.clear(),this._options.showFilter&&(i.needsWidths=!0),this._model=new J(t,i),this.breadcrumbs.init(this._model),this.options.showFilter&&this.filters.init(this._model),this.grid.init(this._model,s),this._model.columnWidthsSub.subscribe(t=>{if(t.length){this.filters.getChild(0).style.marginLeft="12px";for(const[e,i]of t.entries()){const t=this.filters.getInput(e);t&&(t.style.width=i)}}}),await this.draw()}async draw(){await this.grid.draw()}create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=o.html`
      <style>
        :host {
          display: flex;
          flex-flow: column;
        }
        :host > div {
          position: relative;
        }
        :host > .tf-panel-filters-container {
          display: inline-block;
        }
        :host > .tf-panel-grid-container {
          flex: 1;
        }
      </style>
      <div class="tf-panel-breadcrumbs-container">
        ${'<slot name="breadcrumbs"></slot>'}
      </div>
      <div class="tf-panel-filters-container">
        ${'<slot name="filters"></slot>'}
      </div>
      <div class="tf-panel-grid-container">
        ${'<slot name="grid"></slot>'}
      </div>
    `,[this.shadowSheet,this.breadcrumbsContainer,this.filterContainer,this.gridContainer]=this.shadowRoot.children}get model(){return this._model}get options(){return{...this._options}}set options({showFilter:t=!1}){this._options={showFilter:t}}}customElements.define("tree-finder-panel",tt)}},e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}return i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(561)})()}}]);