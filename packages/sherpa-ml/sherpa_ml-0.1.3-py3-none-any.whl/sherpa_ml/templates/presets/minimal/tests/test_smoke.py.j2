import importlib
import subprocess
import sys
from pathlib import Path

# Use dotted import path even if the generator passed a path-like pkg (e.g. "work/demo_vision")
PKG = "{{ pkg | replace('/', '.') }}"


def project_root() -> Path:
    # Project root (one level up from this tests/ dir in the rendered repo)
    return Path(__file__).resolve().parents[1]


def test_import():
    importlib.import_module(PKG)


def test_train_fast():
    root = project_root()
    proc = subprocess.run(
        [sys.executable, "-m", f"{PKG}.train"],
        cwd=root,
        capture_output=True,
        text=True,
    )
    assert proc.returncode == 0, proc.stderr
