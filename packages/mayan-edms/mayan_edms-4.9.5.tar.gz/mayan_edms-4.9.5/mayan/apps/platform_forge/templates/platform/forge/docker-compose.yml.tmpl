name: {{ FORGE_DOCKER_COMPOSE_PROJECT_NAME }}-{{ FORGE_DOCKER_COMPOSE_PROJECT_VERSION }}

services:
  forge:
    env_file:
      - .env
      - path: .env-local
        required: false
    environment:
      - PIP_PREFER_BINARY=1
      - SSH_AUTH_SOCK=/ssh-agent
    image: ${MAYAN_FORGE_DOCKER_IMAGE_NAME:-{{ FORGE_DOCKER_IMAGE_NAME }}}:${MAYAN_FORGE_DOCKER_IMAGE_TAG:-{{ FORGE_DOCKER_IMAGE_TAG }}}
    network_mode: "host"
    restart: unless-stopped
    stdin_open: true
    tty: true
    user: "${HOST_UID}:${HOST_GID}"
    volumes:
      - ../:/workspace
      - $SSH_AUTH_SOCK:/ssh-agent
      # Optional: Mount host's PIP cache.
      # - ~/.cache/pip:/home/ubuntu/.cache/pip
      - /etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt
      - ~/.transifexrc:/.transifexrc
      # Optional: Support DooD (Docker Out of Docker).
      # - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /workspace
