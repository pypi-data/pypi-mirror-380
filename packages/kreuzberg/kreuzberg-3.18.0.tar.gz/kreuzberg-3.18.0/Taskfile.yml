version: "3"

env:
  DOCKER_BUILDKIT: 1
  BUILDKIT_PROGRESS: plain

tasks:
  setup:
    desc: "Install dependencies with uv"
    cmds:
      - uv sync --all-extras --all-packages
      - prek install && prek install --hook-type commit-msg

  update:
    desc: "Update the dependencies"
    cmds:
      - uv run uv-bump
      - cd benchmarks && uv run uv-bump && cd -
      - uv sync --all-extras --all-packages --upgrade
      - prek autoupdate

  test:
    desc: "Run tests with pytest"
    cmds:
      - uv run pytest

  test:cov:
    desc: "Run tests with coverage"
    cmds:
      - uv run pytest --cov

  lint:
    desc: "Lint code with ruff and docs with markdownlint"
    cmds:
      - prek run --all-files

  docs:build:
    desc: "Build documentation"
    cmds:
      - uv run mkdocs build --clean --strict

  docs:serve:
    desc: "Serve documentation locally"
    cmds:
      - uv run mkdocs serve

  default:
    desc: "Show available tasks"
    cmds:
      - task --list
