"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["82994"],{63002:function(t,i,e){e.a(t,async function(t,n){try{e.d(i,{$3:function(){return v},$O:function(){return T},$j:function(){return m},ED:function(){return o},JE:function(){return x},OQ:function(){return O},PU:function(){return j},Ph:function(){return f},Uf:function(){return E},W1:function(){return y},Wr:function(){return l},Z:function(){return u},gF:function(){return p},iY:function(){return b},jU:function(){return c},nN:function(){return $},p3:function(){return _},pJ:function(){return g},r_:function(){return d},sz:function(){return h}});e(79827),e(35748),e(65315),e(59023),e(12977),e(18223),e(95013);var s=e(72652),r=e(50654),a=t([r]);r=(a.then?(await a)():a)[0];var o=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const c=59509==e.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,d=["L","gal","ft³","m³","CCF","MCF"],u=t=>t.sendMessagePromise({type:"recorder/info"}),_=(t,i)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:i}),l=(t,i)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:i}),h=(t,i,e,n,s="hour",r,a)=>t.callWS({type:"recorder/statistics_during_period",start_time:i.toISOString(),end_time:null==e?void 0:e.toISOString(),statistic_ids:n,period:s,units:r,types:a}),g=(t,i,e,n)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:i,units:n,fixed_period:e.fixed_period?{start_time:e.fixed_period.start instanceof Date?e.fixed_period.start.toISOString():e.fixed_period.start,end_time:e.fixed_period.end instanceof Date?e.fixed_period.end.toISOString():e.fixed_period.end}:void 0,calendar:e.calendar?Object.assign(Object.assign({},"week"===e.calendar.period?{first_weekday:(0,r.DD)(t.locale).substring(0,3)}:{}),e.calendar):void 0,rolling_window:e.rolling_window}),f=t=>t.callWS({type:"recorder/validate_statistics"}),y=(t,i,e)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:i,unit_of_measurement:e}),v=(t,i)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:i}),m=t=>{let i=null;if(!t)return null;for(const e of t)null!==e.change&&void 0!==e.change&&(null===i?i=e.change:i+=e.change);return i},p=(t,i)=>{let e=null;for(const n of i){if(!(n in t))continue;const i=m(t[n]);null!==i&&(null===e?e=i:e+=i)}return e},b=(t,i)=>t.some(t=>void 0!==t[i]&&null!==t[i]),S=["mean","min","max"],w=["sum","state","change"],$=(t,i)=>!(!S.includes(i)||0===t.mean_type)||!(!w.includes(i)||!t.has_sum),E=(t,i,e,n,s)=>{const r=new Date(e).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:i,start_time:r,adjustment:n,adjustment_unit_of_measurement:s})},T=(t,i,e)=>{const n=t.states[i];return n?(0,s.u)(n):(null==e?void 0:e.name)||i},x=(t,i,e)=>{let n;var s;i&&(n=null===(s=t.states[i])||void 0===s?void 0:s.attributes.unit_of_measurement);return void 0===n?null==e?void 0:e.statistics_unit_of_measurement:n},O=t=>t.includes(":"),j=t=>t.callWS({type:"recorder/update_statistics_issues"});n()}catch(c){n(c)}})},36886:function(t,i,e){e.a(t,async function(t,n){try{e.d(i,{Gs:function(){return S},RR:function(){return T},TI:function(){return w},od:function(){return $},ok:function(){return x}});e(91949),e(35748),e(99342),e(35058),e(41846),e(65315),e(837),e(22416),e(37089),e(12977),e(88238),e(34536),e(16257),e(20152),e(44711),e(72108),e(77030),e(56660),e(95013);var s=e(4494),r=e(41484),a=e(4681),o=e(77415),c=e(40391),d=e(23336),u=e(99904),_=e(83466),l=e(9151),h=e(70162),g=e(91927),f=e(49418),y=e(8868),v=e(46089),m=e(65380),p=t([v,m,y]);function S(t,i){let e=new Date(i);return t>2&&0===e.getHours()&&(e=(0,s.O)(e,1)),e.setMinutes(0,0,0),t>35&&e.setDate(1),t>2&&e.setHours(0),e.getTime()}function w(t){return t>35?"month":t>2?"day":"hour"}function $(t,i,e,n,s,a,o,c){const d=(0,r.c)(i,t),u=void 0!==a&&void 0!==o;return{xAxis:{type:"time",min:t,max:S(d,i)},yAxis:{type:"value",name:s,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:t=>(0,y.ZV)(Math.abs(t),e)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const i=[],r=[];return t.forEach(t=>{var e;null!==(e=t.seriesId)&&void 0!==e&&e.startsWith("compare-")?r.push(t):i.push(t)}),[i,r].map(t=>E(t,e,n,d,u,s,c)).filter(Boolean).join("<br><br>")}return E([t],e,n,d,u,s,c)}}}}function E(t,i,e,n,s,r,o){var c,d,u,_;if(null===(c=t[0])||void 0===c||!c.value)return"";const l=new Date(null!==(d=null===(u=t[0].value)||void 0===u?void 0:u[2])&&void 0!==d?d:null===(_=t[0].value)||void 0===_?void 0:_[0]);let h;h=n>89?`${(0,v.fr)(l,i,e)}`:n>0?`${(0,v.sl)(l,i,e)}`:`${s?`${(0,v.sl)(l,i,e)}: `:""}${(0,m.fU)(l,i,e)} – ${(0,m.fU)((0,a.L)(l,1),i,e)}`;const g=`<h4 style="text-align: center; margin: 0;">${h}</h4>`;let f=0,p=0,b=0,S=0;const w=t.map(t=>{var e;const n=null===(e=t.value)||void 0===e?void 0:e[1],s=(0,y.ZV)(n,i,n<.1?{maximumFractionDigits:3}:void 0);return"0"!==s&&("bar"===t.componentSubType&&(n>0?(f+=n,p++):(b+=n,S++)),`${t.marker} ${t.seriesName}: ${s} ${r}`)}).filter(Boolean);let $="";return 0!==f&&p>1&&o&&($+=`<br><b>${o(f)}</b>`),0!==b&&S>1&&o&&($+=`<br><b>${o(b)}</b>`),w.length>0?`${g}${w.join("<br>")}${$}`:""}function T(t){Array.from(new Set(t.map(t=>t.data.map(t=>Number(t[0]))).flat())).sort((t,i)=>t-i).forEach((i,e)=>{const n={},s={};for(let _=t.length-1;_>=0;_--){var r,a,o,c,d;const l=t[_].data[e],h=l&&"object"==typeof l&&"value"in l?l:{value:l},g=null===(r=h.value)||void 0===r?void 0:r[0],f=null!==(a=t[_].stack)&&void 0!==a?a:"";var u;if(void 0!==g)if(Number(g)!==i)null===(u=t[_].data)||void 0===u||u.splice(e,0,{value:[i,0],itemStyle:{borderWidth:0}});else 0===(null===(o=h.value)||void 0===o?void 0:o[1])?t[_].data[e]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderWidth:0})}):!n[f]&&(null===(c=h.value)||void 0===c?void 0:c[1])>0?(t[_].data[e]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[4,4,0,0]})}),n[f]=!0):!s[f]&&(null===(d=h.value)||void 0===d?void 0:d[1])<0&&(t[_].data[e]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[0,0,4,4]})}),s[f]=!0)}})}function x(t,i){if(!i)return t=>t;const e=(0,o.V)(t,i);if(0!==e&&t.getTime()===(0,c.D)(t).getTime())return t=>(0,d.e)(t,e);const n=(0,u.W)(t,i);if(0!==n&&t.getTime()===(0,_.w)(t).getTime())return t=>(0,l.P)(t,n);const s=(0,r.c)(t,i);if(0!==s&&t.getTime()===(0,h.o)(t).getTime())return t=>(0,g.f)(t,s);const a=t.getTime()-i.getTime();return t=>(0,f.A)(t,a)}[v,m,y]=p.then?(await p)():p,n()}catch(b){n(b)}})},73097:function(t,i,e){e.a(t,async function(t,n){try{e.r(i),e.d(i,{DEFAULT_DAYS_TO_SHOW:function(){return S},HuiStatisticsGraphCard:function(){return w}});e(46852),e(35748),e(99342),e(65315),e(84136),e(22416),e(5934),e(95013);var s=e(69868),r=e(41484),a=e(4494),o=e(84922),c=e(11991),d=e(75907),u=(e(70490),e(43716)),_=e(36886),l=e(63002),h=e(44630),g=e(8510),f=e(38177),y=t([u,_,l]);[u,_,l]=y.then?(await y)():y;let v,m,p,b=t=>t;const S=30;class w extends o.WF{static async getConfigElement(){return await Promise.all([e.e("42153"),e.e("3654"),e.e("30199"),e.e("11015"),e.e("37824"),e.e("62975"),e.e("55038"),e.e("74644"),e.e("70756"),e.e("76950")]).then(e.bind(e,39788)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,i,e){const n=(0,h.B)(t,1,i,e,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:n.length?[n[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){var t;super.connectedCallback(),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){var t;this._energySub||(this._energySub=(0,u.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){var t,i,e;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(i=this._config)&&void 0!==i&&i.hide_legend?0:(null===(e=this._entities)||void 0===e?void 0:e.length)||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const i=t.entities?(0,f.L)(t.entities,!1):[];this._entities=[],i.forEach(t=>{this._entities.push(t.entity),t.name&&(this._names[t.entity]=t.name)}),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t}shouldUpdate(t){return(0,g.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),!this._config||!t.has("_config"))return;const i=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==i?void 0:i.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("_config")&&(null==i?void 0:i.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==i?void 0:i.stat_types)===this._config.stat_types&&(null==i?void 0:i.days_to_show)===this._config.days_to_show&&(null==i?void 0:i.period)===this._config.period&&(null==i?void 0:i.unit)===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){var i;clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entities),await this._getStatistics(),null!==(i=this._config)&&void 0!==i&&i.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){var t,i;return null!==(t=null===(i=this._config)||void 0===i?void 0:i.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,_.TI)((0,r.c)(this._energyEnd,this._energyStart)):void 0}render(){var t,i;if(!this.hass||!this._config)return o.s6;const e="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,o.qy)(v||(v=b` <ha-card> ${0} <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .startTime="${0}" .endTime="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}" .expandLegend="${0}"></statistics-chart> </div> </ha-card> `),this._config.title?(0,o.qy)(m||(m=b`<h1 class="card-header">${0}</h1>`),this._config.title):o.s6,(0,d.H)({"has-header":!!this._config.title,"has-rows":!(null===(i=this._config.grid_options)||void 0===i||!i.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,_.Gs)((0,r.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,r.c)(this._energyEnd,this._energyStart):this._config.days_to_show||S,e?"100%":void 0,this._config.expand_legend)}get _intervalTimeout(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}async _getStatisticsMetaData(t){const i=await(0,l.Wr)(this.hass,t),e={};i.forEach(t=>{e[t.statistic_id]=t}),this._metadata=e}async _getStatistics(){var t;const i=null!==(t=this._energyStart)&&void 0!==t?t:(0,a.O)(new Date,24*(this._config.days_to_show||S)+1),e=this._energyEnd;try{let t;if(this._config.unit&&this._metadata){const i=Object.values(this._metadata).find(t=>(0,l.JE)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit);i&&(t=i.unit_class,this._unit=this._config.unit)}if(!t&&this._metadata){const i=this._metadata[this._entities[0]];t=null==i?void 0:i.unit_class,this._unit=t&&(0,l.JE)(this.hass,i.statistic_id,i)||void 0}const n=t?{[t]:this._unit}:void 0,s=await(0,l.sz)(this.hass,i,e,this._entities,this._period,n,this._statTypes);this._statistics={},this._entities.forEach(t=>{t in s&&(this._statistics[t]=s[t])})}catch(n){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._names={}}}w.styles=(0,o.AH)(p||(p=b`ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`)),(0,s.__decorate)([(0,c.MZ)({attribute:!1})],w.prototype,"hass",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_config",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_statistics",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_metadata",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_unit",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_energyStart",void 0),(0,s.__decorate)([(0,c.wk)()],w.prototype,"_energyEnd",void 0),w=(0,s.__decorate)([(0,c.EM)("hui-statistics-graph-card")],w),n()}catch(v){n(v)}})},23336:function(t,i,e){e.d(i,{e:function(){return s}});var n=e(9151);function s(t,i,e){return(0,n.P)(t,12*i,e)}},77415:function(t,i,e){e.d(i,{V:function(){return a}});e(35748),e(95013);var n=e(90298),s=e(38227);function r(t,i,e){const[s,r]=(0,n.x)(null==e?void 0:e.in,t,i);return s.getFullYear()-r.getFullYear()}function a(t,i,e){const[a,o]=(0,n.x)(null==e?void 0:e.in,t,i),c=(0,s.z)(a,o),d=Math.abs(r(a,o));a.setFullYear(1584),o.setFullYear(1584);const u=c*(d-+((0,s.z)(a,o)===-c));return 0===u?0:u}}}]);
//# sourceMappingURL=82994.611c99cdfa7104a2.js.map