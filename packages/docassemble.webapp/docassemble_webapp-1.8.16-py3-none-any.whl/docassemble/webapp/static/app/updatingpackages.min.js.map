{"version":3,"sources":["docassemble_webapp/docassemble/webapp/static/app/updatingpackages.js"],"sourcesContent":["var daCheckinInterval = null;\nvar resultsAreIn = false;\nvar pollDelay = 0;\nvar pollFail = 0;\nvar pollPending = false;\nfunction daRestartCallback(data) {\n  //console.log(\"Restart result: \" + data.success);\n}\nfunction daRestart() {\n  $.ajax({\n    type: \"POST\",\n    url: daRestartAjax,\n    data: \"csrf_token=\" + daCsrf + \"&action=restart\",\n    success: daRestartCallback,\n    dataType: \"json\",\n  });\n  return true;\n}\nfunction daBadCallback(data) {\n  pollPending = false;\n  pollFail += 1;\n}\nfunction daUpdateCallback(data) {\n  pollPending = false;\n  if (data.success) {\n    if (data.status == \"finished\") {\n      resultsAreIn = true;\n      if (data.ok) {\n        $(\"#notification\").html(daNoError);\n        $(\"#notification\").removeClass(\"alert-info\");\n        $(\"#notification\").removeClass(\"alert-danger\");\n        $(\"#notification\").addClass(\"alert-success\");\n      } else {\n        $(\"#notification\").html(daErrorWithLog);\n        $(\"#notification\").removeClass(\"alert-info\");\n        $(\"#notification\").removeClass(\"alert-success\");\n        $(\"#notification\").addClass(\"alert-danger\");\n      }\n      $(\"#resultsContainer\").show();\n      $(\"#resultsArea\").html(data.summary);\n      if (daCheckinInterval != null) {\n        clearInterval(daCheckinInterval);\n      }\n      //daRestart();\n    } else if (data.status == \"failed\" && !resultsAreIn) {\n      resultsAreIn = true;\n      $(\"#notification\").html(daUpdateError);\n      $(\"#notification\").removeClass(\"alert-info\");\n      $(\"#notification\").removeClass(\"alert-success\");\n      $(\"#notification\").addClass(\"alert-danger\");\n      $(\"#resultsContainer\").show();\n      if (data.error_message) {\n        $(\"#resultsArea\").html(data.error_message);\n      } else if (data.summary) {\n        $(\"#resultsArea\").html(data.summary);\n      }\n      if (daCheckinInterval != null) {\n        clearInterval(daCheckinInterval);\n      }\n    }\n  } else if (!resultsAreIn) {\n    $(\"#notification\").html(daGeneralError);\n    $(\"#notification\").removeClass(\"alert-info\");\n    $(\"#notification\").removeClass(\"alert-success\");\n    $(\"#notification\").addClass(\"alert-danger\");\n    if (daCheckinInterval != null) {\n      clearInterval(daCheckinInterval);\n    }\n  }\n}\nfunction daUpdate() {\n  if (pollDelay > 50 || pollFail > 16) {\n    $(\"#notification\").html(daServerDidNotRespond);\n    $(\"#notification\").removeClass(\"alert-info\");\n    $(\"#notification\").removeClass(\"alert-success\");\n    $(\"#notification\").addClass(\"alert-danger\");\n    if (daCheckinInterval != null) {\n      clearInterval(daCheckinInterval);\n    }\n    return;\n  }\n  if (pollPending) {\n    pollDelay += 1;\n    return;\n  }\n  if (resultsAreIn) {\n    return;\n  }\n  pollDelay = 0;\n  pollPending = true;\n  $.ajax({\n    type: \"POST\",\n    url: daUrlUpdatePackageAjax,\n    data: \"csrf_token=\" + daCsrf,\n    success: daUpdateCallback,\n    error: daBadCallback,\n    timeout: 2000,\n    dataType: \"json\",\n  });\n  return true;\n}\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  $(document).ready(function () {\n    daCheckinInterval = setInterval(daUpdate, 6000);\n  });\n});\n"],"names":["daCheckinInterval","resultsAreIn","pollDelay","pollFail","pollPending","daRestartCallback","data","daRestart","$","ajax","type","url","daRestartAjax","daCsrf","success","dataType","daBadCallback","daUpdateCallback","status","ok","html","daNoError","removeClass","addClass","daErrorWithLog","show","summary","clearInterval","daUpdateError","error_message","daGeneralError","daUpdate","daServerDidNotRespond","daUrlUpdatePackageAjax","error","timeout","document","addEventListener","ready","setInterval"],"mappings":"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"}