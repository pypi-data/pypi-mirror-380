import{j as s,r as u}from"./@radix-3bj3otF9.js";import{c as y}from"./helper-BXlR2ZLp.js";import{E as D,H as w,J as C,K as P,a5 as d,B as f,L as v,N as b,O as N,Q as T,R as _,a6 as k,U as p,a7 as A,r as m,a0 as R,T as B,a1 as F,a8 as E,a9 as I,aa as O,e as h,a3 as L,z as i,a4 as M}from"./index-1REJ-mbf.js";import{c as U,b as g}from"./@tanstack-CByuvRcg.js";import{u as H}from"./bulk-delete-C0Pqi-YB.js";import{S as Q}from"./refresh-BaK7e0kN.js";import{S as q}from"./SearchField-CjwYvxg3.js";import{B as z,D as G}from"./deployment-status-tag-CXWJMCxB.js";import{P as J}from"./Pagination-DePVp3ki.js";import{S as K}from"./terminal-square-Bg7ZPM8R.js";import{L as x,f as $,a as V}from"./@react-router-Ct_TgVUW.js";import{S as W}from"./trash-B0fyghWi.js";import{D as X,a as Y}from"./DeleteAlertDialog-BUIIlTob.js";import"./@reactflow-CwWcBchH.js";import"./index-FwZ5fdjO.js";import"./chevron-right-double-BuLe9bCa.js";import"./zod-36FJuF1H.js";import"./index.esm-DnoyTjte.js";async function Z({payload:e,snapshotId:t}){const a=w(P.pipeline_snapshots.detail(t)),n=await D(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const r=await n.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Failed to update snapshot ${t}`);throw new C({status:n.status,statusText:n.statusText,message:r})}return n.json()}function ee(e){return U({...e,mutationFn:async({payload:t,snapshotId:a})=>Z({payload:t,snapshotId:a})})}const{ContextProvider:te,useContext:l}=y();function j(){const{setRowSelection:e}=l(),{mutateAsync:t}=ee();async function a(n){await t({snapshotId:n,payload:{name:!1}})}return H({deleteFn:a,queryKeyToInvalidate:d.all,setRowSelection:e})}function se(){const{selectedRowCount:e,selectedRowIDs:t}=l(),{bulkDelete:a}=j();async function n(){await a(t)}return s.jsx(z,{itemName:"Pipeline Snapshot",selectedItemCount:e,onDeleteSelected:n})}function ae({params:e}){const{refetch:t}=g({...d.list(e),throwOnError:!0}),{selectedRowCount:a}=l();return s.jsxs("div",{className:"flex items-center justify-between",children:[a?s.jsx(se,{}):s.jsx(q,{searchParams:e}),s.jsxs(f,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>t(),children:[s.jsx(Q,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})]})}function ne({deleteHandler:e}){return s.jsx(X,{title:"Delete Pipeline Snapshots",handleDelete:e,children:s.jsxs(Y,{children:[s.jsx("p",{children:"Are you sure?"}),s.jsx("p",{children:"This action cannot be undone."})]})})}function re({deleteHandler:e,open:t,setOpen:a}){return s.jsx(v,{open:t,onOpenChange:a,children:s.jsx(ne,{deleteHandler:e})})}function oe({snapshotId:e}){const[t,a]=u.useState(!1),{bulkDelete:n}=j();async function r(){await n([e]),a(!1)}return s.jsxs(s.Fragment,{children:[s.jsx(re,{deleteHandler:r,open:t,setOpen:a}),s.jsxs(b,{children:[s.jsx(N,{asChild:!0,children:s.jsx(f,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:s.jsx(T,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),s.jsx(_,{align:"end",sideOffset:7,children:s.jsxs(k,{onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[s.jsx(W,{className:"h-3 w-3 fill-neutral-400"}),s.jsx("p",{children:"Delete"})]})})]})]})}function ie(){return u.useMemo(()=>[{id:"check",header:({table:e})=>s.jsx(p,{id:"check-all",checked:e.getIsAllRowsSelected(),onCheckedChange:t=>e.toggleAllRowsSelected(t==="indeterminate"?!0:t)}),meta:{width:"1%"},cell:({row:e})=>s.jsx(p,{id:e.id,checked:e.getIsSelected(),onCheckedChange:e.getToggleSelectedHandler(),className:"h-3 w-3"})},{id:"name",header:"Snapshot",accessorFn:e=>e.name,cell:({row:e})=>{const t=e.original.name,a=e.original.id;return s.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5 fill-primary-400"}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{to:m.projects.snapshots.detail.overview(a),className:"flex items-center gap-1",children:s.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t??"Unnamed"})}),s.jsx(R,{copyText:t??""})]})})]})}},{id:"deployment",header:"Deployment",accessorFn:e=>{var t,a;return(a=(t=e.resources)==null?void 0:t.deployment)==null?void 0:a.id},cell:({row:e})=>{var n,r;const t=(n=e.original.resources)==null?void 0:n.deployment,a=(r=t==null?void 0:t.body)==null?void 0:r.status;return a?s.jsx(G,{status:a}):null}},{id:"latest-run",header:"Latest Run",accessorFn:e=>{var t;return(t=e.resources)==null?void 0:t.latest_triggered_run_id},cell:({row:e})=>{var n,r;const t=(n=e.original.resources)==null?void 0:n.latest_run_id,a=(r=e.original.resources)==null?void 0:r.latest_run_status;return!t||!a?s.jsx("div",{children:"No run"}):s.jsx(x,{to:m.projects.runs.detail(t),children:s.jsxs(B,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:F(a),children:[s.jsx(K,{className:`h-3 w-3 ${E(a)}`}),t==null?void 0:t.split("-")[0]]})})}},{id:"latest-run-author",header:"Latest Run Author",accessorFn:e=>{var t;return(t=e.resources)==null?void 0:t.latest_run_author},cell:({row:e})=>{var a,n,r;const t=(a=e.original.resources)==null?void 0:a.user;return t?s.jsx(I,{username:t.name,isServiceAccount:!!((n=t.body)!=null&&n.is_service_account),avatarUrl:((r=t.body)==null?void 0:r.avatar_url)??void 0}):null}},{id:"created",header:"Created at",accessorFn:e=>{var t;return{date:(t=e.body)==null?void 0:t.created}},cell:({getValue:e})=>{const{date:t}=e();return s.jsx(O,{dateString:t})}},{id:"admin_actions",header:"",accessorFn:e=>e.id,cell:({row:e})=>{const t=e.original.id;return s.jsx(oe,{snapshotId:t})}}],[])}function le({params:e}){const{rowSelection:t,setRowSelection:a}=l(),n=ie(),r=g({...d.list(e),throwOnError:!0});if(r.isPending)return s.jsxs("div",{className:"flex flex-col items-center gap-5",children:[s.jsx("div",{className:"w-full",children:s.jsx(h,{className:"h-[500px] w-full"})}),s.jsx(h,{className:"h-[36px] w-[300px]"})]});if(r.isError)return s.jsx("p",{children:"Error fetching snapshots"});const o=r.data;return s.jsxs("div",{className:"flex flex-col items-center gap-5",children:[s.jsx("div",{className:"w-full",children:s.jsx(L,{columns:n,data:o.items,rowSelection:t,onRowSelectionChange:a,getRowId:S=>S.id})}),o.total_pages>1&&s.jsx(J,{searchParams:e,paginate:o})]})}const c=1,ce=i.object({page:i.coerce.number().min(c).optional().default(c).catch(c),name:i.string().optional(),operator:i.enum(["and","or"]).optional()});function ue(){const[e]=$(),{page:t,name:a,operator:n}=ce.parse({page:e.get("page")||void 0,name:e.get("name")||void 0});return{page:t,name:a,logical_operator:n}}function de(){const{pipelineId:e}=V(),t=ue(),a={pipeline:e,named_only:!0,...t,sort_by:"desc:updated"};return s.jsxs(s.Fragment,{children:[s.jsx(ae,{params:a}),s.jsx(le,{params:a})]})}function pe(e){const{setBreadcrumbs:t}=M();u.useEffect(()=>{},[t,e])}function Ae(){return pe(),s.jsx("div",{className:"space-y-5",children:s.jsx(te,{children:s.jsx(de,{})})})}export{Ae as default};
