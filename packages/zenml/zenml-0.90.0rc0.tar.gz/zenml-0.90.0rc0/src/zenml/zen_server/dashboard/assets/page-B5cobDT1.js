import{j as e,r as j}from"./@radix-3bj3otF9.js";import{B as i,r as u,E as D,H as S,J as b,K as T,bq as x,L as g,M as k,z as c,N as R,O as A,Q as P,R as B,a6 as E,U as h,a0 as p,a9 as _,e as f,a3 as L,l as F}from"./index-1REJ-mbf.js";import{S as M}from"./SearchField-CjwYvxg3.js";import{c as I,b as y}from"./@tanstack-CByuvRcg.js";import{S as z}from"./refresh-BaK7e0kN.js";import{S as H}from"./plus-Cewn_igr.js";import{L as m,f as O}from"./@react-router-Ct_TgVUW.js";import{c as Q}from"./helper-BXlR2ZLp.js";import{u as $}from"./bulk-delete-C0Pqi-YB.js";import{S as C}from"./trash-B0fyghWi.js";import{D as K,a as U}from"./DeleteAlertDialog-BUIIlTob.js";import{P as q}from"./Pagination-DePVp3ki.js";import{C as G,R as J}from"./resource-type-tooltip-BE4VKx3q.js";import{e as V,R as W,E as X}from"./service-connectors-CfDpQmT_.js";import"./@reactflow-CwWcBchH.js";import"./index-FwZ5fdjO.js";import"./zod-36FJuF1H.js";import"./index.esm-DnoyTjte.js";import"./chevron-right-double-BuLe9bCa.js";function Y(){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Service Connectors"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your service connectors."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/infrastructure-deployment/auth-management",className:"link text-text-sm text-primary-400",children:"Learn More"})]})]})}function Z(){return e.jsx(i,{size:"md",asChild:!0,children:e.jsxs(m,{to:u.settings.connectors.create,children:[e.jsx(H,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Connector"})]})})}async function ee({connectorId:t}){const s=S(T.serviceConnectors.detail(t)),r=await D(s,{method:"DELETE"});if(!r.ok){const n=await r.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Error while deleting connector ${t}`);throw new b({status:r.status,statusText:r.statusText,message:n})}return r.json()}function te(t){return I({...t,mutationFn:async({connectorId:s})=>ee({connectorId:s})})}const{ContextProvider:se,useContext:l}=Q();function v(){const{setRowSelection:t}=l(),{mutateAsync:s}=te();async function r(n){await s({connectorId:n})}return $({deleteFn:r,queryKeyToInvalidate:[...x.connectors],setRowSelection:t})}function w({deleteHandler:t}){return e.jsx(K,{title:"Delete Connectors",handleDelete:t,children:e.jsxs(U,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}function re({deleteHandler:t,open:s,setOpen:r}){return e.jsx(g,{open:s,onOpenChange:r,children:e.jsx(w,{deleteHandler:t})})}function ne(){const{selectedRowCount:t,selectedRowIDs:s}=l(),{bulkDelete:r}=v();async function n(){await r(s)}const o=t>1?"s":"",a=`${t} Service connector${o} selected`;return e.jsxs("div",{className:"flex h-7 items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:a}),e.jsxs(g,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(i,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(C,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(w,{deleteHandler:n})]})]})}function oe({queryParams:t}){const{selectedRowCount:s}=l();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s>0?e.jsx(ne,{}):e.jsx(M,{searchParams:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{queryParams:t}),e.jsx(Z,{})]})]})})}function ae({queryParams:t}){const{refetch:s}=y(x.serviceConnectorList(t));return e.jsxs(i,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>s(),children:[e.jsx(z,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})}const d=1,ce=c.object({page:c.coerce.number().min(d).optional().default(d).catch(d),name:c.string().optional(),operator:c.enum(["and","or"]).optional()});function ie(){const[t]=O(),{page:s,name:r,operator:n}=ce.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,sortBy:t.get("sort_by")||void 0});return{page:s,name:r,logical_operator:n}}function le({id:t}){const[s,r]=j.useState(!1),{bulkDelete:n}=v();async function o(){await n([t]),r(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(re,{deleteHandler:o,open:s,setOpen:r}),e.jsxs(R,{children:[e.jsx(A,{asChild:!0,children:e.jsx(i,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx(P,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsx(B,{align:"end",sideOffset:7,children:e.jsxs(E,{onSelect:()=>r(!0),className:"cursor-pointer space-x-2",children:[e.jsx(C,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})})]})]})}function de(){return j.useMemo(()=>[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(h,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(h,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Service Connector",accessorKey:"name",cell:({row:t})=>{var o;const s=t.original.id,r=t.original.name,n=(o=t.original.body)==null?void 0:o.connector_type;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[!!n&&typeof n!="string"&&e.jsx(G,{connectorType:n}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{to:u.settings.connectors.detail.configuration(s),className:"block max-w-[200px] truncate text-text-md font-semibold",children:r}),e.jsx(p,{copyText:r})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{to:u.settings.connectors.detail.configuration(s),children:s.split("-")[0]}),e.jsx(p,{copyText:s})]})]})]})}},{id:"resource_types",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Types"})},cell:({row:t})=>{const s=V(t.original);return e.jsx("div",{className:"flex items-center gap-0.5",children:s.map((r,n)=>e.jsx(J,{resourceType:r},n))})}},{id:"resource-name",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Name"})},cell:({row:t})=>e.jsx("div",{className:"max-w-[100px]",children:e.jsx(W,{connector:t.original})})},{id:"user",header:"Author",accessorFn:t=>{var s,r;return(r=(s=t.resources)==null?void 0:s.user)==null?void 0:r.name},cell:({row:t})=>{var r,n,o;const s=(r=t.original.resources)==null?void 0:r.user;return s?e.jsx(_,{className:"max-w-[200px] truncate",avatarUrl:((n=s.body)==null?void 0:n.avatar_url)??void 0,username:s.name,isServiceAccount:!!((o=s.body)!=null&&o.is_service_account)}):null}},{id:"expires",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Expires in"})},accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.expires_at},cell:({row:t})=>{var r;const s=(r=t.original.body)==null?void 0:r.expires_at;return s?e.jsx(X,{expires:s}):e.jsx("p",{children:"Never"})}},{id:"admin_actions",header:"",cell:({row:t})=>e.jsx(le,{id:t.original.id})}],[])}function ue({queryParams:t}){const{rowSelection:s,setRowSelection:r}=l(),n=y({...x.serviceConnectorList(t)}),o=de();if(n.isPending)return e.jsxs("div",{className:"space-y-5",children:[e.jsx(f,{className:"h-[300px] w-full"}),e.jsx(f,{className:"mx-auto h-[36px] w-[300px]"})]});if(n.isError)return null;const a=n.data;return e.jsx("section",{className:"flex flex-col gap-5",children:e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(L,{columns:o,data:a.items,rowSelection:s,getRowId:N=>N.id,onRowSelectionChange:r})}),a.total_pages>1&&e.jsx(q,{searchParams:t,paginate:a})]})})}function me(){const s={...ie(),sort_by:"desc:updated"};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{queryParams:s}),e.jsx(ue,{queryParams:s})]})}function Be(){return e.jsxs(F,{className:"space-y-4 p-5",children:[e.jsx(Y,{}),e.jsx(se,{children:e.jsx(me,{})})]})}export{Be as default};
