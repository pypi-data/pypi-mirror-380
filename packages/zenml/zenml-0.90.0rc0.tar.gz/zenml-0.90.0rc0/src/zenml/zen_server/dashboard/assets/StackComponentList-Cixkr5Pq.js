import{j as e,r as x}from"./@radix-3bj3otF9.js";import{S as B}from"./plus-Cewn_igr.js";import{S as g}from"./refresh-BaK7e0kN.js";import{P as y}from"./Pagination-DePVp3ki.js";import{S as v}from"./SearchField-CjwYvxg3.js";import{E as H,H as I,J as M,K as O,aY as T,a2 as $,W as Q,r as h,X as q,Y as U,Z as K,_ as G,$ as Y,a0 as u,aa as N,B as d,a3 as b,e as m,A as J,h as W,a9 as P,i as X,j as Z,k as V,bO as ee,L as A,N as se,O as te,Q as ae,R as ne,a6 as S,bj as re,U as w,s as k,aP as ie,T as le,z as p,M as oe}from"./index-1REJ-mbf.js";import{c as ce,b as _}from"./@tanstack-CByuvRcg.js";import{L as j,c as de,f as me}from"./@react-router-Ct_TgVUW.js";import{S as xe}from"./expand-full-HjUlDE5L.js";import{S as he}from"./SheetHeader-D7LxTrv6.js";import{S as ue}from"./Tabs-DnNiHAEK.js";import{u as pe}from"./all-pipeline-runs-query-CzIJhvJX.js";import{s as je}from"./index-iuK9vGP1.js";import{C as fe}from"./ComponentBadge-CYC6mnh8.js";import{S as F}from"./trash-B0fyghWi.js";import{D as ge,a as ye}from"./DeleteAlertDialog-BUIIlTob.js";import{I as ve}from"./Infobox-D1YtF5f6.js";import{c as Ne}from"./helper-BXlR2ZLp.js";import{u as be}from"./bulk-delete-C0Pqi-YB.js";async function Ce({componentId:t}){const s=I(O.components.detail(t)),a=await H(s,{method:"DELETE"});if(!a.ok){const n=await a.json().then(r=>Array.isArray(r.detail)?r.detail[1]:r.detail).catch(()=>`Error while deleting component ${t}`);throw new M({status:a.status,statusText:a.statusText,message:n})}return a.json()}function Se(t){return ce({...t,mutationFn:async({componentId:s})=>Ce({componentId:s})})}const{ContextProvider:es,useContext:C}=Ne();function E(){const{setRowSelection:t}=C(),{mutateAsync:s}=Se();async function a(n){await s({componentId:n})}return be({deleteFn:a,queryKeyToInvalidate:T.all,setRowSelection:t})}const we=[{id:"name",header:"Run",accessorFn:t=>{var s;return{id:t.id,name:t.name,status:(s=t.body)==null?void 0:s.status}},cell:({getValue:t})=>{const{name:s,status:a,id:n}=t();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx($,{className:`h-5 w-5 ${Q(a)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{to:h.projects.runs.detail(n),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:s})}),e.jsx(q,{children:e.jsxs(U,{children:[e.jsx(K,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(G,{status:a})}),e.jsx(Y,{className:"z-20 capitalize",children:a})]})}),e.jsx(u,{copyText:s})]}),e.jsxs(j,{to:h.projects.runs.detail(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:n.split("-")[0]}),e.jsx(u,{copyText:n})]})]})]})}},{id:"created-at",header:"Created at",accessorFn:t=>{var s;return{date:(s=t.body)==null?void 0:s.created}},cell:({getValue:t})=>{const{date:s}=t();return e.jsx("div",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:s})})}}];function ke({componentId:t}){const[s,a]=x.useState(void 0),[n,r]=x.useState(1),o={name:s,page:n},{data:l,refetch:c}=pe({params:{...o,stack_component:t,sort_by:"desc:updated"}});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{inMemoryHandler:i=>{r(1),i||a(void 0),a(`contains:${i}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>c(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:l?e.jsx(b,{columns:we,data:l.items}):e.jsx(m,{className:"h-[500px] w-full"})}),l?l.total_pages>1&&e.jsx(y,{inMemoryHandler:r,searchParams:{},paginate:l}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}function De(){return[{id:"name",header:"Stack",accessorFn:t=>t.name,cell:({row:t})=>{const{name:s,id:a}=t.original;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(J,{type:"square",size:"md",children:e.jsx(W,{size:"md",children:s[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-text-md font-semibold",children:s})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(u,{copyText:a})]})]})]})}},{id:"author",header:"Author",accessorFn:t=>{var s;return{author:(s=t.resources)==null?void 0:s.user}},cell:({getValue:t})=>{var a,n;const{author:s}=t();return s?e.jsx(P,{avatarUrl:((a=s.body)==null?void 0:a.avatar_url)??void 0,username:s.name,isServiceAccount:!!((n=s.body)!=null&&n.is_service_account)}):null}},{id:"created",header:"Created at",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:t()})})}]}function Te({componentId:t}){const[s,a]=x.useState(void 0),[n,r]=x.useState(1),o={name:s,page:n},{refetch:l,data:c}=_(je.stackList({...o,component_id:t,sort_by:"desc:updated"}));return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{inMemoryHandler:i=>{r(1),i||a(void 0),a(`contains:${i}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>l(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:c?e.jsx(b,{columns:De(),data:c.items}):e.jsx(m,{className:"h-[500px] w-full"})}),c?c.total_pages>1&&e.jsx(y,{inMemoryHandler:r,searchParams:{},paginate:c}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}function D({children:t,onOpenChange:s,componentId:a}){return e.jsxs(X,{onOpenChange:s,children:[e.jsx(Z,{asChild:!0,children:t}),e.jsxs(V,{className:"w-[1000px] overflow-y-auto",children:[e.jsx(he,{className:"gap-0.5",children:e.jsx(d,{className:"flex aspect-square items-center justify-center p-0",intent:"secondary",asChild:!0,emphasis:"minimal",children:e.jsxs(j,{to:h.components.detail(a),children:[e.jsx(xe,{className:"h-5 w-5 shrink-0 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Expand component detail to page"})]})})}),e.jsxs("div",{className:"@container",children:[e.jsx(ee,{isPanel:!0,componentId:a}),e.jsx(ue,{isPanel:!0,runsTabContent:e.jsx(ke,{componentId:a}),stacksTabContent:e.jsx(Te,{componentId:a}),componentId:a})]})]})]})}function R({deleteHandler:t}){return e.jsx(ge,{title:"Delete Components",handleDelete:t,children:e.jsxs(ye,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."}),e.jsx(ve,{className:"mt-4 text-theme-text-primary",children:"If a component is still part of a stack, it will not be deleted."})]})})}function Pe({deleteHandler:t,open:s,setOpen:a}){return e.jsx(A,{open:s,onOpenChange:a,children:e.jsx(R,{deleteHandler:t})})}function Ae({id:t}){const[s,a]=x.useState(!1),n=de(),{bulkDelete:r}=E();async function o(){await r([t]),a(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{deleteHandler:o,open:s,setOpen:a}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(d,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx(ae,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsxs(ne,{align:"end",sideOffset:7,children:[e.jsxs(S,{onSelect:()=>n(h.components.edit(t)),className:"cursor-pointer space-x-2",children:[e.jsx(re,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(S,{onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(F,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function _e(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(w,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(w,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Component",accessorKey:"name",cell:({row:t})=>{var n;const s=t.original.id,a=t.original.name;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx("img",{width:32,height:32,src:k(((n=t.original.body)==null?void 0:n.logo_url)||""),alt:"Flavor Icon"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:s,children:e.jsx("button",{children:e.jsx("h2",{className:"text-text-md font-semibold",children:a})})}),e.jsx(u,{copyText:a})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:s,children:e.jsx("button",{className:"text-text-xs text-theme-text-secondary",children:s.split("-")[0]})}),e.jsx(u,{copyText:s})]})]})]})}},{id:"type",header:"Component Type",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.type},cell:({row:t})=>{var a;const s=((a=t.original.body)==null?void 0:a.type)||"orchestrator";return e.jsx(fe,{type:s,children:ie(s)})}},{id:"flavor",header:"Flavor",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.flavor_name},cell:({row:t})=>{var a,n;const s=(a=t.original.body)==null?void 0:a.flavor_name;return e.jsxs(le,{rounded:!1,className:"w-fit gap-1 text-theme-text-primary",color:"grey",emphasis:"minimal",children:[e.jsx("img",{width:20,height:20,src:k(((n=t.original.body)==null?void 0:n.logo_url)||""),alt:"Flavor Icon of Component"}),e.jsx("p",{children:s})]})}},{id:"author",header:"Author",accessorFn:t=>{var s,a;return(a=(s=t.resources)==null?void 0:s.user)==null?void 0:a.name},cell:({row:t})=>{var a,n,r;const s=(a=t.original.resources)==null?void 0:a.user;return s?e.jsx(P,{avatarUrl:((n=s.body)==null?void 0:n.avatar_url)??void 0,username:s.name,isServiceAccount:!!((r=s.body)!=null&&r.is_service_account)}):null}},{id:"created",header:"Created at",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({row:t})=>{var s;return e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:((s=t.original.body)==null?void 0:s.created)||""})})}},{id:"admin_actions",header:"",cell:({row:t})=>e.jsx(Ae,{id:t.original.id})}]}const f=1,Fe=p.object({page:p.coerce.number().min(f).optional().default(f).catch(f),name:p.string().optional(),operator:p.enum(["and","or"]).optional()});function Ee(){const[t]=me(),{page:s,name:a,operator:n}=Fe.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:a,logical_operator:n}}function Re(){const{bulkDelete:t}=E(),{selectedRowCount:s,selectedRowIDs:a}=C();async function n(){await t(a)}const r=s>1?"s":"",o=`${s} Component${r} selected`;return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:o}),e.jsxs(A,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(d,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(F,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(R,{deleteHandler:n})]})]})}function ss({fixedQueryParams:t,displayCreateComponent:s=!0}){const a=Ee(),{rowSelection:n,setRowSelection:r,selectedRowCount:o}=C(),l=_({...T.componentList({...a,...t,sort_by:"desc:updated"}),throwOnError:!0}),c=_e();if(l.isError)return null;const{data:i,refetch:z}=l;return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:o>=1?e.jsx(Re,{}):e.jsx(v,{searchParams:a})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>z(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),s&&e.jsx(d,{size:"md",asChild:!0,children:e.jsxs(j,{to:h.components.create,children:[e.jsx(B,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Component"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(b,{getRowId:L=>L.id,rowSelection:n,onRowSelectionChange:r,columns:c,data:i.items}):e.jsx(m,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(y,{searchParams:a,paginate:i}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}export{es as C,ss as S};
