import{r as c,j as e}from"./@radix-3bj3otF9.js";import{c as N}from"./helper-BXlR2ZLp.js";import{H as R,J as _,K as k,p as D,L as A,M as O,B as P,N as E,O as I,Q as B,R as F,U as f,V as L,W as $,r as p,X as z,Y as M,Z as H,_ as Q,$ as q,a0 as g,T as G,a1 as K,a2 as U,z as d,a3 as J,e as j}from"./index-1REJ-mbf.js";import{c as V,b as W}from"./@tanstack-CByuvRcg.js";import{u as X}from"./bulk-delete-C0Pqi-YB.js";import{S as Y}from"./refresh-BaK7e0kN.js";import{P as Z}from"./Pagination-DePVp3ki.js";import{S as ee}from"./SearchField-CjwYvxg3.js";import{S as C}from"./trash-B0fyghWi.js";import{D as v,a as S}from"./DeleteAlertDialog-BUIIlTob.js";import{L as m,f as te}from"./@react-router-Ct_TgVUW.js";import{A as se}from"./AlertDialogDropdownItem-CAlqlfdb.js";import"./@reactflow-CwWcBchH.js";import"./chevron-right-double-BuLe9bCa.js";import"./index-FwZ5fdjO.js";import"./zod-36FJuF1H.js";import"./index.esm-DnoyTjte.js";async function ne({pipelineId:t}){const s=R(k.pipelines.detail(t)),n=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(r=>r.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new _({status:n.status,statusText:n.statusText,message:a})}return n.json()}function ae(t){return V({mutationFn:ne,...t})}const{ContextProvider:re,useContext:u}=N();function w(){const{setRowSelection:t}=u(),{mutateAsync:s}=ae();async function n(a){await s({pipelineId:a})}return X({deleteFn:n,queryKeyToInvalidate:D.all,setRowSelection:t})}function ie(){const[t,s]=c.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=u(),{bulkDelete:r}=w();async function i(){await r(a),s(!1)}return e.jsxs(A,{open:t,onOpenChange:s,children:[e.jsx(O,{asChild:!0,children:e.jsxs(P,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(C,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(v,{title:`Delete Pipeline${n>=2?"s":""}`,handleDelete:i,children:e.jsxs(S,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function le(){const{selectedRowCount:t}=u();return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} Pipeline${t>1?"s":""} selected`}),e.jsx(ie,{})]})}function oe({id:t}){const[s,n]=c.useState(!1),[a,r]=c.useState(!1),i=c.useRef(null),l=c.useRef(null),{bulkDelete:y}=w();async function b(){await y([t]),x(!1)}function T(){l.current=i.current}function x(o){if(o===!1){r(!1),setTimeout(()=>{n(o)},200);return}n(o)}return e.jsxs(E,{onOpenChange:r,open:a,children:[e.jsx(I,{ref:i,children:e.jsx(B,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(F,{hidden:s,onCloseAutoFocus:o=>{l.current&&(l.current.focus(),l.current=null,o.preventDefault())},align:"end",sideOffset:7,children:e.jsx(se,{onSelect:T,open:s,onOpenChange:x,triggerChildren:"Delete",icon:e.jsx(C,{fill:"red"}),children:e.jsx(v,{title:"Delete Pipeline",handleDelete:b,children:e.jsxs(S,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})})]})}function ce(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(f,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(f,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>{var s,n,a;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(L,{className:`h-5 w-5 ${$((s=t.original.resources)==null?void 0:s.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{to:p.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(z,{children:e.jsxs(M,{children:[e.jsx(H,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(Q,{status:(n=t.original.resources)==null?void 0:n.latest_run_status})}),e.jsx(q,{className:"z-20 capitalize",children:(a=t.original.resources)==null?void 0:a.latest_run_status})]})}),e.jsx(g,{copyText:t.original.name})]}),e.jsxs(m,{to:p.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(g,{copyText:t.original.id})]})]})]})}},{id:"latest-run",header:"Latest Run",accessorFn:t=>{var s,n;return{status:(s=t.resources)==null?void 0:s.latest_run_status,runId:(n=t.resources)==null?void 0:n.latest_run_id}},cell:({getValue:t})=>{const{runId:s,status:n}=t();return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(m,{to:p.projects.runs.detail(s),children:e.jsxs(G,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:K(n),children:[e.jsx(U,{className:"h-3 w-3 fill-current"}),s==null?void 0:s.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(oe,{id:t.original.id})}]}const h=1,de=d.object({page:d.coerce.number().min(h).optional().default(h).catch(h),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function ue(){const[t]=te(),{page:s,name:n,operator:a}=de.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:n,logical_operator:a}}function pe(){const t=ue(),{selectedRowCount:s,rowSelection:n,setRowSelection:a}=u(),{data:r,refetch:i}=W({...D.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[s?e.jsx(le,{}):e.jsx(ee,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(P,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>i(),children:[e.jsx(Y,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(J,{rowSelection:n,onRowSelectionChange:a,getRowId:l=>l.id,columns:ce(),data:r.items}):e.jsx(j,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(Z,{searchParams:t,paginate:r}):e.jsx(j,{className:"h-[36px] w-[300px]"})]})]})}function _e(){return e.jsx(re,{children:e.jsx(pe,{})})}export{_e as default};
