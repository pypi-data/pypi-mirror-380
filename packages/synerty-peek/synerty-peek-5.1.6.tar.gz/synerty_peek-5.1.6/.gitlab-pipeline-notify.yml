# Pipeline notification jobs

# Success notification - runs when pipeline succeeds
notify-of-success:
    image: nexus.synerty.com:5000/peek-alma8-build:${RELEASE_BRANCH}
    tags:
        - linux
    stage: notify
    allow_failure: true
    dependencies: []
    script:
        - curl -k -s 
            --form-string "token=${PUSHOVER_API_TOKEN}" 
            --form-string "user=${PUSHOVER_API_GROUP_KEY}" 
            --form-string "message=Pipeline ${CI_PIPELINE_ID} completed successfully in ${CI_PROJECT_NAME}" 
            --form-string "title=GitLab CI Success" 
            https://api.pushover.net/1/messages.json
    rules:
        - if: '$CI_PIPELINE_SOURCE == "push"'
          when: never
        - when: on_success

# Failure notification - runs when pipeline fails
notify-of-failure:
    image: nexus.synerty.com:5000/peek-alma8-build:${RELEASE_BRANCH}
    tags:
        - linux
    stage: notify
    allow_failure: true
    dependencies: []
    script:
        - curl -k -s 
            --form-string "token=${PUSHOVER_API_TOKEN}" 
            --form-string "user=${PUSHOVER_API_GROUP_KEY}" 
            --form-string "message=Pipeline ${CI_PIPELINE_ID} failed in ${CI_PROJECT_NAME}" 
            --form-string "title=GitLab CI Failure" 
            --form-string "priority=1" 
            https://api.pushover.net/1/messages.json
    rules:
        - if: '$CI_PIPELINE_SOURCE == "push"'
          when: never
        - when: on_failure