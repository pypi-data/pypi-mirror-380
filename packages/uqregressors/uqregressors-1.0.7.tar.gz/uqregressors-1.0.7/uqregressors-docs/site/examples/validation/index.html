
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../saving_models/">
      
      
        <link rel="next" href="../conformal_coverage_validation/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Validation - UQregressors</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M13%2014h-2V9h2m0%209h-2v-2h2M1%2021h22L12%202z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#validation-of-regressor-implementations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="UQregressors" class="md-header__button md-logo" aria-label="UQregressors" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UQregressors
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Validation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="UQregressors" class="md-nav__button md-logo" aria-label="UQregressors" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    UQregressors
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../saving_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Saving and Loading Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utility-functions-for-running-regressor-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Utility functions for running regressor tests:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mc-dropout-regressor" class="md-nav__link">
    <span class="md-ellipsis">
      MC dropout Regressor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-ensemble-regressor" class="md-nav__link">
    <span class="md-ellipsis">
      Deep Ensemble Regressor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-conformal-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Split Conformal Prediction
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conformal_coverage_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validating Coverage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regressor_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regressor Details
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bayesian
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Bayesian
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Bayesian/deep_ens/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deep Ensembles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Bayesian/dropout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dropout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Bayesian/gp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gaussian Processes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Bayesian/bbmm_gp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gaussian Process (Black Box Matrix-Matrix Inference)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Conformal
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Conformal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Conformal/cqr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conformal Quantile Regression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Conformal/k_fold_cqr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    K-Fold Conformal Quantile Regression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Conformal/conformal_ens/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Normalized Conformal Ensemble
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Utils/activations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Activations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Utils/data_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Utils/file_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Utils/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/Utils/torch_sklearn_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Torch Sklearn Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utility-functions-for-running-regressor-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Utility functions for running regressor tests:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mc-dropout-regressor" class="md-nav__link">
    <span class="md-ellipsis">
      MC dropout Regressor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-ensemble-regressor" class="md-nav__link">
    <span class="md-ellipsis">
      Deep Ensemble Regressor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-conformal-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Split Conformal Prediction
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="validation-of-regressor-implementations">Validation of Regressor Implementations</h1>
<p>This is an example script which replicates published results for the MC-dropout, Deep Ensemble, and Split Conformal Quantile Regression (CQR) methods. Additionally, average coverage is validated for the K-fold-CQR and normalized conformal ensemble methods. This script matches the experimental setup described in each of these papers using public datasets, runs one fit-predict trial, and verifies that the desired results land within the probable range reported in the published results. </p>
<h2 id="utility-functions-for-running-regressor-tests">Utility functions for running regressor tests:</h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.utils.torch_sklearn_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.tuning.tuning</span><span class="w"> </span><span class="kn">import</span> <span class="n">tune_hyperparams</span><span class="p">,</span> <span class="n">log_likelihood</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.utils.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_logging_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.utils.file_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.bayesian.dropout</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCDropoutRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.bayesian.deep_ens</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeepEnsembleRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.utils.data_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">clean_dataset</span><span class="p">,</span> <span class="n">validate_dataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.metrics.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_all_metrics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.utils.data_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_unformatted_dataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.conformal.cqr</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConformalQuantileRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.conformal.k_fold_cqr</span><span class="w"> </span><span class="kn">import</span> <span class="n">KFoldCQR</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.conformal.conformal_ens</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConformalEnsRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

<span class="n">r_seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">set_logging_config</span><span class="p">(</span><span class="nb">print</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># Disable logging for all future regressors for cleanliness</span>
<span class="n">optuna</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">optuna</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span> <span class="c1"># Disable hyperparameter logging for cleanliness</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_regressor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                   <span class="n">tuning_epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scoring_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">initial_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">clean_dataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">validate_dataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># Hyperparameter Optimization: </span>
    <span class="k">if</span> <span class="n">tuning_epochs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">param_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">epochs_copy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">model</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tuning_epochs</span><span class="p">)</span>
        <span class="n">opt_model</span><span class="p">,</span> <span class="n">opt_score</span><span class="p">,</span> <span class="n">study</span> <span class="o">=</span> <span class="n">tune_hyperparams</span><span class="p">(</span><span class="n">regressor</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                                        <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
                                                        <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> 
                                                        <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
                                                        <span class="n">score_fn</span><span class="o">=</span><span class="n">scoring_fn</span><span class="p">,</span> 
                                                        <span class="n">greater_is_better</span><span class="o">=</span><span class="n">greater</span><span class="p">,</span>
                                                        <span class="n">initial_params</span><span class="o">=</span><span class="n">initial_params</span><span class="p">,</span> 
                                                        <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> 
                                                        <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> 
                                                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
                                                        <span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">opt_model</span> 
        <span class="n">model</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs_copy</span> 

    <span class="c1"># Modify learning rate for deep ensembles on energy and kin8nm datasets: </span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="ow">is</span> <span class="n">DeepEnsembleRegressor</span><span class="p">:</span> 
        <span class="nb">print</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;kin8nm&quot;</span><span class="p">]:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting learning rate to 1e-2&quot;</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">1e-2</span> 

        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Setting learning rate to 1e-1&quot;</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span><span class="mf">1e-1</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="n">compute_all_metrics</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">metrics</span> 

<span class="k">def</span><span class="w"> </span><span class="nf">run_regressor_test</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span> 
                       <span class="n">BASE_SAVE_DIR</span><span class="o">=</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="s2">&quot;.uqregressors&quot;</span><span class="p">,</span> 
                       <span class="n">tuning_epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scoring_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">initial_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> 
    <span class="n">DATASET_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span>
    <span class="n">saved_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Loading dataset: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_unformatted_dataset</span><span class="p">(</span><span class="n">DATASET_PATH</span> <span class="o">/</span> <span class="n">file</span><span class="p">)</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="n">test_regressor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> 
                                 <span class="n">tuning_epochs</span><span class="o">=</span><span class="n">tuning_epochs</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span> 
                                 <span class="n">scoring_fn</span><span class="o">=</span><span class="n">scoring_fn</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="n">greater</span><span class="p">,</span> <span class="n">initial_params</span><span class="o">=</span><span class="n">initial_params</span><span class="p">,</span> 
                                 <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

        <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">BASE_SAVE_DIR</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span>
        <span class="n">saved_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">save_path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">saved_results</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_results</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span> 
    <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">()</span>
    <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span> 
        <span class="n">results</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">load_logs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results for </span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">])</span>
</code></pre></div>
<h2 id="datasets">Datasets</h2>
<p>A variety of datasets are chosen which match the datasets for which there are published results. Extremely large datasets, and those where there is ambiguity about which target is being predicted are omitted. </p>
<p>Information about the datasets used is available in: <a href="https://arxiv.org/abs/1502.05336">Hernández Lobato and Adams, 2015</a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">datasets_bayesian</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="s2">&quot;concrete&quot;</span><span class="p">:</span> <span class="s2">&quot;concrete.xls&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="s2">&quot;energy_efficiency.xlsx&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;kin8nm&quot;</span><span class="p">:</span> <span class="s2">&quot;kin8nm.arff&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="s2">&quot;power_plant.xlsx&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;wine&quot;</span><span class="p">:</span> <span class="s2">&quot;winequality-red.csv&quot;</span><span class="p">,</span> 
<span class="p">}</span>

<span class="n">datasets_conformal</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;concrete&quot;</span><span class="p">:</span> <span class="s2">&quot;concrete.xls&quot;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 

<span class="k">def</span><span class="w"> </span><span class="nf">plot_validation</span><span class="p">(</span><span class="n">pub</span><span class="p">,</span> <span class="n">save_paths</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric_1</span><span class="p">,</span> <span class="n">metric_2</span><span class="p">,</span> <span class="n">metric_1_name</span><span class="p">,</span> <span class="n">metric_2_name</span><span class="p">):</span> 
    <span class="n">save_paths_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">save_paths</span><span class="p">],</span> <span class="p">[(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">save_paths</span><span class="p">]))</span>

    <span class="n">MCD_exp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">RMSE</span><span class="p">,</span> <span class="n">RMSE_std</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">LL_std</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pub</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
        <span class="n">MCD_exp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_class</span><span class="o">=</span><span class="n">save_paths_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">save_paths_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span>

    <span class="n">datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pub</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">))</span>

    <span class="c1"># Prepare RMSE and LL values</span>
    <span class="n">pub_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pub</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>
    <span class="n">pub_rmse_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.96</span> <span class="o">*</span> <span class="n">pub</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>
    <span class="n">exp_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MCD_exp</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">metric_1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>

    <span class="n">pub_ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pub</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>
    <span class="n">pub_ll_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.96</span> <span class="o">*</span> <span class="n">pub</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">metric_2</span> <span class="ow">is</span> <span class="s2">&quot;nll_gaussian&quot;</span><span class="p">:</span> 
        <span class="n">exp_ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">MCD_exp</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">metric_2</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">exp_ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MCD_exp</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">metric_2</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">])</span>

    <span class="c1"># Plot RMSE</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pub_rmse</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">pub_rmse_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Published (95% CI)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">exp_rmse</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">metric_1_name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_1_name</span><span class="si">}</span><span class="s2"> Validation&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Plot Log Likelihood</span>
    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">pub_ll</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">pub_ll_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Published (95% CI)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">exp_ll</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">metric_2_name</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_2_name</span><span class="si">}</span><span class="s2"> Validation&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h2 id="mc-dropout-regressor">MC dropout Regressor</h2>
<p>First, results are generated and compared to the results published in <a href="https://arxiv.org/pdf/1506.02142">Gal and Ghahramani, 2016</a>. As described in the paper, a single layer neural network with 50 hidden units is used with 0.05 dropout probability, and parameters optimized for 400 epochs with minibatch sizes of 32 on the Adam optimizer. Before training, the aleatoric uncertainty parameter, <span class="arithmatex">\(\tau\)</span>, is estimated with 30 iterations of Bayesian Optimization with initial prior length scale 0.01. </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.tuning.tuning</span><span class="w"> </span><span class="kn">import</span> <span class="n">log_likelihood</span><span class="p">,</span> <span class="n">interval_score</span>


<span class="n">dropout</span> <span class="o">=</span> <span class="n">MCDropoutRegressor</span><span class="p">(</span>
    <span class="n">hidden_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">],</span> 
    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
    <span class="n">use_paper_weight_decay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">prior_length_scale</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
    <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="c1"># Changed to 40 during hyperparameter tuning</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> 
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> 
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> 
    <span class="n">use_wandb</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Hyperparameter Tuning: </span>
<span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;tau&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">MC_save_paths</span> <span class="o">=</span> <span class="n">run_regressor_test</span><span class="p">(</span><span class="n">dropout</span><span class="p">,</span> <span class="n">datasets_bayesian</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">r_seed</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;dropout_validation&quot;</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                   <span class="n">tuning_epochs</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span> <span class="n">scoring_fn</span><span class="o">=</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">print_results</span><span class="p">(</span><span class="n">MC_save_paths</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">MCD_pub</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;concrete&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.23</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.04</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">],</span> 
    <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.66</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.99</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">],</span> 
    <span class="s2">&quot;kin8nm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span> 
    <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.12</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> 
    <span class="s2">&quot;wine&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">plot_validation</span><span class="p">(</span><span class="n">MCD_pub</span><span class="p">,</span> <span class="n">MC_save_paths</span><span class="p">,</span> <span class="s2">&quot;MC Dropout&quot;</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;nll_gaussian&quot;</span><span class="p">,</span> <span class="s2">&quot;Root Mean Squared Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaussian Log Likelihood&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../validation_files/validation_8_0.png" /></p>
<p><img alt="png" src="../validation_files/validation_8_1.png" /></p>
<h2 id="deep-ensemble-regressor">Deep Ensemble Regressor</h2>
<p>Next, validation is performed for the Deep Ensemble Regressor as in <a href="https://arxiv.org/pdf/1612.01474">Lakshminarayanan et. al. 2017</a>. A very similar experimental setup as that of MC Dropout is carried out using a Deep Ensemble with 5 estimators, each a single layer neural network with 50 hidden units, a batch size of 100, and a learning rate of either 1e-1 or 1e-2 on the Adam optimizer. </p>
<div class="highlight"><pre><span></span><code><span class="n">deep_ens</span> <span class="o">=</span> <span class="n">DeepEnsembleRegressor</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
    <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> 
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="c1">#Changed to 1e-2 for energy and kin8nm datasets </span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> 
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> 
    <span class="n">scale_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">use_wandb</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">deep_ens_save_paths</span> <span class="o">=</span> <span class="n">run_regressor_test</span><span class="p">(</span><span class="n">deep_ens</span><span class="p">,</span> <span class="n">datasets_bayesian</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">r_seed</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;deep_ens_validation&quot;</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">DE_pub</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;concrete&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.03</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.06</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">],</span> 
    <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.09</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.38</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">],</span> 
    <span class="s2">&quot;kin8nm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span> 
    <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.11</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.79</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">],</span> 
    <span class="s2">&quot;wine&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">plot_validation</span><span class="p">(</span><span class="n">DE_pub</span><span class="p">,</span> <span class="n">deep_ens_save_paths</span><span class="p">,</span> <span class="s2">&quot;Deep Ensemble&quot;</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="s2">&quot;nll_gaussian&quot;</span><span class="p">,</span> <span class="s2">&quot;Root Mean Squared Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Gaussian Log Likelihood&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../validation_files/validation_11_0.png" /></p>
<p><img alt="png" src="../validation_files/validation_11_1.png" /></p>
<h2 id="split-conformal-prediction">Split Conformal Prediction</h2>
<p>Next, split conformal prediction is validated according to the results in <a href="https://arxiv.org/abs/1905.03222">Romano et. al. 2019</a>. A split conformal quantile regressor with half of the training data in the calibration set, two hidden layers of 64 neurons each, a 0.1 dropout probability, and trained for 1000 epochs with a batch size of 64 using the standard quantile loss function is implemented as in the paper, and compared to the published results on the concrete compressive strength dataset. Note that a mean and standard deviation for the published results were estimated from the reported box and whisker plot, and scaled by the mean of the outputs. A slightly better average interval width than published was found, likely due to small differences in the training procedure and hyperparameter tunining functions. </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">uqregressors.tuning.tuning</span><span class="w"> </span><span class="kn">import</span> <span class="n">interval_width</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>

<span class="n">cqr</span> <span class="o">=</span> <span class="n">ConformalQuantileRegressor</span><span class="p">(</span>
    <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span> 
    <span class="n">cal_size</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
    <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> 
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> 
    <span class="n">optimizer_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">},</span> 
    <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> 
    <span class="n">scale_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">use_wandb</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;tau_lo&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s2">&quot;tau_lo&quot;</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">cqr_save_paths</span> <span class="o">=</span> <span class="n">run_regressor_test</span><span class="p">(</span><span class="n">cqr</span><span class="p">,</span> <span class="n">datasets_conformal</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">r_seed</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;cqr_validation&quot;</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                    <span class="n">tuning_epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span> <span class="n">scoring_fn</span><span class="o">=</span><span class="n">interval_width</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                    <span class="n">n_trials</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">conformal_pub</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;concrete&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.01913</span><span class="p">,</span> <span class="mf">17.189</span><span class="p">,</span> <span class="mf">0.5479</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">plot_validation</span><span class="p">(</span><span class="n">conformal_pub</span><span class="p">,</span> <span class="n">cqr_save_paths</span><span class="p">,</span> <span class="s2">&quot;CQR&quot;</span><span class="p">,</span> <span class="s2">&quot;coverage&quot;</span><span class="p">,</span> <span class="s2">&quot;average_interval_width&quot;</span><span class="p">,</span> <span class="s2">&quot;Coverage&quot;</span><span class="p">,</span> <span class="s2">&quot;Avg. Interval Width&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../validation_files/validation_14_0.png" /></p>
<p><img alt="png" src="../validation_files/validation_14_1.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>