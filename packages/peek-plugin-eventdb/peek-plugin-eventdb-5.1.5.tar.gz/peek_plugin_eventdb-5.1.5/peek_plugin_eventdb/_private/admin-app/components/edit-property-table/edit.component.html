<nz-card>
    <div>
        <button nz-button nzType="primary" (click)="handleSave()">Save</button>
        <button nz-button nzType="default" (click)="handleReset()">
            Reset
        </button>
    </div>

    <nz-table #propertyTable [nzData]="items$ | async" nzSize="small">
        <thead>
            <tr>
                <th nzWidth="60px" nzShowExpand>Values</th>
                <th>Model Set</th>
                <th>Key</th>
                <th>Name</th>
                <th nzWidth="100px">Order</th>
                <th>Comment</th>
                <th nzWidth="100px">Filter</th>
                <th nzWidth="100px">Display</th>
                <th nzWidth="100px">Popup</th>
                <th nzWidth="60px">
                    <button
                        nz-button
                        nzType="default"
                        nzShape="circle"
                        (click)="handleAdd()"
                    >
                        <i nz-icon nzType="plus"></i>
                    </button>
                </th>
            </tr>
        </thead>
        <tbody>
            <ng-container
                *ngFor="let item of propertyTable.data; let i = index"
            >
                <tr>
                    <td [(nzExpand)]="item.uiExpandValues"></td>
                    <td>
                        <nz-select [(ngModel)]="item.modelSetId">
                            <nz-option
                                *ngFor="let set of modelSets$ | async"
                                [nzValue]="set.id"
                                [nzLabel]="set.name"
                            >
                            </nz-option>
                        </nz-select>
                        <nz-badge
                            *ngIf="!item.isValid"
                            nzColor="red"
                        ></nz-badge>
                    </td>
                    <td>
                        <input
                            nz-input
                            [(ngModel)]="item.key"
                            placeholder="exampleKey"
                        />
                    </td>
                    <td>
                        <input
                            nz-input
                            [(ngModel)]="item.name"
                            placeholder="Example Name"
                        />
                    </td>
                    <td>
                        <nz-input-number
                            [(ngModel)]="item.order"
                            [nzMin]="1"
                            [nzMax]="100"
                            [nzStep]="1"
                        >
                        </nz-input-number>
                    </td>
                    <td>
                        <input
                            nz-input
                            [(ngModel)]="item.comment"
                            placeholder="Comment"
                        />
                    </td>
                    <td>
                        <nz-switch [(ngModel)]="item.useForFilter"></nz-switch>
                    </td>
                    <td>
                        <nz-switch [(ngModel)]="item.useForDisplay"></nz-switch>
                    </td>
                    <td>
                        <nz-switch [(ngModel)]="item.useForPopup"></nz-switch>
                    </td>
                    <td>
                        <button
                            nz-button
                            nzType="default"
                            nzShape="circle"
                            (click)="handleRemove(i)"
                        >
                            <i nz-icon nzType="close"></i>
                        </button>
                    </td>
                </tr>

                <tr [nzExpand]="item.useForDisplay || item.useForFilter">
                    <td colspan="10">
                        <div class="display-options">
                            <ng-container *ngIf="item.useForDisplay">
                                <span>Show on Summary</span>
                                <nz-switch
                                    [(ngModel)]="
                                        item.displayByDefaultOnSummaryView
                                    "
                                >
                                </nz-switch>

                                <span>Show on Detail</span>
                                <nz-switch
                                    [(ngModel)]="
                                        item.displayByDefaultOnDetailView
                                    "
                                >
                                </nz-switch>
                            </ng-container>

                            <ng-container *ngIf="item.useForFilter">
                                <span>Show filter as:</span>
                                <nz-select [(ngModel)]="item.showFilterAs">
                                    <nz-option
                                        *ngFor="
                                            let option of showFilterAsOptions
                                        "
                                        [nzValue]="option.num"
                                        [nzLabel]="option.text"
                                    >
                                    </nz-option>
                                </nz-select>
                            </ng-container>
                        </div>
                    </td>
                </tr>

                <tr [nzExpand]="item.uiExpandValues">
                    <td colspan="10" class="nested-table">
                        <nz-table
                            #valueTable
                            [nzData]="item.valuesFromAdminUi"
                            nzSize="small"
                        >
                            <thead>
                                <tr>
                                    <th>Value</th>
                                    <th>Name</th>
                                    <th>Color</th>
                                    <th>Comment</th>
                                    <th nzWidth="60px">
                                        <button
                                            nz-button
                                            nzType="default"
                                            nzShape="circle"
                                            (click)="handleAddValue(item)"
                                        >
                                            <i nz-icon nzType="plus"></i>
                                        </button>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr
                                    *ngFor="
                                        let value of valueTable.data;
                                        let vi = index
                                    "
                                >
                                    <td>
                                        <input
                                            nz-input
                                            [(ngModel)]="value.value"
                                            placeholder="Value"
                                        />
                                    </td>
                                    <td>
                                        <input
                                            nz-input
                                            [(ngModel)]="value.name"
                                            placeholder="Name"
                                        />
                                    </td>
                                    <td>
                                        <input
                                            nz-input
                                            [(ngModel)]="value.color"
                                            placeholder="Color"
                                        />
                                    </td>
                                    <td>
                                        <input
                                            nz-input
                                            [(ngModel)]="value.comment"
                                            placeholder="Comment"
                                        />
                                    </td>
                                    <td>
                                        <button
                                            nz-button
                                            nzType="default"
                                            nzShape="circle"
                                            (click)="
                                                handleRemoveValue(item, vi)
                                            "
                                        >
                                            <i nz-icon nzType="close"></i>
                                        </button>
                                        <nz-badge
                                            *ngIf="!value.isValid"
                                            nzColor="red"
                                        >
                                        </nz-badge>
                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </nz-table>
</nz-card>
