<button (click)="handleModalOpen()" nz-button nzType="default">
    <span nz-icon nzType="table" nzTheme="outline"></span> Columns
</button>

<nz-modal
    (nzOnCancel)="handleModalCancel()"
    [nzVisible]="isVisible$ | async"
    [nzFooter]="modalFooter"
    nzTitle="Events Columns"
>
    <ng-container *nzModalContent>
        <div class="column-container">
            <div class="select-container">
                <nz-alert
                    *ngIf="(selectedProps$ | async)?.length === 0"
                    nzType="warning"
                    nzMessage="Please select at least one column"
                    [nzShowIcon]="true"
                ></nz-alert>
                <nz-select
                    [ngModel]="selectedProps$ | async"
                    (ngModelChange)="updateState({ selectedProps: $event })"
                    nzMode="multiple"
                    nzPlaceHolder="Select columns to display"
                    [nzShowSearch]="true"
                    nzAllowClear="false"
                >
                    <nz-option
                        *ngFor="let prop of allProps$ | async"
                        [nzLabel]="prop.name"
                        [nzValue]="prop.key"
                        [nzDisabled]="
                            (selectedProps$ | async)?.length === 1 &&
                            (selectedProps$ | async)?.includes(prop.key)
                        "
                    ></nz-option>
                </nz-select>
                <small class="hint-text"
                    >Select columns to display in the events table</small
                >
            </div>
        </div>
    </ng-container>
</nz-modal>

<ng-template #modalFooter>
    <div class="modal-footer">
        <button
            (click)="handleDefaultReset()"
            nz-button
            nzDanger="true"
            [disabled]="isOkLoading$ | async"
        >
            Reset Defaults
        </button>

        <div class="modal-footer-right">
            <button
                (click)="handleModalCancel()"
                nz-button
                nzType="default"
                [disabled]="isOkLoading$ | async"
            >
                Cancel
            </button>
            <button
                (click)="handleModalApply()"
                [nzLoading]="isOkLoading$ | async"
                nz-button
                nzType="primary"
                [disabled]="!(selectedProps$ | async)?.length"
            >
                Apply
            </button>
        </div>
    </div>
</ng-template>
