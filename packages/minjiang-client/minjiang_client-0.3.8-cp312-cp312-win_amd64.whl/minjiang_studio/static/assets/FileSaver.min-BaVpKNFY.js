import{P as se,u as W,G as le,d as ee,e as J,f as E,h as Q,bj as pe,bk as Pe,i as y,w as C,ab as xe,ac as Ge,E as D,s as te,z as Y,t as ne,B as N,l as a,K as Xe,b as me,bl as be,a3 as Ce,C as ve,r as S,aT as ze,Q as i,N as Z,ag as ge,R as Je,S as Qe,a4 as de,D as We,M as ie,U as Ie,V as Ye,L as ye,v as he,a2 as He,bm as X,J as Te,k as Ze,m as De,p as et,bn as Me,n as Ae,b5 as tt,aa as nt,aQ as at,ae as Fe,a8 as Ee,bo as ot,o as st,aY as rt,b0 as it,b1 as lt,aX as ue}from"./index-CvCv8tjC.js";import{a as $e,_ as qe}from"./Tabs-CqcYRKXl.js";import{m as ut}from"./exp-BIf1sWJ4.js";import{c as fe}from"./index-D5YeMwg8.js";import{C as oe}from"./Copy16Filled-cQpDZe19.js";import{H as Ve}from"./HandRight24Filled-Bscs9-Ei.js";import{_ as Re}from"./Popconfirm-DNmDyeOO.js";import{i as ct}from"./json-editor-vue-BvJIz9SG.js";import{R as pt}from"./Reload-CiqI3T8w.js";import{N as dt}from"./Switch-1B_VZ16h.js";function ft(h){return se(W.getParamsByTree,h)}function Be(h){return se(W.submitParams,h)}function Ke(h){return se(W.removeParams,h)}function mt(h){return le(W.getHistoryParams,h)}function vt(h){return le(W.searchSpaceParameters,h)}function Kt(){return le(W.getSpaceInitializerList)}function Nt(h){return le(W.getSpaceInitializerSetup,h)}function Gt(h){return se(W.spaceInitializerPreview,h)}function Xt(h){return se(W.submitInitializerPreview,h)}function Jt(h){return se(W.insertSpace,h)}function Qt(h){return le(W.getSpaceAbstract,h)}const yt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},ke=ee({name:"AddCircle16Filled",render:function(q,g){return E(),J("svg",yt,g[0]||(g[0]=[Q("g",{fill:"none"},[Q("path",{d:"M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8zm6-3a.5.5 0 0 0-.5.5v2h-2a.5.5 0 0 0 0 1h2v2a.5.5 0 0 0 1 0v-2h2a.5.5 0 0 0 0-1h-2v-2A.5.5 0 0 0 8 5z",fill:"currentColor"})],-1)]))}}),ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Wt=ee({name:"ArrowDownload24Filled",render:function(q,g){return E(),J("svg",ht,g[0]||(g[0]=[Q("g",{fill:"none"},[Q("path",{d:"M5.25 20.5h13.498a.75.75 0 0 1 .101 1.494l-.101.006H5.25a.75.75 0 0 1-.102-1.493l.102-.007h13.498H5.25zm6.633-18.497L12 1.996a1 1 0 0 1 .993.883l.007.117v12.59l3.294-3.293a1 1 0 0 1 1.32-.083l.094.083a1 1 0 0 1 .083 1.32l-.083.095l-4.997 4.996a1 1 0 0 1-1.32.084l-.094-.083l-5.004-4.997a1 1 0 0 1 1.32-1.498l.094.083L11 15.58V2.996a1 1 0 0 1 .883-.993L12 1.996l-.117.007z",fill:"currentColor"})],-1)]))}}),_t={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},we=ee({name:"RefreshCircle",render:function(q,g){return E(),J("svg",_t,g[0]||(g[0]=[Q("path",{d:"M256 48C141.31 48 48 141.32 48 256c0 114.86 93.14 208 208 208c114.69 0 208-93.31 208-208c0-114.87-93.13-208-208-208zm0 313a94 94 0 0 1 0-188h4.21l-14.11-14.1a14 14 0 0 1 19.8-19.8l40 40a14 14 0 0 1 0 19.8l-40 40a14 14 0 0 1-19.8-19.8l18-18c-2.38-.1-5.1-.1-8.1-.1a66 66 0 1 0 66 66a14 14 0 0 1 28 0a94.11 94.11 0 0 1-94 94z",fill:"currentColor"},null,-1)]))}}),gt={class:"flex justify-between items-center gap-2"},kt={key:0},wt={key:0,class:"flex justify-center w-full"},xt=ee({__name:"CategoryTabs",props:pe({readOnly:{type:Boolean},tabs:{}},{modelValue:{},modelModifiers:{}}),emits:pe(["insert","refresh"],["update:modelValue"]),setup(h,{emit:q}){const g=q,k=Pe(h,"modelValue"),I=(v="")=>{g("insert",{full_key:v})},x=()=>{g("refresh")};return(v,O)=>{const b=N,l=qe,r=$e;return E(),J("div",null,[y(r,{type:"card",placement:"left",value:k.value,"onUpdate:value":O[1]||(O[1]=u=>k.value=u),class:"tabs",style:{"max-height":"calc(100vh - 340px)"}},{suffix:C(()=>[v.readOnly?Y("",!0):(E(),J("div",wt,[y(b,{type:"info",quaternary:"",onClick:O[0]||(O[0]=()=>I()),size:"small"},{icon:C(()=>[y(a(ke))]),_:1}),y(b,{type:"info",quaternary:"",onClick:x,size:"small"},{icon:C(()=>[y(a(we))]),_:1})]))]),default:C(()=>[(E(!0),J(xe,null,Ge(v.tabs,(u,m)=>(E(),D(l,{name:u.node_name,class:"!flex-1 w-full",key:m},{default:C(()=>[Q("div",gt,[te(ne(u.node_name)+" ",1),v.readOnly?Y("",!0):(E(),J("div",kt,[y(b,{type:"info",quaternary:"",onClick:()=>I(u.full_key),size:"small"},{icon:C(()=>[y(a(ke))]),_:2},1032,["onClick"]),y(b,{type:"info",quaternary:"",onClick:x,size:"small"},{icon:C(()=>[y(a(we))]),_:1})]))])]),_:2},1032,["name"]))),128))]),_:1},8,["value"])])}}}),bt=Xe(xt,[["__scopeId","data-v-6fd4e427"]]),Ct={class:"flex justify-end w-full"},It={class:"flex gap-2 items-center"},Se=ee({__name:"ParamsHistory",props:{spaceId:{},hkey:{},maxHeight:{},hideHistoryOption:{type:Boolean},hideRevertOption:{type:Boolean}},emits:["update:success","close:modal"],setup(h,{expose:q,emit:g}){const k=h,I=g,{t:x}=me(),{copy:v,isSupported:O}=be({legacy:!0}),b=Ce(),l=ve(),r=S(!1),u=S("globalOverview"),m=S(),_=S({show:!1,info:{k_full:void 0}}),P=async d=>{v(d),b.success(x("common.copied"))},z=ze(async d=>{const[c,o]=await Be({keys:[d.k_full],values:[d.v],types:[d.t],device_group_name:l.query.device_group_name,space_id:k.spaceId});if(!c&&(o==null?void 0:o.status)===0){b.success(x("groupDetail.parameterManager.revertSuccess"));const p=d.k_full.replace(/(.*)\/.*$/,"$1").split("/");I("update:success",fe(p),!1),F()}},300),V=ze(d=>{_.value={show:!0,info:d}},300),j=[{title:x("groupDetail.parameterManager.keyPath"),key:"k_full",render:d=>i("div",{class:"inline-flex gap-2"},[i("div",d.k_full),O.value?i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>{P(d.k_full)}},{default:()=>i(oe)}):void 0])},{title:x("groupDetail.parameterManager.dataType"),key:"t",width:100},{title:x("groupDetail.parameterManager.value"),key:"v",render:d=>{if(d.v)return i("div",{class:"flex gap-2"},[i(ge,{tooltip:{show:!1}},{default:()=>d.v}),O.value?i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>{P(d.v)}},{default:()=>i(oe)}):void 0])}},{title:x("groupDetail.parameterManager.time"),key:"timestamp",width:180},{title:x("createuser"),key:"user_name"},{title:x("groupDetail.parameterManager.options"),key:"options",width:!k.hideHistoryOption&&!k.hideRevertOption?160:90,align:"center",render:d=>i("div",{class:"flex justify-center"},fe([k.hideRevertOption?null:i(Re,{onPositiveClick:()=>z(d),placement:"left"},{default:()=>x("groupDetail.parameterManager.revertConfirm"),trigger:()=>i(N,{quaternary:!0,type:"info",size:"small"},{default:()=>x("groupDetail.parameterManager.optionRevert")})}),k.hideHistoryOption?void 0:i(N,{size:"small",type:"info",quaternary:!0,onClick:()=>V(d)},{default:()=>x("groupDetail.parameterManager.optionHistory")})]))}],K=d=>({class:d.deleted_flag?"removed":""}),M=Je({page:1,per_page:Qe,total:0}),F=async()=>{if(r.value)return;r.value=!0;const d=l.query.device_group_name;if(!k.spaceId||!d)return;const[c,o]=await mt({device_group_name:d,space_id:k.spaceId,key:k.hkey,page:M.page,per_page:M.per_page});r.value=!1,!c&&(o==null?void 0:o.status)===0&&(m.value=o.data.list,M.total=o.data.total)};de(()=>k.spaceId,d=>{d&&F()},{immediate:!0}),q({refresh:F});const B=d=>{d||(_.value={show:!1,info:{k_full:void 0}},I("close:modal"))};return(d,c)=>{const o=qe,p=$e,R=Ie,U=We("params-history",!0),G=he,t=ye;return E(),J("div",null,[y(p,{value:a(u),"onUpdate:value":c[1]||(c[1]=s=>ie(u)?u.value=s:null),class:"!h-full",disabled:a(r)},{suffix:C(()=>[Q("div",Ct,[y(a(N),{type:"primary",onClick:c[0]||(c[0]=()=>F())},{icon:C(()=>[y(a(pt))]),default:C(()=>[te(" "+ne(a(x)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),default:C(()=>[y(o,{name:"globalOverview"},{default:C(()=>[Q("div",It,[te(ne(a(x)("groupDetail.parameterManager.globalHistory"))+" ",1),d.hkey?(E(),J(xe,{key:0},[te(" -  [  "+ne(d.hkey)+"  ] ",1)],64)):Y("",!0)])]),_:1})]),_:1},8,["value","disabled"]),y(R,{columns:j,data:a(m),pagination:!1,"row-props":K,loading:a(r),"max-height":d.maxHeight||"calc(100vh - 420px)",class:"mt-5"},null,8,["data","loading","max-height"]),y(Ye,{"page-info":a(M),"onUpdate:pageInfo":c[2]||(c[2]=s=>ie(M)?M.value=s:null),onUpdateList:F},null,8,["page-info"]),y(t,{show:a(_).show,"onUpdate:show":c[3]||(c[3]=s=>a(_).show=s),size:"huge",onUpdateShow:B},{default:C(()=>[y(G,{style:{"min-height":"400px",overflow:"auto",width:"1200px","min-width":"500px"}},{default:C(()=>{var s;return[y(U,{"max-height":d.maxHeight,"space-id":d.spaceId,hkey:(s=a(_).info)==null?void 0:s.k_full,"hide-history-option":!0,"hide-revert-option":d.hideRevertOption,"onUpdate:success":F},null,8,["max-height","space-id","hkey","hide-revert-option"])]}),_:1})]),_:1},8,["show"])])}}}),Mt={class:"flex gap-5"},Rt={class:"float-right"},Ne=ee({__name:"ParamsAction",props:{info:{},spaceId:{},actionTye:{},hideParentTree:{type:Boolean},showHistoryEntry:{type:Boolean}},emits:["update:success","ok","update:hisotry:success"],setup(h,{expose:q,emit:g}){const{t:k}=me(),I=ve(),x=He(),v=S(!1),O=S(!1),b=h,l=g,r=S(null),u=S({types:X.str,keys:void 0,values:void 0}),m=S({keys:{required:!0},values:{required:!0},types:{required:!0}}),_=[X.float,X.str,X.int,X.complex],P=[X.list,X.tuple,X.dict,X.ndarray],z=()=>{O.value=!1,u.value={types:X.str,keys:void 0,values:void 0}},V=o=>{o||(u.value={types:X.str,keys:void 0,values:void 0})},j=Te(()=>{var o,p;if((o=u.value)!=null&&o.types)return(p=u.value)==null?void 0:p.types}),K=()=>{var o;v.value||(v.value=!0,(o=r.value)==null||o.validate(async p=>{var w;if(p){v.value=!1;return}if(b.actionTye==="custom"){l("ok",u.value),z(),v.value=!1;return}const{keys:R,values:U,types:G}=u.value,[t,s]=await Be({keys:[`${F.value}/${R}`],values:[U||""],types:[G],device_group_name:I.query.device_group_name,space_id:b.spaceId});v.value=!1,!t&&(s==null?void 0:s.status)===0&&(z(),l("update:success",((w=F.value)==null?void 0:w.split("/"))||[]))}))},M=o=>{u.value=o},F=Te(()=>{var o,p,R,U;return((o=b.info)==null?void 0:o.type)==="add"?(p=b.info)==null?void 0:p.full_key:(U=(R=b.info)==null?void 0:R.full_key)==null?void 0:U.replace(/(.*)\/.*$/,"$1")}),B=S(!1),d=()=>{B.value=!0},c=()=>{l("update:success")};return de(B,o=>{o&&z()}),q({open:()=>O.value=!0,close:z,setFormValue:M}),(o,p)=>{const R=et,U=De,G=Ae,t=dt,s=N,w=Ze,L=he,e=ye;return E(),J(xe,null,[y(e,{show:a(O),"onUpdate:show":p[5]||(p[5]=n=>ie(O)?O.value=n:null),size:"huge",onUpdateShow:V},{default:C(()=>[y(L,{style:{"min-height":"400px",overflow:"auto",width:"800px","min-width":"500px"}},{default:C(()=>[y(w,{model:a(u),rules:a(m),ref_key:"formRef",ref:r},{default:C(()=>[Q("div",Mt,[y(U,{label:"Type",path:"types",class:"w-40"},{default:C(()=>[y(R,{options:a(Me),value:a(u).types,"onUpdate:value":p[0]||(p[0]=n=>a(u).types=n)},null,8,["options","value"])]),_:1}),y(U,{label:"Key",path:"keys",class:"flex-1"},{default:C(()=>{var n;return[y(G,{value:a(u).keys,"onUpdate:value":p[1]||(p[1]=f=>a(u).keys=f),disabled:((n=o.info)==null?void 0:n.type)==="edit"},tt({_:2},[o.hideParentTree?void 0:{name:"prefix",fn:C(()=>[te(ne(a(F))+"/ ",1)]),key:"0"}]),1032,["value","disabled"])]}),_:1})]),y(U,{label:"Value",path:"values"},{default:C(()=>[a(j)&&_.includes(a(j))?(E(),D(G,{key:0,value:a(u).values,"onUpdate:value":p[2]||(p[2]=n=>a(u).values=n)},null,8,["value"])):Y("",!0),a(j)&&a(j)===a(X).bool?(E(),D(t,{key:1,value:a(u).values,"onUpdate:value":p[3]||(p[3]=n=>a(u).values=n)},null,8,["value"])):Y("",!0),a(j)&&P.includes(a(j))?(E(),D(a(ct),{key:2,class:nt(["w-full max-h-[65vh] overflow-auto",[a(x).baseColor==="#000"?"jse-theme-dark":""]]),modelValue:a(u).values,"onUpdate:modelValue":p[4]||(p[4]=n=>a(u).values=n),mode:"text"},null,8,["class","modelValue"])):Y("",!0)]),_:1}),Q("div",Rt,[o.showHistoryEntry?(E(),D(s,{key:0,type:"info",class:"!mr-2",onClick:d},{default:C(()=>[te(ne(a(k)("groupDetail.parameterManager.history")),1)]),_:1})):Y("",!0),y(s,{type:"primary",loading:a(v),onClick:K},{default:C(()=>[te(ne(a(k)("common.OK")),1)]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),y(e,{show:a(B),"onUpdate:show":p[7]||(p[7]=n=>ie(B)?B.value=n:null),size:"huge"},{default:C(()=>[y(L,{style:{"min-height":"400px",overflow:"auto",width:"1000px","min-width":"500px"}},{default:C(()=>{var n;return[y(Se,{"max-height":"auto","space-id":o.spaceId?Number(o.spaceId):void 0,hkey:(n=o.info)==null?void 0:n.full_key,"hide-history-option":"","onClose:modal":p[6]||(p[6]=()=>B.value=!1),"onUpdate:success":c},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])],64)}}});var _e,Le;function St(){if(Le)return _e;Le=1;var h=9007199254740991,q="[object Arguments]",g="[object Function]",k="[object GeneratorFunction]",I=/^(?:0|[1-9]\d*)$/;function x(e,n){for(var f=-1,H=e?e.length:0;++f<H&&n(e[f],f,e)!==!1;);return e}function v(e,n){for(var f=-1,H=Array(e);++f<e;)H[f]=n(f);return H}function O(e,n){return function(f){return e(n(f))}}var b=Object.prototype,l=b.hasOwnProperty,r=b.toString,u=b.propertyIsEnumerable,m=O(Object.keys,Object);function _(e,n){var f=o(e)||c(e)?v(e.length,String):[],H=f.length,T=!!H;for(var $ in e)l.call(e,$)&&!(T&&($=="length"||F($,H)))&&f.push($);return f}var P=K(V),z=M();function V(e,n){return e&&z(e,n,w)}function j(e){if(!B(e))return m(e);var n=[];for(var f in Object(e))l.call(e,f)&&f!="constructor"&&n.push(f);return n}function K(e,n){return function(f,H){if(f==null)return f;if(!p(f))return e(f,H);for(var T=f.length,$=-1,A=Object(f);++$<T&&H(A[$],$,A)!==!1;);return f}}function M(e){return function(n,f,H){for(var T=-1,$=Object(n),A=H(n),ae=A.length;ae--;){var re=A[++T];if(f($[re],re,$)===!1)break}return n}}function F(e,n){return n=n??h,!!n&&(typeof e=="number"||I.test(e))&&e>-1&&e%1==0&&e<n}function B(e){var n=e&&e.constructor,f=typeof n=="function"&&n.prototype||b;return e===f}function d(e,n){var f=o(e)?x:P;return f(e,typeof n=="function"?n:L)}function c(e){return R(e)&&l.call(e,"callee")&&(!u.call(e,"callee")||r.call(e)==q)}var o=Array.isArray;function p(e){return e!=null&&G(e.length)&&!U(e)}function R(e){return s(e)&&p(e)}function U(e){var n=t(e)?r.call(e):"";return n==g||n==k}function G(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=h}function t(e){var n=typeof e;return!!e&&(n=="object"||n=="function")}function s(e){return!!e&&typeof e=="object"}function w(e){return p(e)?_(e):j(e)}function L(e){return e}return _e=d,_e}var Ot=St();const je=at(Ot),zt={class:"flex gap-5"},Yt=ee({__name:"ParamsLatest",props:{spaceId:{},maxHeight:{},readOnly:{type:Boolean},version:{}},setup(h,{expose:q}){const g=h,k=ve(),{t:I}=me(),{copy:x,isSupported:v}=be({legacy:!0}),O=Ce(),b=S(),l=S(!1),r=S(),u=S(),m=S({show:!1,info:void 0}),_=S(),P=S(),z=S(),V=t=>{x(t),O.success(I("common.copied"))},j=t=>{var s;(s=_.value)==null||s.open(),P.value={...t,type:"add"}},K=t=>{var s,w;(s=_.value)==null||s.open(),(w=_.value)==null||w.setFormValue({types:t.t,keys:t.node_name,values:t.v}),P.value={...t,type:"edit"}},M=(t,s,w)=>{const L=JSON.parse(JSON.stringify(u.value));let e=!1;const n=(f,H)=>{je(f,(T,$)=>{var A;if(e)return!1;if(T.full_key===t){switch(s){case"rchildren":delete T.children;break;case"rself":(A=H.children)==null||A.splice($,1);break;case"update":w&&(T.children=w);break;case"insert":T.children=w}return e=!0,!1}T.children&&n(T.children,T)})};n(L,{children:L}),u.value=L},F=async t=>{const[s,w]=await Ke({key:t.full_key,device_group_name:k.query.device_group_name,space_id:g.spaceId});!s&&(w==null?void 0:w.status)===0&&M(t.full_key,"rself")},B=(t,s)=>{var w;R(t,void 0,s!==void 0?s:((w=P.value)==null?void 0:w.type)==="add")},d=t=>{m.value={show:!0,info:t}},c=()=>{R([r.value])},o=t=>{R(t.full_key.split("/"));const s=(z.value||[]).concat(t.full_key);z.value=[...new Set(s)]},p=[{title:I("groupDetail.parameterManager.key"),key:"node_name",render:t=>t.expandable?i("div",{class:"inline-flex items-center gap-1"},fe([i("span",t.node_name),g.readOnly?null:i(N,{quaternary:!0,type:"info",size:"small",onClick:()=>j(t)},{icon:()=>i(ke)}),g.readOnly?null:i(N,{quaternary:!0,type:"info",size:"small",onClick:()=>o(t)},{icon:()=>i(we)})])):i("div",{class:"inline-flex gap-2"},[i("div",t.node_name),v.value?i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>V(t.full_key)},{default:()=>i(oe)}):void 0])},{title:I("groupDetail.parameterManager.dataType"),key:"t",width:100,render:t=>{if(t.expandable)return;const s=Me.find(w=>w.value===t.t);return i(Fe,{size:"small",bordered:!1,color:{textColor:"#fff",color:(s==null?void 0:s.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>t.t})}},{title:I("groupDetail.parameterManager.value"),key:"v",render:t=>t.expandable?t.v:i("div",{class:"flex gap-2"},[i(ge,{tooltip:{show:!1}},{default:()=>t.v}),v.value?i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>V(t.v)},{default:()=>i(oe)}):void 0])},{title:I("groupDetail.parameterManager.paramsDesc"),key:"desc",render:t=>t.expandable?t.v:i("div",{class:"flex gap-2"},[i(ge,{class:"opacity-80"},{default:()=>t.desc})])}];g.readOnly||p.push({title:I("groupDetail.parameterManager.options"),key:"options",width:260,align:"center",render:t=>{if(!(t!=null&&t.isLeaf))return;const s={quaternary:!0,type:"info",size:"small"},w=i(N,{...s,onClick:()=>{K(t)}},{default:()=>I("groupDetail.parameterManager.optionEdit")}),L=i(N,{...s,onClick:()=>d(t)},{default:()=>I("groupDetail.parameterManager.optionHistory")}),e=i(Re,{onPositiveClick:()=>F(t)},{default:()=>I("groupDetail.parameterManager.removeConfirm"),icon:()=>i(Z,{color:"#e88080",size:22},i(Ve)),trigger:()=>i(N,{...s,type:"error"},{default:()=>I("groupDetail.parameterManager.optionRemove")})});return i("div",{class:"flex justify-end"},[w,L,e])}});const R=async(t=[],s,w)=>{var e;if(!g.spaceId||l.value)return;l.value=!0;const L=fe(t);try{const[n,f]=await ft({device_group_name:k.query.device_group_name,space_id:g.spaceId,parent_tree:L,version:g.version});if(l.value=!1,n||(f==null?void 0:f.status)!==0)return;if(L.length===0){b.value=f.data,f.data&&f.data.length>0&&R([f.data[0].node_name]),Ee(f.data)&&(u.value=[]);return}const H="/"+L.join("/"),T=f.data.map(A=>({...A,isLeaf:!A.expandable})),$=(e=T.filter(A=>A.isLeaf))==null?void 0:e.map(A=>A.full_key);if(!Ee($)){const[A,ae]=await ut({full_key_list:$.join(","),language:localStorage.getItem("lang")||"en"});!A&&(ae==null?void 0:ae.status)===0&&je(T,re=>{const Oe=ae.data[re.full_key];Oe&&(re.desc=Oe)})}if(s)return s.resolve(),T;L.length===1?u.value=T:w?M(H,"insert",T):M(H,"update",T)}catch{s&&s.reject(),l.value=!1}},U=t=>new Promise(async(s,w)=>{const L=await R(t.full_key.split("/"),{resolve:s,reject:w});t.children=L}),G=t=>{const[s]=ot(z.value,t);s&&M(s,"rchildren"),z.value=t};return de(()=>g.spaceId,t=>{t&&R()},{immediate:!0}),de(r,t=>{t&&(z.value=[],u.value=[],R([t]))}),q({refresh:R}),(t,s)=>{const w=Ie,L=he,e=ye;return E(),J("div",zt,[a(b)?(E(),D(bt,{key:0,tabs:a(b),modelValue:a(r),"onUpdate:modelValue":s[0]||(s[0]=n=>ie(r)?r.value=n:null),onInsert:j,onRefresh:c,"read-only":t.readOnly},null,8,["tabs","modelValue","read-only"])):Y("",!0),y(w,{size:"small","max-height":t.maxHeight?t.maxHeight:"calc(100vh - 340px)",columns:p,data:a(u),loading:a(l),"row-key":n=>n.full_key,"expanded-row-keys":a(z),onLoad:U,onUpdateExpandedRowKeys:G},null,8,["max-height","data","loading","row-key","expanded-row-keys"]),t.spaceId?(E(),D(Ne,{key:1,info:a(P),ref_key:"actionInfoRef",ref:_,"space-id":t.spaceId,"onUpdate:success":B},null,8,["info","space-id"])):Y("",!0),y(e,{show:a(m).show,"onUpdate:show":s[1]||(s[1]=n=>a(m).show=n),size:"huge"},{default:C(()=>[y(L,{style:{"min-height":"400px",overflow:"auto",width:"1000px","min-width":"500px"}},{default:C(()=>{var n;return[y(Se,{"max-height":"auto","space-id":t.spaceId,hkey:(n=a(m).info)==null?void 0:n.full_key,"hide-history-option":"","onUpdate:success":B},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])])}}}),Tt={class:"relative mb-2 w-[450px]"},Zt=ee({__name:"ParamsSearch",props:pe({spaceId:{}},{modelValue:{},modelModifiers:{}}),emits:pe(["refresh"],["update:modelValue"]),setup(h,{emit:q}){const g=q,k=h,I=ve(),x=He(),{t:v}=me(),{copy:O,isSupported:b}=be({legacy:!0}),l=Ce(),r=S(!1),u=S(),m=Pe(h,"modelValue"),_=S({show:!1,info:void 0}),P=S(),z=S(),V=c=>{O(c),l.success(v("common.copied"))},j=c=>{var o,p;(o=P.value)==null||o.open(),(p=P.value)==null||p.setFormValue({types:c.t,keys:c.full_key.replace(/^.*\/([^\/]*)$/,"$1"),values:c.v}),z.value={...c,type:"edit"}},K=async c=>{const[o,p]=await Ke({key:c.full_key,device_group_name:I.query.device_group_name,space_id:k.spaceId});!o&&(p==null?void 0:p.status)===0&&(d(),g("refresh"))},M=()=>{d(),g("refresh")},F=c=>{_.value={show:!0,info:c}},B=[{title:v("groupDetail.parameterManager.key"),key:"full_key",render:c=>i("div",{class:"inline-flex gap-2"},[i("div",c.full_key),i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>V(c.full_key)},{default:()=>i(oe)})])},{title:v("groupDetail.parameterManager.dataType"),key:"t",width:100,render:c=>{if(c.expandable)return;const o=Me.find(p=>p.value===c.t);return i(Fe,{size:"small",bordered:!1,color:{textColor:"#fff",color:(o==null?void 0:o.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>c.t})}},{title:v("groupDetail.parameterManager.value"),key:"v",ellipsis:{tooltip:!0},render:c=>c.expandable?c.v:i("div",{class:"flex gap-2"},[i("div",c.v),b.value?i(Z,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>V(c.v)},{default:()=>i(oe)}):void 0])},{title:v("groupDetail.parameterManager.options"),key:"options",width:260,align:"center",render:c=>{const o={quaternary:!0,type:"info",size:"small"},p=i(N,{...o,onClick:()=>{j(c)}},{default:()=>v("groupDetail.parameterManager.optionEdit")}),R=i(N,{...o,onClick:()=>F(c)},{default:()=>v("groupDetail.parameterManager.optionHistory")}),U=i(Re,{onPositiveClick:()=>K(c),placement:"left-start"},{default:()=>v("groupDetail.parameterManager.removeConfirm"),icon:()=>i(Z,{color:"#e88080",size:22},i(Ve)),trigger:()=>i(N,{...o,type:"error"},{default:()=>v("groupDetail.parameterManager.optionRemove")})});return i("div",{class:"flex justify-end"},[p,R,U])}}],d=async()=>{var p;if(!((p=m.value)!=null&&p.trim())||!k.spaceId||r.value)return;r.value=!0;const[c,o]=await vt({device_group_name:I.query.device_group_name,space_id:k.spaceId,search_word:m.value});r.value=!1,(c||(o==null?void 0:o.status)==0)&&(u.value=o==null?void 0:o.data)};return st(()=>{rt(()=>{setTimeout(()=>{d()},200)})}),(c,o)=>{const p=Ae,R=Ie,U=he,G=ye;return E(),J("div",null,[Q("div",Tt,[y(p,{style:{width:"450px","padding-right":"20px"},value:m.value,"onUpdate:value":o[0]||(o[0]=t=>m.value=t),valueModifiers:{trim:!0},placeholder:a(v)("groupDetail.parameterManager.searchPlaceholder"),onKeyup:it(d,["enter"])},null,8,["value","placeholder"]),Q("div",{class:"absolute -right-4 top-1/2 -translate-1/2 h-full w-8 flex items-center justify-center cursor-pointer",onClick:d},[y(a(Z),{color:a(x).primaryColor,component:a(lt)},null,8,["color","component"])])]),y(R,{size:"small","max-height":"calc(100vh - 340px)",columns:B,data:a(u),loading:a(r),"row-key":t=>t.full_key},null,8,["data","loading","row-key"]),c.spaceId?(E(),D(Ne,{key:0,info:a(z),ref_key:"actionInfoRef",ref:P,"space-id":c.spaceId,"onUpdate:success":M},null,8,["info","space-id"])):Y("",!0),y(G,{show:a(_).show,"onUpdate:show":o[1]||(o[1]=t=>a(_).show=t),size:"huge"},{default:C(()=>[y(U,{style:{"min-height":"400px",overflow:"auto",width:"1000px","min-width":"500px"}},{default:C(()=>{var t;return[y(Se,{"max-height":"auto","space-id":c.spaceId,hkey:(t=a(_).info)==null?void 0:t.full_key,"hide-history-option":"","onUpdate:success":M},null,8,["space-id","hkey"])]}),_:1})]),_:1},8,["show"])])}}});var ce={exports:{}},Et=ce.exports,Ue;function Lt(){return Ue||(Ue=1,function(h,q){(function(g,k){k()})(Et,function(){function g(l,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function k(l,r,u){var m=new XMLHttpRequest;m.open("GET",l),m.responseType="blob",m.onload=function(){b(m.response,r,u)},m.onerror=function(){console.error("could not download file")},m.send()}function I(l){var r=new XMLHttpRequest;r.open("HEAD",l,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function x(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(r)}}var v=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ue=="object"&&ue.global===ue?ue:void 0,O=v.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),b=v.saveAs||(typeof window!="object"||window!==v?function(){}:"download"in HTMLAnchorElement.prototype&&!O?function(l,r,u){var m=v.URL||v.webkitURL,_=document.createElement("a");r=r||l.name||"download",_.download=r,_.rel="noopener",typeof l=="string"?(_.href=l,_.origin===location.origin?x(_):I(_.href)?k(l,r,u):x(_,_.target="_blank")):(_.href=m.createObjectURL(l),setTimeout(function(){m.revokeObjectURL(_.href)},4e4),setTimeout(function(){x(_)},0))}:"msSaveOrOpenBlob"in navigator?function(l,r,u){if(r=r||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(g(l,u),r);else if(I(l))k(l,r,u);else{var m=document.createElement("a");m.href=l,m.target="_blank",setTimeout(function(){x(m)})}}:function(l,r,u,m){if(m=m||open("","_blank"),m&&(m.document.title=m.document.body.innerText="downloading..."),typeof l=="string")return k(l,r,u);var _=l.type==="application/octet-stream",P=/constructor/i.test(v.HTMLElement)||v.safari,z=/CriOS\/[\d]+/.test(navigator.userAgent);if((z||_&&P||O)&&typeof FileReader<"u"){var V=new FileReader;V.onloadend=function(){var M=V.result;M=z?M:M.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=M:location=M,m=null},V.readAsDataURL(l)}else{var j=v.URL||v.webkitURL,K=j.createObjectURL(l);m?m.location=K:location.href=K,m=null,setTimeout(function(){j.revokeObjectURL(K)},4e4)}});v.saveAs=b.saveAs=b,h.exports=b})}(ce)),ce.exports}var Dt=Lt();export{Wt as A,Dt as F,Ne as _,Kt as a,Nt as b,Xt as c,Yt as d,Se as e,Zt as f,Qt as g,Jt as i,Gt as s};
