import{d as F,e as D,f as m,h as i,Q as $,Y as et,Z as J,$ as mt,a0 as pt,a1 as gt,b as ft,C as vt,c as ht,a2 as yt,a3 as kt,r as E,R as j,a4 as wt,a5 as bt,E as y,w as a,i as s,W as Ct,T as Et,B as St,t as c,l as e,N as It,a6 as Q,s as p,a7 as zt,a8 as Dt,a9 as Tt,aa as Lt,ab as K,ac as Rt,ad as Nt,v as qt,z as A,ae as Mt,af as X,ag as Ot,ah as Bt,j as Ut,ai as Vt,aj as Y,ak as k,V as $t,M as jt,X as At,al as Ft,K as Pt}from"./index-CvCv8tjC.js";import{a as xt}from"./task-BzTCKWl0.js";import{s as Gt,g as Ht,a as Wt}from"./exp-BIf1sWJ4.js";import{u as Jt}from"./useInterval-BHEiX-wJ.js";import{R as Qt,D as Kt,E as Xt}from"./ExpsTpl-BHXuKP2W.js";import{c as Yt}from"./index-D5YeMwg8.js";import{u as Zt}from"./groupDetail-NvvmkxSe.js";import{C as te}from"./ChevronBack-C7yhpAg4.js";import{A as Z}from"./Add-DSV7m2CF.js";import"./DynamicForm.vue_vue_type_script_setup_true_lang-Ijfe0G_0.js";import"./json-editor-vue-BvJIz9SG.js";import"./debounce-D4NDO7dG.js";import"./InputNumber-C_LhnbBs.js";import"./Add-D6uUqg2u.js";import"./Switch-1B_VZ16h.js";import"./Tabs-CqcYRKXl.js";const ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},se=F({name:"Timer24Regular",render:function(w,g){return m(),D("svg",ee,g[0]||(g[0]=[i("g",{fill:"none"},[i("path",{d:"M12 5a8.5 8.5 0 1 1 0 17a8.5 8.5 0 0 1 0-17zm0 1.5a7 7 0 1 0 0 14a7 7 0 0 0 0-14zM12 8a.75.75 0 0 1 .743.648l.007.102v4.5a.75.75 0 0 1-1.493.102l-.007-.102v-4.5A.75.75 0 0 1 12 8zm7.147-2.886l.083.06l1.158.964a.75.75 0 0 1-.877 1.212l-.082-.06l-1.159-.964a.75.75 0 0 1 .877-1.212zM14.25 2.5a.75.75 0 0 1 .102 1.493L14.25 4h-4.5a.75.75 0 0 1-.102-1.493L9.75 2.5h4.5z",fill:"currentColor"})],-1)]))}}),ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ne=F({name:"Eye",render:function(w,g){return m(),D("svg",ae,g[0]||(g[0]=[i("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),i("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96c-42.52 0-84.33 12.15-124.27 36.11c-40.73 24.43-77.63 60.12-109.68 106.07a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416c46.71 0 93.81-14.43 136.2-41.72c38.46-24.77 72.72-59.66 99.08-100.92a32.2 32.2 0 0 0-.1-34.76zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1)]))}}),tt=(S,w)=>{var T;if(!S.length)return;const g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);const _=S.map(v=>$(et,{width:100,src:v}));let l=document.querySelector("#preview-image");if(!l){const v=document.createElement("div");v.id="preview-image",document.body.appendChild(v),l=v}_.length>1?J($(pt,{},[$(mt,{},_)]),l):J(_[0],l),(T=l==null?void 0:l.querySelectorAll(".n-image img")[w])==null||T.dispatchEvent(g)},oe={class:"flex items-center mb-5 text-xl gap-2"},ie={class:"inline-flex gap-2"},le={class:"flex justify-between"},re={class:"text-lg flex items-center gap-1.5"},ce={class:"break-keep font-bold"},ue={class:"flex items-center gap-1.5 opacity-75 text-xs mt-2"},_e={class:"flex gap-2"},de={class:"h-20 w-20 overflow-hidden"},me={key:2,class:"bg-gray-500 w-20 h-20 rounded text-center leading-4 text-xs flex items-center justify-center text-white"},pe={class:"flex gap-2 flex-col flex-1"},ge={class:"flex items-center gap-1"},fe={class:"break-all inline-block whitespace-pre-line"},ve={class:"flex justify-around items-center gap-1"},he=F({__name:"ExperimentList",setup(S){const w=Zt(),g=gt(),{t:_}=ft(),l=vt(),T=ht(),v=yt(),st=kt(),L=E(),M=j({}),h=E(!1),at=E(),P=E(),I=j({page:1,per_page:8,total:0}),x=(n,u={})=>{const o=new URLSearchParams({device_group_name:l.query.device_group_name,task_id:l.query.task_id,task_title:l.query.task_title,space_id:l.query.space_id,exp_id:String(n.exp_id),...u});window.open(`/experiment/expSettings?${o.toString()}`,g.expOpenForm)},R=E(),nt=async(n,u)=>{var f;const[o,r]=await Wt({exp_ids:n,group_name:l.query.device_group_name,create_timestamps:u,org_id:(f=w.groupInfo)==null?void 0:f.organization_id});if(!o&&(r==null?void 0:r.status)===0)return r.data},O=async n=>{var f;if(H(),!n){if(h.value)return;h.value=!0}const u=l.query.device_group_name;if(!u)return;const[o,r]=await xt({...((f=at.value)==null?void 0:f.searchParasm)||{},...At(I),task_id:l.query.task_id,device_group_name:u});if(n||(h.value=!1),G(),!o&&r&&r.status===0){const b=[],z=Yt(r.data.list.map(d=>{if(M[d.exp_id]===void 0)return b.push(d.create_timestamp),d.exp_id;d.img=M[d.exp_id]}));if(z.length>0){const d=JSON.parse(JSON.stringify(r.data.list));nt(z.join(","),b.join(",")).then(N=>{N&&(Ft(N,(q,V)=>{d.some(C=>{if(C.exp_id===+V)return C.img=q,[k.COMPLETE,k.ERROR,k.CANCELED,k.HOST_DOWNLOADED].includes(C.status)&&(M[C.exp_id]=q),!0})}),R.value=d)})}R.value=r.data.list,I.total=r.data.total}},ot=()=>{T.push({name:"taskList",query:{device_group_name:l.query.device_group_name}})},it=async n=>{h.value=!0;const[u,o]=await Gt({exp_id:n.exp_id});h.value=!1,!u&&(o==null?void 0:o.status)===0&&st.success("实验终止成功")},lt=n=>{x(n,{dup:"1"})},rt=()=>{var n;(n=P.value)==null||n.open()},ct=()=>{},{start:G,stop:H}=Jt(O,{initParams:!0,isManual:!0});wt(()=>{var n;return(n=w.groupInfo)==null?void 0:n.organization_id},n=>{n&&(O(),L.value=setTimeout(()=>{G()},5e3))},{immediate:!0}),bt(()=>{H(),L.value!==null&&clearInterval(L.value),L.value=null});const B=E(),U=j({}),ut=async n=>{if(U[String(n.exp_id)]){tt([U[String(n.exp_id)]],0);return}B.value=n.exp_id;const[u,o]=await Ht({exp_id:n.exp_id,device_group_name:l.query.device_group_name,space_id:l.query.space_id});B.value=void 0,!u&&(o==null?void 0:o.status)===0&&(tt([o.data.big_picture_url],0),U[String(n.exp_id)]=o.data.big_picture_url)};return(n,u)=>{const o=It,r=St,f=Mt,b=Ot,z=Ut,d=Vt,N=et,q=qt,V=Nt,C=Tt,W=zt,_t=Et,dt=Ct;return m(),y(d,{show:e(h)},{default:a(()=>[s(dt,{"has-sider":""},{default:a(()=>[s(_t,{class:"min-h-[500px]"},{default:a(()=>[i("div",oe,[s(r,{onClick:ot,quaternary:""},{icon:a(()=>[s(o,{size:"26"},{default:a(()=>[s(e(te))]),_:1})]),default:a(()=>[i("span",null,c(e(_)("groupDetail.exps.back")),1)]),_:1}),i("span",{class:"flex-1 text-center",style:Q({color:e(v).primaryColor})},c(e(_)("groupDetail.exps.taskTitle",{taskId:e(l).query.task_id,taskTitle:` " ${e(l).query.task_title} " `})),5),i("div",ie,[s(r,{type:"primary",onClick:rt},{default:a(()=>[s(o,null,{default:a(()=>[s(e(Z))]),_:1}),p("  "+c(e(_)("groupDetail.exps.createFromTemplate")),1)]),_:1}),s(r,{type:"primary",onClick:ct},{default:a(()=>[s(o,null,{default:a(()=>[s(e(Z))]),_:1}),p("  "+c(e(_)("groupDetail.exps.createManualTask")),1)]),_:1})])]),s(W,{style:Q({maxHeight:e(Dt)(e(R))?"200px":"calc(100vh - 350px)"})},{default:a(()=>[s(C,{cols:"4","x-gap":"20","y-gap":"20",class:Lt(["py-1 px-1.5",[e(h)?"select-none":""]])},{default:a(()=>[(m(!0),D(K,null,Rt(e(R),t=>(m(),y(V,{key:t.exp_id},{default:a(()=>[s(q,{rounded:"",style:{width:"100%"},"content-class":"!mb-0 !p-2",class:"hover:scale-103 hover:transform-gpu"},{default:a(()=>[i("div",le,[i("div",null,[i("div",re,[i("div",ce,c(t.exp_id),1),t!=null&&t.status?(m(),y(f,{key:0,color:{color:e(X)[t.status].color,textColor:"#fff"},bordered:!1,size:"small"},{default:a(()=>[p(c(e(_)(e(X)[t.status].text)),1)]),_:2},1032,["color"])):A("",!0),s(f,{size:"small",type:"info"},{default:a(()=>[p(c(t==null?void 0:t.progress),1)]),_:2},1024),t!=null&&t.source?(m(),y(f,{key:1,size:"small",type:"info"},{default:a(()=>[p(c(e(_)("groupDetail.exps.source"))+": "+c(t==null?void 0:t.source),1)]),_:2},1024)):A("",!0)]),i("div",ue,[s(o,{component:e(se)},null,8,["component"]),s(b,{"line-clamp":1},{default:a(()=>[p(c(t==null?void 0:t.create_time),1)]),_:2},1024),t!=null&&t.user_name?(m(),D(K,{key:0},[s(o,{component:e(Bt),class:"ml-2"},null,8,["component"]),i("div",null,c(t==null?void 0:t.user_name),1)],64)):A("",!0)])])]),s(b,{style:{"max-width":"100%"},class:"text-lg mt-2"},{default:a(()=>[p(c(t==null?void 0:t.title),1)]),_:2},1024),s(z,{class:"!my-3"}),i("div",_e,[i("div",de,[(t==null?void 0:t.img)===void 0?(m(),y(d,{key:0,show:!0,"content-class":"h-20"},{default:a(()=>u[1]||(u[1]=[i("div",{class:"w-20 h-20 rounded"},null,-1)])),_:1})):t!=null&&t.img?(m(),y(d,{key:1,show:e(B)===t.exp_id},{default:a(()=>[(m(),y(N,{key:t.exp_id,class:"w-20 h-20 rounded cursor-pointer",src:t==null?void 0:t.img,"preview-disabled":!0,onClick:()=>ut(t)},null,8,["src","onClick"]))]),_:2},1032,["show"])):(m(),D("div",me,c(e(_)("groupDetail.exps.noresult")),1))]),i("div",pe,[i("div",ge,[s(f,{type:"warning",size:"small",class:"!break-all"},{default:a(()=>[i("span",fe,c((t==null?void 0:t.template_name)==="-"?"No Template":t==null?void 0:t.template_name),1)]),_:2},1024)]),s(b,{style:{"max-width":"100%"},class:"opacity-75 text-xs","line-clamp":3},{default:a(()=>[p(c(t==null?void 0:t.description),1)]),_:2},1024)])]),s(z,{class:"!my-3"}),i("div",ve,[s(r,{disabled:![e(k).SERVICE_QUEUING,e(k).RUNNING,e(k).HOST_DOWNLOADED].includes(t.status),type:"info",size:"small",class:"flex-1 !px-0.5",onClick:Y(()=>it(t),["stop"])},{icon:a(()=>[s(e(Qt))]),default:a(()=>[p(" "+c(e(_)("groupDetail.exps.stop")),1)]),_:2},1032,["disabled","onClick"]),s(r,{type:"info",size:"small",class:"flex-1",onClick:Y(()=>lt(t),["stop"]),disabled:(t==null?void 0:t.exp_mode)==="batch_circuit"},{icon:a(()=>[s(e(Kt))]),default:a(()=>[p(c(e(_)("expInfo.duplicate"))+" ",1)]),_:2},1032,["onClick","disabled"]),s(r,{type:"info",size:"small",class:"flex-1",disabled:(t==null?void 0:t.exp_mode)==="batch_circuit",onClick:()=>x(t)},{icon:a(()=>[s(e(ne))]),default:a(()=>[p(c(e(_)("groupDetail.exps.preview"))+" ",1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["class"])]),_:1},8,["style"]),s($t,{"page-info":e(I),"onUpdate:pageInfo":u[0]||(u[0]=t=>jt(I)?I.value=t:null),"page-sizes":[8,16,24],onUpdateList:O,class:"!pb-0"},null,8,["page-info"]),s(Xt,{ref_key:"expsTplRef",ref:P},null,512)]),_:1})]),_:1})]),_:1},8,["show"])}}}),Oe=Pt(he,[["__scopeId","data-v-f5fcd535"]]);export{Oe as default};
