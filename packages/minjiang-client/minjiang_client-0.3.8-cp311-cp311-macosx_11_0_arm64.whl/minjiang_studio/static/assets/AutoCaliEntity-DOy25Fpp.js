import{d as B,E as v,z as U,l as e,a8 as K,f as s,a2 as X,C as M,b as Z,r as l,J as ee,e as b,h as z,i as p,a7 as te,w as n,a9 as ae,ab as R,ac as j,s as se,t as ne,a6 as D,aa as oe,ad as le,M as G,ai as ue,aU as re,aY as ie,ak as $,o as ce,b5 as _e}from"./index-CvCv8tjC.js";import{d as de,e as pe}from"./autoCali-BpZAbNyW.js";import{_ as me,D as fe}from"./DotLoader-YrgY5m2V.js";import{u as ve}from"./useInterval-BHEiX-wJ.js";import{u as ge}from"./autoCali-BTqrD_5Q.js";import{a as F,b as J}from"./Tabs-CqcYRKXl.js";import"./dayjs.min-FWv0Sy9A.js";import"./Add-D6uUqg2u.js";import"./debounce-D4NDO7dG.js";const ye=B({__name:"EntityLog",props:{logs:{}},setup(N){return(r,i)=>e(K)(r.logs)?U("",!0):(s(),v(me,{key:0,logs:r.logs},null,8,["logs"]))}}),be={class:"flex ml-5"},q=120,he=B({__name:"EntitiesView",props:{entities:{}},setup(N){const r=ge(),i=X(),g=M(),{t:V}=Z(),c=l(),_=l(),t=l(0),I=l(),S=l(0),d=l(!1),u=l(),T=N,O=ee(()=>{const o=T.entities.length;return Array(o<q?q:o).fill(0).map((a,f)=>T.entities[f])}),Y=o=>{o&&(u.value||(u.value=!0,c.value=o,_.value=[],I.value=[],t.value=0,S.value=0,d.value=!0,h()))},h=async()=>{var f,x,y,C,E;d.value=!0;const[o,a]=await de({session_id:+g.query.session_id,entity:c.value,last_record_id:t.value});u.value=!1,!o&&(a==null?void 0:a.status)===0&&(t.value!==((f=a.data)==null?void 0:f.last_record_id)&&((x=a.data)!=null&&x.last_record_id)&&(_.value=[...(y=a.data)==null?void 0:y.logs.reverse(),..._.value||[]]),(C=a.data)!=null&&C.last_record_id&&(t.value=(E=a.data)==null?void 0:E.last_record_id),ie(()=>{var w,L;!A.value&&((w=r.sessionInfo)==null?void 0:w.status)===$.RUNNING&&H(),((L=r.sessionInfo)==null?void 0:L.status)!==$.RUNNING&&(P(),d.value=!1,A.value&&h())}))},{start:H,stop:P,runing:A}=ve(h,{isManual:!0,duration:3e3}),k=l(0),Q=o=>{k.value=o,c.value&&h()};return(o,a)=>{const f=le,x=ae,y=te,C=ue,E=re,w=J,L=F;return s(),b("div",be,[z("div",null,[p(y,{style:{height:"calc(100vh - 310px)"}},{default:n(()=>[p(x,{cols:10,style:{width:"560px"}},{default:n(()=>[(s(!0),b(R,null,j(e(O),(m,W)=>(s(),v(f,{key:W,class:oe(["border min-w-14 min-h-14 flex items-center justify-center p-1",[m?"cursor-pointer":""]]),style:D({borderColor:e(i).dividerColor,backgroundColor:e(c)===m&&e(c)?"#00B42A":"inherit",color:e(c)===m?"#fff":"inherit"}),onClick:()=>Y(m)},{default:n(()=>[se(ne(m),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),p(L,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(k),"onUpdate:value":a[0]||(a[0]=m=>G(k)?k.value=m:null),onUpdateValue:Q},{suffix:n(()=>[e(d)?(s(),v(fe,{key:0})):U("",!0)]),default:n(()=>[p(w,{name:0,key:"0",tab:e(V)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:n(()=>[p(y,{style:D({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(i).baseColor})},{default:n(()=>[e(u)?(s(),v(C,{key:0})):(s(),b(R,{key:1},[p(ye,{logs:e(_)},null,8,["logs"]),e(K)(e(_))?(s(),v(E,{key:0,class:"mt-32"})):U("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Se=B({__name:"AutoCaliEntity",setup(N){const r=M(),i=l(),g=l(),V=async()=>{const[_,t]=await pe({device_group_name:r.query.device_group_name,space_id:+r.query.space_id});!_&&(t==null?void 0:t.status)===0&&(g.value=t.data,i.value=Object.keys(t.data)[0])},c=()=>{};return ce(()=>{V()}),(_,t)=>{const I=J,S=F;return s(),b("div",null,[p(S,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(i),"onUpdate:value":t[0]||(t[0]=d=>G(i)?i.value=d:null),onUpdateValue:c,"tab-class":"w-[128px]"},_e({suffix:n(()=>[t[2]||(t[2]=z("div",null,null,-1))]),default:n(()=>[(s(!0),b(R,null,j(e(g),(d,u)=>(s(),v(I,{name:u,key:u,tab:u},{default:n(()=>[p(he,{"active-key":u,entities:d},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e(K)(e(g))?void 0:{name:"prefix",fn:n(()=>[t[1]||(t[1]=z("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Se as default};
