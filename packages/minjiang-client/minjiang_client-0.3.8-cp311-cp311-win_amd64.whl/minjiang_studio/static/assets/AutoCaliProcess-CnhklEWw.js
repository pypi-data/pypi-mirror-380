import{C as Y}from"./CommingSoon-BZ1lQaWI.js";import{d as $,e as f,f as r,h as y,a2 as H,b as Q,C as W,r as h,J as X,a4 as Z,a8 as j,aY as M,ak as ee,i as _,w as N,ab as P,ac as te,l as e,z as I,a6 as q,t as k,ae as se,af as x,s as B,j as ae,N as oe,a7 as re,E as L}from"./index-CvCv8tjC.js";import{b as le,c as ne}from"./autoCali-BpZAbNyW.js";import{u as F}from"./useInterval-BHEiX-wJ.js";import{D as ie,_ as ce}from"./DotLoader-YrgY5m2V.js";import"./dayjs.min-FWv0Sy9A.js";const de={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=$({name:"ChevronDown",render:function(T,m){return r(),f("svg",de,m[0]||(m[0]=[y("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),_e={class:"flex p-5 pb-0"},fe=["onClick"],me={class:"flex-1 break-all"},pe={key:0,class:"flex items-center justify-between pt-2"},ve={class:"flex flex-1 items-center flex-col"},ge={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Ce=$({__name:"AutoCaliProcess",setup(J){const T=H(),{t:m}=Q(),S=W(),w=h(),n=h(),l=X(()=>{var a;return(a=w.value)==null?void 0:a.find(o=>o.node_id===n.value)}),p=h(!0),i=h(),b=h(!1),v=h(0),C=async()=>{var d,u,g,c,s,R,U,V;p.value=!0;const a={node_id:n.value,session_id:+S.query.session_id,last_record_id:v.value},[o,t]=await le(a);b.value=!1,!o&&(t==null?void 0:t.status)===0&&(((u=(d=t.data)==null?void 0:d.logs)==null?void 0:u.find(z=>{if(typeof z.msg=="string")return z.msg.includes("COMPLETE")}))?(G(),p.value=!1,v.value!==t.data.last_record_id&&t.data.last_record_id&&(i.value=[...(g=t.data)==null?void 0:g.logs.reverse(),...i.value||[]]),t.data.last_record_id&&(v.value=t.data.last_record_id),((c=l.value)==null?void 0:c.status)==="RUNNING"&&A()):(v.value!==t.data.last_record_id&&t.data.last_record_id&&(i.value=[...(s=t.data)==null?void 0:s.logs.reverse(),...i.value||[]]),t.data.last_record_id&&(v.value=t.data.last_record_id),!D.value&&((R=l.value)==null?void 0:R.status)==="RUNNING"&&(E(),p.value=!0),((U=l.value)==null?void 0:U.status)!=="RUNNING"&&D.value&&(G(),C()),((V=l.value)==null?void 0:V.status)!=="RUNNING"&&(p.value=!1)))},A=async()=>{var t,d,u;const[a,o]=await ne({session_id:+S.query.session_id});!a&&(o==null?void 0:o.status)===0&&(w.value=o.data,(t=o.data)!=null&&t.find(c=>c.node_id===n.value)||(n.value=(d=o.data[0])==null?void 0:d.node_id,M(()=>{C()})),(u=o.data)!=null&&u.find(c=>c.status=="RUNNING")||K())},{start:E,stop:G,runing:D}=F(C,{isManual:!0,duration:3e3}),{stop:K}=F(A,{duration:10*1e3});Z(l,a=>{j(a)||M(()=>{a.status===ee.RUNNING&&!D.value&&(E(),p.value=!0)})});const O=a=>{b.value||(b.value=!0,i.value=void 0,n.value=a,v.value=0,C())};return(a,o)=>{const t=se,d=ae,u=oe,g=re,c=Y;return r(),f("div",_e,[y("div",null,[_(g,{style:{height:"calc(100vh - 335px)","padding-right":"40px"}},{default:N(()=>[(r(!0),f(P,null,te(e(w),(s,R)=>(r(),f("div",{key:s.node_id,class:"cursor-pointer"},[y("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:q({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(n)===s.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(n)===s.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(n)===s.node_id?e(T).primaryColor:"inherit"}),onClick:()=>O(s.node_id)},[y("span",me,k(s.node_name),1),_(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(x)[s.status].color}},{default:N(()=>[B(k(e(m)(e(x)[s.status].text)),1)]),_:2},1032,["color"])],12,fe),R<e(w).length-1?(r(),f("div",pe,[y("div",ve,[_(d,{class:"!h-10 !bg-[#999A9B]",vertical:""}),_(u,{class:"-mt-2",color:"#999A9B",component:e(ue)},null,8,["component"])]),_(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(x)[s.status].color}},{default:N(()=>[B(k(e(m)(e(x)[s.status].text)),1)]),_:2},1032,["color"])])):I("",!0)]))),128))]),_:1})]),y("div",{class:"border-l pl-10 flex-1",style:q({borderColor:e(T).dividerColor})},[_(g,{style:{height:"calc(100vh - 335px)"}},{default:N(()=>{var s;return[e(j)(e(l))?I("",!0):(r(),f("div",ge,[B(k((s=e(l))==null?void 0:s.node_name)+" ",1),_(t,{size:"tiny",color:{color:e(x)[e(l).status].color}},{default:N(()=>[B(k(e(m)(e(x)[e(l).status].text)),1)]),_:1},8,["color"]),e(p)?(r(),L(ie,{key:0})):I("",!0)])),Array.isArray(e(i))&&e(i).length===0?(r(),L(c,{key:1,class:"h-full"})):(r(),f(P,{key:2},[e(b)?I("",!0):(r(),L(ce,{key:0,logs:e(i)},null,8,["logs"]))],64))]}),_:1})],4)])}}});export{Ce as default};
