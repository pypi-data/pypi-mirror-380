import{d as C,b as R,r as f,E as $,f as I,L as E,l as e,M as N,w as l,i as a,k as j,h as b,m as z,n as A,p as G,B as P,s as S,t as T,v as Q,Q as w,c as W,C as X,R as F,S as H,T as J,N as K,U as O,V as Y,W as Z,X as ee}from"./index-CvCv8tjC.js";import{c as te,g as ae}from"./task-BzTCKWl0.js";import{u as se}from"./useInterval-BHEiX-wJ.js";import{u as oe}from"./groupDetail-NvvmkxSe.js";import{A as ne}from"./Add-DSV7m2CF.js";const le={class:"flex justify-end"},ie=C({__name:"CreateTask",emits:["success"],setup(U,{expose:n,emit:x}){const L=x,{t:i}=R(),h=oe(),_=f(!1),y=f(),s=f({title:void 0,description:void 0,space_name:void 0}),D={title:{required:!0,message:"groupDetail.taskList.taskTitleErrMsg"},description:{required:!0,message:"groupDetail.taskList.descErrMsg"},space_name:{required:!0,message:"groupDetail.taskList.idErrMsg"}},r=f(!1),v=()=>{r.value=!1,s.value={title:void 0,description:void 0,space_name:void 0}},u=t=>{t||v()},c=()=>{var t;_.value||(_.value=!0,(t=y.value)==null||t.validate(async o=>{var k;if(o){_.value=!1;return}const[g,p]=await te({...s.value,device_group_name:(k=h.groupInfo)==null?void 0:k.device_group_name});_.value=!1,!g&&p&&p.status===0&&(v(),L("success"))}))},d=t=>w("div",{class:"flex gap-3 items-baseline"},[w("div",{class:"text-base"},`${t.label}`),w("div",{class:"text-xs opacity-50"},`[${new Date(t.create_time).toLocaleString()}] ${t.description}`)]);return n({open:()=>r.value=!0,close:v}),(t,o)=>{const g=A,p=z,k=G,q=P,M=j,B=Q,V=E;return I(),$(V,{show:e(r),"onUpdate:show":o[3]||(o[3]=m=>N(r)?r.value=m:null),"on-update:show":u},{default:l(()=>[a(B,{style:{width:"600px"},size:"huge",bordered:!1,role:"dialog","aria-modal":"true"},{default:l(()=>[a(M,{ref_key:"formRef",ref:y,model:e(s),rules:D},{default:l(()=>[a(p,{label:e(i)("groupDetail.taskList.taskTitleLabel"),path:"title"},{default:l(()=>[a(g,{value:e(s).title,"onUpdate:value":o[0]||(o[0]=m=>e(s).title=m),placeholder:e(i)("groupDetail.taskList.taskTitlePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(i)("groupDetail.taskList.descLabel"),path:"description"},{default:l(()=>[a(g,{value:e(s).description,"onUpdate:value":o[1]||(o[1]=m=>e(s).description=m),placeholder:e(i)("groupDetail.taskList.descPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(i)("groupDetail.taskList.spaceLabel"),path:"space_name"},{default:l(()=>[a(k,{value:e(s).space_name,"onUpdate:value":o[2]||(o[2]=m=>e(s).space_name=m),placeholder:e(i)("groupDetail.taskList.spacePlaceholder"),options:e(h).spaceList,"render-label":d},null,8,["value","placeholder","options"])]),_:1},8,["label"]),b("div",le,[a(q,{type:"primary",loading:e(_),onClick:c},{default:l(()=>[S(T(e(i)("groupDetail.taskList.createTask")),1)]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),re={class:"flex justify-between items-center gap-5 mb-5"},ue={class:"text-xl"},fe=C({__name:"TaskList",setup(U){const{t:n}=R(),x=W(),L=X(),i=f(),h=f(),_=[{title:n("groupDetail.taskList.id"),key:"task_id",width:100},{title:n("groupDetail.taskList.title"),key:"title"},{title:n("groupDetail.taskList.description"),key:"description"},{title:n("groupDetail.taskList.spaceName"),key:"space_name"},{title:n("groupDetail.taskList.source"),key:"source",width:100},{title:n("groupDetail.taskList.createTime"),key:"create_time",width:180},{title:n("createuser"),key:"user_name"},{title:n("groupDetail.taskList.progress"),key:"progress"}],y=({task_id:u,title:c,space_id:d})=>({class:"cursor-pointer",onClick:()=>{x.push({name:"experimentList",query:{task_id:u,task_title:c,space_id:d,...L.query}})}}),s=F({page:1,per_page:H,total:0}),D=f(),r=async(u={})=>{var o;const c=L.query.device_group_name;if(!c)return;const[d,t]=await ae({...((o=h.value)==null?void 0:o.searchParasm)||{},...u,...ee(s),device_group_name:c});!d&&t&&t.status===0&&(D.value=t.data.list,s.total=t.data.total)},v=()=>{var u;(u=i.value)==null||u.open()};return se(r),(u,c)=>{const d=K,t=P,o=O,g=J,p=Z;return I(),$(p,{"has-sider":""},{default:l(()=>[a(g,null,{default:l(()=>[b("div",re,[b("div",ue,T(e(n)("groupDetail.taskList.tabName")),1),b("div",null,[a(t,{type:"primary",onClick:v},{icon:l(()=>[a(d,null,{default:l(()=>[a(e(ne))]),_:1})]),default:l(()=>[S(" "+T(e(n)("groupDetail.taskList.createTask")),1)]),_:1})])]),a(o,{columns:_,data:e(D),pagination:!1,"row-props":y,"max-height":"calc(100vh - 400px)"},null,8,["data"]),a(Y,{"page-info":e(s),"onUpdate:pageInfo":c[0]||(c[0]=k=>N(s)?s.value=k:null),onUpdateList:r},null,8,["page-info"]),a(ie,{ref_key:"createTaskRef",ref:i,onSuccess:r},null,512)]),_:1})]),_:1})}}});export{fe as default};
