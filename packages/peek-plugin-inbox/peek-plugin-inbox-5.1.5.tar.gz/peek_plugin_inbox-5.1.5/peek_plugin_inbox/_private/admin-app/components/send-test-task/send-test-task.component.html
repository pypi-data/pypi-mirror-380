
<nz-card class="task-form-card">
    <form nz-form nzLayout="vertical">
        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzFor="uniqueId">Unique ID</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="uniqueId"
                            [ngModel]="(task$ | async)?.uniqueId"
                            (ngModelChange)="handleFormUpdate('uniqueId', $event)"
                            name="uniqueId"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzFor="userId">User ID</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="userId"
                            [ngModel]="(task$ | async)?.userId"
                            (ngModelChange)="handleFormUpdate('userId', $event)"
                            name="userId"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzFor="displayAs">Display As</nz-form-label>
                    <nz-form-control>
                        <nz-select
                            id="displayAs"
                            [ngModel]="(task$ | async)?.displayAs"
                            (ngModelChange)="handleFormUpdate('displayAs', $event)"
                            name="displayAs"
                        >
                            <nz-option [nzValue]="DisplayAs.TASK" nzLabel="DISPLAY_AS_TASK"></nz-option>
                            <nz-option [nzValue]="DisplayAs.MESSAGE" nzLabel="DISPLAY_AS_MESSAGE"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="title">Title</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="title"
                            [ngModel]="(task$ | async)?.title"
                            (ngModelChange)="handleFormUpdate('title', $event)"
                            name="title"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="iconPath">Icon Path</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="iconPath"
                            [ngModel]="(task$ | async)?.iconPath"
                            (ngModelChange)="handleFormUpdate('iconPath', $event)"
                            name="iconPath"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <nz-form-item>
            <nz-form-label nzFor="description">Description</nz-form-label>
            <nz-form-control>
                <input 
                    nz-input 
                    id="description"
                    [ngModel]="(task$ | async)?.description"
                    (ngModelChange)="handleFormUpdate('description', $event)"
                    name="description"
                />
            </nz-form-control>
        </nz-form-item>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="routePath">Route Path</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="routePath"
                            [ngModel]="(task$ | async)?.routePath"
                            (ngModelChange)="handleFormUpdate('routePath', $event)"
                            name="routePath"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="routeParamJson">Route Param JSON</nz-form-label>
                    <nz-form-control>
                        <input 
                            nz-input 
                            id="routeParamJson"
                            [ngModel]="(task$ | async)?.routeParamJson"
                            (ngModelChange)="handleFormUpdate('routeParamJson', $event)"
                            name="routeParamJson"
                        />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="autoComplete">Auto Complete</nz-form-label>
                    <nz-form-control>
                        <nz-select
                            id="autoComplete"
                            [ngModel]="(task$ | async)?.autoComplete"
                            (ngModelChange)="handleFormUpdate('autoComplete', $event)"
                            name="autoComplete"
                        >
                            <nz-option [nzValue]="AutoComplete.OFF" nzLabel="AUTO_COMPLETE_OFF"></nz-option>
                            <nz-option [nzValue]="AutoComplete.ON_DELIVER" nzLabel="AUTO_COMPLETE_ON_DELIVER"></nz-option>
                            <nz-option [nzValue]="AutoComplete.ON_SELECT" nzLabel="AUTO_COMPLETE_ON_SELECT"></nz-option>
                            <nz-option [nzValue]="AutoComplete.ON_ACTION" nzLabel="AUTO_COMPLETE_ON_ACTION"></nz-option>
                            <nz-option [nzValue]="AutoComplete.ON_DIALOG" nzLabel="AUTO_COMPLETE_ON_DIALOG"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label nzFor="autoDelete">Auto Delete</nz-form-label>
                    <nz-form-control>
                        <nz-select
                            id="autoDelete"
                            [ngModel]="(task$ | async)?.autoDelete"
                            (ngModelChange)="handleFormUpdate('autoDelete', $event)"
                            name="autoDelete"
                        >
                            <nz-option [nzValue]="AutoDelete.OFF" nzLabel="AUTO_DELETE_OFF"></nz-option>
                            <nz-option [nzValue]="AutoDelete.ON_DELIVER" nzLabel="AUTO_DELETE_ON_DELIVER"></nz-option>
                            <nz-option [nzValue]="AutoDelete.ON_SELECT" nzLabel="AUTO_DELETE_ON_SELECT"></nz-option>
                            <nz-option [nzValue]="AutoDelete.ON_ACTION" nzLabel="AUTO_DELETE_ON_ACTION"></nz-option>
                            <nz-option [nzValue]="AutoDelete.ON_COMPLETE" nzLabel="AUTO_DELETE_ON_COMPLETE"></nz-option>
                            <nz-option [nzValue]="AutoDelete.ON_DIALOG" nzLabel="AUTO_DELETE_ON_DIALOG"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <nz-form-item>
            <nz-form-label nzFor="autoDeleteDateTime">Auto Delete Date/Time</nz-form-label>
            <nz-form-control>
                <nz-date-picker
                    id="autoDeleteDateTime"
                    [nzShowTime]="true"
                    [ngModel]="(task$ | async)?.autoDeleteDateTime"
                    (ngModelChange)="handleFormUpdate('autoDeleteDateTime', $event)"
                    name="autoDeleteDateTime"
                >
                </nz-date-picker>
            </nz-form-control>
        </nz-form-item>

        <div class="notification-methods">
            <h4>Notification Methods</h4>
            <div nz-row [nzGutter]="16">
                <div nz-col [nzSpan]="4">
                    <label nz-checkbox
                        [ngModel]="(task$ | async)?.notifyByPopup"
                        (ngModelChange)="handleFormUpdate('notifyByPopup', $event)"
                        name="notifyByPopup">
                        Popup
                    </label>
                </div>
                <div nz-col [nzSpan]="4">
                    <label nz-checkbox
                        [ngModel]="(task$ | async)?.notifyByDialog"
                        (ngModelChange)="handleFormUpdate('notifyByDialog', $event)"
                        name="notifyByDialog">
                        Dialog
                    </label>
                </div>
                <div nz-col [nzSpan]="4">
                    <label nz-checkbox
                        [ngModel]="(task$ | async)?.notifyBySound"
                        (ngModelChange)="handleFormUpdate('notifyBySound', $event)"
                        name="notifyBySound">
                        Sound
                    </label>
                </div>
                <div nz-col [nzSpan]="4">
                    <label nz-checkbox
                        [ngModel]="(task$ | async)?.notifyBySms"
                        (ngModelChange)="handleFormUpdate('notifyBySms', $event)"
                        name="notifyBySms">
                        SMS
                    </label>
                </div>
                <div nz-col [nzSpan]="4">
                    <label nz-checkbox
                        [ngModel]="(task$ | async)?.notifyByEmail"
                        (ngModelChange)="handleFormUpdate('notifyByEmail', $event)"
                        name="notifyByEmail">
                        Email
                    </label>
                </div>
            </div>
        </div>

        <div class="actions-section">
            <button nz-button (click)="handleAddAction()" class="add-action-button">
                Add Action
            </button>
            
            <div *ngFor="let action of (task$ | async)?.actions; let i = index" class="action-item">
                <h4>Action {{ i }}</h4>
                <div nz-row [nzGutter]="16">
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <nz-form-label>Action Title</nz-form-label>
                            <nz-form-control>
                                <input 
                                    nz-input
                                    [ngModel]="action.title"
                                    (ngModelChange)="handleActionUpdate(i, 'title', $event)"
                                    [name]="'actionTitle' + i"
                                />
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzSpan]="12">
                        <nz-form-item>
                            <nz-form-label>Action Confirm Message</nz-form-label>
                            <nz-form-control>
                                <input 
                                    nz-input
                                    [ngModel]="action.confirmMessage"
                                    (ngModelChange)="handleActionUpdate(i, 'confirmMessage', $event)"
                                    [name]="'actionConfirmMessage' + i"
                                />
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
            </div>
        </div>

        <div class="button-container">
            <button nz-button nzType="primary" (click)="handleSend()">Send</button>
        </div>
    </form>
</nz-card>