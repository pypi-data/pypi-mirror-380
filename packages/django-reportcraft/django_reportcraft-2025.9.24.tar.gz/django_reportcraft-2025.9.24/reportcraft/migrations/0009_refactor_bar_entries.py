# Generated by Django 5.2.4 on 2025-08-18 15:09

from django.db import migrations


def refactor_bar_entries(apps, schema_editor):
    """
    This migration is a placeholder for refactoring bar entries.
    """

    Entry = apps.get_model('reportcraft', 'Entry')
    to_update = Entry.objects.filter(kind__in=['bars', 'columns'])
    for entry in to_update:
        old_attrs = {**entry.attrs}
        entry.attrs = {}
        if 'x_axis' in old_attrs:
            entry.attrs['categories'] = old_attrs['x_axis']
        if 'y_value' in old_attrs:
            entry.attrs['values'] = [old_attrs['y_value']]
        if old_attrs.get('stack'):
            entry.attrs['stack'] = True
        if old_attrs.get('colors'):
            entry.attrs['scheme'] = old_attrs['colors']
        if old_attrs.get('y_axis'):
            entry.attrs['group_by'] = old_attrs['y_axis'][0],

    Entry.objects.bulk_update(to_update, ['attrs'])


class Migration(migrations.Migration):

    dependencies = [
        ('reportcraft', '0008_alter_report_section'),
    ]

    operations = [
        migrations.RunPython(refactor_bar_entries, reverse_code=migrations.RunPython.noop),
    ]
