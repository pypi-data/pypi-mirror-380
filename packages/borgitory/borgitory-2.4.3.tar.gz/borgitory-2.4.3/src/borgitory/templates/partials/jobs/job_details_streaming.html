{# Streaming job details for running jobs using HTMX SSE #}
<div class="border-t dark:border-gray-600 bg-gray-50 dark:bg-gray-700 p-4" 
     hx-ext="sse" 
     sse-connect="/api/jobs/{{ job.id }}/stream">
    
    <div class="space-y-3">
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <span class="font-medium text-gray-700 dark:text-gray-300">Type:</span>
                <span class="ml-2 text-gray-900 dark:text-gray-100">{{ job.type }}</span>
            </div>
            <div>
                <span class="font-medium text-gray-700 dark:text-gray-300">Repository:</span>
                <span class="ml-2 text-gray-900 dark:text-gray-100">{{ repository_name }}</span>
            </div>
            <div>
                <span class="font-medium text-gray-700 dark:text-gray-300">Started:</span>
                <span class="ml-2 text-gray-900 dark:text-gray-100">{{ started_at }}</span>
            </div>
            <div>
                <span class="font-medium text-gray-700 dark:text-gray-300">Status:</span>
                <span class="ml-2 text-gray-900 dark:text-gray-100" sse-swap="status">{{ job.status.title() }}</span>
            </div>
        </div>
        {# Composite job with streaming tasks #}
        <div class="mt-4">
            <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-3">Tasks:</h4>
            <div class="space-y-2" id="tasks-container-{{ job.id }}" sse-swap="tasks">
                {% for task in sorted_tasks %}
                    {% set task_expanded = false %}
                    {% include 'partials/jobs/task_item_streaming.html' %}
                {% endfor %}
            </div>
        </div>
    </div>
    
    {# Auto-refresh to static view when job completes #}
    <div style="display: none;" 
         hx-get="/api/jobs/{{ job.id }}/details-static" 
         hx-target="#job-details-{{ job.id }}" 
         hx-swap="innerHTML"
         hx-trigger="sse:complete"
         sse-swap="complete">
    </div>
</div>