<!-- Repository Import Form -->
<div>
    <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Repository Import Form</h4>
    
    <!-- Status div for responses -->
    <div id="import-form-status"></div>
    
    <form 
        hx-post="/api/repositories/import" 
        hx-encoding="multipart/form-data"
        hx-target="#import-form-status" 
        hx-swap="innerHTML"
        hx-indicator="#import-loading"
    >
    <div class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-100">Name (for this app)</label>
            <input type="text" name="name" required class="input-modern mt-1">
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-100">Repository Path</label>
            <input type="text" name="path" required 
                   {% if path %}value="{{ path }}"{% endif %}
                   class="input-modern mt-1"
                   readonly>
        </div>
        
        <!-- Encryption Type -->
        <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-100">Encryption Type</label>
            <select name="encryption_type" id="encryption-type-select" class="select-modern w-full mt-1"
                    onchange="toggleKeyfileContent()" required>
                <option value="">Please select encryption type...</option>
                <option value="none">None (unencrypted)</option>
                <option value="repokey">Repokey (passphrase only)</option>
                <option value="keyfile">Keyfile (requires keyfile content)</option>
            </select>
        </div>
        
        <!-- Passphrase field (shown/hidden by JavaScript) -->
        <div id="passphrase-field" class="hidden">
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-100">Passphrase</label>
            <input type="password" name="passphrase" class="input-modern mt-1">
        </div>
        
        <!-- Keyfile content field (shown/hidden by JavaScript) -->
        <div id="keyfile-content-field" class="hidden">
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-100">Keyfile Content</label>
            <textarea name="keyfile_content" rows="8" 
                      class="input-modern mt-1 font-mono text-sm"
                      placeholder="Paste your keyfile content here..."></textarea>
            <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Paste the entire content of your Borg keyfile here. This will be stored encrypted in the database.</p>
        </div>
        
        <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 flex items-center justify-center">
            Import Repository
        </button>
        
        <!-- HTMX Loading Indicator -->
        <div id="import-loading" class="[&.htmx-request]:flex hidden items-center justify-center text-sm text-gray-700 dark:text-gray-300 mt-2">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
            Importing repository...
        </div>
        </div>
    </form>
</div>

<script>
function toggleKeyfileContent() {
    const select = document.getElementById('encryption-type-select');
    const keyfileField = document.getElementById('keyfile-content-field');
    const passphraseField = document.getElementById('passphrase-field');
    
    if (select) {
        const selectedType = select.value;
        
        // Show/hide keyfile field
        if (keyfileField) {
            if (selectedType === 'keyfile') {
                keyfileField.classList.remove('hidden');
            } else {
                keyfileField.classList.add('hidden');
            }
        }
        
        // Show/hide passphrase field
        if (passphraseField) {
            if (selectedType === 'repokey' || selectedType === 'keyfile') {
                passphraseField.classList.remove('hidden');
            } else {
                passphraseField.classList.add('hidden');
            }
        }
    }
}
</script>